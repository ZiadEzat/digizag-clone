"use strict";!function(a){a.Routes={"/performance":{templateUrl:"partials/performance.html",controller:"Controllers.reports",mobileTemplateUrl:"partials/mobile/performance.html",bodyClass:"performance",pageTitle:"Performance Report",permissions:["stats"]},"/performance/default":{templateUrl:"partials/performance.html",controller:"Controllers.reports",bodyClass:"performance",pageTitle:"Performance Report"},"/performanceDetail/:entity/:id":{templateUrl:"partials/performanceDetail.html",controller:"Controllers.reports",bodyClass:"performance",pageTitle:"Performance Detail Report",permissions:["stats"]},"/conversion":{templateUrl:"partials/logs.html",mobileTemplateUrl:"partials/mobile/logs.html",controller:"Controllers.reports",bodyClass:"performance conversion",pageTitle:"Conversion Report",permissions:["stats"],restrictOnFeatures:["PREMIUM_PARTNER_INSTANCE"]},"/network-conversion-report":{templateUrl:"partials/tuneNetwork/reports/conversionReport.html",mobileTemplateUrl:"partials/tuneNetwork/reports/conversionReportMobile.html",controller:"Controllers.conversionReport",bodyClass:"performance conversion",pageTitle:"Conversion Report",permissions:["stats"],features:["PREMIUM_PARTNER_INSTANCE"]},"/network-brand-report":{templateUrl:"partials/tuneNetwork/reports/brandReport.html",mobileTemplateUrl:"partials/tuneNetwork/reports/brandReportMobile.html",controller:"Controllers.brandReport",bodyClass:"performance conversion",pageTitle:"Brand Report",permissions:["stats"],features:["PREMIUM_PARTNER_INSTANCE"]},"/conversion/default":{templateUrl:"partials/logs.html",controller:"Controllers.reports",bodyClass:"performance",pageTitle:"Conversion Report",permissions:["stats"]},"/referral":{templateUrl:"partials/reporting/referralReport.html",controller:"Controllers.referralReport",bodyClass:"referral",pageTitle:"Referral Report",permissions:["stats"],preferences:{referral_commissions:!0},reloadOnSearch:!1},"/offers":{templateUrl:"js/application/offers/partials/offers.html",mobileTemplateUrl:"js/application/offers/partials/offersMobile.html",controller:"Controllers.offers",bodyClass:"offers",pageTitle:"Offers",permissions:["offer_management"],reloadOnSearch:!1,restrictOnFeatures:["PREMIUM_PARTNER_INSTANCE"]},"/tuneNetwork/offers":{mobileTemplateUrl:"js/application/offers/partials/tune-network-offers-mobile.html",templateUrl:"js/application/offers/partials/tune-network-offers.html",controller:"Controllers.tuneNetworkOffers",pageTitle:"Tune Network Offers",permissions:["offer_management"],bodyClass:"offers tune-network-offers",reloadOnSearch:!1,features:["PREMIUM_PARTNER_INSTANCE"]},"/scheduled/changes":{templateUrl:"js/application/offers/partials/scheduled-offer-changes.html",controller:"Controllers.scheduledOfferChanges",pageTitle:"Scheduled Offer Changes",permissions:["offer_management"],preferences:{enable_scheduled_offer_changes:!0},restrictOnFeatures:["PREMIUM_PARTNER_INSTANCE"]},"/offers/:context":{templateUrl:"js/application/offers/partials/offers.html",mobileTemplateUrl:"js/application/offers/partials/offersMobile.html",controller:"Controllers.offers",bodyClass:"offers",pageTitle:"My Offers",permissions:["offer_management"],reloadOnSearch:!1,restrictOnFeatures:["PREMIUM_PARTNER_INSTANCE"]},"/offer/:offer_id":{templateUrl:"js/application/offers/partials/offer-single.html",mobileTemplateUrl:"js/application/offers/partials/offer-single.html",controller:"Controllers.offerDetail",pageTitle:"Offer Details",bodyClass:"offerDetails",permissions:["offer_management"],reloadOnSearch:!1},"/dashboard":{templateUrl:"js/application/dashboard/partials/dashboard.html",controller:"Controllers.dashboard",bodyClass:"dashboard",pageTitle:"Summary Report"},"/savedReports":{templateUrl:"partials/reporting/saved-reports.html",bodyClass:"savedReports",controller:"Controllers.savedReports",pageTitle:"Saved Reports",permissions:["stats"]},"/savedReport/stats/:id":{templateUrl:"partials/performance.html",controller:"Controllers.reports",bodyClass:"performance",pageTitle:"Saved Performance Report",permissions:["stats"]},"/savedReport/conversions/:id":{templateUrl:"partials/logs.html",controller:"Controllers.reports",bodyClass:"performance",pageTitle:"Saved Conversion Report",permissions:["stats"]},"/messages":{templateUrl:"partials/messages.html",mobileTemplateUrl:"partials/messages.html",controller:"Controllers.messages",bodyClass:"messages",pageTitle:"Inbox"},"/message/:message_id":{templateUrl:"partials/message-single.html",controller:"Controllers.messages",bodyClass:"message",pageTitle:"Subject"},"/billing":{templateUrl:"partials/billing.html",mobileTemplateUrl:"partials/billing.html",controller:"Controllers.billing",bodyClass:"billing",pageTitle:"Billing",preferences:{enable_affiliate_billing:!0}},"/settings":{templateUrl:"partials/settings.html",mobileTemplateUrl:"partials/settings.html",controller:"Controllers.settings",bodyClass:"settings",pageTitle:"Settings"},"/unsubscribe":{templateUrl:"partials/unsubscribe.html",mobileTemplateUrl:"partials/unsubscribe.html",controller:"Controllers.unsubscribe",bodyClass:"settings",pageTitle:"Unsubscribe Alerts"},"/invoice/:id":{templateUrl:"partials/invoice.html",controller:"Controllers.invoice",bodyClass:"invoice",pageTitle:"Invoice",preferences:{enable_affiliate_billing:!0}},"/receipt/:id":{templateUrl:"partials/receipt.html",controller:"Controllers.receipt",bodyClass:"receipt",pageTitle:"Payment",preferences:{enable_affiliate_billing:!0,disable_payment_reconciliation:!1}},"/account":{templateUrl:"partials/account.html",mobileTemplateUrl:"partials/account.html",controller:"Controllers.account",bodyClass:"account",pageTitle:"My Account"},"/account/:id":{templateUrl:"partials/account.html",controller:"Controllers.account",bodyClass:"account",pageTitle:"View Account"},"/tools/pixels":{templateUrl:"partials/tools/pixels/pixels.html",mobileTemplateUrl:"partials/tools/pixels/pixels.html",controller:"Controllers.pixelPostback",pageTitle:"Pixels",bodyClass:"tools-pixels"},"/tools/adgroups":{templateUrl:"js/application/adGroups/partials/adgroups.html",mobileController:"Controllers.adGroups",controller:"Controllers.adGroups",bodyClass:"adgroups",pageTitle:"Ad Groups"},"/tools/adgroups/:id":{templateUrl:"js/application/adGroups/partials/adgroup-single.html",controller:"Controllers.adGroupDetail",bodyClass:"adgroupdetails",pageTitle:"Ad Group Details"},"/tools/adgroup/create":{templateUrl:"js/application/adGroups/partials/adgroup-create.html",controller:"Controllers.adGroupForm",bodyClass:"createadgroup",pageTitle:"Create Ad Group"},"/tools/api-key":{templateUrl:"js/application/apiKey/partials/apiKey.html",controller:"Controllers.apiKey",pageTitle:"API V3",bodyClass:"tools-apis",permissions:["API"]},"/tools/mobileapp":{templateUrl:"js/application/mobileApp/partials/mobileApp.html",controller:"Controllers.mobileApp",pageTitle:"Mobile App",bodyClass:"mobileApp",features:["AFFMOHO"]},"/page/:id":{templateUrl:"js/application/customPage/partials/template.html",controller:"Controllers.customPage",bodyClass:"custom-page",pageTitle:"",permissions:[]},"/terms":{templateUrl:"js/application/terms/partials/terms.html",controller:"Controllers.terms",bodyClass:"custom-page",pageTitle:"Terms of Service",restrictOnFeatures:["PREMIUM_PARTNER_INSTANCE"]},"/privacy_policy":{templateUrl:"js/application/privacyPolicy/partials/privacyPolicy.html",controller:"Controllers.privacyPolicy",bodyClass:"custom-page",pageTitle:"Privacy Policy",restrictOnFeatures:["PREMIUM_PARTNER_INSTANCE"]},"/start_page":{templateUrl:"js/application/customPage/partials/template.html",controller:"Controllers.startPage",bodyClass:"custom-page",pageTitle:"Loading Start Page"},"/tune_network":{templateUrl:"partials/tuneNetwork/tuneNetwork.html",controller:"Controllers.tune_network",bodyClass:"tune-network-page",pageTitle:"TUNE Network",features:["PREMIUM_PARTNER_INSTANCE","CORE1104_TUNENETWORK_DIRECTORY"]},"/tune_network/manage_profile":{templateUrl:"partials/tuneNetwork/tuneNetworkProfile.html",controller:"Controllers.tune_network_profile",bodyClass:"tune-network-profile-page",pageTitle:"TUNE Network Profile",features:["NETWORK_PARTNER_PROFILE","PREMIUM_PARTNER_INSTANCE"]},"/tune_network/connection_request":{templateUrl:"partials/tuneNetwork/tuneNetworkConnectionRequest.html",controller:"Controllers.tune_network_connection_request",bodyClass:"tune-network-connection-request",pageTitle:"TUNE Network Connection Request",features:["PARTNERS_MANAGE_BRAND_REQUESTS","PREMIUM_PARTNER_INSTANCE"]}}}(this),function(a){var b=function(b,c){return{get:function(c,d,e,f){var g,h,i=this,j=c.split("/");if(2!==j.length)throw new Error("Invalid API method "+c);var k=a.Config.api_endpoint+"Affiliate_"+j[0]+".json";return d=d||{},d.Method=j[1],d.NetworkId=f?f:a.Config.api_network_id,e?d.api_key=e:d.SessionToken=a.Config.session_token,d=this.filterParams(d),g=b.post(k,d),h={method:c,url:this.generateURL(c,d),params:JSON.stringify(d,null,2),status:"",data:{},time:moment().format("h:mm:ss"),duration:moment(),uid:i.logger.uid++},i.logRequest(h,"progress",{}),g.then(function(a){i.logRequest(h,"success",JSON.stringify(a,null,2))},function(a){i.logRequest(h,"error",JSON.stringify(a,null,2))}),g},postFile:function(c,d){var e,f,g=this,h=c.split("/");if(2!==h.length)throw new Error("Invalid API method "+c);var i=a.Config.api_endpoint+"Affiliate_"+h[0]+".json",j={};return j.Method=h[1],j.NetworkId=a.Config.api_network_id,j.SessionToken=a.Config.session_token,j=this.filterParams(j),e=b({method:"POST",params:j,url:i,processData:!1,data:{file:d},transformRequest:function(a,b){var c=new FormData;angular.forEach(a,function(a,b){c.append(b,a)});var d=b();return delete d["Content-Type"],c}}),f={method:c,url:this.generateURL(c,j),params:JSON.stringify(j,null,2),status:"",data:{file:d},time:moment().format("h:mm:ss"),duration:moment(),uid:g.logger.uid++},g.logRequest(f,"progress",{}),e.then(function(a){g.logRequest(f,"success",JSON.stringify(a,null,2))},function(a){g.logRequest(f,"error",JSON.stringify(a,null,2))}),e},getPartnerCraftV4:function(c,d){var e,f,g=this,h=Object.keys(d).reduce(function(a,b,c){var e="&";return 0===c&&(e=""),a+e+b+"="+d[b]},"?"),i=a.Config.api_v4_path+"/v4"+c+h;return e=b({method:"GET",url:i,headers:{Authorization:"Bearer "+a.Config.partner_token,"Content-Type":"application/json; charset=utf-8"}}),f={method:i,url:"",params:JSON.stringify(d,null,2),status:"",data:{},time:moment().format("h:mm:ss"),duration:moment(),uid:g.logger.uid++},g.logRequest(f,"progress",{}),e.then(function(a){g.logRequest(f,"success",JSON.stringify(a,null,2))},function(a){g.logRequest(f,"error",JSON.stringify(a,null,2))}),e},logRequest:function(a,b,d){a=_.clone(a),a.status=b,a.data=d,a.duration=-1*a.duration.diff();var e=this;c(function(){e.logger.logRequest(a.uid,a)})},generateURL:function(b,c){var d=b.split("/"),e=a.Config.api_endpoint;if(2!==d.length)throw new Error("Invalid API method "+b);return c=_.clone(c)||{},c.Method=d[1],e+="Affiliate_"+d[0]+".json",c.NetworkId||(c.NetworkId=a.Config.api_network_id),c.api_key||c.SessionToken||(c.SessionToken=a.Config.session_token),c&&(c=this.filterParams(c),_.size(c)>0&&(e+="?"+$.param(c))),e},filterParams:function(a){var b={};return _.each(a,function(a,c){!a&&0!==a&&a!==!1||_.isFunction(a)||(b[c]=a)}),b},getZenithConnect:function(a,c){return b({method:"GET",params:c,url:"http://localhost:3000/"+a})},logger:new a.ApiLogger}};a.Application.service("api",["$http","$timeout",function(c,d){return a.Api=new b(c,d)}])}(this),window.log=function(){log.history=log.history||[],log.history.push(arguments),this.console&&console.log(Array.prototype.slice.call(arguments))},function(){var a=function(a,b){if(!_.isString(a))throw new TypeError("template passed to _.format should be a String");if(!_.isObject(b)&&!_.isArray(b))throw new TypeError("data passed to _.format should be an Object or an Array");var c=new RegExp(/(?![\{])(?:[\s\w]+)(?=\})/g),d=a.match(c),e=a;return _.each(d,function(a){var c=a.trim();(!_.has(b,c)||_.isUndefined(b[c])||_.isNull(b[c]))&&(b[c]=""),e=e.replace("{"+a+"}",b[c])}),e},b=function(a){var b=_.rest(_.toArray(arguments));1===b.length&&(b=b[0].split("."));for(var c=a;b.length;){var d=b.shift();if(!_.isObject(c)&&!_.isArray(c)||!_.contains(_.keys(c),String(d)))return!1;c=c[d]}return!0},c=function(a,b){return b?_.hasMembers(a,b)?_.reduce(b.split("."),function(a,b){return a[b]},a):void 0:a},d=function(a){var b=[];return this.each(a,function(a,c){a&&(b[b.length]=c)}),b};_.mixin({format:a,hasMembers:b,getDeepMember:c,filterSelected:d})}(),String.prototype.endsWith=function(a){return-1!==this.indexOf(a,this.length-a.length)},function($){function a(a){return"object"==typeof a?a:{top:a,left:a}}var b=$.scrollTo=function(a,b,c){$(window).scrollTo(a,b,c)};b.defaults={axis:"xy",duration:parseFloat($.fn.jquery)>=1.3?0:1},b.window=function(){return $(window)._scrollable()},$.fn._scrollable=function(){return this.map(function(){var a=this,b=!a.nodeName||-1!=$.inArray(a.nodeName.toLowerCase(),["iframe","#document","html","body"]);if(!b)return a;var c=(a.contentWindow||a).document||a.ownerDocument||a;return $.browser.safari||"BackCompat"==c.compatMode?c.body:c.documentElement})},$.fn.scrollTo=function(c,d,e){return"object"==typeof d&&(e=d,d=0),"function"==typeof e&&(e={onAfter:e}),"max"==c&&(c=9e9),e=$.extend({},b.defaults,e),d=d||e.speed||e.duration,e.queue=e.queue&&e.axis.length>1,e.queue&&(d/=2),e.offset=a(e.offset),e.over=a(e.over),this._scrollable().each(function(){function f(a){i.animate(k,d,e.easing,a&&function(){a.call(this,c,e)})}var g,h=this,i=$(h),j=c,k={},l=i.is("html,body"),m=!0;("number"==typeof j||"string"==typeof j)&&(/^([+\-]=)?\d+(\.\d+)?(px|%)?$/.test(j)?(j=a(j),m=!1):j=$(j,this)),m&&(j.is||j.style)&&(g=(j=$(j)).offset()),$.each(e.axis.split(""),function(a,c){var d="x"==c?"Left":"Top",m=d.toLowerCase(),n="scroll"+d,o=h[n],p=b.max(h,c);if(g)k[n]=g[m]+(l?0:o-i.offset()[m]),e.margin&&(k[n]-=parseInt(j.css("margin"+d),10)||0,k[n]-=parseInt(j.css("border"+d+"Width"),10)||0),k[n]+=e.offset[m]||0,e.over[m]&&(k[n]+=j["x"==c?"width":"height"]()*e.over[m]);else{var q=j[m];k[n]=q.slice&&"%"==q.slice(-1)?parseFloat(q)/100*p:q}/^\d+$/.test(k[n])&&(k[n]=k[n]<=0?0:Math.min(k[n],p)),!a&&e.queue&&(o!=k[n]&&f(e.onAfterFirst),delete k[n])}),f(e.onAfter)}).end()},b.max=function(a,b){var c="x"==b?"Width":"Height",d="scroll"+c;if(!$(a).is("html,body"))return a[d]-$(a)[c.toLowerCase()]();var e="client"+c,f=a.ownerDocument.documentElement,g=a.ownerDocument.body;return Math.max(f[d],g[d])-Math.min(f[e],g[e])}}(jQuery),function(){var a=["HelveticaNeue-Light","Helvetica Neue Light","Helvetica Neue","Source Sans Pro","Helvetica","Arial","Lucida Grande","sans-serif"].join(", "),b={plotBackgroundColor:"#ffffff",alternateGridColor:"#f7f7f7",lineColor:"#f0f0f0",textColor:"#999999",textColorAlt:"#333333",series_color_1:"#2585c7",series_color_2:"#ed6400",series_color_3:"#66bc29",series_color_4:"#9900cc",series_color_5:"#003399",series_color_6:"#33cc99",series_color_7:"#990066",series_color_8:"#ffcc00",series_color_9:"#ff0099",series_color_10:"#66ccff"};window.Highcharts.theme={colors:[b.series_color_1,b.series_color_2,b.series_color_3,b.series_color_4,b.series_color_5,b.series_color_6,b.series_color_7,b.series_color_8,b.series_color_9,b.series_color_10],chart:{borderWidth:0,plotBackgroundColor:b.plotBackgroundColor,plotShadow:!1,plotBorderWidth:0,backgroundColor:"transparent"},xAxis:{gridLineWidth:1,gridLineColor:b.lineColor,alternateGridColor:b.alternateGridColor,labels:{style:{color:b.textColor,fontSize:"11px",fontFamily:a}},lineColor:b.lineColor,tickColor:b.lineColor,title:{title:"",style:{color:b.textColorAlt,fontWeight:"bold",fontSize:"12px",fontFamily:a}}},yAxis:{lineColor:b.lineColor,gridLineColor:b.lineColor,lineWidth:1,tickWidth:1,tickColor:b.lineColor,labels:{style:{color:b.textColor,fontSize:"11px",fontFamily:a}},title:{text:"",margin:10,style:{color:b.textColor,fontWeight:"normal",fontSize:"12px",fontFamily:a}}},legend:{enabled:!1,itemStyle:{fontSize:"9pt",fontFamily:a,color:"black"},itemHoverStyle:{color:"#039"},itemHiddenStyle:{color:"gray"}},exporting:{enabled:!1},title:{text:""},tooltip:{shared:!0,formatter:function(){return"The value for <b>"+this.x+"</b> is <b>"+this.y+"</b>"},crosshairs:!0,borderRadius:4,shadow:{color:"#dedede",width:2,opacity:.4,offsetY:0,offsetX:0},borderWidth:1,backgroundColor:{linearGradient:[0,0,0,60],stops:[[0,"#ffffff"],[1,"#f0efef"]]},borderColor:"#dcdcdc",style:{color:"#333333"}},labels:{style:{color:"#99b"}},credits:{enabled:!1},plotOptions:{line:{marker:{enabled:!1},shadow:{color:"#2585c7",width:4,opacity:.25,offsetY:0,offsetX:0},lineWidth:2,states:{hover:{marker:{enabled:!0}}}}}},window.Highcharts.setOptions(Highcharts.theme)}(),function(a){a.Highcharts.setOptions({global:{useUTC:!1}});var b={};b.appChart=Class.extend({init:function(b,c,d){this.target=b;var e=$(b);this.nameMap={},this.params={colors:_.hasMembers(a,"Highcharts","theme","colors")?a.Highcharts.theme.colors:"",credits:{enabled:!1},chart:{renderTo:e[0],height:350,spacingLeft:10,type:c},title:{text:""},exporting:{enabled:!1},series:[],legend:{enabled:!0},tooltip:{enabled:!0,formatter:d,useHTML:!0},marginBottom:0,spacingBottom:5}},setLegendPos:function(a){a&&(this.params.legend.verticalAlign=a)},render:function(){var a=this;if(this.checkActive()){this.params.chart.events={load:$.proxy(this.triggerCallback,this)},this.params.yAxis&&(this.params.yAxis.min=0,this.params.yAxis[0]&&(this.params.yAxis[0].min=0),this.params.yAxis[1]&&(this.params.yAxis[1].min=0)),this.seriesEvent=this.seriesEvent||function(){},"pie"==this.params.chart.type?_.each(this.params.series,function(b){_.each(b.data,function(b){b.events={mouseOver:a.seriesEvent,mouseOut:a.seriesEvent}})}):("line"==this.params.chart.type||"column"==this.params.chart.type)&&_.each(this.params.series,function(b){if(b.color){var c=b.color.toUpperCase().replace("#","");b.marker={symbol:"url({0}img/markers/graphMarker_{1}.png)".format(window.location.pathname,c)}}b.shadow={color:b.color},b.events={mouseOver:a.seriesEvent,mouseOut:a.seriesEvent}});var b=!0;_.isElement(this.target)&&0===$(this.target).length&&(b=!1),b&&(this.chart=new Highcharts.Chart(this.params))}},setCallback:function(a,b){this.callback=a,this.callbackContext=b},triggerCallback:function(a){var b=this;if(this.checkActive()){if(!this.chart)return void setTimeout(function(){b.triggerCallback(a)},10);var c=null;_.isObject(this.callbackContext)&&_.isString(this.callback)?c=$.proxy(this.callbackContext,this.callback):_.isObject(this.callbackContext&&_.isFunction(this.callback))?c=$.proxy(this.callback,this.callbackContext):_.isFunction(this.callback)&&(c=this.callback),c&&c(a)}},addSeries:function(a,b,c){if(_.indexOf(["line","column"],this.params.chart.type)>-1){b=b.toString().split(",");var d=[];_.each(b,function(a,e){a?d.push(b[e]):(b[e]=c.metric||"Unknown",d.push("null"))}),b=b.join(","),c.realName=d.join(",")}a=this.filterData(a,b,c),c=_.isObject(c)?c:{},c.data=a,c.name=this.nameMap[b]?this.nameMap[b]:b,c.realName=c.realName||b,c.type=this.params.chart.type,this.params.series.push(c)},addDetails:function(a){this.details.push(a)},filterData:function(a,b,d){var e=this;if(_.isUndefined(this.params.xAxis))return a;for(var f=0;f<a.length;f++)for(var g=0;g<a[f].length;g++)0===g&&"datetime"===this.params.xAxis.type?a[f][g]=c.mySqlDateTime(a[f][g]):a[f][g]?(a[f][g].replace&&a[f][g].replace(/[^0-9\.]+/g,""),a[f][g]=Number(a[f][g])):a[f][g]=0;if(!_.isUndefined(d.currency_index)&&d.currency_index!==!1){var h=b.split(",")[d.currency_index];"USD"!==h&&_.each(a,function(b,c){a[c]=b*e.currencyRateMap[h]})}return a},setSeries:function(a,b){_.each(a,$.proxy(function(a,c){this.addSeries(a,c,_.clone(b))},this))},setCategories:function(a){"undefined"!=typeof this.params.xAxis&&0!==a.length&&(this.params.xAxis.categories=a)},setSeriesNames:function(a){this.nameMap=a},determineMetaData:function(a,b){var d=0,e=0,f="string",g=0,h=b.data_start?c.parseDate(b.data_start):new Date,i=b.data_end?c.parseDate(b.data_end):new Date,j=b.timestamp.split(".").pop();switch(h.set({minute:-h.getMinutes(),second:-h.getSeconds(),hour:-h.getHours()}),j){case"hour":d=0,e=23,g=1,f="int";break;case"datehour":i.setHours(24-i.getHours()),d=h.getTime(),e=i.getTime(),g=36e5,f="datehour";break;case"date":d=h.getTime(),e=i.getTime(),g=864e5,f="date";break;case"week":var k=moment(h).startOf("week"),l=moment(i).startOf("week");d=k.valueOf(),e=l.valueOf(),g=6048e5,f="week";break;case"month":h.getFullYear()!=i.getFullYear()?(d=1,e=12):(d=h.getMonth()+1,e=i.getMonth()+1),g=1,f="int";break;case"year":d=h.getFullYear(),e=i.getFullYear(),g=1,f="int"}var m=(e-d)/g,n=[];_.isNumber(m)&&(n=new Array(Math.ceil(m))),a.metaData={startPoint:d,endPoint:e,interval:g,type:f,pointList:n,startDate:h,endDate:i,timestamp:j},d==e&&$.extend(!0,this.params,{plotOptions:{series:{marker:{enabled:!0}}}})},processData:function(a,b,d){if(!a.processed){this.determineMetaData(a,b);var e=[];a.seriesGroups={},_.each(b.field,function(b){b=b.split(".").pop(),e[e.length]=b,a.seriesGroups[b]={}});var f=_.chain(b.groups).reject(function(a){return _.contains(["Stat.date","Stat.hour","Stat.datehour","Stat.week","Stat.month","Stat.year"],a)}).map(function(a){return a.split(".").pop()}).value(),g=a.metaData.timestamp;_.each(a.data,function(b){var h,i,j=_.chain(b.Stat).pick(f).toArray().value().join(",");if("pie"!==d)switch(a.metaData.type){case"int":h=i=parseInt(b.Stat[g],10);break;case"date":h=c.parseDate(b.Stat[g]),i=h.getTime();break;case"week":h=c.parseWeek(b.Stat[g]),i=h.getTime();break;case"datehour":h=i=c.mySqlDateTime(b.Stat[g]).getTime()}_.each(e,function(c){var e;_.isUndefined(a.seriesGroups[c][j])&&(a.seriesGroups[c][j]=[]),e="pie"==d?b.Stat[c]:[b.Stat[g],b.Stat[c],h,i],a.seriesGroups[c][j][a.seriesGroups[c][j].length]=e})})}},setLineSeriesData:function(b,c,d,e){var f,g=e.startPoint,h=e.endPoint,i=e.interval,j=e.timestamp;_.each(b,function(a,c){f=_.clone(e.pointList),_(a).chain().reject(function(a){return a[3]<g||a[3]>h}).each(function(a){var b=Math.round((a[3]-g)/i);f[b]=parseFloat(a[1])}),b[c]=[];for(var d=0,j=f.length;j>d;d++)b[c][d]=f[d]||0});var k=h-g,l=i,m=$(this.target).width()<800?7:20;if("datehour"==j&&(m=$(this.target).width()<800?5:10,this.params.xAxis.min=g,this.params.xAxis.max=h),0===k?l=$(this.target).width()<800?4:2:k/m>i&&(l=Math.ceil(k/m)),this.params.xAxis.tickInterval=l,_.contains(a.Config.Enums.currencyFields,c.field)){var n=_.indexOf(c.group.split(","),"currency_code");c.currency_index=n>-1?n:!1}else c.currency_index=!1;c={pointStart:g,pointInterval:i,metric:c.metric,currency_index:c.currency_index},d&&(c.yAxis=d.yAxis),this.setSeries(b,c)},getColors:function(){return $.proxy(c.getColors,this)()},fetchDataFromApi:function(a,b){return this.apiUrl=a,_.isUndefined(b)===!1&&(this.apiArgs=b),this.load()},load:function(){var a={};return"undefined"!=typeof this.apiArgs&&this.apiArgs&&$.extend(!0,a,this.apiArgs),$(document).api(this.apiUrl,a,$.proxy(function(b){this.dataReturn(b,a)},this))},dataReturn:function(a,b){this.checkActive()&&(b.timestamp?this.setLineSeriesData(a,b):this.setSeries([a]),this.render())},populateCurrencyRateMap:function(a){var b=this;b.currencyRateMap={},_.each(a.data,function(a){"USD"!==a.currency_code&&a.currency_rate&&(b.currencyRateMap[a.currency_code]=a.currency_rate)})},checkActive:function(){return!0}}),b.LineChart=b.appChart.extend({init:function(a,b,c,d,e,f,g){this._super(a,"line",g),this.params.xAxis={title:{text:b},labels:{formatter:d}},this.params.yAxis={title:{text:e},labels:{formatter:f}},"datetime"==c?(this.params.chart.zoomType="x",this.params.xAxis.maxZoom=1728e5,this.params.xAxis.type="datetime"):this.params.xAxis.allowDecimals=!1,this.params.yAxis.startOnTick=!1}}),b.MultiLineChart=b.appChart.extend({init:function(a,b,c,d,e,f,g,h){var i=this;this.lineStyles=h.lineStyles||["solid","longdash","dot","dashdot"],this._super(a,"line",g),this.params.xAxis={title:{text:b},labels:{formatter:d}},this.params.yAxis=[],_.each(e,function(a,b){i.params.yAxis.push({title:{text:a},labels:{formatter:f[b]},opposite:(b+1)%2==0,lineWidth:1*b+1,min:0,offset:b>1?42:0})}),"datetime"==c?(this.params.chart.zoomType="x",this.params.xAxis.maxZoom=1728e5,this.params.xAxis.type="datetime"):this.params.xAxis.allowDecimals=!1,this.params.yAxis.startOnTick=!1,this.instructions=h},render:function(){var a,b,c=this,d=_.clone(this.params.colors),e={};_.hasMembers(c,"callbackContext","data","data",0,"rowid")?_.each(c.callbackContext.data.data,function(c,f){for(b=f;b>=d.length;)b-=d.length;c.rowid?a=_.map(c.rowid.split("__"),function(a){return a.split("--").pop()}).join(","):c.colorid&&(a=c.colorid),_.isUndefined(a)||(e[a]=d[b])}):_.each(this.params.series,function(a,c){for(b=c;b>=d.length;)b-=d.length;e[a.realName]=d[b]});var f;$.each(this.params.series,function(a,b){f=e[b.realName],_.extend(b,{color:f,lineColor:f,dashStyle:c.lineStyles[b.yAxis]})}),this._super()}}),b.ColumnChart=b.appChart.extend({init:function(a,b,c,d,e,f,g){this._super(a,"column",g),this.params.xAxis={title:{text:b},labels:{formatter:d}},this.params.yAxis={title:{text:e},labels:{formatter:f}},"datetime"==c&&(this.params.xAxis.type="datetime"),this.params.plotOptions={series:{borderWidth:0,marker:{enabled:!1}}},this.params.legend.labelFormatter=function(){return this.options.metric?this.name+" - "+this.options.metric:this.name}},addSeries:function(a,b,c){a=_.map(a,$.proxy(function(a){if(_.isArray(a)){var b=this.nameMap[a[0]]?this.nameMap[a[0]]:a[0];return{name:""===b?"No Name":b,y:a[1],realName:a[0]}}return a},this)),this._super(a,b,$.extend(c,$.extend(!0,{innerSize:"60%",size:"100%"},this.seriesOptions)))},dataReturn:function(a,b){if(b.timestamp)this.setLineSeriesData(a,b);else{var c={};_.each(a,function(a){c[a[0]+""]=[parseFloat(a[1])]}),$(document).main.addError("series",dump(c),"debug"),this.setSeries(c),this.params.xAxis.categories=[" "]}this.render()}}),b.BarChart=b.ColumnChart.extend({init:function(a,b,c,d,e,f,g){this._super(a,b,c,d,e,f,g),this.params.chart.inverted=!0}}),b.PieChart=b.appChart.extend({init:function(b,c,d){this._super(b,"pie",d),this.params.plotOptions={pie:{showInLegend:!0,dataLabels:{enabled:!0,distance:-18,formatter:a.Formatter.formatValuePercent}}},this.params.chart.marginTop=0,this.params.legend.align="right",this.params.legend.verticalAlign="top",this.params.legend.borderColor="#FFF",this.params.legend.layout="vertical",this.params.legend.x=-25,this.params.legend.floating=!0,this.seriesOptions={}},addSeries:function(a,b,c){var d=_.reduce(a,function(a,b){return a+parseFloat(b[1])},0);a=_.map(a,$.proxy(function(a){var b=this.nameMap[a[0]]?this.nameMap[a[0]]:a[0];return{name:""===b?"No Name":b,y:a[1]/d,realName:a[0],realY:a[1]}},this)),this._super(a,b,$.extend(c,$.extend(!0,{innerSize:"60%",size:"100%"},this.seriesOptions)))},getColors:function(){return $.proxy(c.getColors,this)()},render:function(){this._super()}}),b.DualPieChart=b.appChart.extend({init:function(b,c,d){this._super(b,"pie",d),this.params.plotOptions={pie:{showInLegend:!0,dataLabels:{enabled:!0,distance:-18,formatter:a.Formatter.formatValuePercent}}},this.params.chart.marginTop=0,this.params.legend.align="right",this.params.legend.verticalAlign="top",this.params.legend.borderColor="#FFF",this.params.legend.layout="vertical",this.params.legend.x=-25,this.params.legend.floating=!0,this.params.legend.itemStyle={"font-size":"14px","line-height":"18px"},this.params.legend.labelFormatter=function(){return 0===this.series.options.colorIndex?_.hasMembers(this,"config","name")?this.config.name:this.name:null},this.seriesOptions={id:"dualpie"}},addSeries:function(a,b,c){var d=c.sizeObj?c.sizeObj:{size:"100%"};this._super(a,b,$.extend(c,$.extend(!0,d,this.seriesOptions)))},setSeries:function(b,c,d){var e,f,g=this,h=[],i=$.extend({},c,d),j=0,k=function(a,b){return a+parseFloat(b[0])};if(_.indexOf(a.Config.Enums.currencyFields,c.field)>-1){var l,m=_.indexOf(c.group.split(","),"currency_code");m>-1&&_.each(b,function(a,c){l=a[0].split(",")[m],"USD"!==l&&(b[c][1]=b[c][1]*g.currencyRateMap[l])})}f=_.reduce(b,k,0),_.each(b,function(a,b){var d={name:g.nameMap[b],field:i.name,y:a[0]/f,realName:b,realY:a[0],metric:c.field};j>g.params.colors.length&&(j-=g.params.colors.length),e=g.params.colors[j],i.colorIndex>0&&(e=Highcharts.Color(e).brighten(.15*i.colorIndex).get(),i.showInLegend=!1),e&&(d.color=e),h.push(d),j++}),g.addSeries(h,"",i)},getColors:function(){return $.proxy(c.getColors,this)()},render:function(){var a,b,c=_.chain(this.params.series).first().find(function(a,b){return"data"==b?!0:void 0}).pluck("name").map(function(a){try{return a?a.length:0}catch(b){return 0}}).max().value();c>30&&(a=7*(c-30),b=$(this.target),this.params.chart.marginLeft-=a,b.width(b.width()+a));var d=-20;1===this.params.series.length?d=-50:2===this.params.series.length&&(d=-25);var e=function(){var a=parseInt(this.percentage,10);return a>0?a+"%":""};this.params.plotOptions=_.extend(this.params.plotOptions||{},{pie:{showInLegend:!0,dataLabels:{color:"#000",style:{fontWeight:"bold"},distance:d,formatter:e}}}),this._super()}}),b.bigLineChart=b.LineChart.extend({init:function(a,b,c,d,e,f,g){this._super(a,b,c,d,e,f,g),this.params.chart.marginBottom=80,this.params.plotOptions.series.lineWidth=4,this.params.legend={verticalAlign:"bottom",align:"left",borderWidth:0,symbolWidth:0,labelFormatter:function(){return""}}}}),b.bigMultiLineChart=b.MultiLineChart.extend({init:function(a,b,c,d,e,f,g,h){this._super(a,b,c,d,e,f,g,h),this.params.chart.marginBottom=80,this.params.legend={verticalAlign:"bottom",align:"left",borderWidth:0,symbolWidth:0,labelFormatter:function(){return""}}}}),b.bigDualPieChart=b.DualPieChart.extend({init:function(a,b,c,d){this._super(a,b,c),this.params.chart.height=350,$.extend(!0,this.params,d||{})}});var c={determineLabelFormat:function(b){var c,d,e="integer";switch(b.split(".").pop()){case"hour":c="Hour of Day",d=a.Formatter.formatHour;break;case"datehour":e="datetime",c="Hour",d=a.Formatter.formatDateHour;break;case"date":e="datetime",c="Date",d=a.Formatter.formatDate;break;case"week":c="Week of Year",d=a.Formatter.formatWeek;break;case"month":c="Month of Year",d=a.Formatter.formatMonth;break;case"year":c="Year",d=a.Formatter.formatString}return{xAxisType:e,xAxisLabel:c,xAxisFormat:d}},parseDate:function(a){var b=a.match(/([0-9]{4})\-([0-9]{2})\-([0-9]{2})/);return new Date(b[1],b[2]-1,b[3],0,0,0)},parseWeek:function(a){var b=a.match(/([0-9]{4})([0-9]{2})/),c=new Date(b[1],0,1,0,0,0).add(Number(b[2])).weeks();return c},mySqlDateTime:function(a){var b,c=a.split(/[\- :]/);return b=3==c.length?new Date(c[0],c[1]-1,c[2]):new Date(c[0],c[1]-1,c[2],c[3],c[4],c[5])},getColors:function(a){a=a||this.chart||this;var b={};return _.each(a.series,function(a){b[a.options.realName]=a.color}),b}},d=function(a,b){if(a&&"null"!==a){var c='<td class="rowLabel"><span style="background-color: {1};"></span> {0}</td>';return a="organic"==a?a.titleCaps():a,c.format(a,b)}return""},e={CustomTitle:function(){var b,c=[],e={},f=[],g=15,h="<tr><td>{1}</td>{0}</tr>",i="",j={};j={conversions:"conv",impressions:"impr"},_.each(this.points,function(b){var c,g,h,k,l="",m=b.y;c=b.series.xAxis.tooltipFormatter||b.series.xAxis.options.labels.formatter||a.Formatter.formatString,g=b.series.yAxis.tooltipFormatter||b.series.yAxis.options.labels.formatter||a.angular.noop,k="column"===b.series.options.type?"transparent":b.series.color,h=d(b.series.name,k,c(b.x)),e[b.series.name]=e[b.series.name]||{title:h,rows:{}},_.hasMembers(b,"series","yAxis","axisTitle","textStr")&&(l=b.series.yAxis.axisTitle.textStr.toLowerCase(),j[l]&&(l=j[l])),i||(i=c(b.x)),_.contains(f,l)||f.push(l),_.isUndefined(e[b.series.name].rows[l])||(m+="payout"===l?a.currency.unformat(e[b.series.name].rows[l]):parseFloat(e[b.series.name].rows[l],10),(!_.isNumber(m)||_.isNaN(m))&&(m=b.y)),e[b.series.name].rows[l]=g(m)}),_.each(e,function(a){var b="",d="<tr>{0}{1}</tr>";_.each(f,function(c){b+='<td class="columnValue">{0}</td>'.format(a.rows[c]||"");
}),c.push(d.format(a.title,b))}),f=_.reduce(f,function(a,b){return a+"<td>"+b+"</td>"},"");var k=h.format(f,i),l="";return c.length>g&&(l='<tr><td class="foot" colspan="5">and {0} more...</td></tr>'.format(c.length-g),c=c.slice(0,g)),b='<table class="tooltip_content"><thead>{0}</thead><tbody>{1}</tbody><tfoot>{2}</tfoot></table>',b.format(k,c.join(""),l)},BarCustom:function(a,b){return String((this.series.name&&"null"!==this.series.name?this.series.name+":":"")+" <strong>"+b(this.y)+"</strong>")},PieCustom:function(b){var c=_.contains(a.Config.Enums.currencyFields,this.point.field);b=c?a.Formatter.formatCurrency:a.Formatter.formatNumber;var e=d(this.point.name),f='<table class="tooltip_content">{0}<tr><td>{1}%</td><td>{2}: {3}</td></tr></table>';return f.format(e,this.point.percentage.toFixed(2),this.point.field,b(this.point.options.realY))}};b.chartDisplay=Class.extend({nameMap:{},displayNum:5,init:function(a,b,c,d,e,f,g,h,i,j){this.location=a,this.api=c,this.data=d,this.chartParams=e,this.type=b,this.chart=null,this.dataCallback=f,this.chartCallback=g,this.parent=j,h&&(this.displayNum=h),i&&(this.seriesEvent=i),this.api&&(this.determineNameMap(),this.determineLabelFormat()),this.buildChart()},getChart:function(){return this.chart},triggerChartCallback:function(){_.isFunction(this.chartCallback)&&this.chartCallback.apply(this,[])},triggerDataCallback:function(a){_.isFunction(this.dataCallback)&&this.dataCallback(a)},determineLabelFormat:function(){if(this.chartParams.timestamp){var a=c.determineLabelFormat(this.chartParams.timestamp);this.xAxisType=a.xAxisType,this.xAxisLabel=a.xAxisLabel,this.xAxisFormat=a.xAxisFormat}},determineNameMap:function(){var b=this.data,c=this.parent.$scope.getDefinition(),d={},e=_.chain(this.chartParams.groups).reject(function(a){var b=["Stat.date","Stat.hour","Stat.datehour","Stat.week","Stat.month","Stat.year"];return _.contains(b,a)}).map(function(a){return a.split(".").pop()}).value(),f=_.chain(e).clone().map(function(b){var d=b.split("_");d.pop(),d=a.Formatter.titleCaps(d.join("_"));var e={"OfferFile.name":"OfferFile.display"};return e[d+".name"]?e[d+".name"]:c.related_entities[d]?d+".name":d}).value();_.each(b.data,function(a){var b=_.chain(a.Stat).pick(e).toArray().value().join(","),c=_.chain(a).map(function(a,b){var c=[];return _.each(f,function(d){d=d.split("."),d[0]==b&&c.push(a[d[1]])}),c}).flatten().compact().value();d[b]=c.length>0?c.join(" - "):"",a.chartName=b}),this.nameMap=d},getColors:function(){return this.getChart().getColors()},formatSingleName:function(a){return"ad_clicks_unique"==a?"Clicks":a.replace("_"," ").ucFirst()},getAndProcessData:function(a){var b=this;b.api?b.api(this.chartParams).success(function(c){if(c.response&&c.response.data&&(c=c.response.data),c.errors)throw new Error(c.errors.toString());b.chart.processData(c,b.chartParams,b.type),a(c)}):b.data&&(b.chart.processData(b.data,b.chartParams,b.type),a(b.data))},determineTooltipFormatters:function(a){this.chartParams&&a&&(a.xAxis&&this.chartParams.xAxisTooltipFormatter&&(a.xAxis.tooltipFormatter=this.chartParams.xAxisTooltipFormatter),a.yAxis&&this.chartParams.yAxisTooltipFormatter&&(a.yAxis.tooltipFormatter=this.chartParams.yAxisTooltipFormatter))},buildChart:function(){var c,d=this,e=this.data,f=this.nameMap,g={},h={};c=_.clone(this.chartParams),this.determineLabelFormat(),this.parent.$scope.getDefinition&&(this.determineNameMap(),f=this.nameMap);var i,j=this.xAxisType,k=this.xAxisFormat,l={},m=0;switch(_.each(c.field,function(b){var c=_.contains(a.Config.Enums.currencyFields,b);b=b.split(".").pop(),l[b]={parms:_.clone(d.chartParams),yFormat:c?a.Formatter.formatCurrency:a.Formatter.formatNumber,title:g[b]?g[b]:a.Formatter.titleCaps(b),yax:m},l[b].parms.metric=b,delete l[b].parms.options,m++}),this.type){case"line":var n={appendLabel:!0};this.chartParams.lineStyles&&(n.lineStyles=this.chartParams.lineStyles),d.chart=new b.bigMultiLineChart(d.location,"",j,k,_.pluck(l,"title"),_.pluck(l,"yFormat"),function(){return a.ChartFactory.getTooltip("CustomTitle").apply(this,d.determineTooltipFormatters(this.series))},n),d.chart.populateCurrencyRateMap(e),d.seriesEvent&&(d.chart.seriesEvent=d.seriesEvent),d.chart.setCallback("triggerChartCallback",d),d.chart.setSeriesNames(f),d.getAndProcessData(function(a){_.each(a.seriesGroups,function(b,c){var e=l[c]&&l[c].title?l[c].title:"",f={name:e,yAxis:l[c].yax};d.chart.setLineSeriesData(b,l[c].parms,f,a.metaData)});try{d.triggerDataCallback(a),d.chart.render()}catch(b){console.log(b)}});break;case"pie":d.chart=new b.bigDualPieChart(this.location,_.first(_.pluck(l,"yFormat")),function(){return a.ChartFactory.getTooltip("PieCustom").apply(this,[_.first(_.pluck(l,"yFormat"))])},{chart:{marginLeft:l.length>1?-350:-250,marginTop:10}}),d.chart.populateCurrencyRateMap(e),d.seriesEvent&&(d.chart.seriesEvent=d.seriesEvent),d.chart.setCallback("triggerChartCallback",d),i={},this.chartParams.groups=_.reject(this.chartParams.groups,this.parent.rejectGroups),this.chart.setSeriesNames(f);var o=_.size(l),p=100/o,q=0;d.getAndProcessData(function(a){_.each(a.seriesGroups,function(a,b){var c,e=o-(q+1);1==o?c={size:"100%"}:2==o?c=0===e?{size:"60%"}:{size:"100%",innerSize:"61%"}:(c={size:"{0}%".format(p*(e+1))},e>0&&(c.innerSize="{0}%".format(p*e+1)));var f={name:l[b].title,sizeObj:c,colorIndex:q};d.chart.setSeries(a,l[b].parms,f),q++});try{d.triggerDataCallback(a),d.chart.render()}catch(b){console.log(b)}});break;case"bar":h=_.first(_.pluck(l,"yFormat")),d.chart=new b.ColumnChart(this.location,"",j,k,"",h,function(){return a.ChartFactory.getTooltip("CustomTitle").apply(this,d.determineTooltipFormatters([k,h]))}),d.chart.populateCurrencyRateMap(e),d.seriesEvent&&(d.chart.seriesEvent=d.seriesEvent),this.chart.setSeriesNames(f),this.chart.setCallback("triggerChartCallback",d),d.getAndProcessData(function(a){_.each(a.seriesGroups,function(b,c){var e={name:l[c].title};d.chart.setLineSeriesData(b,l[c].parms,e,a.metaData)});try{d.triggerDataCallback(a),d.chart.render()}catch(b){console.log(b)}})}}}),a.ChartFactory={types:["BarChart","PieChart","DualPieChart","bigLineChart","bigMultiLineChart","bigDualPieChart"],construct:function(a,b){var c=function(){return a.apply(this,b)};return c.prototype=a.prototype,new c},getChart:function(){var a=_.toArray(arguments),c=a.shift();if(!_.contains(this.types,c))throw new Error("Chart type "+c+" not currently supported");return this.construct(b[c],a)},chartDisplay:function(){var a=_.toArray(arguments);return this.construct(b.chartDisplay,a)},getTooltip:function(a){if(!_.has(e,a))throw new Error("Tooltip "+a+" does not exist");return e[a]},getHelper:function(){return c}}}(this),function(a){a.Formatter={rgbColorToHex:function(a){var b=a||this,c=/rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)/.exec(b.toLowerCase());return c?"#"+(1<<24|c[1]<<16|c[2]<<8|c[3]).toString(16).substr(1):b.toLowerCase()},decodeHtmlEntities:function(b,c){var d="",e="",f={};if(!1===(f=a.Formatter.get_html_translation_table("HTML_ENTITIES",c)))return!1;delete f["&"],f["&"]="&amp;";for(d in f)e=f[d],b=b.split(e).join(d);return b=b.split("&#039;").join("'")},encodeHtmlEntities:function(b,c){var d="",e="",f={};if(!1===(f=a.Formatter.get_html_translation_table("HTML_ENTITIES",c)))return!1;delete f["&"],f["&"]="&amp;";for(d in f)e=f[d],b=b.split(d).join(e);return b=b.split("&#039;").join("'")},titleCaps:function(a,b){return b&&(a=a.split("_").join(" ")),_.map(a.split(" "),function(a){return a.substr(0,1).toUpperCase()+a.substring(1)}).join(" ")},get_html_translation_table:function(a,b){var c,d={},e={},f={},g={},h={},i={};if(f[0]="HTML_SPECIALCHARS",f[1]="HTML_ENTITIES",g[0]="ENT_NOQUOTES",g[2]="ENT_COMPAT",g[3]="ENT_QUOTES",h=isNaN(a)?a?a.toUpperCase():"HTML_SPECIALCHARS":f[a],i=isNaN(b)?b?b.toUpperCase():"ENT_COMPAT":g[b],"HTML_SPECIALCHARS"!==h&&"HTML_ENTITIES"!==h)throw new Error("Table: "+h+" not supported");d[38]="&amp;","HTML_ENTITIES"===h&&(d[160]="&nbsp;",d[161]="&iexcl;",d[162]="&cent;",d[163]="&pound;",d[164]="&curren;",d[165]="&yen;",d[166]="&brvbar;",d[167]="&sect;",d[168]="&uml;",d[169]="&copy;",d[170]="&ordf;",d[171]="&laquo;",d[172]="&not;",d[173]="&shy;",d[174]="&reg;",d[175]="&macr;",d[176]="&deg;",d[177]="&plusmn;",d[178]="&sup2;",d[179]="&sup3;",d[180]="&acute;",d[181]="&micro;",d[182]="&para;",d[183]="&middot;",d[184]="&cedil;",d[185]="&sup1;",d[186]="&ordm;",d[187]="&raquo;",d[188]="&frac14;",d[189]="&frac12;",d[190]="&frac34;",d[191]="&iquest;",d[192]="&Agrave;",d[193]="&Aacute;",d[194]="&Acirc;",d[195]="&Atilde;",d[196]="&Auml;",d[197]="&Aring;",d[198]="&AElig;",d[199]="&Ccedil;",d[200]="&Egrave;",d[201]="&Eacute;",d[202]="&Ecirc;",d[203]="&Euml;",d[204]="&Igrave;",d[205]="&Iacute;",d[206]="&Icirc;",d[207]="&Iuml;",d[208]="&ETH;",d[209]="&Ntilde;",d[210]="&Ograve;",d[211]="&Oacute;",d[212]="&Ocirc;",d[213]="&Otilde;",d[214]="&Ouml;",d[215]="&times;",d[216]="&Oslash;",d[217]="&Ugrave;",d[218]="&Uacute;",d[219]="&Ucirc;",d[220]="&Uuml;",d[221]="&Yacute;",d[222]="&THORN;",d[223]="&szlig;",d[224]="&agrave;",d[225]="&aacute;",d[226]="&acirc;",d[227]="&atilde;",d[228]="&auml;",d[229]="&aring;",d[230]="&aelig;",d[231]="&ccedil;",d[232]="&egrave;",d[233]="&eacute;",d[234]="&ecirc;",d[235]="&euml;",d[236]="&igrave;",d[237]="&iacute;",d[238]="&icirc;",d[239]="&iuml;",d[240]="&eth;",d[241]="&ntilde;",d[242]="&ograve;",d[243]="&oacute;",d[244]="&ocirc;",d[245]="&otilde;",d[246]="&ouml;",d[247]="&divide;",d[248]="&oslash;",d[249]="&ugrave;",d[250]="&uacute;",d[251]="&ucirc;",d[252]="&uuml;",d[253]="&yacute;",d[254]="&thorn;",d[255]="&yuml;"),"ENT_NOQUOTES"!==i&&(d[34]="&quot;"),"ENT_QUOTES"===i&&(d[39]="&#39;"),d[60]="&lt;",d[62]="&gt;";for(c in d)d.hasOwnProperty(c)&&(e[String.fromCharCode(c)]=d[c]);return e},zeroPadNumber:function(a){return a=a.toString(),a=1==a.length?"0"+a:a},getVal:function(b,c){return _.isUndefined(b)&&c!==a.Formatter&&(b=c.value),b},formatString:function(b){return a.Formatter.getVal(b,this)},formatCurrency:function(b,c,d){return b=a.Formatter.getVal(b,this),d=d||5,currency.formatCurrency(b,c||a.Config.network_currency||"USD",d)},formatInteger:function(b){return parseInt(a.Formatter.getVal(b,this),10)},formatNumber:function(b){return currency.formatNumber(a.Formatter.getVal(b,this))},formatHour:function(b){var c=a.Formatter.getVal(b,this);return 0===c?c="12 am":12>=c?c+=" {0}".format(12==c?"pm":"am"):c=c-12+" pm",c},formatMonth:function(b){var c=a.Formatter.getVal(b,this);return["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][c-1]},formatWeek:function(b){b=a.Formatter.getVal(b,this);var c=moment(b);return"{0}-{1}".format(c.year(),a.Formatter.zeroPadNumber(c.isoWeek()))},formatDate:function(b){b=a.Formatter.getVal(b,this);var c=new Date(b);return c.toString("MM/dd")},formatDateWithYear:function(b){b=a.Formatter.getVal(b,this);var c=new Date(b);return c.toString("MM/dd/yyyy")},formatDateHour:function(b){b=a.Formatter.getVal(b,this);var c=new Date(b),d=a.Formatter.formatHour(c.getHours());return"{0}/{1} {2}".format(c.getMonth()+1,c.getDate(),d)},formatDateRelative:function(a){var b=moment(a),c=b.format("LLLL"),d="";return b.isValid()?(b.isAfter(moment().startOf("day"))&&(d=b.format("h:m a")),b.isBefore(moment().subtract(1,"month"))&&(d=b.format("MM-DD-YYYY")),d=b.fromNow(),'<span title="{0}">{1}</span>'.format(c,d)):"Unknown Date"},formatPercent:function(b){return b=a.Formatter.getVal(b,this),"{0}%".format(parseInt(1e3*b,10)/10)},formatValuePercent:function(){return a.Formatter.formatPercent(this.y)},sanitizeString:function(a){return a.replace(/[^\w. ]/gi,function(a){return"&#"+a.charCodeAt(0)+";"})}},String.prototype.format=function(){for(var a=this,b=0;b<arguments.length;b++){var c=new RegExp("\\{"+b+"\\}","gm");a=a.replace(c,arguments[b])}return a}}(this),function(a){a.ApiLogger=function(){var a={},b={};this.enabled=!1,this.uid=0,this.processCallStat=function(b,c){c=c||{},a[b]=a[b]||{calls:0,fields:[],filters:[],contain:[]},a[b].calls++,c.fields&&(a[b].fields=_.union(a[b].fields,c.fields)),c.filters&&(a[b].filters=_.union(a[b].filters,c.filters)),c.contain&&a[b].contain.push(c.contain)},this.logRequest=function(a,c){return this.enabled?(b[a]=c,void this.processCallStat(c.method,c.params)):!1},this.getRequests=_.throttle(function(){return this.enabled?_.chain(b).toArray().sortBy(function(a){return a.uid}).value():{}},500),this.getCallStats=_.throttle(function(){return this.enabled?a:[]},500),this.dump=function(){var c='"'+escape(JSON.stringify({callStats:a,requests:b}))+'"';window.saveAs(new Blob([c],{type:"text/plain;charset="+document.characterSet}),"debug-"+moment().format()+".txt")},this.loadDump=function(c){var d=JSON.parse(unescape(c));a=d.callStats,b=d.requests}}}(this),function(a){a.angular.module("hasApp.filters",[]).filter("notIn",function(){return function(a,b){var c=[],d=_.map($(b).find("option"),function(a){return $(a).attr("value")});return _.each(a,function(a){-1===_.indexOf(d,a.value)&&(c[c.length]=a)}),c}}).filter("include",function(){return function(a,b){return _.isUndefined(a)?void 0:_.intersection(a,b)}}).filter("exclude",function(){return function(a,b){return _.isUndefined(a)?void 0:_.isUndefined(b)?a:_.difference(a,b)}}).filter("ifEmpty",function(){return function(a,b){return $.trim(a)?a:b}}).filter("maskCreditCard",function(){return function(a){return a?(a=a.toString().replace(/-/g,""),a.length>4?new Array(a.length-3).join("&bull;")+a.slice(-4):a.slice(-4)):null}}).filter("percent",function(){return function(a){return a?parseFloat(a).toFixed(2)+"%":"0%"}}).filter("parseDate",function(){var a=function(a,b){return a?moment(a).format(b):""};return a.$stateful=!0,a}).filter("parseDateUTC",function(){var a=function(a,b,c){if(!a)return"";try{return moment.utc(a).tz(c).format(b)}catch(d){return moment.utc(a).format(b)}};return a.$stateful=!0,a}).filter("convertUTCtoTz",function(){var a=function(a,b,c){return a&&b&&c?moment(a).utc(!0).tz(c).format(b):""};return a.$stateful=!0,a}).filter("parseLocalUTC",function(){var a=function(a,b,c){if(!a)return"";try{return moment.utc(a).zone(-1*Number(c)).format(b)}catch(d){return moment.utc(a).format(b)}};return a.$stateful=!0,a}).filter("relativeDate",function(){var b=function(b){return b?a.Formatter.formatDateRelative(b):""};return b.$stateful=!0,b}).filter("capitalize",function(){return function(a){if(!a)return"";var b=a.split(" "),c=[];return _.each(b,function(a){c.push(a.charAt(0).toUpperCase()+a.slice(1))}),c.join(" ")}}).filter("plainText",function(){return function(a){return a?$("<span>"+a+"</span>").text():""}}).filter("truncate",function(){return function(a,b,c){return a?(b=b||10,c=c||"...",a.length<=b?a:b<c.length?a.substring(0,b):a.substring(0,b-c.length+1).replace(/(^|\W+)\w*$/,c)):""}}).filter("formatAddress",["geographic",function(a){return function(b,c){if(!b)return"";var d,e,f;return c=c||"",d={address1:b[c+"address1"]||b[c+"bank_address"]||null,address2:b[c+"address2"]||null,city:b[c+"city"]||"",region:b[c+"region"]||"",zipcode:b[c+"zipcode"]||b[c+"postal_code"]||"",country:b[c+"country"]||b[c+"country_code"]||b[c+"destination_country_code"]||null},"NO REGION"===d.region&&(d.region=""),e=d.city&&d.region?", ":" ",d.country&&(d.country=a.determineCountryNiceName(d.country)),f=[d.address1,d.address2,$.trim(d.city+e+d.region+" "+d.zipcode),d.country],_.compact(f).join("<br />")}}]).filter("formatPaymentMethod",function(){return function(a){if(!a)return"";var b={check:"billing.paymentMethods.check",direct_deposit:"billing.paymentMethods.direct_deposit",other:"billing.paymentMethods.other",payoneer:"billing.paymentMethods.payoneer",paypal:"billing.paymentMethods.paypal",wire:"billing.paymentMethods.wire"};return b[a]||a}}).filter("currency",["currencyService",function(a){return function(b,c,d,e){return b="string"==typeof b?b?b.replaceAll(",",""):0:b||0,c=c||window.Config.network_currency,d=d||5,a.formatCurrency(b||0,c,d,e)}}]).filter("formatFileSize",function(){return function(a){a=parseFloat(a);for(var b,c=0,d=!0,e=[{size:1e9,suffix:" GB"},{size:1e6,suffix:" MB"},{size:1e3,suffix:" KB"}];d;){if(d=e[c],b=d.suffix||"",c===e.length-1||a>=d.size)return(a/d.size).toFixed(2)+b;c+=1}}}).filter("formattedJson",function(){return function(a){return JSON.stringify(a,null,2)}}).filter("enum",function(){return function(b,c){return a.Config.Enums[c]?a.Config.Enums[c][b]||b:b}}).filter("contains",function(){return function(a,b){return _.contains(a,b)}}).filter("url_encode",function(){return function(a){return encodeURIComponent(a)}}).filter("url_decode",function(){return function(a){return decodeURIComponent(a)}}).filter("creativeFileUrl",function(){return function(a,b){return encodeURIComponent(a+"file_id="+b)}}).filter("currencySummary",function(){return function(a){return a>=1?parseFloat(a.toFixed(2)):a}})}(this),function(a){var b=["api","digestService",function(b,c){var d=Class.extend({name:"base",init:function(){},populateScope:function(a,b,c,d){a.success&&a.success(function(a){(!d||_.isObject(a))&&(b[c]=a)})},processRequestsToScope:function(a,b){var c=this;_.each(b,function(b,d){c[b](a,d)})},determineNicename:function(b,c){var d,e=b.split(".");return e.length>1?_.hasMembers(c.related_entities,e[0],"fields",e[1],"nicename")&&(d=c.related_entities[e[0]].fields[e[1]].nicename):c.fields[b]&&c.fields[b].nicename?d=c.fields[b].nicename:_.hasMembers(c,"related_entities",b,"nicename")&&(d=c.related_entities[b].nicename),d||(d=e.length>0?"Stat"==e[0]?e[1]:e[0]:b,d=a.Formatter.titleCaps(d,!0)),d},choiceCache:{},getChoices:function(d,e,f,g,h,i,j){g.NetworkId=j,g.api_key=i;var k=b.generateURL(f,g),l=c,m=l.md5(k),n=this;if(n.choiceCache[m])return d[e]=a.angular.copy(n.choiceCache[m]),{};var o=b.get(f,g,i,j),p=[];return o.success(function(b){if(!_.isObject(b))throw new Error("Unable to determine choices for "+e);_.each(b,function(a){h.entity&&a[h.entity]&&(a=a[h.entity]);var b={label:"{0}{1}".format(h.label_prefix?h.label_prefix:"",a[h.label]),value:a[h.value]};p.push(b)}),p.sort(function(a,b){return a.label>b.label?1:a.label<b.label?-1:0}),h.default_choice&&p.unshift(h.default_choice),n.choiceCache[m]=p,d[e]=a.angular.copy(n.choiceCache[m])}),o},getTagsChoices:function(a,d,e,f,g){var h=b.generateURL(e,f),i=c,j=(i.md5(h),b.get(e,f));return j.success(function(b){if(!_.isObject(b))throw new Error("Unable to determine choices for "+d);var c=b.data,e=[],f=_.map(c,function(a){return a[g.entity]});_.each(f,function(a){g.scope&&e.indexOf(a[g.scope])<0&&e.push(a[g.scope])});var h=function(a,b){var c=function(a){return a.lowerCaseName=a[b].toLowerCase(),a};return _.sortBy(a.map(c),"lowerCaseName")},i=h(f,"name");_.each(e,function(b){var c=_.filter(i,{attribute:b});a[b.split(" ").join("_").toLowerCase()]=c.map(function(a){return{label:"{0}{1}".format(g.label_prefix?g.label_prefix:"",a[g.label]),value:a[g.value]}})})}),j},addDateFilter:function(a,b){return b=b||"Stat.date",a.data_start&&a.data_end&&(a.filters=a.filters||{},a.filters[b]={conditional:"BETWEEN",values:[a.data_start,a.data_end]}),a},convertContains:function(a){if(a.contain){var b={};_.each(a.contain,function(c){var d={fields:[],filters:{}};a.fields=_.reject(a.fields,function(a){return a.split(".").shift()==c?(d.fields.push(a),!0):!1}),_.each(a.filters,function(b,e){e.split(".").shift()==c&&(d.filters[e]=b,delete a.filters[e])}),b[c]=d}),a.contain=b}return a},getStandardDef:function(b){var c={id:{type:"integer",nicename:"ID"},status:{type:"enum",values:{active:"Active",paused:"Paused",deleted:"Deleted"}},bool_yes:{type:"boolean",values:{0:"No",1:"Yes"}},bool_enabled:{type:"enum",values:{1:"Enabled",0:"Disabled"}},created:{type:"timestamp"},modified:{type:"timestamp"}};if(!c[b])throw new Error("Could not determine standard fieldname: "+b);return a.angular.copy(c[b])}});return d}];a.Models={},a.Models.base=b}(this),function(a){var b=a.angular.module("hasOffers.serviceLayer",[]);b.service("directiveRegistry",["$rootScope",function(a){var b,c;return b={},c={},c.default_timeout=6e3,c.register=function(a,c){if(b[c])throw new Error("Scope with the name ("+c+") already registered");b[c]=a,a.$on("$destroy",function(){delete b[c]})},c.onDirectivesReady=function(b,d,e){_.isArray(b)||(b=[b]);var f=a.$new(!0),g={};setTimeout(function(){var a=_.keys(g);if(f.$destroy(),a.length!==b.length){var c=_.difference(b,a);throw new Error("Timed out waiting for the following directives to register: "+c.join(", "))}},c.default_timeout),f.$watch(function(){_.each(b,function(a){c.get(a)&&(g[a]=!0)});var a=_.keys(g);return a.length===b.length},function(a){a&&d.call(e||void 0)})},c.get=function(a){return b[a]},c.purge=function(a){delete b[a]},c}])}(this),function(a){a.Application.service("analyticsService",["$rootScope","$log",function(b,c){var d={gaAccount:"UA-7978744-17",brandTracker:!1,pendoApiKey:"f5632c8e-e3bf-4e9a-481b-1b4040e3d7f1",pendoEnabled:!1,pendoUserProps:{}},e=function(){};e.prototype.init=function(){try{!function(a,b,c,d,e,f,g){a.GoogleAnalyticsObject=e,a[e]=a[e]||function(){(a[e].q=a[e].q||[]).push(arguments)},a[e].l=1*new Date,f=b.createElement(c),g=b.getElementsByTagName(c)[0],f.async=1,f.src=d,g.parentNode.insertBefore(f,g)}(window,document,"script","//www.google-analytics.com/analytics.js","__ga");var b="__ga."+a.Config.api_network_id;__ga("create",d.gaAccount,{cookieName:b+".tune",name:"tune"}),d.googleAnalyticsAccountId&&(d.brandTracker=!0,__ga("create",d.googleAnalyticsAccountId,{cookieName:b,name:"brandTracker"}))}catch(c){console.log(c)}},e.prototype.trackEvent=function(a){__ga&&__ga("tune.send","event",a.category,a.action,a.label,a.value)},e.prototype.track=function(a){__ga&&(__ga("tune.send","pageview",a),d.brandTracker&&__ga("brandTracker.send","pageview",a))};var f=function(){};f.prototype.init=function(){if(d.pendoEnabled)try{!function(a,b,c,e,f){var g,h,i,j,k;for(f=a[e]=a[e]||{},f._q=[],g=["initialize","identify","updateOptions","pageLoad"],h=0,i=g.length;i>h;++h)(function(a){f[a]=f[a]||function(){f._q[a===g[0]?"unshift":"push"]([a].concat([].slice.call(arguments,0)))}})(g[h]);j=b.createElement(c),j.async=!0,j.src="https://cdn.pendo.io/agent/static/"+d.pendoApiKey+"/pendo.js",k=b.getElementsByTagName(c)[0],k.parentNode.insertBefore(j,k)}(window,document,"script","pendo"),pendo.initialize(d.pendoUserProps)}catch(a){console.log("Pendo init error",a)}};var g=function(){};g.prototype.setSettings=function(a){d=a},g.prototype.getSettings=function(){return d};var h={googleAnalytics:new e,pendo:new f};return _.each(["init"],function(a){g.prototype[a]=function(b){_.isUndefined(b)?b=_.keys(h):_.isArray(b)||(b=[b]),_.each(b,function(b){_.isUndefined(h[b])?c.error("analyticsService",b+" does not exist"):_.isUndefined(h[b][a])?c.error("analyticsService",b+" does not contain the method: "+a):h[b][a]()})}}),_.each(["track","trackEvent","registerUser"],function(a){g.prototype[a]=function(b,d){_.isUndefined(d)?d=_.keys(h):_.isArray(d)||(d=[d]),_.each(d,function(d){_.isUndefined(h[d])?c.error("analyticsService",d+" does not exist"):_.isUndefined(h[d][a])?c.error("analyticsService",d+" does not contain the method: "+a):h[d][a](b)})}}),new g}])}(this),function(a){a.Application.service("cache",function(){var a=function(){var a={},b={},c=function(c){a[c]=a[c]||{},b[c]=b[c]||{}};this.get=function(d,e,f){if(c(d),!_.isNumber(b[d][e]))return null;_.isUndefined(f)&&(f=10);var g=(new Date).getTime();return g-b[d][e]<1e3*f?_.isNull(a[d][e])?null:a[d][e]:null},this.put=function(d,e,f){c(d),a[d][e]=f,b[d][e]=(new Date).getTime()}};return new a})}(this),function(a){a.Application.service("chartService",["$translate","$rootScope",function(b,c){return{$scope:null,location:"#chart_container",gridData:{},chartParams:{},colorState:{},currentSet:[],chart:null,buildChart:function(d,e,f){var g=this;if($("#chart_container").show(),$("#no-graph-possible").hide(),e&&(this.$scope=e),this.currentSet=[],d?this.gridData=d:_.each(this.colorState,function(a,b){a.active&&g.currentSet.push(b)}),f&&(this.location=f),0===this.gridData.data.length){var h=c.hasFeatures("PREMIUM_PARTNER_INSTANCE")?"/tuneNetwork/offers":"/offers";return $(this.location).html('<div class="no-data"><div class="no-data-available"><div><em>'+b("common.stats.no_data")+'</em><p class="msg"></p><a href="#!'+h+'" class="btn"><span>'+b("offer.browse_offers")+"</span></a></div></div></div>"),void(this.$scope&&this.$scope.$broadcast("chart-loaded",this.location))}this.chartParams=$.extend(!0,{},this.gridData.params),this.currentReport=this.$scope.currentReport||{selectedMetrics:null,selectedInterval:null,selectedFilters:null,chartType:this.chartParams.type,rowCount:null},this.chartParams.fields&&this.currentReport&&(this.addRowIds(),this.chartParams.field=this.currentReport.selectedMetrics,this.chartParams.timestamp=this.$scope.chartInterval,this.chartParams.groups=this.determineGroups(),this.chartParams.fields=this.determineFields(),this.chartParams.filters=this.determineFilter()),delete this.chartParams.page,delete this.chartParams.sort,this.chartParams.limit=0,$(this.location).css("width","pie"==this.currentReport.chartType?"750px":"auto");var i=this.$scope.reportModel?$.proxy(this.$scope.reportModel.getReportData,this.$scope.reportModel):null;return this.chart=a.ChartFactory.chartDisplay(this.location,this.currentReport.chartType,i,this.gridData,this.chartParams,this.chartDataCallback,this.chartCompleteCallback,this.currentReport.rowCount,$.proxy(this.seriesHover,this),this),this.chart.chart.chart},clearCurrentSet:function(){this.currentSet=[]},rejectGroups:function(a){var b=["Stat.hour","Stat.date","Stat.datehour","Stat.week","Stat.month","Stat.year"];return _.contains(b,a)},determineId:function(b,c){var d=this,e="{0}--{1}";return _.chain(b).reject(d.rejectGroups).map(function(b,d){var f=b.split(".");return _.isArray(c)?e.format(b,c[d]||"null"):f.length>1?e.format(b,a.Formatter.sanitizeString(c[f[0]][f[1]])):e.format(b,a.Formatter.sanitizeString(c[b]))}).value().join("__")},determineFromId:function(a){var b={};return _.each(a.split("__"),function(a){a=a.split("--"),b[a[0]]=a[1]}),b},addRowIds:function(){var a=this,b=this.gridData,c=_.first(this.chartParams.fields).split(".").shift(),d=_.first(this.chartParams.fields).split(".").pop();"Stat"===c&&"offer_id"===d&&(c="Offer"),_.each(b.data,function(b){b[c]||(b[c]={}),b[c].first=!0,b.rowid=a.determineId(a.chartParams.groups,b)})},determineGroups:function(){if(this.$scope.determineGroups){var a=this.$scope.determineGroups(this.gridData.params.fields,!0);return a.push(this.$scope.chartInterval),_.unique(a)}},determineFields:function(){var a=_.chain(this.chartParams.groups).clone().union(this.chartParams.field).unique().value();return a},determineFilter:function(){var a,b,c,d,e,f,g;return a=this,b=this.gridData,c=this.chartParams.groups,d=this.$scope.processUserFilters(this.currentReport.selectedFilters||{}),f={},g={},e={},this.currentSet.length>0?_.each(this.currentSet,function(b){var c=a.determineFromId(b);_.each(c,function(a,b){_.isUndefined(f[b])&&(f[b]={conditional:"EQUAL_TO",values:[]}),f[b].values.push(a)})}):(_.chain(c).reject(a.rejectGroups).each(function(a){f[a]={conditional:"EQUAL_TO",values:[]};var b=a.split(".");g[b[0]]||(g[b[0]]=[]),g[b[0]].push(b[1])}),"0"!==a.$scope.rowCount&&_.chain(b.data).take(Number(a.$scope.rowCount)).each(function(a){_.each(g,function(b,c){var d=_.pick(a[c],b);_.each(d,function(a,b){var d="{0}.{1}".format(c,b);-1===_.indexOf([null,""],a)&&_.has(f,d)&&!_.contains(f[d].values,a)&&f[d].values.push(a)})})})),_.size(e)>0&&(f.OR=e),_.each(f,function(a,b){"OR"!==b&&0===_.size(a.values)&&delete f[b]}),f=_.extend(d,f)},chartDataCallback:function(a){this.parent.currentSet=_.keys(a)},chartCompleteCallback:function(){var a=this,b={};a.parent&&a.parent.$scope&&a.parent.$scope.$broadcast("chart-loaded",this.location);var c=_(a.parent.determineGroups()).reject(a.parent.rejectGroups);if(_.contains(c,"Stat.offer_id")){var d=_.indexOf(c,"Stat.offer_id");c.splice(d,1),c.unshift("Stat.offer_id")}var e=function(d){var e=["conversions","metrics","impressions","payout"],f=d.options.realName;if("null"===f||_(e).contains(f))return void(this.parent.colorState=b={});var g=0===f?[0]:f.split(","),h=a.parent.determineId(c,g).replace("undefined","null"),i=h.split(".").join("\\.")||"null",j=$("#{0} .triangle".format(i));b[h]?j.css({"border-color":"transparent",color:"transparent"}):(j.css({"border-color":"{0} transparent transparent {1}".format(d.color,d.color),color:d.color}),b[h]={active:!0,color:d.color,chartElm:[],gridElm:j}),b[h].chartElm.push(d),d.legendItem&&$(d.legendItem.element).click(function(){a.parent.changeColorState(h)})};$(".triangle").css({"border-color":"transparent",color:"transparent"});var f=this.chart.chart.series||[];f=f.data||f,f.length?(_(f).each(e,this),this.parent.colorState=b):($("#chart_container").hide(),$("#no-graph-possible").show())},changeColorState:function(a){var b=this;if("null"==a&&(a=""),this.colorState[a]){if(this.colorState[a].active=!this.colorState[a].active,_.each(b.colorState[a].chartElm,function(c){try{_.defer(function(){c.setVisible(b.colorState[a].active)})}catch(d){}}),this.colorState[a].gridElm){var c=this.colorState[a].active?this.colorState[a].color:"#EEEEEE",d="{0} transparent transparent {0}".format(c);this.colorState[a].gridElm.css("border-color",d)}}else this.colorState[a]={active:!0},this.buildChart()},highlightMetrics:function(){if(this.$scope){var a=this.$scope.getGridElement();_.each(this.chartParams.field,function(b){a.jqGrid("highlightMetric",b)})}},seriesHover:function(){}}}])}(this),function(a){var b=function(b,c,d,e,f,g){return{AffiliateUser:{},Affiliate:{},AccountManager:{},UserPreferences:{},BrandPreferences:{},Brand:{},Features:[],loading:!1,isLoaded:!1,hashChange:!1,isLoadedDeferred:c.defer(),ConnectAdvertisers:{},refresh:function(h){var i=this;if(i.hashChange=!1,i.isLoadedDeferred=c.defer(),h||!i.loading){i.loading=!0;var j,k;j=d.get("AffiliateUser/getContext",{affiliate_user_id:a.Config.affiliate_user_id}),j.success(function(b){a.Config.affiliate_id||(a.Config.affiliate_id=b.Affiliate.id),!a.Config.connect_affiliate_id&&b.ConnectAffiliateId&&(a.Config.connect_affiliate_id=b.ConnectAffiliateId),_.each(b,function(a,b){i[b]=a}),window.Config.network_currency=i.BrandPreferences.network_currency,g.setDefaultCurrencyCode(i.BrandPreferences.network_currency);var c={network_timezone:i.BrandPreferences.timezone_id},d=e.get("preference_cache_hash"),h=f.md5(JSON.stringify(c));d!==h&&(i.hashChange=!0),e.add("preference_cache_hash",h)}),k=d.get("BrandInformation/getBrandInformation",{}),k.success(function(a){if(!a){var b="Failed to load BrandInformation";throw window._collectedErrors.push(b),window._collectedErrors.push(JSON.stringify(a)),window.displayError(),new Error(b)}i.Brand=a.BrandInformation}),c.all([j,k]).then(function(){i.loading=!1,i.isLoaded=!0,b.$broadcast("UserLoaded",!0,i.hashChange),i.isLoadedDeferred.resolve()},function(){throw i.loading=!1,b.$broadcast("UserLoaded",!1,i.hashChange),i.isLoadedDeferred.reject("user_load_failure"),new Error("User info failed to load. Application will not function properly.")})}},logOut:function(){this.AffiliateUser={},this.Affiliate={},this.AccountManager={},this.UserPreferences={},this.BrandPreferences={},this.Brand={},this.Features=[]},hasPermission:function(a){return _.has(this.AffiliateUser,"access")?_.contains(this.AffiliateUser.access,"Affiliate."+a):!1},hasPermissionPromise:function(a){var d,e=c.defer(),f=this;return d=function(a,b){this.hasPermission(b)?a.resolve():a.reject()},this.isLoaded?d.call(this,e,a):b.$on("UserLoaded",function(){d.call(f,e,a)}),e.promise},hasFeature:function(a){return _.contains(this.Features,a)},hasFeatures:function(a,d,e){var f,g=c.defer(),h=this;return f=function(a,b){this.hasFeature(b)?a.resolve(b):a.reject(b)},this.isLoaded?f.call(this,g,a):b.$on("UserLoaded",function(){f.call(h,g,a)}),d&&e&&g.promise.then(function(){d[e]=!0},function(){d[e]=!1}),g.promise},checkPreference:function(a,d,e,f){var g,h=c.defer(),i=this;return g=function(a,b,c){var d=this.getPreferenceValue(b);d==c?a.resolve(d):a.reject(d);
},this.isLoaded?g.call(this,h,a,d):b.$on("UserLoaded",function(){g.call(i,h,a,d)}),e&&f&&h.promise.then(function(){e[f]=!0},function(){e[f]=!1}),h.promise},getPreferenceValue:function(a){return _.isEmpty(this.BrandPreferences)?null:this.BrandPreferences[a]},getUserPreferenceValue:function(a){return _.isEmpty(this.UserPreferences)?null:this.UserPreferences[a]},setPreferenceValue:function(a,b){return d.get("UserPreferences/setValue",{name:a,value:b})}}};a.Application.service("currentUser",["$rootScope","$q","api","localStorageService","digestService","currencyService",function(c,d,e,f,g,h){return a.CurrentUser=new b(c,d,e,f,g,h)}])}(this),function(a){var b=a.angular.module("hasOffers.serviceLayer");b.service("dataRenderer",["$compile",function(a){var b={},c=function(a){return this._params&&this._params.fields?_(this._params.fields).contains(a):!1};return b.renderTemplateItems=function(b,d,e,f){function g(a,b){return b=b.split("."),b.forEach(function(b){a=a[b]||""}),a}var h=[];if(_(b).each(function(g,i){var j=d.$new(),k=$(e);k.attr("data-has-row",i),j.$first=0===i,j.$last=i!==b.length,j.$middle=!j.$first&&!j.$last,j.$hasField=_.bind(c,j),_(g).each(function(a,b){j[b]=a}),j._params=f,a(k)(j),k.datum=g,h.push(k)}),f&&f.sort){var i=_.keys(f.sort)[0];switch(i){case"Offer.name":h=_.sortBy(h,function(a){var b=g(a,"datum."+i)||"";return b.toLowerCase()});break;case"Offer.id":h=_.sortBy(h,function(a){return parseInt(g(a,"datum."+i))})}"desc"===f.sort[i]&&h.reverse()}return h},b.renderSingleTemplate=function(b,d,e){var f=b.$new();return f._params=e,f.$hasField=_.bind(c,f),a(d)(f),d},b}])}(this),function(a){var b={appName:"hasApp"},c={};c.localStorageService=function(){return{prefix:b.appName+".",isSupported:function(){try{return"localStorage"in window&&null!==window.localStorage}catch(a){return!1}},add:function(b,c){if(c=a.angular.toJson(c),!this.isSupported())return console.log("Cannot add to local storage. Get from cookies"),!1;try{localStorage.setItem(this.prefix+b,c)}catch(d){return console.error(d.Description),-1}},get:function(b){if(!this.isSupported())return console.log("Cannot get from local storage. Use cookies"),!1;var c=localStorage.getItem(this.prefix+b);return a.angular.fromJson(c)},remove:function(a){return this.isSupported()?localStorage.removeItem(this.prefix+a):(console.log("Cannot remove item from local storage. Remove from cookies"),!1)},clearAll:function(){if(!this.isSupported())return console.log("Cannot remove all items from local storage. Remove all app cookies"),!1;var a=this.prefix.length;for(var b in localStorage)b.substr(0,a)===this.prefix&&localStorage.removeItem(b)}}},c.sessionStorageService=function(){return{prefix:b.appName+".",isSupported:function(){try{return"sessionStorage"in a&&null!==a.sessionStorage}catch(b){return!1}},add:function(b,c){if(c=a.angular.toJson(c),!this.isSupported())return console.log("Cannot add to session storage. Get from cookies"),!1;try{sessionStorage.setItem(this.prefix+b,c)}catch(d){return console.error(d.Description),-1}},get:function(b){if(!this.isSupported())return console.log("Cannot get from session storage. Use cookies"),!1;var c=sessionStorage.getItem(this.prefix+b);return a.angular.fromJson(c)},remove:function(a){return this.isSupported()?sessionStorage.removeItem(this.prefix+a):(console.log("Cannot remove item from session storage. Remove from cookies"),!1)},clearAll:function(){if(!this.isSupported())return console.log("Cannot remove all items from session storage. Remove all app cookies"),!1;var a=this.prefix.length;for(var b in sessionStorage)b.substr(0,a)===this.prefix&&sessionStorage.removeItem(b)}}},c.cookieStorageService=function(){return{prefix:b.appName+".",findAll:function(){var a={};return _(document.cookie.split(";")).chain().map(function(a){return a.replace(/^\s+/,"").replace(/\s+$/,"")}).each(function(b){var c=b.split("="),d=c[0],e=null,f=_.size(c);f>1&&(e=c.slice(1).join("")),a[d]=e}),a},get:function(b){var c=null,d=this.findAll();return _.each(d,function(d,e){e===b&&(c=a.angular.fromJson(d))}),c},add:function(b,c,d){var e=new Date,f="undefined"==typeof d?864e5:1e3*d,g=new Date(e.getTime()+f),h={};h[b]=a.angular.toJson(c),h.path="/",null!==d&&(h.expires=g.toGMTString());var i=_.map(h,function(a,c){return["name"==c?b:c,a].join("=")}).join(";");return document.cookie=i,this},remove:function(a){return this.add(a,null,-1),this}}},_.each(c,function(b,c){a.Application.service(c,b)})}(this),function(a){a.Application.service("garbageCollection",["$location","$rootScope",function(b,c){var d=[],e=!0;return{add:function(b){d.push(b),e&&(e=!1,c.$on("$routeChangeSuccess",function(){d.length>0&&(_.each(d,function(b){a.angular.element(b).remove()}),d=[])}))}}}])}(this),function(a){a.Application.service("geographic",["$rootScope","$q","api","localStorageService","currentUser",function(a,b,c,d,e){var f={},g=[],h={},i={AL:"Alabama",AK:"Alaska",AZ:"Arizona",AR:"Arkansas",CA:"California",CO:"Colorado",CT:"Connecticut",DE:"Delaware",DC:"District of Columbia",FL:"Florida",GA:"Georgia",HI:"Hawaii",ID:"Idaho",IL:"Illinois",IN:"Indiana",IA:"Iowa",KS:"Kansas",KY:"Kentucky",LA:"Louisiana",ME:"Maine",MD:"Maryland",MA:"Massachusetts",MI:"Michigan",MN:"Minnesota",MO:"Missouri",MT:"Montana",NE:"Nebraska",NV:"Nevada",NH:"New Hampshire",NJ:"New Jersey",NM:"New Mexico",NY:"New York",NC:"North Carolina",ND:"North Dakota",OH:"Ohio",OK:"Oklahoma",OR:"Oregon",PA:"Pennsylvania",RI:"Rhode Island",SC:"South Carolina",SD:"South Dakota",TN:"Tennessee",TX:"Texas",UT:"Utah",VT:"Vermont",VA:"Virginia",WA:"Washington",WV:"West Virginia",WI:"Wisconsin",WY:"Wyoming"},j={AB:"Alberta",BC:"British Columbia",MB:"Manitoba",NB:"New Brunswick",NF:"Newfoundland",NT:"Northwest Territories",NS:"Nova Scotia",NU:"Nunuvat",ON:"Ontario",PE:"Prince Edward Island",QC:"Quebec",SK:"Saskatchewan",YT:"Yukon Territory"},k=function(a){var b={};_.each(a,function(b,c){var d=moment.tz(b.keyword).format("Z");"+00:00"==d?a[c].gmt="(GMT)":a[c].gmt="(GMT "+d+")"});var c=/(?:[\+|\-]\d+)(?=:\d+)/,d=_.find(a,{id:e.BrandPreferences.timezone_id}),f=c.exec(d.gmt);if(f){var g=f[0];f=g.slice(0,1)+Number(g.slice(1))}else f="+0";return _(a).each(function(a){var d=c.exec(a.gmt);if(d){var e=d[0];d=e.slice(0,1)+Number(e.slice(1))}else d="+0";b[a.keyword]=a,b[a.keyword].hour_offset=Number(d)-Number(f)}),b},l=function(){d.isSupported()&&(f=d.get("countriesObj")||{},h=d.get("timeZones")||{});var a=[];Object.keys(f).length||a.push(c.get("Application/findAllCountries").success(function(a){_.each(a,function(a){var b=a.Country;f[b.code]=b.name}),d.add("countriesObj",f)})),Object.keys(h).length||a.push(c.get("Application/findAllTimezones").success(function(a){h={},_.each(a,function(a,b){a.Timezone.id=b,h[a.Timezone.keyword]=a.Timezone}),d.add("timeZones",h)})),a?b.all(a).then(function(){m()}):m()},m=function(){h=k(h),n.userTimezone=_.find(h,function(a){return a.id===e.UserPreferences.timezone_id}),n.loaded=!0,a.$broadcast("geoInfoLoaded")},n={loaded:!1,getCountries:function(){return 0===g.length&&_.each(f,function(a,b){g.push({name:a,code:b})}),g},getTimezone:function(){var a=d.get("userTimezone");if(a)return a.keyword;var b=jstz.determine().name();if(!b)return"GMT";var c={"Europe/Berlin":"Europe/Amsterdam","Pacific/Honolulu":"America/Adak","America/Halifax":"America/Glace_Bay","Africa/Lagos":"Africa/Algiers","Europe/Helsinki":"Europe/Athens","Africa/Johannesburg":"Africa/Cairo","Asia/Baghdad":"Africa/Addis_Ababa","Asia/Shanghai":"Asia/Hong_Kong","Pacific/Fiji":"Etc/GMT-12"};if(c[b])return c[b];var e=_(h).find({keyword:b});return e?e.keyword:"America/Los_Angeles"},setUserTimezone:function(a){var b=_(h).find({keyword:a});b&&d.add("userTimezone",b)},getTimezones:function(){return h},determineCountryNiceName:function(a){return f[a]||a},getCountryRegions:function(a){var b=null;if(!a)return null;switch(a.toLowerCase()){case"ca":b=j;break;case"us":b=i;break;default:return null}var c=[];return _.each(b,function(a,b){c.push({name:a,code:b})}),c}};return e.isLoaded&&(e.hashChange&&d.remove("timeZones"),l()),a.$on("UserLoaded",function(a,b,c){b&&c&&d.remove("timeZones")}),a.$on("UserLoaded",function(a,b){b&&l()}),n}])}(this),function(a){a.Application.service("hasSession",["$rootScope","$q","cookieStorageService","currentUser","api",function(b,c,d,e,f){return{loggedIn:null,init:function(){a.Config.logout?(b.addReturnLocation(),d.add("publisher_from_page",b.returnLocation,300),window.top.location.href="/login"):d.remove("publisher_from_page"),a.Config.affiliate_id&&a.Config.affiliate_user_id&&a.Config.session_token&&!this.loggedIn&&(this.loggedIn=!0,e.refresh());var c=this;b.$on("http_status_401",function(){c.loggedIn&&c.logOut(),c.loggedIn=!1,c.emitState()}),this.isLoggedIn()},isLoggedIn:function(){var a=c.defer(),d=this;return _.isNull(this.loggedIn)?b.$on("sessionLogin",function(b,c){c===!0?a.resolve(!0):a.reject(!1),d.emitState()}):(this.loggedIn===!0?a.resolve(!0):a.reject(!1),d.emitState()),a.promise},logOut:function(){f.get("Authentication/destroySessionToken",{SessionToken:a.Config.session_token});return window.top.location.href="/logout"},emitState:function(){b.$broadcast("sessionLogin",this.loggedIn)}}}])}(this),function(a){a.Application.service("digestService",function(){return{md5:function(a){function b(a,b,c,d,e,f){return b=l(l(b,a),l(d,f)),l(b<<e|b>>>32-e,c)}function c(a,c,d,e,f,g,h){return b(c&d|~c&e,a,c,f,g,h)}function d(a,c,d,e,f,g,h){return b(c&e|d&~e,a,c,f,g,h)}function e(a,c,d,e,f,g,h){return b(c^d^e,a,c,f,g,h)}function f(a,c,d,e,f,g,h){return b(d^(c|~e),a,c,f,g,h)}function g(a,b){var g=a[0],h=a[1],i=a[2],j=a[3];g=c(g,h,i,j,b[0],7,-680876936),j=c(j,g,h,i,b[1],12,-389564586),i=c(i,j,g,h,b[2],17,606105819),h=c(h,i,j,g,b[3],22,-1044525330),g=c(g,h,i,j,b[4],7,-176418897),j=c(j,g,h,i,b[5],12,1200080426),i=c(i,j,g,h,b[6],17,-1473231341),h=c(h,i,j,g,b[7],22,-45705983),g=c(g,h,i,j,b[8],7,1770035416),j=c(j,g,h,i,b[9],12,-1958414417),i=c(i,j,g,h,b[10],17,-42063),h=c(h,i,j,g,b[11],22,-1990404162),g=c(g,h,i,j,b[12],7,1804603682),j=c(j,g,h,i,b[13],12,-40341101),i=c(i,j,g,h,b[14],17,-1502002290),h=c(h,i,j,g,b[15],22,1236535329),g=d(g,h,i,j,b[1],5,-165796510),j=d(j,g,h,i,b[6],9,-1069501632),i=d(i,j,g,h,b[11],14,643717713),h=d(h,i,j,g,b[0],20,-373897302),g=d(g,h,i,j,b[5],5,-701558691),j=d(j,g,h,i,b[10],9,38016083),i=d(i,j,g,h,b[15],14,-660478335),h=d(h,i,j,g,b[4],20,-405537848),g=d(g,h,i,j,b[9],5,568446438),j=d(j,g,h,i,b[14],9,-1019803690),i=d(i,j,g,h,b[3],14,-187363961),h=d(h,i,j,g,b[8],20,1163531501),g=d(g,h,i,j,b[13],5,-1444681467),j=d(j,g,h,i,b[2],9,-51403784),i=d(i,j,g,h,b[7],14,1735328473),h=d(h,i,j,g,b[12],20,-1926607734),g=e(g,h,i,j,b[5],4,-378558),j=e(j,g,h,i,b[8],11,-2022574463),i=e(i,j,g,h,b[11],16,1839030562),h=e(h,i,j,g,b[14],23,-35309556),g=e(g,h,i,j,b[1],4,-1530992060),j=e(j,g,h,i,b[4],11,1272893353),i=e(i,j,g,h,b[7],16,-155497632),h=e(h,i,j,g,b[10],23,-1094730640),g=e(g,h,i,j,b[13],4,681279174),j=e(j,g,h,i,b[0],11,-358537222),i=e(i,j,g,h,b[3],16,-722521979),h=e(h,i,j,g,b[6],23,76029189),g=e(g,h,i,j,b[9],4,-640364487),j=e(j,g,h,i,b[12],11,-421815835),i=e(i,j,g,h,b[15],16,530742520),h=e(h,i,j,g,b[2],23,-995338651),g=f(g,h,i,j,b[0],6,-198630844),j=f(j,g,h,i,b[7],10,1126891415),i=f(i,j,g,h,b[14],15,-1416354905),h=f(h,i,j,g,b[5],21,-57434055),g=f(g,h,i,j,b[12],6,1700485571),j=f(j,g,h,i,b[3],10,-1894986606),i=f(i,j,g,h,b[10],15,-1051523),h=f(h,i,j,g,b[1],21,-2054922799),g=f(g,h,i,j,b[8],6,1873313359),j=f(j,g,h,i,b[15],10,-30611744),i=f(i,j,g,h,b[6],15,-1560198380),h=f(h,i,j,g,b[13],21,1309151649),g=f(g,h,i,j,b[4],6,-145523070),j=f(j,g,h,i,b[11],10,-1120210379),i=f(i,j,g,h,b[2],15,718787259),h=f(h,i,j,g,b[9],21,-343485551),a[0]=l(g,a[0]),a[1]=l(h,a[1]),a[2]=l(i,a[2]),a[3]=l(j,a[3])}function h(a){var b,c=a.length,d=[1732584193,-271733879,-1732584194,271733878];for(b=64;c>=b;b+=64)g(d,i(a.substring(b-64,b)));a=a.substring(b-64);var e=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],f=a.length;for(b=0;f>b;b++)e[b>>2]|=a.charCodeAt(b)<<(b%4<<3);if(e[b>>2]|=128<<(b%4<<3),b>55)for(g(d,e),b=16;b--;)e[b]=0;return e[14]=8*c,g(d,e),d}function i(a){var b,c=[];for(b=0;64>b;b+=4)c[b>>2]=a.charCodeAt(b)+(a.charCodeAt(b+1)<<8)+(a.charCodeAt(b+2)<<16)+(a.charCodeAt(b+3)<<24);return c}function j(a){for(var b="",c=0;4>c;c++)b+=m[a>>8*c+4&15]+m[a>>8*c&15];return b}function k(a){for(var b=a.length,c=0;b>c;c++)a[c]=j(a[c]);return a.join("")}function l(a,b){return a+b&4294967295}function l(a,b){var c=(65535&a)+(65535&b),d=(a>>16)+(b>>16)+(c>>16);return d<<16|65535&c}var m="0123456789abcdef".split("");return"5d41402abc4b2a76b9719d911017c592"!=k(h("hello")),k(h(a))}}})}(this),function(a){a.Application.service("models",["$injector",function(b){return{get:function(a){var b=this.getExtendable(a);return new b},getExtendable:function(c){var d=a.Models[c];if(!d)throw new Error("No model found named "+c);return b.invoke(d)}}}])}(this),function(a){a.Application.service("nonceService",["$http","$location",function(a,b){return{generateNonce:function(){var c=b.protocol()+"://"+b.host()+"/custom_pages/ajax_generate_nonce";return a.get(c)}}}])}(this),function(a){a.Application.service("pageState",["$location","$rootScope","urlArg",function(a,b,c){var d,cache={},e=[],f=/^([^\?#]*)(\?([^#]*))?(#(.*))?$/,g=function(){cache={}};g.prototype.pageSettings=function(a){var b=h();_.has(a,"canonical")&&(d.setCanonical(b,a.canonical),b=a.canonical)},g.prototype.get=function(a){return a=h(a),k(),cache[a]||{}},g.prototype.set=function(a,b){b=h(b),cache[b]=a,e.push(b),b==h()&&i()},g.prototype.reset=function(a){d.set({},h(a)),(_.isUndefined(a)||a==h())&&i()};var h=function(b){return _.isUndefined(b)&&(b=a.path()),"/"==b.charAt(0)&&(b=b.substr(1)),b},i=function(b){var d=h(),e={},f=c.stringify(cache[d]||{}).split("&");_.each(f,function(b){if(!_.isEmpty(b)){var d=b.split("=");2!=d.length||_.isNull(d[1])||_.isUndefined(d[1])||(e[c.tryDecodeURIComponent(d[0])]=!0,a.search(c.tryDecodeURIComponent(d[0]),c.tryDecodeURIComponent(d[1])).replace())}})},j=function(){var b=f.exec(a.url());_.isEmpty(b[3])||d.set(c.parse(b[3]))},k=_.throttle(function(){j()},100,{trailing:!1});_.throttle(function(){var a=h();e.length>0&&(_.each(_.unique(e),function(b){b!=a&&delete cache[b]}),e=[])},100,{trailing:!1});return d=new g}])}(window),function(a){a.Application.service("publicEventService",["$rootScope","currentUser",function(a,b){var c,d=function(){this.ee=window.publicEvent};return d.prototype.init=function(){a.$on("$routeChangeSuccess",function(){c.ee.emitEvent("routeChangeSuccess")}),a.$on("UserLoaded",function(a,d){if(d){var e=[{Affiliate:b.Affiliate,AffiliateUser:b.AffiliateUser,Brand:b.Brand,AccountManager:b.AccountManager}];c.ee.emitEvent("currentUserDataLoaded",e)}})},c=new d}])}(this),function(a){a.Application.service("timeoutQueue",["cache",function(cache){var b=function(b){var c={queue:{},inProgress:{},timeout:null,defaults:{namespace:"",key:"",defaultValue:"",timeoutLength:100,cacheTimeout:120,getPromise:a.angular.noop,processData:a.angular.noop,postProcess:a.angular.noop},init:function(){this.options=$.extend({},this.defaults,b)},enqueue:function(b,c){if(c instanceof $){var d=this.cacheGet(b,this.options.cacheTimeout);if(null!==d)return c.html(d),void this.options.postProcess.call(this);this.queue[b]=c,a.clearTimeout(this.timeout),function(b){b.timeout=a.setTimeout(function(){b.process.apply(b)},b.options.timeoutLength)}(this)}},process:function(){var a=_.keys(this.queue),b=this;this.inProgress=$.extend(this.inProgress,this.queue),this.queue={};var c=this.options.getPromise.call(this.options.getPromise,a);c.success(function(c){b.options.processData.call(b,c,a),_.each(a,function(a){var c=b.cacheGet(a);null===c&&(b.cachePut(a,b.options.defaultValue),c=b.options.defaultValue),b.inProgress[a].html(c),delete b.inProgress[a]}),b.options.postProcess.call(b)})},cachePut:function(a,b){cache.put(this.options.namespace,this.options.key+"_"+a,b)},cacheGet:function(a,b){return cache.get(this.options.namespace,this.options.key+"_"+a,b)}};return c.init(),c};return{factory:function(a){return new b(a)}}}])}(this),function(a){a.Application.service("urlArg",[function(){var a,b=function(){};return b.prototype.tryDecodeURIComponent=function(a){try{return decodeURIComponent(a)}catch(b){return a}},b.prototype.parse=function(b){if(!b)return{};if(-1===b.indexOf("=")&&-1===b.indexOf("&"))return{};var c={},d=b.split("&");return _.each(d,function(b){var d=b.split("="),e=a.tryDecodeURIComponent(d[0]),f=a.tryDecodeURIComponent(d[1]);a._access(c,e,f)}),c},b.prototype.coerceMode=!0,b.prototype._access=function(b,c,d){var e="undefined"!=typeof d,f=-1,g={"true":!0,"false":!1,"null":null};if(_.isString(c)&&(f=c.search(/[\.\[]/)),-1===f)return a.coerceMode&&(d=d&&!isNaN(d)?+d:"undefined"===d?void 0:void 0!==g[d]?g[d]:d),e?b[c]=d:b[c];var h=c.substr(0,f),i=c.substr(f+1);switch(c.charAt(f)){case"[":return b[h]=b[h]||[],i=i.replace("]",""),-1===i.search(/[\.\[]/)&&(i=parseInt(i,10)),a._access(b[h],i,d);case".":return b[h]=b[h]||{},a._access(b[h],i,d)}return b},b.prototype.stringify=function(b,c){switch(typeof b){case"object":var d,e=[];for(var f in b)if(b.hasOwnProperty(f)){var g=b[f];_.isEmpty(f)||_.isUndefined(g)||_.isNull(g)||(d=c?c+"."+f:f,_.isArray(b)&&(d=c?c+"["+f+"]":f),_.isObject(g)?e.push(a.stringify(g,d)):e.push(encodeURIComponent(a.tryDecodeURIComponent(d))+"="+encodeURIComponent(a.tryDecodeURIComponent(g))))}return e.join("&")}return encodeURIComponent(a.tryDecodeURIComponent(b))},a=new b}])}(window),function(a){a.Application.service("util",function(){return{convertForOptions:function(a){var b=[];return _(a).each(function(a,c){b.push({key:c,value:a})}),b}}})}(this),function(a){var b=["api","models",function(b,c){var d=c.getExtendable("base").extend({name:"affiliates",init:function(){this._super()},getAffiliate:function(){var c={id:a.Config.affiliate_id,contain:{0:"PaymentMethod",1:"AffiliateMeta"}};return b.get("Affiliate/findById",c)},updateAffiliate:function(a){return b.get("Affiliate/update",a)},updateAffiliateTaxId:function(a){return b.get("AffiliateBilling/updateTaxId",{tax_id:a})}});return d}];a.Models.affiliate=b}(this),function(a){var b=["api","models",function(b,c){var d=c.getExtendable("base").extend({name:"affiliateUser",init:function(){this._super()},get:function(b){return a.Api.get("AffiliateUser/findById",{id:b})},update:function(b){return a.Api.get("AffiliateUser/update",b)},create:function(b){return a.Api.get("AffiliateUser/create",b)},setPermissions:function(b,c){c&&"Affiliate"===c[0]&&c.shift();var d={affiliate_user_id:b,permissions:c};a.Api.get("AffiliateUser/setPermissions",d)},getAllAffiliateUsers:function(b){var c=a.Api.get("AffiliateUser/findAll",b).success(function(a){var b=[];return _.each(a.data,function(a){b.push(a.AffiliateUser)}),a.data=b,a});return c},getDefinition:function(){return{entity:"AffiliateUser",nicename:"AffiliateUser",nameField:"email",fields:{id:this.getStandardDef("id"),affiliate_id:{type:"integer"},email:{type:"string"},first_name:{type:"string"},last_name:{type:"string"},status:{type:"enum",values:{active:"Active",blocked:"Blocked",deleted:"Deleted"}},title:{type:"string"},phone:{type:"string"},cell_phone:{type:"string"},permissions:{type:"string"},access:{type:"array"},wants_alerts:{type:"enum",values:{0:"No",1:"Yes"}},is_creator:{type:"enum",values:{0:"No",1:"Yes"}},user_id:{type:"int"},join_date:this.getStandardDef("created"),modified:this.getStandardDef("modified"),last_login:this.getStandardDef("modified")}}},isValidPassword:function(a){return/^[a-zA-Z0-9]{4,16}$/.test(a)},isValidEmail:function(a){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a)}});return d}];a.Models.affiliateUser=b}(this),function(a){var b=["api","models",function(b,c){var d=c.getExtendable("base").extend({name:"Application",init:function(){this._super()},timezoneCache:null,findAllTimezones:function(c){var d=this,e=new c.defer;return d.timezoneCache?e.resolve(a.angular.copy(d.timezoneCache)):b.get("Application/findAllTimezones").success(function(b){d.timezoneCache=b,e.resolve(a.angular.copy(d.timezoneCache))}),e.promise}});return d}];a.Models.Application=b}(this),function(a){var b=["api","models",function(b,c){var d=c.getExtendable("base").extend({name:"billing",init:function(){this._super()},getPaymentHistory:function(a){return b.get("AffiliateBilling/findAllInvoices",a)},getAccountBalance:function(c,d){d=$.extend(d,{id:a.Config.affiliate_id});var e=b.get("Affiliate/getAccountBalance",d);return e.success(function(a){c.account_balance=a}),e},getPayoutTotals:function(c){var d=moment().format("YYYY"),e={affiliate_id:a.Config.affiliate_id,timeframes:[{label:"alltime",start_date:"2001-01-01",end_date:d+"-12-31"},{label:"this_year",start_date:d+"-01-01",end_date:d+"-12-31"}]},f=b.get("AffiliateBilling/getPayoutTotals",e);return f.success(function(a){c.payout_to_date=a.alltime.total_payout,c.payout_year=a.this_year.total_payout}),f},getPayoneerSignupLink:function(){var a=window.location.protocol+"//"+window.location.host,c=a+window.location.pathname+"complete/payoneer/";return b.get("Affiliate/getPayoneerSignupUrl",{redirect_url:c})},getPaymentHistoryDefinition:function(){return{entity:"AffiliateInvoice",fields:{id:{type:"integer"},affiliate_id:{type:"integer"},start_date:{type:"timestamp"},end_date:{type:"timestamp"},status:{type:"enum",values:{active:"Active",deleted:"Deleted"}},memo:{type:"string"},notes:{type:"string"},is_paid:{type:"enum",values:{0:"Pending",1:"Paid"}},receipt_id:{type:"integer"},currency:{type:"string"},datetime:{type:"timestamp"},amount:{type:"currency"},impressions:{type:"integer"},clicks:{type:"integer"},conversions:{type:"integer"},revenue:{type:"currency"},sale_amount:{type:"currency"}}}}});return d}];a.Models.billing=b}(this),function(a){var b=["api","models","$q","currentUser",function(b,c,d,e){var f=c.getExtendable("reportsBase").extend({name:"conversionReport",init:function(){this._super()},filterList:[],getDefinition:function(){return a.angular.copy(this.conversionReportDefinition)},getOptions:function(){return a.angular.copy(this.conversionReportsOptions)},getColumnOrder:function(){return a.angular.copy(this.conversionReportsOrder)},getDownloadReportLink:function(a){return this.addDateFilter(a),this.generateReportDownload("getConversions",a.data_start,a.data_end,a)},getReportData:function(a){this.addDateFilter(a),a.fields=_.reject(a.fields,function(a){return-1!==a.indexOf("@")}),_.each(_.keys(a.sort||{}),function(b){_.contains(a.fields,b)||delete a.sort[b]});var c=b.get("Report/getConversions",a);return c},getDefaultReport:function(){var b=a.angular.copy(this.conversionReportsDefaultReport);return _.has(window.PI_DEFAULT_REPORT_FIELDS,"conversion")&&_.isArray(window.PI_DEFAULT_REPORT_FIELDS.conversion)&&window.PI_DEFAULT_REPORT_FIELDS.conversion.length&&(b.fields=window.PI_DEFAULT_REPORT_FIELDS.conversion),b},determineNicename:function(a,b){return b=b||this.getDefinition(),this._super(a,b)},getFilterList:function(){var b=this;return 0===_.size(b.filterList)&&(b.filterList=[],_.each(b.reportFilterList,function(a){_.indexOf(b.conversionReportFilterList,a.value)>-1&&b.filterList.push(a)})),a.angular.copy(b.filterList)},getConversionStatusChoices:function(a,b){var c=d.defer(),f=e.getPreferenceValue("affiliate_conversion_access")||"",g=[{value:"approved",label:"Approved"}];-1!==f.indexOf("pending")&&g.push({value:"pending",label:"Pending"}),-1!==f.indexOf("rejected")&&g.push({value:"rejected",label:"Rejected"});var h=b.property;return a[h]=g,c.resolve(),c.promise},getColumnWidth:function(){}});return f}];a.Models.conversionReport=b}(this),function(a){var b=["api","models",function(a,b){var c=b.getExtendable("base").extend({name:"currencies",init:function(){this._super()},getCurrencies:function(b){var c={};a.get("Currency/getCurrencies").success(function(a){_.each(a,function(a){var b="%s%v";"1"===a.is_rtl?b="%v%s":"after"===a.symbol_position&&(b="%v%s");var d=a.symbol;a.space_between&&(d="before"===a.symbol_position?a.symbol+Array(1).fill("").join(""):Array(1).fill("").join("")+a.symbol),c[a.code]={symbol:d,format:b,decimal:""===a.decimal_separator?".":a.decimal_separator,thousand:""===a.thousands_separator?",":a.thousands_separator,precision:parseInt(a.decimal_digits>0?a.decimal_digits:2)}}),b(c)})}});return c}];a.Models.currency=b}(this),function(a){var b=["api","models",function(a,b){var c=b.getExtendable("base").extend({name:"invoice",init:function(){this._super()},getInvoice:function(b){var c={id:b,contain:["InvoiceItem","Affiliate","PaymentMethod"]};return a.get("AffiliateBilling/findInvoiceById",c)},getReceipt:function(b){var c={id:b,contain:["Invoice"]};return a.get("AffiliateBilling/findReceiptById",c)}});return c}];a.Models.invoice=b}(this),function(a){var b=["api","models","$q","$timeout","currentUser",function(a,b,c,d,e){var f=b.getExtendable("base").extend({getLanguageOptions:function(){return[{language:"cz",label:"Czech"},{language:"en",label:"English"},{language:"fr",label:"French"},{language:"de",label:"German"},{language:"it",label:"Italian"},{language:"ja",label:"Japanese"},{language:"ko",label:"Korean"},{language:"es",label:"Spanish"},{language:"pl",label:"Polish"},{language:"pt",label:"Portuguese"},{language:"ru",label:"Russian"},{language:"zn",label:"Simplified Chinese"},{language:"tc",label:"Traditional Chinese"},{language:"tr",label:"Turkish"},{language:"vn",label:"Vietnamese"}]},getLabelByLanguage:function(a){var b=this.getLanguageOptions();return _.filter(b,{language:a})},getSelectedLanguage:function(){e.refresh();var a=e.getUserPreferenceValue("language")||window.lang,b=this.getLabelByLanguage(a);return a&&b.length>0?{language:a,label:b[0].label}:{language:"en",label:"English"}},setLanguage:function(a){return e.setPreferenceValue("language",a.language)}});return f}];a.Models.language=b}(this),function(a){var b=["api","models","cache","$q",function(b,c,cache,d){var e=c.getExtendable("base").extend({name:"messages",init:function(){this._super()},convertLocalTime:function(b){var c=a.ChartFactory.getHelper(),d=c.mySqlDateTime(b),e=new Date(d.getTime()+-1*d.getTimezoneOffset()*60*1e3);return e},formatMessage:function(a){if(a.Alert.datetime=this.convertLocalTime(a.Alert.datetime),_.hasMembers(a,"Alert","data","offer_id")){var b=a.Alert.description,c=a.Alert.data.offer_id,d=b.match(/Your application to (.*) has been/);b&&d[1]&&(b=b.replace(d[1],'<a href="#!/offer/'+c+'">'+d[1]+"</a>")),a.Alert.description=b}else-1!=a.Alert.description.search(/<a href="\/offers\/view\//)&&(a.Alert.description=a.Alert.description.replace('<a href="/offers/view/','<a href="#!/offer/'));return a},getMessage:function(a,c){var d=this,e=b.get("Alert/findById",{id:a});e.success(function(a){c.message=d.formatMessage(a)})},getMessageCount:function(){throw new Error("getMessageCount currently incorrect")},getMessages:function(c){c=$.extend({affiliate_user_id:a.Config.affiliate_user_id,is_dismissed:"0"},c),c.limit=c.limit||100,c.page=c.page||1;var e=b.get("Alert/getAffiliateUserAlerts",c),f=this.name,g=d.defer(),h=this;return e.success(function(b){var c=[];b.data||(b={data:b}),_(b.data).each(function(a){c.push(h.formatMessage(a))}),b.data=c,cache.put(f,"messages",a.angular.copy(b)),g.resolve(b)}),g.promise},dismissMessage:function(c){return c=$.extend(c,{affiliate_user_id:a.Config.affiliate_user_id}),b.get("Alert/dismissAffiliateUserAlert",c)},getDefinition:function(){return{entity:"Alert",fields:{id:{type:"integer"},title:{type:"string"},description:{type:"string"},content:{type:"string"},status:{type:"enum",values:{active:"Active",deleted:"Deleted"}},datetime:{type:"daterelative"},type_code:{type:"integer"},employee_id:{type:"integer"},data:{type:"text"},ref_affiliate_id:{type:"integer"},ref_key:{type:"string"},ref_id:{type:"integer"}},related_entities:{AffiliateUserAlert:{fields:{id:{type:"integer"},affiliate_user_id:{type:"integer"},alert_id:{type:"integer"},is_dismissed:{type:"enum",values:{0:!1,1:!0}}}}}}}});return e}];a.Models.messages=b}(this),function(a){var b=["api","models",function(a,b){var c=b.getExtendable("base").extend({name:"notifications",init:function(){this._super()},getNotifications:function(){return a.get("Notification/getUserSubscriptions")},getNotificationOptOuts:function(){return a.get("NotificationCenter/getEventOptOuts")},setNotifications:function(b){return 0===b.length?a.get("Notification/clearUserSubscriptions",{}):a.get("Notification/replaceUserSubscriptions",{scenario_ids:b})},setNotificationOptOuts:function(b){return a.get("NotificationCenter/replaceEventOptOuts",{opt_outs:b})},getOptOutDefinition:function(){return[{groupLabel:"settings.alert.groupLabel.automation",groupDescription:"settings.alert.groupDescription.automation-descriptions",options:[{label:"settings.alert.options.optimizer_high_cr_block",optimizerType:"high_cr_block",fields:{email:{selected:!0},app:{selected:!0}}},{label:"settings.alert.options.optimizer_high_cr_warning",optimizerType:"high_cr_warning",fields:{email:{selected:!0},app:{selected:!0}}},{label:"settings.alert.options.optimizer_low_cr_block",optimizerType:"low_cr_block",fields:{email:{selected:!0},app:{selected:!0}}},{label:"settings.alert.options.optimizer_low_cr_warning",optimizerType:"low_cr_warning",fields:{email:{selected:!0},app:{selected:!0}}},{label:"settings.alert.options.optimizer_low_performance_block",optimizerType:"low_performance_block",fields:{email:{selected:!0},app:{selected:!0}}},{label:"settings.alert.options.optimizer_low_performance_warning",optimizerType:"low_performance_warning",fields:{email:{selected:!0},app:{selected:!0}}}]}]},getDefinition:function(){return[{groupLabel:"settings.alert.groupLabel.offers",groupDescription:"settings.alert.groupDescription.offers-descriptions",options:[{scenario_id:17,selected:!1,name:"offer-cap-approaching",label:"settings.alert.options.offer-cap-approaching"},{scenario_id:29,selected:!1,name:"offer-cap-reaches",label:"settings.alert.options.offer-cap-reaches"},{scenario_id:18,selected:!1,name:"offer-expires",label:"settings.alert.options.offer-expires"},{scenario_id:19,selected:!1,name:"offer-status-change",label:"settings.alert.options.offer-status-change"},{scenario_id:23,selected:!1,name:"offer-payout-change",label:"settings.alert.options.offer-payout-change"},{scenario_id:10,selected:!1,name:"offer-approved",label:"settings.alert.options.offer-approved"}]},{groupLabel:"settings.alert.groupLabel.invoices",groupDescription:"settings.alert.groupDescription.invoices-descriptions",options:[{scenario_id:9,selected:!1,name:"invoice-paid",label:"settings.alert.options.invoice-paid"}]},{groupLabel:"settings.alert.groupLabel.tune-networks",groupDescription:"settings.alert.groupDescription.automation-descriptions",options:[{scenario_id:47,selected:!1,name:"tune-network-connection-request",label:"settings.alert.options.tune-network-brand-request-to-connect"}]}]}});return c}];a.Models.notifications=b}(this),function(a){var b=["api","models",function(b,c){var d=c.getExtendable("base").extend({name:"receipts",init:function(){this._super()},getReceipts:function(){var c={filters:{affiliate_id:a.Config.affiliate_id},contain:["Invoice"]};return b.get("AffiliateBilling/findAllReceipts",c)},getDefinition:function(){return{entity:"AffiliateReceipt",nicename:"Receipt",fields:{id:{type:"integer"},affiliate_id:{type:"integer"},amount:{type:"currency"},datetime:{type:"timestamp"},date:{type:"string"},memo:{type:"string"},notes:{type:"string"},transaction_id:{type:"string"},currency:{type:"string"},token_id:{type:"string"},payment_ref_id:{type:"string"},payment_info:{type:"object"},status:{type:"enum",values:{pending:"Pending",success:"Success",failed:"Failed",deleted:"Deleted"}},method:{type:"enum",values:{check:"Check",direct_deposit:"Direct Deposit",other:"Other",payoneer:"Payoneer",paypal:"PayPal",wire:"Wire"}}},related_entities:{AffiliateInvoice:{nicename:"Invoice",groupable:!0,fields:{id:{type:"integer"},affiliate_id:{type:"integer"},start_date:{type:"timestamp"},end_date:{type:"timestamp"},status:{type:"enum",values:{active:"Active",deleted:"Deleted"}},memo:{type:"string"},notes:{type:"string"
},is_paid:{type:"enum",values:{0:"Pending",1:"Paid"}},receipt_id:{type:"integer"},currency:{type:"string"},datetime:{type:"timestamp"},amount:{type:"currency"},impressions:{type:"integer"},clicks:{type:"integer"},conversions:{type:"integer"},actions:{type:"integer"},revenue:{type:"currency"},sale_amount:{type:"currency"}}}}}}});return d}];a.Models.receipts=b}(this),function(a){var b=["api","models",function(b,c){var d=c.getExtendable("reportsBase").extend({name:"referralReport",init:function(){this._super()},filterList:[],getDefinition:function(){return a.angular.copy(this.referralReportDefinition)},getReportData:function(a){return b.get("Report/getAffiliateCommissions",a)},getReferralList:function(){return b.get("Report/getAffiliateReferrals")},determineNicename:function(a,b){return b=b||this.getDefinition(),this._super(a,b)}});return d}];a.Models.referralReport=b}(this),function(a){var b=["api","models","currentUser",function(b,c,d){var e=c.get("offers"),f=c.getExtendable("base").extend({init:function(){var a=["Stat.offer_id"],b=["Stat.datetime"];if(d.getPreferenceValue("affiliate_sale_amount")===!0&&this.statsReportsOptions[1].optionsList[1].push("Stat.sale_amount"),d.getPreferenceValue("click_display_both")===!0&&(_.contains(this.statsReportsOptions[1].optionsList[0],"Stat.gross_clicks")||(this.statsReportsOptions[1].optionsList[0].push("Stat.gross_clicks"),this.statsReportsOptions[1].optionsList[0].push("Stat.unique_clicks"),d.hasFeature("FRAUD_STATS_REPORT")&&this.statsReportsOptions[2].optionsList[0].splice(2,0,"Stat.unique_click_rate"))),d.hasFeature("FRAUD_STATS_REPORT")){this.statsReportsOptions[1].optionsList[0].push("Stat.suspicious_clicks"),this.statsReportsOptions[1].optionsList[0].push("Stat.rejected_clicks");var c=_.contains(this.statsReportsOptions[2].optionsList[0],"Stat.unique_click_rate")?3:2;this.statsReportsOptions[2].optionsList[0].splice(c,0,"Stat.rejected_click_rate"),this.statsReportsOptions[2].optionsList[0].splice(c+1,0,"Stat.suspicious_click_rate")}d.hasFeature("PAYOUT_STRUCTURE_PI_REPORTING")&&(this.statsReportsOptions[0].optionsList[0].push("PayoutStructure.name"),this.conversionReportsOptions[1].optionsList[1].push("PayoutStructure.name")),d.getPreferenceValue("enable_cashflow_groups")===!0&&(_.contains(this.conversionReportsOptions[1].optionsList[0],"PayoutGroup.name")||(this.conversionReportsOptions[1].optionsList[0].length>1?this.conversionReportsOptions[1].optionsList[0].splice(-1,0,"PayoutGroup.name"):this.conversionReportsOptions[1].optionsList[0].push("PayoutGroup.name"))),d.getPreferenceValue("show_mobile_tracking_params")!==!0&&(this.conversionReportsOptions[2].hidden=!0),this.statsReportsOrder=_.union(a,_.chain(this.statsReportsOptions).clone().pluck("optionsList").flatten().reject(function(b){return _.indexOf(a,b)>-1}).value());var e=this.statsReportsOrder;_.forEach(["Stat.unique_click_rate","Stat.suspicious_click_rate","Stat.rejected_click_rate"],function(a){if(_.contains(e,a)){var b=a.replace("_rate","s"),c=e.indexOf(b),d=e.indexOf(a);e.splice(d,1),e.splice(c+1,0,a)}}),this.conversionReportsOrder=_.union(b,_.chain(this.conversionReportsOptions).clone().pluck("optionsList").flatten().reject(function(a){return _.indexOf(b,a)>-1}).value())},processOptionsToSelectors:function(a,b){var c=this;return _.each(a,function(d,e){a[e].options=_.map(d.optionsList,function(a){var d=[];return _.each(a,function(a){d[d.length]={field:a,label:c.determineNicename(a,b)}}),d})}),a},getSelectorOptions:function(){return this.processOptionsToSelectors(this.getOptions(),this.getDefinition())},getOptions:function(){throw new Error("method 'getOptions' must be declared in "+this.name)},getDefinition:function(){throw new Error("method 'getDefinition' must be declared in "+this.name)},getNameField:function(a){var b;return b=this.getDefinition(),b.related_entities&&b.related_entities[a]&&b.related_entities[a].nameField?b.related_entities[a].nameField:"{0}.name".format(a)},getIdField:function(a){var b;return b=this.getDefinition(),b.related_entities&&b.related_entities[a]&&b.related_entities[a].idField?b.related_entities[a].idField:"{0}.id".format(a)},getIntervalOptions:function(){return[{field:"Stat.hour",label:"reports.chart.intervalOptions.hourOfDay"},{field:"Stat.datehour",label:"reports.chart.intervalOptions.hour"},{field:"Stat.date",label:"reports.chart.intervalOptions.day"},{field:"Stat.week",label:"reports.chart.intervalOptions.week"},{field:"Stat.month",label:"reports.chart.intervalOptions.month"},{field:"Stat.year",label:"reports.chart.intervalOptions.year"}]},generateReportDownload:function(a,c,d,e,f,g){var h={method:a,start_date:c,end_date:d,arguments:e};return b.get("DownloadReport/getDownloadReportLink",h,f,g)},determineFiltersFromParam:function(c,d){var e=a.Formatter.titleCaps(d.entity),f=this.determineNicename(e),g=this.getNameField(e),h=b.get("{0}/findById".format(e),{id:d.id,fields:["id","name",g]}),i=_.find(this.reportFilterList,function(a){return a.value==e}),j=function(a){var b=g.split(".").pop(),h="";_.hasMembers(a,e,b)&&(h=a[e][b]),c.selectedFilters=[{id:0,matchType:"exact",entity:e,field:i.field?i.field:!1,value:d.id,label:"{0}: {1}".format(f,h)}];var j=g;-1!==g.indexOf(".")&&(j=g.split(".").pop()),c.pageTitle=c.pageTitle+": {0} {1}".format(f,h),c.applyPanelFn("filters")};h.success(j),h.error(j)},currencyFields:a.Config.Enums.currencyFields,reportFilterList:[{value:"",label:"Select filters to add",dataCall:void 0},{value:"Offer",label:"Filter: Offers",dataCall:$.proxy(e.getOfferChoices,e)},{value:"Goal",label:"Filter: Goals",dataCall:$.proxy(e.getGoalChoices,e)},{value:"Category",field:"Category.id",label:"Filter: Category",dataCall:$.proxy(e.getCategoryChoices,e)},{value:"OfferUrl",field:"Stat.offer_url_id",label:"Filter: Offer Urls",dataCall:$.proxy(e.getOfferUrlChoices,e)},{value:"OfferFile",field:"Stat.offer_file_id",label:"Filter: Offer Files",dataCall:$.proxy(e.getOfferFileChoices,e)},{value:"Country",field:"Country.code",label:"Filter: Countries",dataCall:$.proxy(e.getCountryChoices,e)},{value:"Sub ID 1",field:"Stat.affiliate_info1",label:"Filter: Sub ID 1",dataCall:null,matchType:"wild"},{value:"Sub ID 2",field:"Stat.affiliate_info2",label:"Filter: Sub ID 2",dataCall:null,matchType:"wild"},{value:"Sub ID 3",field:"Stat.affiliate_info3",label:"Filter: Sub ID 3",dataCall:null,matchType:"wild"},{value:"Sub ID 4",field:"Stat.affiliate_info4",label:"Filter: Sub ID 4",dataCall:null,matchType:"wild"},{value:"Sub ID 5",field:"Stat.affiliate_info5",label:"Filter: Sub ID 5",dataCall:null,matchType:"wild"},{value:"Advertiser Sub ID",field:"Stat.advertiser_info",label:"Filter: Advertiser Sub ID",dataCall:null,matchType:"wild"},{value:"Advertiser Sub ID 2",field:"ConversionsMobile.adv_sub2",label:"Filter: Advertiser Sub ID 2",dataCall:null,matchType:"wild"},{value:"Advertiser Sub ID 3",field:"ConversionsMobile.adv_sub3",label:"Filter: Advertiser Sub ID 3",dataCall:null,matchType:"wild"},{value:"Advertiser Sub ID 4",field:"ConversionsMobile.adv_sub4",label:"Filter: Advertiser Sub ID 4",dataCall:null,matchType:"wild"},{value:"Advertiser Sub ID 5",field:"ConversionsMobile.adv_sub5",label:"Filter: Advertiser Sub ID 5",dataCall:null,matchType:"wild"},{value:"IP",field:"Stat.ip",label:"Filter: IP Address",dataCall:null,matchType:"wild"},{value:"Source",field:"Stat.source",label:"Filter: Source",dataCall:null,matchType:"wild"},{value:"Status",field:"Stat.conversion_status",label:"Filter: Status",dataCall:function(){var a=c.get("conversionReport");a.getConversionStatusChoices.apply(a,arguments)}},{value:"Trans ID",field:"Stat.ad_id",label:"Filter: Transaction ID",dataCall:null,matchType:"exact"}],statsReportFilterList:["","Offer","Goal","Category","OfferUrl","OfferFile","Country","Sub ID 1","Sub ID 2","Sub ID 3","Sub ID 4","Sub ID 5","Advertiser Sub ID","Advertiser Sub ID 2","Advertiser Sub ID 3","Advertiser Sub ID 4","Advertiser Sub ID 5","IP","Trans ID","Source"],statsOnlyFilterList:[{value:"Advertiser Sub ID",field:"Stat.adv_sub1",label:"Filter: Advertiser Sub ID",dataCall:null,matchType:"wild"},{value:"Advertiser Sub ID 2",field:"Stat.adv_sub2",label:"Filter: Advertiser Sub ID 2",dataCall:null,matchType:"wild"},{value:"Advertiser Sub ID 3",field:"Stat.adv_sub3",label:"Filter: Advertiser Sub ID 3",dataCall:null,matchType:"wild"},{value:"Advertiser Sub ID 4",field:"Stat.adv_sub4",label:"Filter: Advertiser Sub ID 4",dataCall:null,matchType:"wild"},{value:"Advertiser Sub ID 5",field:"Stat.adv_sub5",label:"Filter: Advertiser Sub ID 5",dataCall:null,matchType:"wild"}],statsReportsOptions:[{title:"Select data to include:",optionsList:[["Offer","AdCampaign","Goal","Category","OfferUrl","OfferFile","Stat.promo_code","Country","Browser","Stat.source","Stat.affiliate_info1","Stat.affiliate_info2","Stat.affiliate_info3","Stat.affiliate_info4","Stat.affiliate_info5","Stat.adv_sub1","Stat.adv_sub2","Stat.adv_sub3","Stat.adv_sub4","Stat.adv_sub5","Stat.app_version"]]},{title:"Select statistics to include:",optionsList:[["Stat.impressions","Stat.conversions","Stat.clicks"],["Stat.payout","Stat.currency","Stat.payout_type","Stat.date"]]},{title:"Select calculations to include",optionsList:[["Stat.ctr","Stat.ltr","Stat.cpc","Stat.cpm","Stat.cpa","Stat.cpl","Stat.erpc"]]}],statsReportsDefaultReport:{fields:["Offer","Stat.impressions","Stat.clicks","Stat.conversions","Stat.payout","Stat.ctr","Stat.ltr"],chartType:"line",intervalType:"Stat.date",rowCount:"3",selectedMetrics:["Stat.conversions"],defaultSort:"Stat.conversions desc"},statsReportsOrder:[],statReportDefinitions:{singleFieldGroups:["Stat.source","Stat.date","Stat.affiliate_info1","Stat.affiliate_info2","Stat.affiliate_info3","Stat.affiliate_info4","Stat.affiliate_info5","Stat.adv_sub1","Stat.adv_sub2","Stat.adv_sub3","Stat.adv_sub4","Stat.adv_sub5","Stat.app_version","Stat.promo_code"],fields:{currency:{type:"string"},payout_type:{type:"string"}},related_entities:{Stat:{groupable:!1,fields:{count:{type:"integer"},affiliate_count:{type:"integer"},offer_count:{type:"integer"},impressions:{type:"integer",nicename:"Impressions"},clicks:{type:"integer",nicename:"Clicks"},gross_clicks:{type:"integer"},unique_clicks:{type:"integer"},unique_click_rate:{type:"percent",nicename:"Unique Click Rate"},rejected_clicks:{type:"integer",nicename:"Rejected Clicks"},rejected_click_rate:{type:"percent",nicename:"Rejected Click Rate"},suspicious_clicks:{type:"integer",nicename:"Suspicious Clicks"},suspicious_click_rate:{type:"percent",nicename:"Suspicious Click Rate"},ctr:{type:"percent",nicename:"CTR"},conversions:{type:"integer",nicename:"Conversions"},ltr:{type:"percent",nicename:"CR"},goal_id:{type:"integer"},payout:{type:"currency",nicename:"Payout"},erpc:{type:"currency",nicename:"EPC"},cpc:{type:"currency",nicename:"CPC"},cpm:{type:"currency",nicename:"CPM"},cpa:{type:"currency",nicename:"CPA"},cpl:{type:"currency",nicename:"CPL"},sale_amount:{type:"currency"},affiliate_info1:{type:"url_encoded_string",nicename:"Sub ID 1"},affiliate_info2:{type:"url_encoded_string",nicename:"Sub ID 2"},affiliate_info3:{type:"url_encoded_string",nicename:"Sub ID 3"},affiliate_info4:{type:"url_encoded_string",nicename:"Sub ID 4"},affiliate_info5:{type:"url_encoded_string",nicename:"Sub ID 5"},adv_sub1:{type:"url_encoded_string",nicename:"Advertiser Sub ID 1"},adv_sub2:{type:"url_encoded_string",nicename:"Advertiser Sub ID 2"},adv_sub3:{type:"url_encoded_string",nicename:"Advertiser Sub ID 3"},adv_sub4:{type:"url_encoded_string",nicename:"Advertiser Sub ID 4"},adv_sub5:{type:"url_encoded_string",nicename:"Advertiser Sub ID 5"},year:{type:"integer",nicename:"Interval: Year"},month:{type:"integer",nicename:"Interval: Month"},week:{type:"string",nicename:"Interval: Week"},date:{type:"date"},datehour:{type:"date",nicename:"Interval: Hour"},hour:{type:"integer",nicename:"Interval: Hour of Day"},affiliate_id:{type:"integer"},offer_id:{type:"integer"},offer_url_id:{type:"integer"},offer_file_id:{type:"integer"},ad_campaign_id:{type:"integer"},country_code:{type:"string"},browser_id:{type:"integer"},source:{type:"string"},currency:{type:"string"},ip:{type:"string",nicename:"IP"},app_version:{type:"string",nicename:"App Version"},promo_code:{type:"string",width:100,nicename:"Promo Code"}}},Goal:{groupable:!0,idField:"Goal.name",fields:{id:{type:"integer"},name:{type:"string",groups:["Goal.id"]}}},PayoutStructure:{groupable:!0,idField:"PayoutStructure.name",fields:{name:{nicename:"Payout Structure",groups:["PayoutStructure.name"]}}},Offer:{groupable:!0,idField:"Stat.offer_id",fields:{id:{type:"integer"},name:{type:"string",groups:["Offer.id"]},display_advertiser:{type:"boolean"},shared_type:{type:"string"}}},Category:{groupable:!0,idField:"Category.name",fields:{id:{type:"integer"},name:{type:"string",groups:["Category.id"]}}},OfferUrl:{nicename:"Offer URL",idField:"Stat.offer_url_id",groupable:!0,fields:{id:{type:"integer"},name:{type:"string",nicename:"Offer URL",groups:["OfferUrl.id","OfferUrl.preview_url"]},preview_url:{type:"string"}}},OfferFile:{nameField:"OfferFile.display",nicename:"Creative",idField:"Stat.offer_file_id",groupable:!0,fields:{id:{type:"integer"},display:{type:"string",nicename:"Offer File",groups:["OfferFile.id"]}}},AdCampaign:{idField:"Stat.ad_campaign_id",nicename:"Ad Group",groupable:!0,fields:{id:{type:"integer"},name:{type:"string",nicename:"Ad Group",groups:["AdCampaign.id"]}}},Country:{groupable:!0,idField:"Country.name",nameField:"Country.name",fields:{code:{type:"string"},name:{type:"string",groups:["Country.code"]}}},Browser:{nameField:"Browser.display_name",idField:"Browser.display_name",groupable:!0,fields:{id:{type:"integer"},display_name:{type:"string",groups:["Browser.id"]}}}}},conversionReportFilterList:["","Offer","Goal","Category","Country","Sub ID 1","Sub ID 2","Sub ID 3","Sub ID 4","Sub ID 5","Advertiser Sub ID","Advertiser Sub ID 2","Advertiser Sub ID 3","Advertiser Sub ID 4","Advertiser Sub ID 5","IP","Trans ID","Source","Status"],conversionReportsOptions:[{title:"Include:",optionsList:[["Offer","OfferUrl","Goal","Country","Browser","Stat.promo_code"]]},{title:"Data:",optionsList:[["Stat.conversion_status","Stat.payout","Stat.currency","Stat.conversion_sale_amount"],["Stat.session_ip","Stat.ip","Stat.ad_id","Stat.datetime","Stat.source","Stat.modified_datetime","ConversionMeta.note","Stat.app_version","Stat.tune_event_id"],["Stat.affiliate_info1","Stat.affiliate_info2","Stat.affiliate_info3","Stat.affiliate_info4","Stat.affiliate_info5"],["ConversionsMobile.affiliate_click_id","ConversionsMobile.affiliate_unique1","ConversionsMobile.affiliate_unique2","ConversionsMobile.affiliate_unique3","ConversionsMobile.affiliate_unique4","ConversionsMobile.affiliate_unique5"],["Stat.advertiser_info","ConversionsMobile.adv_sub2","ConversionsMobile.adv_sub3","ConversionsMobile.adv_sub4","ConversionsMobile.adv_sub5"],["Stat.adv_unique1","Stat.adv_unique2","Stat.adv_unique3","Stat.adv_unique4","Stat.adv_unique5"]]},{title:"Mobile Data",optionsList:[["ConversionsMobile.device_brand","ConversionsMobile.device_model","ConversionsMobile.device_os","ConversionsMobile.device_os_version","ConversionsMobile.ios_ifa","ConversionsMobile.ios_ifa_md5","ConversionsMobile.ios_ifa_sha1","ConversionsMobile.unknown_id","ConversionsMobile.google_aid","ConversionsMobile.google_aid_sha1","ConversionsMobile.google_aid_md5","ConversionsMobile.windows_aid","ConversionsMobile.windows_aid_sha1","ConversionsMobile.windows_aid_md5"]]}],conversionReportsDefaultReport:{fields:["Stat.ad_id","Offer","Stat.datetime","Stat.conversion_status","Stat.payout","Stat.affiliate_info1"],defaultSort:"Stat.datetime desc"},conversionReportsOrder:[],conversionReportDefinition:{fields:{currency:{type:"string"}},related_entities:{Stat:{groupable:!1,fields:{conversion_id:{type:"integer",nicename:"ID"},session_ip:{type:"string",width:100,nicename:"Session IP"},ip:{type:"string",width:100,nicename:"Conversion IP"},ad_id:{nicename:"Transaction ID",type:"string",width:130},source:{type:"string"},affiliate_info1:{nicename:"Sub ID",type:"url_encoded_string",width:130},affiliate_info2:{type:"url_encoded_string",nicename:"Sub ID 2"},affiliate_info3:{type:"url_encoded_string",nicename:"Sub ID 3"},affiliate_info4:{type:"url_encoded_string",nicename:"Sub ID 4"},affiliate_info5:{type:"url_encoded_string",nicename:"Sub ID 5"},advertiser_info:{type:"string",nicename:"Advertiser Sub ID"},adv_unique1:{type:"string",nicename:"Advertiser Unique 1"},adv_unique2:{type:"string",nicename:"Advertiser Unique 2"},adv_unique3:{type:"string",nicename:"Advertiser Unique 3"},adv_unique4:{type:"string",nicename:"Advertiser Unique 4"},adv_unique5:{type:"string",nicename:"Advertiser Unique 5"},conversion_status:{nicename:"Status",type:"string"},goal_id:{type:"integer"},conversion_payout:{nicename:"Payout",type:"currency"},payout:{type:"currency"},conversion_sale_amount:{nicename:"Sale Amount",type:"currency"},datetime:{type:"timestamp",nicename:"Time"},modified_datetime:{type:"timestamp",nicename:"Modified Time"},date:{type:"date"},offer_id:{type:"integer"},country_code:{type:"string"},app_version:{type:"string",nicename:"App Version"},tune_event_id:{type:"string",nicename:"Event ID"},promo_code:{type:"string",width:100,nicename:"Promo Code"}}},PayoutGroup:{groupable:!1,fields:{id:{nicename:"Payout Group ID"},name:{nicename:"Payout Group"}}},PayoutStructure:{groupable:!1,fields:{name:{nicename:"Payout Structure"}}},ConversionMeta:{groupable:!1,fields:{note:{type:"string",nicename:"Note"}}},ConversionsMobile:{groupable:!1,fields:{device_brand:{type:"string",nicename:"Device Brand"},device_model:{type:"string",nicename:"Device Model"},device_os:{type:"string",nicename:"Device OS"},device_os_version:{type:"string",nicename:"Device OS Version"},ios_ifa:{type:"string",nicename:"iOS IFA"},ios_ifa_md5:{type:"string",nicename:"iOS IFA MD5"},ios_ifa_sha1:{type:"string",nicename:"iOS IFA SHA1"},unknown_id:{type:"string",nicename:"Unknown ID"},google_aid:{type:"string",nicename:"Google AID"},google_aid_md5:{type:"string",nicename:"Google AID MD5"},google_aid_sha1:{type:"string",nicename:"Google AID SHA1"},windows_aid:{type:"string",nicename:"Windows AID"},windows_aid_md5:{type:"string",nicename:"Windows AID MD5"},windows_aid_sha1:{type:"string",nicename:"Windows AID SHA1"},adv_sub2:{type:"string",nicename:"Advertiser Sub ID 2"},adv_sub3:{type:"string",nicename:"Advertiser Sub ID 3"},adv_sub4:{type:"string",nicename:"Advertiser Sub ID 4"},adv_sub5:{type:"string",nicename:"Advertiser Sub ID 5"},affiliate_click_id:{type:"string",nicename:"Affiliate Click ID"},affiliate_unique1:{type:"string",nicename:"Affiliate Unique 1"},affiliate_unique2:{type:"string",nicename:"Affiliate Unique 2"},affiliate_unique3:{type:"string",nicename:"Affiliate Unique 3"},affiliate_unique4:{type:"string",nicename:"Affiliate Unique 4"},affiliate_unique5:{type:"string",nicename:"Affiliate Unique 5"}}},Goal:{groupable:!1,fields:{id:{type:"integer"},name:{type:"string"}}},Offer:{groupable:!1,idField:"Stat.offer_id",fields:{id:{type:"integer"},name:{type:"string",width:115},shared_type:{type:"string"}}},OfferUrl:{nicename:"Offer URL",idField:"Stat.offer_url_id",groupable:!1,fields:{id:{type:"integer"},name:{type:"string",nicename:"Offer URL"},preview_url:{type:"string"}}},Country:{groupable:!1,idField:"Country.name",fields:{code:{type:"string"},name:{type:"string"}}},Browser:{nameField:"Browser.display_name",idField:"Browser.display_name",groupable:!1,fields:{id:{type:"integer"},display_name:{type:"string"}}}}},subscriptionDefinition:{fields:{},related_entities:{Stat:{fields:{status:{type:"string"},created:{type:"timestamp"},start_date:{type:"date"},end_date:{type:"date"},payout:{type:"currency"},revenue:{type:"currency"},sale_amount:{type:"currency"},source:{type:"string"},affiliate_info1:{type:"string"},affiliate_info2:{type:"string"},affiliate_info3:{type:"string"},affiliate_info4:{type:"string"},affiliate_info5:{type:"string"},advertiser_info:{type:"string"},refer:{type:"string"},pixel_refer:{type:"string"},provided_id:{type:"string"},customer_list_id:{type:"integer"},affiliate_id:{type:"integer"},affiliate_manager_id:{type:"integer"},offer_id:{type:"integer"}}},CustomerList:{fields:{id:{type:"integer"},name:{type:"string"}}},Affiliate:{fields:{id:{type:"integer"},company:{type:"string"}}},AffiliateManager:{niceName:"Affiliate Manager",fields:{id:{type:"integer"},full_name:{type:"string"}}},Offer:{fields:{id:{type:"integer"},name:{type:"string"}}}}}});return f}];a.Models.reportsBase=b}(this),function(a){var b=["api","models","digestService",function(b,c,d){var e=c.get("statsReport"),f=c.getExtendable("base").extend({name:"savedReports",timePresetConversion:{today:"today",yesterday:"yesterday",last_seven_days:"last_week",last_thirty_days:"last_thirty",this_month:"this_month",last_month:"last_month",last_six_months:"last_six_months",all_time:"all_time",other:"custom"},timePresetTitles:{today:"Today",yesterday:"Yesterday",last_week:"Last 7 Days",last_thirty:"Last 30 days",this_month:"This month",last_month:"Last month",last_six_months:"Last six months",all_time:"All time",custom:"Custom Date Range"},getPresetTitle:function(a){var b=this.timePresetConversion[a]||a;return this.timePresetTitles[b]},timePresetFunctionMap:{today:{dateStart:function(){return a.moment()},dateEnd:function(){return a.moment()}},yesterday:{dateStart:function(){return a.moment().subtract(1,"days")},dateEnd:function(){return a.moment().subtract(1,"days")}},last_week:{dateStart:function(){return a.moment().subtract(6,"days")},dateEnd:function(){return a.moment()}},last_thirty:{dateStart:function(){return a.moment().subtract(30,"days")},dateEnd:function(){return a.moment()}},this_month:{dateStart:function(){return a.moment().startOf("month")},dateEnd:function(){return a.moment()}},last_month:{dateStart:function(){return a.moment().subtract(1,"month").startOf("month")},dateEnd:function(){return a.moment().subtract(1,"month").endOf("month")}},last_six_months:{dateStart:function(){return a.moment().subtract(6,"month").startOf("month")},dateEnd:function(){return a.moment()}},this_year:{dateStart:function(){return a.moment().startOf("year")},dateEnd:function(){return a.moment()}},last_year:{dateStart:function(){return a.moment().subtract(1,"year").startOf("year")},dateEnd:function(){return a.moment().subtract(1,"year").endOf("year")}},all_time:{dateStart:function(){return a.moment("2007-01-01","YYYY-MM-DDT")},dateEnd:function(){return a.moment()}},last_three_days:{dateStart:function(){return a.moment().subtract(2,"days")},dateEnd:function(){return a.moment()}},last_fourteen_days:{dateStart:function(){return a.moment().subtract(13,"days")},dateEnd:function(){return a.moment()}},last_thirty_days:{dateStart:function(){return a.moment().subtract(29,"days")},dateEnd:function(){return a.moment()}},last_sixty_days:{dateStart:function(){return a.moment().subtract(59,"days")},dateEnd:function(){return a.moment()}}},init:function(){this._super()},getSavedReports:function(){var a,c;return c=this,a=b.get("SavedReports/findAll"),a.success(function(a){_.each(a,$.proxy(c.convertFromApiReport,c))}),a},getSavedReport:function(a){var c,d;return d=this,c=b.get("SavedReports/findAll",{filters:{"SavedReport.id":a}}),c.success(function(a){_.each(a,$.proxy(d.convertFromApiReport,d))}),c},saveReport:function(c,e,f){var g,h;return g={data:{"interface":"affiliate",user_id:a.Config.affiliate_user_id,type:c.type,name:c.name,data:this.convertToApiReport(c)}},c.id?(g.id=c.id,h="SavedReports/update"):(g.data.hash=d.md5("AffiliateSaveReport{0}{1}{2}".format(a.angular.toJson(g),(new Date).getTime(),Math.floor(1e4*Math.random()))),h="SavedReports/create"),b.get(h,g,e,f)},deleteReport:function(a){return b.get("SavedReports/delete",{id:a})},convertFromApiReport:function(a){var b,c,d,f,g;return c={},_(["","other"]).contains(a.SavedReport.data.DateRange.preset)?(c.start_date=a.SavedReport.data.DateRange.start_date,c.end_date=a.SavedReport.data.DateRange.end_date):(f=this.timePresetConversion[a.SavedReport.data.DateRange.preset],g=this.timePresetFunctionMap[f],c.start_date=g.dateStart().format("YYYY-MM-DD"),c.end_date=g.dateEnd().format("YYYY-MM-DD")),c.fields=_.chain(a.SavedReport.data.Report.fields).union(a.SavedReport.data.Report.grouping).map(function(a){var b;return a&&a.indexOf(".")>-1&&(b=a.split("."),"Stat"!=b[0]&&"ConversionsMobile"!=b[0]&&"ConversionMeta"!=b[0]&&(a=b[0])),a}).value(),c.groups=a.SavedReport.data.Report.grouping,c.selectedFilters=a.SavedReport.data.Report.filters||[],"stats"==a.SavedReport.type&&(a.SavedReport.data.ChartOptions?(_.extend(c,a.SavedReport.data.ChartOptions),_.extend(c,a.SavedReport.data.GridOptions)):(b=e.getIntervalOptions(),c.intervalType=_.chain(b).pluck("field").find(function(b){return _.indexOf(a.SavedReport.data.Report.grouping,b)>-1}).value(),c.chartInterval=c.intervalType,d=_.clone(e.statsReportsDefaultReport),c=$.extend(d,c))),a.reportData=c,a},convertToApiReport:function(a){var b,d,e,f,g;switch(g=_.invert(this.timePresetConversion),a.type){case"stats":f=c.get("statsReport");break;case"conversions":f=c.get("conversionReport");break;case"referral":f=c.get("referralReport")}return d=[],e=[],_.each(a.currentReport.fields,function(a){a.indexOf(".")>-1?e.push(a):d.push(f.getNameField(a))}),b={DateRange:{timezone:"_DEFAULT_",preset_date_range:g[a.dateRange.preset],start_date:a.dateRange.start_date,end_date:a.dateRange.end_date,preset:g[a.dateRange.preset]},Report:{page:"",grouping:d,fields:e,filters:a.filters},GridOptions:{defaultSort:a.currentReport.defaultSort,selectedInterval:a.currentReport.selectedInterval}},"stats"==a.type&&(b.ChartOptions={},_.each(["intervalType","rowCount","chartType","selectedMetrics"],function(c){b.ChartOptions[c]=a.currentReport[c]})),b}});return f}];a.Models.savedReports=b}(this),function(a){var b=["api","models","currentUser",function(b,c,d){var e=c.getExtendable("reportsBase").extend({name:"statsReport",init:function(){this._super()},filterList:[],getDefinition:function(){return a.angular.copy(this.statReportDefinitions)},getOptions:function(){return a.angular.copy(this.statsReportsOptions)},getColumnOrder:function(){return a.angular.copy(this.statsReportsOrder)},getDownloadReportLink:function(a,b,c){return a=this.getFormattedApiParams(a),this.generateReportDownload("getStats",a.data_start,a.data_end,a,b,c)},getFormattedApiParams:function(b){b=a.angular.copy(b);var c=_.indexOf(b.groups,"Stat.datehour"),d=_.indexOf(b.fields,"Stat.datehour");c>-1&&(b.groups[c]="Stat.hour",b.groups.push("Stat.date"),b.groups=_.unique(b.groups),b.timestamp="Stat.hour",b.filters&&b.filters["Stat.datehour"]&&(_.size(b.filters["Stat.datehour"].values)>0&&(b.filters["Stat.hour"]=b.filters["Stat.datehour"]),delete b.filters["Stat.datehour"])),d>-1&&(b.fields[d]="Stat.hour",b.fields.push("Stat.date"),b.fields=_.unique(b.fields));var e=this.getDefinition(),f=e.related_entities,g=_.reduce(b.fields,function(a,b){var c=b.split(".");if(c.length>1&&"Stat"!==c[0]&&_.has(f,c[0],"fields",c[1],"groups")){var d=[b].concat(f[c[0]].fields[c[1]].groups);return a.concat(d)}return a},[]);return _.isArray(b.groups)||(b.groups=[]),b.groups=_.unique(b.groups.concat(g)),b.sort&&_.isUndefined(b.sort["Stat.datehour"])===!1&&(b.sort["Stat.date"]=b.sort["Stat.hour"]=b.sort["Stat.datehour"],delete b.sort["Stat.datehour"]),b=this.addDateFilter(b),_.each(_.keys(b.sort||{}),function(a){_.contains(b.fields,a)||delete b.sort[a]}),b},getReportData:function(c,e,f){var g=_.indexOf(c.groups,"Stat.datehour"),h=_.indexOf(c.fields,"Stat.datehour");c=this.getFormattedApiParams(c),c.fields=_.reject(c.fields,function(a){return-1!==a.indexOf("@")}),f||e||!d.hasFeature("PREMIUM_PARTNER_INSTANCE")||(f=c.NetworkId,e=d.ConnectAdvertisers[c.NetworkId]?d.ConnectAdvertisers[c.NetworkId].api_key:"");var i=b.get("Report/getStats",c,e,f);return _.max([g,h])>-1?i.success(function(b){_.each(b.data,function(b){try{var c=a.Formatter.zeroPadNumber(b.Stat.hour);b.Stat.datehour="{0} {1}:00:00".format(b.Stat.date,c)}catch(d){console.error(d)}})}):i},getDefaultReport:function(){var b=a.angular.copy(this.statsReportsDefaultReport);return _.has(window.PI_DEFAULT_REPORT_FIELDS,"performance")&&_.isArray(window.PI_DEFAULT_REPORT_FIELDS.performance)&&window.PI_DEFAULT_REPORT_FIELDS.performance.length&&(b.fields=window.PI_DEFAULT_REPORT_FIELDS.performance),b},determineNicename:function(a,b){return b=b||this.getDefinition(),this._super(a,b)},getFilterList:function(){var b=this,c=this.statsOnlyFilterList.map(function(a){return a.value});return 0===_.size(b.filterList)&&(b.filterList=[],_.each(b.reportFilterList,function(a){_.indexOf(b.statsReportFilterList,a.value)>-1&&-1===_.indexOf(c,a.value)&&b.filterList.push(a)}),Array.prototype.push.apply(b.filterList,b.statsOnlyFilterList)),a.angular.copy(b.filterList)}});return e}];a.Models.statsReport=b}(this),function(a){var b=function(b,c,d,e,f,g){var h=c.get("offerFile"),i=c.get("offerDetail"),j=function(){var b=a.Config.Enums.offerFileType,c={},d=["image banner","html ad","text ad","hidden"];for(var e in b)_.contains(d,e)&&(c[e]=b[e]);return g.convertForOptions(c)},k=function(){b.formFields={height:_.contains(["html ad"],b.fileType),width:_.contains(["html ad"],b.fileType),code:_.contains(["html ad","text ad"],b.fileType),name:_.contains(["html ad","text ad"],b.fileType)}},l=function(){b.tab=_.contains(["text ad","html ad"],b.fileType)?"input":"upload"};b.uploadOptions={url:e.generateURL("OfferFile/create",{return_object:!0,api_key:i.apiKey,NetworkId:i.upstreamNetworkId}),handleResponse:function(a,c){var d=c.result.response.errors,e=d.length>0,f="An Error Occurred";e||c.errorThrown||"error"===c.textStatus?(f=d[0].publicMessage||d[0].err_msg||c.errorThrown||c.textStatus,b.errors=[f],c.files[0].error=f,o()):(m(),b.$emit("offerFileCreated"))},submit:function(a,c){var d=c.files[0];return d.done=!1,d.error=null,n(c),b.errors.length>0?!1:void 0}};var m=function(){b.fileData={offer_id:b.offerId,type:b.fileType}},n=function(a){var c=null;a&&a.files&&(c=a.files[0]),b.errors=[],b.invalidTypeError=!1,!b.fileData.width&&b.formFields.width?b.errors.push("Please Enter Width"):_.isNaN(parseInt(b.fileData.width,10))&&b.formFields.width&&b.errors.push("Width Should be a Number"),!b.fileData.height&&b.formFields.height?b.errors.push("Please Enter Height"):_.isNaN(parseInt(b.fileData.height,10))&&b.formFields.height&&b.errors.push("Height Should be a Number"),!b.fileData.display&&b.formFields.name&&"input"==b.tab&&b.errors.push("Please Enter a Name"),!b.fileData.code&&b.formFields.code&&"input"==b.tab&&b.errors.push("Please Enter some Code"),c&&!c.fake&&("image banner"==b.fileType&&(_.contains(["image/jpeg","image/gif","image/png"],c.type)||(b.invalidTypeError=!0,b.errors.push("Invalid Image File Added, Should be in .png, .gif, jpeg, or .jpg Format"))),"html ad"==b.fileType&&"text/html"!=c.type&&(b.invalidTypeError=!0,b.errors.push("Invalid HTML File Added, Should be in .html Format")))},o=function(){b.uploader&&b.uploader.clear(b.uploader.queue)};b.addCreative=function(){var a={name:b.fileData.display,display_name:b.fileData.display,fake:!0};if(n(b.uploader),!b.errors.length){b.uploader.add({files:[a]}),a.$progress=function(){return{loaded:1,total:1}};var c=h.create({data:b.fileData,return_object:!0},i.apiKey,i.upstreamNetworkId);c.success(function(){b.$emit("offerFileCreated"),a.done=!0,m()}),c.error(function(){a.$cancel(),b.errors.push("Unable to create CreativeFile")})}},b.offerData=null,f.$on("offerLoaded",function(a,c){b.offerData=c.Offer}),b.$watch("fileType",function(){b.errors=[],o(),m(),l(),k()}),d.onDirectivesReady("creativeUpload",function(){var a=d.get("creativeUpload");b.uploader=a,b.$on("fileuploadadd",function(a,c){var d=c.files[0];return d.displayName=d.name,n(c),b.invalidTypeError?void c.files.shift():(c.formData={},void _(b.fileData).each(function(a,b){c.formData["data["+b+"]"]=a}))}),b.$on("fileuploadsubmit",function(a,c){var d=c.files[0];c.formData["data[type]"]=b.fileType,c.formData["data[display]"]=d.displayName,
c.formData["data[file][name]"]=d.name,c.formData.filename=d.name,c.paramName=d.name})}),b.fileType="image banner",b.fileTypeOptions=j(),b.errors=[],k(),l()};b.$inject=["$scope","models","directiveRegistry","api","$rootScope","util"],a.Application.controller("Controllers.offerAddCreatives",b)}(this),function(a){a.Application.controller("Controllers.offerApprovalQuestionsModal",["$scope","models","$route","directiveRegistry",function(a,b,c,d){var e,f=b.get("offerDetail");a._model=f,a.offerQuestions=[],a.approvalAnswers=[],a.questionsLoading=!1,a.button={text:"Save Answers",enabled:!0},a.answersAreOk=function(){var b;return b=_.chain(a.approvalAnswers).where({required:!0}).find(function(a){return""===$.trim(a.answer)}),!b.value()},a.clearAnswers=function(){_.each(a.approvalAnswers,function(a){a.answer=""})};var g;d.onDirectivesReady(["offerApprovalModal"],function(){g=d.get("offerApprovalModal")}),a.$on("approvalRequired",function(b,c){a.button={text:"Save Answers",enabled:!0},a.questionsLoading=!0,e=c,f.getOfferApprovalQuestions(c).success(function(b){a.questionsLoading=!1,_.each(b,function(b){a.offerQuestions.push(b.SignupQuestion)}),a.offerQuestions=_.sortBy(a.offerQuestions,function(a){return"1"==a.required?-1:1}),_.each(a.offerQuestions,function(b){a.approvalAnswers.push({question_id:b.id,answer:"",required:"1"==b.required})}),_(b).size()||g.$on("modalShow",function(){a.saveAnswers()})})}),a.saveAnswers=function(){if(a.answersAreOk()){a.button.text="Saving",a.button.enabled=!1;var b={offer_id:e},d=_.chain(a.approvalAnswers).reject(function(a){return""===$.trim(a.answer)}).map(function(a){return{question_id:a.question_id,answer:a.answer}});b.answers=d.value();var h=f.saveOfferApprovalAnswers(b);h.success(function(){g.dismiss(),c.reload()}),h.error(function(){a.flashError("There was a problem processing your approval. Please try again later."),g.dismiss()})}}}])}(this),function(a){a.Application.controller("Controllers.offerCreativeModal",["$scope","models",function(b,c){b.offers=[],b.offers={},b.current_index=0,b.max_index=0;var d=c.get("offerFile"),e=c.get("offerDetail");b.moveLeft=function(){b.current_index>0&&(b.offer=b.offers[--b.current_index],b.refreshCreativeCode())},b.moveRight=function(){b.current_index<b.max_index&&(b.offer=b.offers[++b.current_index],b.refreshCreativeCode())},b.getUrlExtension=function(){return _.hasMembers(b,"offer","OfferFile")&&b.offer.OfferFile.url?b.offer.OfferFile.url.split(".").pop().toUpperCase():"Unknown"},b.isImage=function(){return _.hasMembers(b,"offer","OfferFile")?"image banner"==b.offer.OfferFile.type:!1},b.isHtml=function(){return _.hasMembers(b,"offer","OfferFile")?_.contains(["html ad","email creative","flash banner"],b.offer.OfferFile.type):!1},b.getImgTag=function(){if(b.isImage()){var a=b.offer.OfferFile,c='<img src="{0}" border="0" alt="{1}"/>';return c.format(a.url,a.display)}return!1},b.refreshCreativeCode=function(){var a=b.offer.OfferFile.id,c={id:a,offer_id:b.offerId,tracking_url:b.trackingLink},f="offer_id="+b.offerId,g="offer_id="+b.offerId+"&file_id="+a;c.impression_pixel=b.trackingPixel.replace(f,g),-1!==c.tracking_url.indexOf("?")?c.tracking_url+="&file_id="+a:c.tracking_url+="?file_id="+a,_.extend(c,b.trackingLinkParams),b.currentCreativeCode="Loading Code...",b.isHtml()&&(document.getElementById("htmlIframe").src="about:blank"),d.getCreativeCode(c,e.apiKey,e.upstreamNetworkId).then(function(a){b.currentCreativeCode=a.data.CreativeCode,b.isHtml()&&document.getElementById("htmlIframe").contentWindow.document.write(a.data.CreativeCode)})},b.getCTR=function(){return _.hasMembers(b,"offer","OfferFile","Stat","ctr")?"{0}%".format(b.offer.OfferFile.Stat.ctr):"<em>N/A</em>"},b.getEPC=function(){return _.hasMembers(b,"offer","OfferFile","Stat","erpc")?a.currency.formatCurrency(b.offer.OfferFile.Stat.erpc,"USD"):"<em>N/A</em>"},b.getCR=function(){return _.hasMembers(b,"offer","OfferFile","Stat","conversion_revenue")?"{0}%".format(b.offer.OfferFile.Stat.conversion_revenue):"<em>N/A</em>"},b.showAdGroup=function(a){a&&a.preventDefault(),b.dismiss(),b.$parent.launchAdgroup(b.offer.OfferFile.id)}}])}(this),function(a){a.Application.controller("Controllers.offerCreatives",["$scope","$routeParams","models","directiveRegistry","$timeout","$window","$rootScope",function(a,b,c,d,e,f,g){var h=c.get("offerFile"),i=h.getOfferFileDefinition(),j={},k=c.get("offerDetail");a.creatives=[],a.hasCreatives=!1;var l=function(){var c={page:a.table.paging.page,limit:a.table.paging.pageSize,filters:{type:{NOT_EQUAL_TO:"offer thumbnail"},status:{NOT_EQUAL_TO:"deleted"}},sort:{id:"desc"}};b.offer_id&&(c.filters["OfferFile.offer_id"]=[b.offer_id]),h.getCreatives(c,k.apiKey,k.upstreamNetworkId).success(function(b){a.creatives=b.data||[],a.hasCreatives=Object.keys(a.creatives).length>0,(a.table.drawTable||a.table.addItems)(b,c)})};a.downloadUrl=window.location.protocol+"//"+window.location.host+window.location.pathname+"download/CreativeFiles/"+b.offer_id,a.launchModal=function(b){var c=$(b.currentTarget).data("id"),d=[];_(a.creatives).each(function(b){_(["image banner","flash banner","html ad","email creative"]).contains(b.OfferFile.type)&&(d.push(b),b.OfferFile.id==c&&(a.$parent.offerCreativeModal.scope.offer=b,a.$parent.offerCreativeModal.scope.current_index=d.length-1))}),a.$parent.offerCreativeModal.scope.offers=d,a.$parent.offerCreativeModal.scope.max_index=d.length-1,a.$parent.offerCreativeModal.scope.$digest(),a.$parent.offerCreativeModal.scope.refreshCreativeCode(),a.$parent.offerCreativeModal.show()};var m=function(b,c){var d=a.trackingLink.indexOf("?")>-1?"&":"?";d+="file_id="+b;var e=_({id:b,offer_id:a.offerId,tracking_url:a.trackingLink+d}).extend(a.trackingLinkParams),f="offer_id="+a.offerId,g="offer_id="+a.offerId+"&file_id="+b;e.impression_pixel=a.trackingPixel.replace(f,g),h.getCreativeCode(e,k.apiKey,k.upstreamNetworkId).then(function(a){c(a.data.CreativeCode)})};a.navigateToCreative=function(a){var b=f.open();m(a,function(a){b.location=a})},a.getCode=function(a){var b=$(a.currentTarget),c=b.data("id");c&&(m(c,function(a){$("#offerfile-code-"+c).val(a)}),b.parents("div").addClass("code").scrollTop(0))},a.downloadBlob=function(a){var b=a.display,c="text/plain;",d=["html","email"],e=_.any(_.map(d,function(b){return a.type.indexOf(b)>-1}));e&&!b.endsWith("html")?b+=".html":"text ad"!==a.type||b.endsWith("txt")?(b.endsWith("xml")||"xml feed"===a.type)&&(c="text/xml;"):b+=".txt",m(a.id,function(a){window.saveAs(new Blob([a],{type:c}),b)})},a.hideCode=function(a){var b=$(a.currentTarget);b.parents("div").removeClass("code")},a.launchAdgroup=function(b){var c=$(b.currentTarget).data("id"),d=_.find(a.creatives,function(a){return a.OfferFile.id==c});a.$parent.adgroupSelectModal.scope.offerFile=d.OfferFile,a.$parent.adgroupSelectModal.scope.$broadcast("updateTable"),a.$parent.adgroupSelectModal.show()},a.$parent.launchAdgroup=a.launchAdgroup,a.hasWidthAndHeight=function(a){return a.width>""&&a.height>""},a.formatOfferFileType=function(a){return i.fields.type.values[a]},a.shouldShowAdGroup=function(b){return!g.hasFeatures("PREMIUM_PARTNER_INSTANCE")&&a.getPreference("enable_affiliate_ad_server")&&_(["image banner","flash banner"]).contains(b.type)};var n=function(b){$(".offerfile-launch-modal, .offerfile-get-code, .offerfile-code-cancel, .offerfile-adgroup").unbind("click"),$(".offerfile-code-input").unbind("focus"),b.find(".offerfile-launch-modal").click(a.launchModal),b.find(".offerfile-code-input").focus(a.getCode),b.find(".offerfile-get-code").click(a.getCode),b.find(".offerfile-code-cancel").click(a.hideCode),b.find(".offerfile-adgroup").click(a.launchAdgroup),_.each(a.creatives,function(a){$("#offerfile-code-{0}".format(a.id)).val(a.code)}),_.each(j,function(a){a.destroy()})};g.$on("offerFileCreated",function(){l()}),a.$parent.$watch("offerLoaded",function(b,c){b&&b!==c&&(a.isMobile?d.onDirectivesReady(["creativesTableMobile"],function(){a.table=d.get("creativesTableMobile"),l(),a.table.$on("moreItemsRequested",function(){l()})}):d.onDirectivesReady("creativesTable",function(){a.table=d.get("creativesTable"),a.table.paging.pageSize=50,a.table.$on("pagingChanged",function(){l()}),l(),a.table.$on("tableRenderComplete",function(a,b,c){e(function(){n(c)})})}))})}])}(this),function(a){a.Application.controller("Controllers.offerDetail",["$scope","$routeParams","$rootScope","$q","$timeout","analyticsService","digestService","models","directiveRegistry","$route","$translate","geographic","currentUser","chartService",function(b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=i.get("offerDetail"),q={id:c.offer_id,fields:["Stat.erpc"],data_start:moment().subtract(30,"days").format("YYYY-MM-DD"),data_end:moment().format("YYYY-MM-DD"),contain:["Stat"]};b.offerLoaded=!1,b.isError=!1,b.offerId=c.offer_id,b.tinyURL=!1,b.impressionPixelVisible=!1,b.hasCityTargetingEnabled=n.hasFeatures("CITY_TARGETING"),b.hasPayoutStructures=!1,b.payoutStructures={},b.rulesRange=[],b.criteriaNames=[],b.offerPartnerClass=window.location.hostname.split(".")[0]||"partner",b.trackingTabsVisible={source:!0,creative:!1,subId:!1,website:!1,customVariables:!1},b.hasCityTargetingEnabled?(q.fields.push("GeoTargeting"),q.contain.push("GeoTargeting")):(q.fields.push("Country.name"),q.contain.push("Country"),q.contain.push("Regions")),b.toggleTrackingTab=function(a){if(b.trackingTabsVisible[a]=!b.trackingTabsVisible[a],!b.trackingTabsVisible[a])switch(a){case"website":_.has(b.trackingLinkParams,"url")&&delete b.trackingLinkParams.url,_.has(b.linkParam,"url")&&delete b.linkParam.url;break;case"subId":_.each(["aff_sub","aff_sub2","aff_sub3","aff_sub4","aff_sub5"],function(a){_.has(b.trackingLinkParams,a)&&delete b.trackingLinkParams[a],_.has(b.linkParam,a)&&delete b.linkParam[a]});break;case"source":_.has(b.trackingLinkParams,"source")&&delete b.trackingLinkParams.source,_.has(b.linkParam,"source")&&delete b.linkParam.source;break;case"affClickId":_.has(b.trackingLinkParams,"aff_click_id")&&delete b.trackingLinkParams.aff_click_id,_.has(b.linkParam,"aff_click_id")&&delete b.linkParam.aff_click_id;break;case"affUnique":_.each(["aff_unique1","aff_unique2","aff_unique3","aff_unique4","aff_unique5"],function(a){_.has(b.trackingLinkParams,a)&&delete b.trackingLinkParams[a],_.has(b.linkParam,a)&&delete b.linkParam[a]});break;case"creative":_.has(b.trackingLinkParams,"file_id")&&delete b.trackingLinkParams.file_id,_.has(b.linkParam,"file_id")&&delete b.linkParam.file_id;break;case"customVariables":_.each(b.customVariables,function(a,c){c=encodeURIComponent(c),_.has(b.trackingLinkParams,c)&&delete b.trackingLinkParams[c],b.customVariables={}})}b.refreshTrackingLink()},b.$watch("trackingTabsVisible",function(a,b){var c="",d="";switch(_(b).each(function(d,e){a[e]===!0&&b[e]!=a[e]&&(c=e)}),c){case"source":d=".panel.source";break;case"creative":d=".panel.creative";break;case"subId":d=".panel.sub-ids";break;case"website":d=".panel.website";break;case"customVariables":d=".panel.custom-variables"}angular.element(d).find("input:first").focus()},!0);var r=function(){var a={},c="";_.each(b.customVariables,function(a,b){c+="&"+b+"="+encodeURIComponent(a)}),""!=c&&(a.params=c),b.trackingLinkParams=_.extend(a,b.trackingLinkParams),b.refreshTrackingLink()};b.newCustomVariable={},b.customVariables={},b.addCustomVariable=function(){if(b.newCustomVariable.name&&b.newCustomVariable.value){var a=encodeURIComponent(b.newCustomVariable.name);b.customVariables[a]=b.newCustomVariable.value,b.newCustomVariable={}}delete b.trackingLinkParams.params,r()},b.removeCustomVariable=function(a){delete b.customVariables[a],delete b.trackingLinkParams.params,r()},b.trackingLinkOfferUrlId=0,p.getOfferUrls(b.offerId).then(function(a){if(_.size(a.data)){b.offerUrls=[{id:0,name:"Default URL"},{id:"random",name:"Random URL",preview_url:""}];var c=[];_(a.data).each(function(a){var b={};b.id=a.OfferUrl.id,b.name=a.OfferUrl.name,b.preview_url=a.OfferUrl.preview_url,c.push(b)}),c.sort(function(a,b){return a.name>b.name?1:a.name<b.name?-1:0}),b.offerUrls=b.offerUrls.concat(c)}}),b.$watch("trackingLinkOfferUrlId",function(a){_.isUndefined(a)||_.isNull(a)||b.refreshTrackingLink()}),b.trackingLinkParams={};var s={},t=null,u=function(a){s[a]&&(b.trackingPixel=s[a].impression_pixel,b.trackingLink=s[a].universal_tracking_link?s[a].universal_tracking_link:s[a].click_url,angular.element(".offerfile-codecell").removeClass("code"))};b.updateSubIds=function(){var a=["aff_sub","aff_sub2","aff_sub3","aff_sub4","aff_sub5"];_(a).each(function(a){_.hasMembers(b,"linkParam",a)?b.trackingLinkParams[a]=b.linkParam[a]:delete b.trackingLinkParams[a]}),b.refreshTrackingLink()},b.updateAffUniqueIds=function(){var a=["aff_unique1","aff_unique2","aff_unique3","aff_unique4","aff_unique5"];_(a).each(function(a){_.hasMembers(b,"linkParam",a)?b.trackingLinkParams[a]=b.linkParam[a]:delete b.trackingLinkParams[a]}),b.refreshTrackingLink()},b.addParam=function(a){b.trackingLinkParams[a]=b.linkParam[a],b.refreshTrackingLink()};var v=!1;b.$watch("trackingLink",function(a,c){v&&a!=c&&a.indexOf("http")>-1&&b.flashSuccess("link successfully updated"),a.indexOf("http")>-1&&(v=!0)}),b.refreshTrackingLink=function(){t&&t.reject();var d=e.defer(),f={offer_id:c.offer_id,options:{}};switch(b.trackingLinkOfferUrlId){case 0:delete b.trackingLinkParams.url_id,delete b.trackingLinkParams.random_url;break;case"random":delete b.trackingLinkParams.url_id,b.trackingLinkParams.random_url=1;break;default:delete b.trackingLinkParams.random_url,b.trackingLinkParams.url_id=b.trackingLinkOfferUrlId}_.each(b.trackingLinkParams,function(a,b){""!==a&&(f.options[b]=a)}),b.tinyURL&&(f.options.tiny_url=1);var g,i=h.md5(a.angular.toJson(f));return s[i]?(u(i),d.reject()):(b.trackingLink="Getting Link...",g=p.generateTrackingLink(f),g.success(function(a){s[i]=a,d.resolve(!0)}),g.error(function(){b.trackingLink=["Your link did not successfully generate. ","Try again by clicking the attached refresh icon"].join()})),d.promise.then(function(){u(i)}),t=d,g},b.needsApproval=!1,b.needsTerms=!1,b.requireApproval=function(){return b.offerData&&b.offerData.Offer?(b.needsApproval=1===Number(b.offerData.Offer.require_approval)&&"approved"!==b.offerData.AffiliateOffer.approval_status,b.needsTerms=1===Number(b.offerData.Offer.require_terms_and_conditions)&&null===b.offerData.AffiliateOffer.agreed_terms_and_conditions,b.needsApproval||b.needsTerms):!0},b.showEmailInstructions=function(){if(!_.hasMembers(b,"offerData","Offer")||!n.getPreferenceValue("enable_offer_suppression_lists"))return!1;var a=b.offerData.Offer;return("1"==a.email_instructions||a.dne_download_url||a.dne_unsubscribe_url)&&("1"!==a.email_instructions||a.email_instructions_subject||a.email_instructions_from)?!0:!1},b.hide_caps_monthly=!0,n.checkPreference("hide_caps_monthly",!1).then(function(){b.hide_caps_monthly=!1},function(){b.hide_caps_monthly=!0}),b.agreeToTerms=function(){p.agreeToTerms(b.offerData.Offer.id).then(function(){k.reload()})},b.socialLinks=["twitter","email"],b.opArrayIdxLookup=["","=","<","<=",">",">=","IN","NOT","AND","OR","CALL","LIKE","BETWEEN"],b.flattenGroups=function(a,c){function d(a,b){return a.order>b.order?1:a.order<b.order?-1:0}if(!a||!c)return[];var e={},f={},g={},h=[];b.maxRules=b.maxRules||0,b.rulesRange=_.range(1,1),b.criteriaRange=_.range(1,a.length+1),b.criteriaNames=[],b.defaultPayoutRange=_.range(1,a.length-1);for(var i=0;i<a.length;i++){var j=a[i],k=j.name||i;if(j.inherited&&f[k]?(g[j.id]=f[k],j.id=f[k],b.criteriaRange.pop()):(f[k]=j.id,b.criteriaNames.push(j.name||i)),null==j.rules||"undefined"==typeof j.rules){var l="c"+j.id+"r0";e[l]={name:j.name,left_side:"n/a",operator:0,right_side:"n/a"}}else for(var m=0;m<j.rules.length;m++)if(null!=j.rules[m]&&"undefined"!=typeof j.rules[m]){var n=Object.keys(j.rules[m]).filter(function(a,b,c){return"rule_id"!=a&&"operator"!=a?a:void 0}),o=n[0],p=j.rules[m][o].length+1,k=j.name,q=b.opArrayIdxLookup[j.rules[m].operator]||"",r=null,s=null;"IN"===q?s=j.rules[m][o].join(", "):p>1?(r=j.rules[m][o][1],s=j.rules[m][o][0]):s=j.rules[m][o][1];var t=j.rules[m].rule_id,l="c"+j.id+"r"+j.rules[m].rule_id;e[l]={id:t,name:k,left_side:r,operator:q,right_side:s}}}for(var u=0,v=0;v<c.length;v++){var w=c[v].inherited?u+1:c[v].evaluation_order,x={order:w||0,name:c[v].name||"",payout_rate:c[v].payout.rate,payout_percent:c[v].payout.percent,currency:c[v].currency,inherited:c[v].inherited||!1,rules:[]};if(u=x.order,null==c[v].group_rules||"undefined"==typeof c[v].group_rules){b.payoutStructures.modalGuidance="Some rule details were missing. Showing available criteria.";for(var y=0;y<b.criteriaNames.length;y++)x.rules.push({id:+(1e3+y),name:b.criteriaNames[y],left_side:"",operator:"",right_side:""})}else for(var z=0;z<c[v].group_rules.length;z++){var A=c[v].group_rules[z].criteria_id,B=g[A]?g[A]:A,l="c"+B+"r"+c[v].group_rules[z].rule_id||[];x.rules.push(e[l])}for(var C=b.criteriaNames.slice(),D={},E=0;E<x.rules.length;E++)x.rules[E].name&&C.indexOf(x.rules[E].name)>-1&&(D[x.rules[E].name]=x.rules[E],C.splice(C.indexOf(x.rules[E].name),1));for(var F=0;F<C.length;F++)D[C[F]]={name:C[F],left_side:"",operator:"",right_side:""};x.rules=[];for(var y=0;y<b.criteriaNames.length;y++)x.rules.push(D[b.criteriaNames[y]]);h.push(x),b.maxRules<x.rules.length&&(b.maxRules=x.rules.length,b.rulesRange=_.range(1,b.maxRules+1),b.defaultPayoutRange=_.range(1,b.maxRules))}return h.sort(d),0==h.length&&(b.payoutStructures.modalGuidance="This payout structure was empty. Check back later for updates."),h},b.social=function(a,c){a&&a.preventDefault();var d="";switch(c){case"twitter":d="https://twitter.com/intent/tweet?text={0}%20{1}".format(encodeURIComponent("Check out "+b.offerData.Offer.name),encodeURIComponent(b.trackingLink)),window.open(d);break;case"email":var e="mailto:?subject={0}&body={1}";window.location=e.format(encodeURIComponent("Tracking Link for "+b.offerData.Offer.name),encodeURIComponent(b.trackingLink))}},b.getPreviewUrl=function(a){if(_.isUndefined(a))return b.offerData.Offer.preview_url;var c=b.offerData.Offer.preview_url,d=_.where(b.offerUrls,{id:a});return _.hasMembers(d,0,"preview_url")&&(c=d[0].preview_url),c},b.previewCreative=function(a){b.offerCreativeModal.scope.offer=b.offerData;var c=_.where(b.offerFiles,function(b){return b.OfferFile.id==a});_.hasMembers(c,0,"OfferFile")&&(b.offerCreativeModal.scope.offer.OfferFile=c[0].OfferFile,b.offerCreativeModal.scope.refreshCreativeCode(),b.offerCreativeModal.show())},b.offerFiles={},i.get("offerFile").getCreatives({limit:999,page:1,filters:{type:{NOT_EQUAL_TO:"offer thumbnail"},"OfferFile.offer_id":c.offer_id}},p.apiKey,p.upstreamNetworkId).success(function(a){_.each(a.data,function(a){b.offerFiles[a.OfferFile.id]=a})});var w=p.getOffer(q);e.all([w]).then(function(a){b.timezone=m.getTimezone();var e=a[0],g=["OfferChannel","OfferOperatingSystem","OfferVertical","OfferIncentive","OfferConversionType","OfferMediaPlacement","OfferTag"];if(_.each(g,function(a){if(e[a]&&!_.isEmpty(e[a])){var b=Object.keys(e[a]).map(function(b){return e[a][b].name});e[a]=b.join(", ")}else e[a]&&delete e[a]}),b.offerData=e,b.selected_url=b.offerData.Offer.preview_url,b.has_caps=!1,(b.offerData.Offer.conversion_cap>0||b.offerData.Offer.monthly_conversion_cap>0||b.offerData.Offer.payout_cap>0||b.offerData.Offer.monthly_payout_cap>0)&&(b.has_caps=!0),b.offerData.Offer.dne_third_party_list&&p.getOfferDNE3rdPartyList(c.offer_id).success(function(a){b.offerData.Offer=_.extend(b.offerData.Offer,a)}),d.hasFeatures("GEOTARGETING_EXCLUSIONS")){var h={},i={};_.each(e.GeoTargeting,function(a,b){_.contains(e.GeoTargeting.Exclude,b.toLowerCase())&&!_.isEmpty(a)?i[b]=a:_.isEmpty(a)||"Exclude"===b||(h[b]=a)}),b.includeLocations=h,b.excludeLocations=i}if(p.getOfferPayoutDetails(c.offer_id,d.hasFeatures("HOR-1220-PS-ON-GOALS"),d.hasFeatures("CORE-122-RAKUTEN-PAYOUT-HISTORY")).success(function(a){if(d.hasFeatures("CORE-122-RAKUTEN-PAYOUT-HISTORY")){var c={};_.each(a.goal_payouts,function(a){c[a.goal_id]=a.goal.name}),a.payoutHistory=_.map(a.payoutHistory,function(a){var d={};if(d.datetime=a.datetime,a.current_payout_config){var e=b.getPayoutAmount(a.current_payout_config.payout_type,a.current_payout_config),f=b.getPayoutType(a.current_payout_config.payout_type);d.currentPayout=e+" "+f,d.currentGoals={},_.each(a.current_payout_config.goals,function(a,e){var f=b.getPayoutAmount(a.payout_type,a),g=b.getPayoutType(a.payout_type);a.name=c[e],d.currentGoals[a.id]={name:c[e],payout:f+" "+g}})}if(a.previous_payout_config){var g=b.getPayoutAmount(a.previous_payout_config.payout_type,a.previous_payout_config),h=b.getPayoutType(a.previous_payout_config.payout_type);d.previousPayout=g+" "+h,d.previousGoals={},_.each(a.previous_payout_config.goals,function(a,e){var f=b.getPayoutAmount(a.payout_type,a),g=b.getPayoutType(a.payout_type);a.formattedPayout=f+" "+g,d.previousGoals[a.id]={name:c[e],payout:a.formattedPayout}})}return d.changes=b.getPayoutDiff(d),d})}if(a.goal_payouts){var e=_.clone(a.offer_payout)||{};e.goal=_.clone(b.offerData.Offer),e.goal.name=b.offerData.Offer.default_goal_name||"Default",delete a.offer_payout,a.goal_payouts=a.goal_payouts||[],a.goal_payouts.unshift(e)}b.payoutDetails=a}),b.refreshTrackingLink(),_.size(b.offerData.Country)>0){var j=[],k=!1;k=_.any(b.offerData.Country,function(a){return _.size(a.regions)>0?!0:!1}),k?(_.each(b.offerData.Country,function(a){var b=a.name;b+='<br /><span class="regions">',b+=_.size(a.regions)>0?_.pluck(a.regions,"name").join(", "):"All Regions",b+="</span>",j.push(b)}),b.countryList=j.join("<br /><br />")):b.countryList=_.pluck(b.offerData.Country,"name").join(", ")}else b.countryList=l("common.countries.all");if(b.hasCityTargetingEnabled)if(_.size(b.offerData.GeoTargeting)>0){if(d.hasFeatures("GEOTARGETING_EXCLUSIONS")){var n="";_.each(["Included","Excluded"],function(a){var c="Included"===a?b.includeLocations:b.excludeLocations;if(!_.isEmpty(c)){n+=a+':<br /><span class="regions">';var d=[];_.isEmpty(c.Cities)||_.each(c.Cities,function(a){var b=a.name+", "+a.region.name+", "+a.country.name;d.push(b)}),_.isEmpty(c.Regions)||_.each(c.Regions,function(a){var b=a.name+", "+a.country.name;d.push(b)}),_.isEmpty(c.Countries)||_.each(c.Countries,function(a){d.push(a.name)});var e=d.join(", ");n+=e+"</span><br />"}})}else{var n="";if(_.size(b.offerData.GeoTargeting.Cities)>0){n+='Cities:<br /><span class="regions">';var o=[];_.each(b.offerData.GeoTargeting.Cities,function(a){var b=a.name+", "+a.region.name+", "+a.country.name;o.push(b)});var q=o.join(",");n+=q+"</span><br />"}if(_.size(b.offerData.GeoTargeting.Regions)>0){n+='Regions:<br /><span class="regions">';var r=[];_.each(b.offerData.GeoTargeting.Regions,function(a){var b=a.name+", "+a.country.name;r.push(b)});var s=r.join(",");n+=s+"</span><br />"}if(_.size(b.offerData.GeoTargeting.Countries)>0){n+='Countries:<br /><span class="regions">';var t=[];_.each(b.offerData.GeoTargeting.Countries,function(a){t.push(a.name)});var u=t.join(",");n+=u+"</span><br />"}}b.locationsList=n}else b.locationsList=l("common.countries.all");var v=b.offerData.Offer;if(b.showEmailInstructions()){var w=function(a){return $.trim(a).length>0};b.offerData.from_instructions=_.uniq(_.filter(v.email_instructions_from.split(/\n/),w)),b.offerData.subject_instructions=_.uniq(_.filter(v.email_instructions_subject.split(/\n/),w))}b.offerData.daysUntilExpires=moment(b.offerData.Offer.expiration_date).diff(moment().startOf("day"),"days"),b.offerLoaded=!0,b.$emit("offerLoaded",b.offerData),!b.requireApproval()&&v.is_pay_per_call&&p.getRingRevenueLink(v.id).success(function(a){b.ringRevenueLink=a}),b.requireApproval()&&f(function(){b.$broadcast("approvalRequired",b.offerData.Offer.id)})},function(){b.isError=!0});var x=p.getOfferPromocodes(q.id);x.success(function(a){b.promocodes=a||[]}),b.payoutStructures.name="",b.payoutStructures.payout_type_id_to_acronym={"-1":"",0:"CPA",1:"CPS",2:"CPA+CPS",3:"CPC",4:"CPM"},b.payoutStructures.isPercentPayout=!1,b.payoutStructures.isMoneyPayout=!0,b.payoutStructures.isParentPercentPayout=!1,b.payoutStructures.isParentMoneyPayout=!1,b.payoutStructures.payoutTypes=null,b.payoutStructures.payout_type_id=-1,b.payoutStructures.payout_range=0,b.payoutStructures.default_payout=0,b.payoutStructures.default_payout_percent=0,b.payoutStructures.default_currency="USD",b.payoutStructures.payout_min=0,b.payoutStructures.payout_max=0,b.payoutStructures.payout_percent_min=0,b.payoutStructures.payout_percent_max=0,b.payoutStructures.loading=!0,b.payoutStructures.loadError=!1;var y=p.getPayoutStructure(q.id,"offer");y.success(function(a){if(a&&a.data&&a.data.offerdata&&a.data.offerdata.http_code<400){b.payoutStructures.rawdata=a,b.payoutStructures.ps=b.payoutStructures.rawdata.data.offerdata.data,b.psModal=b.payoutStructures.ps,b.payoutStructures.default_currency=b.payoutStructures.ps.currency?b.payoutStructures.ps.currency:"$",b.payoutStructures.name=b.payoutStructures.ps.name,b.payoutStructures.payout_type_id=b.payoutStructures.ps.payout_type_id,b.payoutStructures.inherit_parent_rules=b.payoutStructures.ps.inherit_parent_rules;var c=b.payoutStructures.payout_type_id_to_acronym[b.payoutStructures.payout_type_id];"CPS"===c?(b.payoutStructures.isPercentPayout=!0,b.payoutStructures.isMoneyPayout=!1):"CPA+CPS"===c?(b.payoutStructures.isPercentPayout=!0,b.payoutStructures.isMoneyPayout=!0):(b.payoutStructures.isPercentPayout=!1,b.payoutStructures.isMoneyPayout=!0);var d=b.payoutStructures.payout_type_id_to_acronym[b.payoutStructures.ps.parent_payout_type_id];d&&c!=d&&(b.payoutStructures.payoutTypes={child:c,parent:d},"CPS"===d?(b.payoutStructures.isParentPercentPayout=!0,b.payoutStructures.isParentMoneyPayout=!1):"CPA+CPS"===d?(b.payoutStructures.isParentPercentPayout=!0,b.payoutStructures.isParentMoneyPayout=!0):d&&(b.payoutStructures.isParentPercentPayout=!1,b.payoutStructures.isParentMoneyPayout=!0)),b.payoutStructures.default_payout=0,b.payoutStructures.default_payout_percent=0;var e=b.payoutStructures.ps.default_payout.rate,f=b.payoutStructures.ps.default_payout.percent;("string"==typeof e&&Number(e.replaceAll(",",""))>0||"number"==typeof e&&e>0)&&(b.payoutStructures.default_payout=b.payoutStructures.ps.default_payout.rate),("string"==typeof f&&Number(f.replaceAll(",",""))>0||"number"==typeof f&&f>0)&&(b.payoutStructures.default_payout_percent=b.payoutStructures.ps.default_payout.percent),b.payoutStructures.loadError=!1,b.payoutStructures.loading=!1,b.payoutStructures.payout_min=b.payoutStructures.default_payout,b.payoutStructures.payout_max=b.payoutStructures.default_payout,b.payoutStructures.payout_percent_min=b.payoutStructures.default_payout_percent,b.payoutStructures.payout_percent_max=b.payoutStructures.default_payout_percent;var g=b.payoutStructures.ps.groups.slice();if(g&&g.length)for(var h=0;h<g.length;h++)g[h].payout.rate&&parseFloat(g[h].payout.rate)>parseFloat(b.payoutStructures.payout_max)&&(b.payoutStructures.payout_max=g[h].payout.rate),g[h].payout.rate&&parseFloat(g[h].payout.rate)<parseFloat(b.payoutStructures.payout_min)&&(b.payoutStructures.payout_min=g[h].payout.rate),g[h].payout.percent&&parseFloat(g[h].payout.percent)>parseFloat(b.payoutStructures.payout_percent_max)&&(b.payoutStructures.payout_percent_max=g[h].payout.percent),g[h].payout.percent&&parseFloat(g[h].payout.percent)<parseFloat(b.payoutStructures.payout_percent_min)&&(b.payoutStructures.payout_percent_min=g[h].payout.percent);b.criteria=b.payoutStructures.ps.evaluation_criteria,b.groups=b.payoutStructures.ps.groups,b.criteriaTable=b.flattenGroups(b.criteria,b.groups),b.hasPayoutStructures=!0}else b.payoutStructures.rawdata={},b.payoutStructures.name="Payout Structure Not Found",b.payoutStructures.loadError=!0,b.payoutStructures.loading=!1,b.payoutStructures.isPercentPayout=!1,b.payoutStructures.isMoneyPayout=!0,b.payoutStructures.isParentPercentPayout=!1,b.payoutStructures.isParentMoneyPayout=!1,b.payoutStructures.payoutTypes=null,b.payoutStructures.payout_type_id=-1,b.payoutStructures.payout_range=0,b.payoutStructures.default_payout=0,b.payoutStructures.default_currency="$",b.payoutStructures.default_payout_percent=0,b.payoutStructures.payout_min=0,b.payoutStructures.payout_max=0,b.criteriaTable=[],b.hasPayoutStructures=!1});var z=i.get("offers").getOfferTypes();b.getPayoutType=function(a){return a&&z[a]?z[a].title:""},b.getPayoutAmount=function(a,b){return a&&z[a]?A(z[a].type,b):""},b.getPayoutDiff=function(a){if(!a.previousPayout)return[];var b=[];return a.previousPayout!=a.currentPayout&&b.push("Offer payout changed from "+a.previousPayout+" to "+a.currentPayout),_.isEmpty(a.currentGoals)&&_.isEmpty(a.previousGoals)||(_.each(a.previousGoals,function(c,d){a.currentGoals&&a.currentGoals[d]||b.push("Goal "+c.name+" ("+d+") removed.")}),_.each(a.currentGoals,function(c,d){a.previousGoals&&a.previousGoals[d]?a.currentGoals[d].payout!=a.previousGoals[d].payout&&b.push(c.name+"("+d+") changed from "+a.previousGoals[d].payout+" to "+a.currentGoals[d].payout):b.push("Goal "+c.name+" ("+d+") added.")})),b};var A=function(c,d){var e="",f=b.offerData.Offer.currency;switch(d.default_payout=d.default_payout||d.payout,c){case"money":e=a.currency.formatCurrency(d.default_payout,f);break;case"percentage":e="{0}%".format(d.percent_payout);break;case"both":e="{0} + {1}%".format(a.currency.formatCurrency(d.default_payout,f),d.percent_payout)}return e},B=i.get("offers").getProtocolTypes();b.getProtocolType=function(a){return a&&B[a]?B[a]:""},b.togglePayoutStructure=function(a){this.payoutDetails.goal_payouts[a].isPayoutStructureVisible=!this.payoutDetails.goal_payouts[a].isPayoutStructureVisible},b.copyTrackingPixelLink=function(){var a=document.getElementById("trackingLink");a.select(),a.setSelectionRange(0,a.value.length),navigator.clipboard.writeText(a.value)},b.triggerResize=function(){$(a).resize()}}])}(this),function(a){var b=["api","models","$q","currentUser","$routeParams",function(b,c,d,e,f){var g=c.getExtendable("base").extend({name:"offerDetail",apiKey:e.hasFeature("PREMIUM_PARTNER_INSTANCE")?e.ConnectAdvertisers[f.upstreamNetworkId].api_key:void 0,upstreamNetworkId:e.hasFeature("PREMIUM_PARTNER_INSTANCE")?f.upstreamNetworkId:void 0,init:function(){this._super()},getOffer:function(a){var c=["Thumbnail","OfferChannel","OfferOperatingSystem","OfferVertical","OfferIncentive","OfferConversionType","OfferMediaPlacement","OfferTag"];this.addDateFilter(a),this.convertContains(a),e.BrandPreferences.display_advertiser&&c.unshift("Advertiser"),Array.prototype.push.apply(a.contain,c),delete a.contain.length;var f=d.defer(),g=b.get("Offer/findById",a,this.apiKey,this.upstreamNetworkId);return g.success(f.resolve).error(f.reject),f.promise},getOfferPromocodes:function(a){var c=d.defer(),e={offer_id:a},f=["id","code"],g={code:"ASC"};return b.get("PromoCode/findAll",{filters:e,fields:f,limit:10,page:1,sort:g},this.apiKey,this.upstreamNetworkId).success(function(a){c.resolve(a)}).error(c.reject),c.promise},getPayoutStructure:function(a,c){var e=d.defer(),f={},g="offer_id",h="getPayoutStructureDetailByOfferId";return"goal"===c&&(g="goal_id",h="getPayoutStructureDetailByGoalId"),f[g]=a,b.get("PayoutStructure/"+h,f,this.apiKey,this.upstreamNetworkId).success(function(a){e.resolve(a)}).error(e.reject),e.promise},getOfferGoals:function(a){var c=d.defer(),e={offer_id:a};return b.get("Goal/findAll",{filters:e},this.apiKey,this.upstreamNetworkId).success(function(a){c.resolve(_(a).pluck("Goal"))}).error(c.reject),c.promise},getOfferDNE3rdPartyList:function(a){var c=d.defer();return b.get("Dne/getUrls",{offer_id:a},this.apiKey,this.upstreamNetworkId).success(function(a){c.resolve(a)}).error(c.reject),c.promise},getOfferPayoutDetails:function(a,c,e){var f=this,g=d.defer(),h=b.get("Offer/getPayoutDetails",{offer_id:a},this.apiKey,this.upstreamNetworkId),i=[f.getOfferGoals(a),h];return e&&i.push(b.get("Offer/getPayoutHistory",{offer_id:a,limit:100,page:1},this.apiKey,this.upstreamNetworkId)),d.all(i).then(function(a){var b={},h=a[1].data;if(h.hasPayoutGroups=!1,e&&(h.payoutHistory=a[2].data),
_.each(a[0],function(a){b[a.id]=a}),c&&!_.isEmpty(b)){var i=Object.keys(b),j=_.map(i,function(a){return f.getPayoutStructure(a,"goal")});d.all(j).then(function(a){var c={"-1":"",0:"CPA",1:"CPS",2:"CPA+CPS",3:"CPC",4:"CPM"};_.each(a,function(a){if(a.data&&a.data.goaldata&&200==a.data.goaldata.http_code){var d=a.data.goaldata.data,e=c[d.payout_type_id],g=c[d.parent_payout_type_id];"CPS"===e?(d.isPercentPayout=!0,d.isMoneyPayout=!1):"CPA+CPS"===e?(d.isPercentPayout=!0,d.isMoneyPayout=!0):(d.isPercentPayout=!1,d.isMoneyPayout=!0),g&&e!=g&&(d.payoutTypes={child:e,parent:g},"CPS"===g?(d.isParentPercentPayout=!0,d.isParentMoneyPayout=!1):"CPA+CPS"===g?(d.isParentPercentPayout=!0,d.isParentMoneyPayout=!0):g&&(d.isParentPercentPayout=!1,d.isParentMoneyPayout=!0));var h=0,i=0,j=d.default_payout.rate,k=d.default_payout.percent;("string"==typeof j&&Number(j.replaceAll(",",""))>0||"number"==typeof j&&j>0)&&(h=d.default_payout.rate),("string"==typeof k&&Number(k.replaceAll(",",""))>0||"number"==typeof k&&k>0)&&(i=d.default_payout.percent),d.payout_min=h,d.payout_max=h,d.payout_percent_min=i,d.payout_percent_max=i;var l=d.groups.slice();if(l&&l.length)for(var m=0;m<l.length;m++)l[m].payout.rate&&parseFloat(l[m].payout.rate)>parseFloat(d.payout_max)&&(d.payout_max=l[m].payout.rate),l[m].payout.rate&&parseFloat(l[m].payout.rate)<parseFloat(d.payout_min)&&(d.payout_min=l[m].payout.rate),l[m].payout.percent&&parseFloat(l[m].payout.percent)>parseFloat(d.payout_percent_max)&&(d.payout_percent_max=l[m].payout.percent),l[m].payout.percent&&parseFloat(l[m].payout.percent)<parseFloat(d.payout_percent_min)&&(d.payout_percent_min=l[m].payout.percent);var n=f.flattenGroups(d.evaluation_criteria,d.groups);d.criteriaTable=n.reducedGroups,d.criteriaNames=n.criteriaNames,d.criteriaRange=n.criteriaRange,d.hasPayoutStructures=!0,d.default_payout=h,d.default_payout_percent=i,b[a.data.goalid].payoutStructure=d,b[a.data.goalid].default_payout=d.default_payout.rate,b[a.data.goalid].payout_type=d.payout_type_id,b[a.data.goalid].percent_payout=d.default_payout.percent}}),h=f.formatPayoutDetails(h,b),g.resolve(h)})["catch"](function(a){g.resolve(h)})}else h=f.formatPayoutDetails(h,b),g.resolve(h)}),g.promise},formatPayoutDetails:function(a,b){var c=this;return a.offer_payout&&_.has(a.offer_payout,"payout_groups")&&(a.hasPayoutGroups=!0,_.each(a.offer_payout.payout_groups,function(b,d){_.each(b.cashflow_group.rules,function(b,e){a.offer_payout.payout_groups[d].cashflow_group.rules[e]=c.formatRule(b)})})),a.goal_payouts&&b&&_.each(a.goal_payouts,function(d,e){a.goal_payouts[e].goal=b[d.goal_id],_.has(d,"payout_groups")&&(a.hasPayoutGroups=!0,_.each(d.payout_groups,function(b,d){_.each(b.cashflow_group.rules,function(b,f){a.goal_payouts[e].payout_groups[d].cashflow_group.rules[f]=c.formatRule(b)})}))}),a},formatRule:function(a){var b={IN:"is","NOT IN":"is not",STARTS_WITH:"starts with","NOT STARTS_WITH":"does not start with",CONTAINS:"contains","NOT CONTAINS":"does not contain",ENDS_WITH:"ends with","NOT ENDS_WITH":"does not end with"},c={advanced_targeting_rule:"Advanced Targeting Rule",aff_sub1:"Affiliate Sub 1",aff_sub2:"Affiliate Sub 2",aff_sub3:"Affiliate Sub 3",aff_sub4:"Affiliate Sub 4",aff_sub5:"Affiliate Sub 5",adv_sub:"Advertiser Sub ID",country:"Country",offer_url:"Offer URL",source:"Source"};return"1"==a.negate&&(a.operator="NOT "+a.operator),a.operator=b[a.operator],_.has(a,"value_details")&&(a.value=_.chain(a.value_details).without(null).pluck("name").value(),delete a.value_details),a.field=c[a.field],a.value.length>1?(a.value.push("or "+a.value.pop()),a.values=a.value.join(", ")):a.values=a.value[0],delete a.value,a},flattenGroups:function(a,b){function c(a,b){return a.order>b.order?1:a.order<b.order?-1:0}if(!a||!b)return[];for(var d={},e={},f={},g=[],h=0,i=_.range(1,1),j=_.range(1,a.length+1),k=[],l=["","=","<","<=",">",">=","IN","NOT","AND","OR","CALL","LIKE","BETWEEN"],m=_.range(1,a.length-1),n=0;n<a.length;n++){var o=a[n],p=o.name||n;if(o.inherited&&e[p]?(f[o.id]=e[p],o.id=e[p],j.pop()):(e[p]=o.id,k.push(o.name||n)),null==o.rules||"undefined"==typeof o.rules){var q="c"+o.id+"r0";d[q]={name:o.name,left_side:"n/a",operator:0,right_side:"n/a"}}else for(var r=0;r<o.rules.length;r++)if(null!=o.rules[r]&&"undefined"!=typeof o.rules[r]){var s=Object.keys(o.rules[r]).filter(function(a,b,c){return"rule_id"!=a&&"operator"!=a?a:void 0}),t=s[0],u=o.rules[r][t].length+1,p=o.name,v=l[o.rules[r].operator]||"",w=null,x=null;"IN"===v?x=o.rules[r][t].join(", "):u>1?(w=o.rules[r][t][1],x=o.rules[r][t][0]):x=o.rules[r][t][1];var y=o.rules[r].rule_id,q="c"+o.id+"r"+o.rules[r].rule_id;d[q]={id:y,name:p,left_side:w,operator:v,right_side:x}}}for(var z=0,A=0;A<b.length;A++){var B=b[A].inherited?z+1:b[A].evaluation_order,C={order:B||0,name:b[A].name||"",payout_rate:b[A].payout.rate,payout_percent:b[A].payout.percent,currency:b[A].currency,inherited:b[A].inherited||!1,rules:[]};if(z=C.order,null==b[A].group_rules||"undefined"==typeof b[A].group_rules)for(var D=0;D<k.length;D++)C.rules.push({id:+(1e3+D),name:k[D],left_side:"",operator:"",right_side:""});else for(var E=0;E<b[A].group_rules.length;E++){var F=b[A].group_rules[E].criteria_id,G=f[F]?f[F]:F,q="c"+G+"r"+b[A].group_rules[E].rule_id||[];C.rules.push(d[q])}for(var H=k.slice(),I={},J=0;J<C.rules.length;J++)C.rules[J].name&&H.indexOf(C.rules[J].name)>-1&&(I[C.rules[J].name]=C.rules[J],H.splice(H.indexOf(C.rules[J].name),1));for(var K=0;K<H.length;K++)I[H[K]]={name:H[K],left_side:"",operator:"",right_side:""};C.rules=[];for(var D=0;D<k.length;D++)C.rules.push(I[k[D]]);g.push(C),h<C.rules.length&&(h=C.rules.length,i=_.range(1,h+1),m=_.range(1,h))}return g.sort(c),0==g.length&&($scope.payoutStructures.modalGuidance="This payout structure was empty. Check back later for updates."),{reducedGroups:g,criteriaNames:k,criteriaRange:j}},getPayoutStructures:function(a,c){var e=d.defer(),f={limit:a.length},g="offer_ids",h="getPayoutStructureByOfferIds";return"goal"===c&&(g="goal_ids",h="getPayoutStructureByGoalIds"),f[g]=a,b.get("PayoutStructure/"+h).success(function(a){e.resolve(a)}).error(e.reject),e.promise},getThumbnail:function(a){var c=d.defer();return b.get("Offer/getThumbnail",{ids:[a]},this.apiKey,this.upstreamNetworkId).success(function(a){if(a.length>0&&a[0].Thumbnail){var b=_.keys(a[0].Thumbnail);c.resolve(a[0].Thumbnail[b[0]])}c.resolve()}).error(c.reject),c.promise},getTargeting:function(a){return b.get("OfferTargeting/getRuleTargetingForOffer",{offer_id:a},this.apiKey,this.upstreamNetworkId)},getOfferUrls:function(a){var c={offer_id:[a]};return b.get("OfferUrl/findAll",{filters:c},this.apiKey,this.upstreamNetworkId)},generateTrackingLink:function(c){return _.isUndefined(c.affiliate_id)&&(c.affiliate_id=a.Config.affiliate_id),c.params=c.options,b.get("Offer/generateTrackingLink",c,this.apiKey,this.upstreamNetworkId)},getOfferApprovalQuestions:function(a){return b.get("Offer/getApprovalQuestions",{offer_id:a},this.apiKey,this.upstreamNetworkId)},saveOfferApprovalAnswers:function(a){return b.get("Offer/requestOfferAccess",angular.copy(a),this.apiKey,this.upstreamNetworkId)},getRingRevenueLink:function(a){return b.get("RingRevenue/createAffiliateLoginUrl",{offer_id:a,url_path:"/home"},this.apiKey,this.upstreamNetworkId)},agreeToTerms:function(a){return b.get("Offer/acceptOfferTermsAndConditions",{offer_id:a},this.apiKey,this.upstreamNetworkId)}});return g}];a.Models.offerDetail=b}(this),function(a){var b=["api","models",function(a,b){var c=b.getExtendable("base").extend({name:"offerFile",init:function(){this._super()},create:function(b,c,d){return a.get("OfferFile/create",b,c,d)},getCreatives:function(b,c,d){return this.convertContains(b),a.get("OfferFile/findAll",b,c,d)},getOfferFileDefinition:function(){return{entity:"OfferFile",fields:{id:{type:"int"},offer_id:{type:"int"},display:{type:"string"},"interface":{type:"enum",values:["advertiser","affiliate","network"]},account_id:{type:"int"},type:{type:"enum",values:{file:"File","image banner":"Static Banner","flash banner":"Flash Banner","email creative":"HTML Email","offer thumbnail":"Offer Thumbnail","text ad":"Text Creative","html ad":"HTML Creative",hidden:"Hidden","xml feed":"XML Feed"}},filename:{type:"string"},width:{type:"int"},height:{type:"int"},code:{type:"string"},status:this.getStandardDef("status"),is_private:$.extend(this.getStandardDef("bool_yes"),{nicename:"Private"}),created:this.getStandardDef("created"),modified:this.getStandardDef("modified"),shared:this.getStandardDef("bool_yes"),size:{type:"int"},url:{type:"string"},thumbnail:{type:"string"}},related_entities:{Offer:{fields:{id:{type:"int"},name:{type:"string"}}}}}},getCreativeCode:function(b,c,d){return a.get("OfferFile/getCreativeCode",b,c,d)}});return c}];a.Models.offerFile=b}(this),function(a){var b=["api","models","$q",function(a,b,c){var d=b.getExtendable("base").extend({name:"offerPixels",init:function(){this._super()},getOfferPixelData:function(b,d,e){if(_.indexOf(b.fields,"Offer.name")>-1&&!_.contains(b.contain,"Offer")&&b.contain.push("Offer"),_.contains(b.fields,"goal_id")){var f=c.defer(),g={fields:["id","name"]},h=c.all([a.get("Goal/findAll",g,d,e),a.get("OfferPixel/findAll",b,d,e)]);return h.then(function(a){var b=a[0].data,c=a[1].data;_.each(c.data,function(a,d){a.OfferPixel.goal_id&&b[a.OfferPixel.goal_id]&&(c.data[d].Goal=b[a.OfferPixel.goal_id].Goal)}),f.resolve(c)},function(a){f.reject(a[1].data)}),f.promise}var i=a.get("OfferPixel/findAll",b,d,e);return i},getOfferGoals:function(b,c,d){var e={fields:["id","name"],filters:{offer_id:b,status:"active"}};return a.get("Goal/findAll",e,c,d)},deleteOfferPixel:function(b,c,d){$.extend(b,{field:"status",value:"deleted"});var e=a.get("OfferPixel/updateField",b,c,d);return e},createOfferPixel:function(b,c,d){return a.get("OfferPixel/create",{data:b},c,d)},getAllowedTypes:function(b,c,d){return a.get("OfferPixel/getAllowedTypes",{offer_id:b},c,d)},getOfferPixelDefinition:function(){return{entity:"OfferPixel",fields:{id:{type:"int",nicename:"ID"},offer_id:{type:"int"},affiliate_id:{type:"int"},type:{type:"enum",values:{code:"HTML / JavaScript Code",image:"Image Pixel",url:"Postback URL"}},code:{type:"string",nicename:"Code/URL"},status:{type:"enum",values:{active:"Active",pending:"Pending",deleted:"Deleted",rejected:"Rejected"}},goal_id:{type:"int"}},related_entities:{Offer:{groupable:!1,fields:{id:{type:"integer"},name:{type:"string"}}}}}}});return d}];a.Models.offerPixel=b}(this),function(a){var b=function(a,b,c,d){var e=c.get("offerDetail"),f=function(a){var b={req_affiliate_info1:"aff_sub1",req_affiliate_info2:"aff_sub2",req_affiliate_info3:"aff_sub3",req_affiliate_info4:"aff_sub4",req_affiliate_info5:"aff_sub5",req_browser_name:"Browser Name",req_browser_version:"Browser Version",req_connection_speed:"Connection Type",req_device_brand:"Device Brand",req_device_marketing_name:"Device Marketing Name",req_device_model:"Device Model",req_device_os:"Device O/S",req_device_os_version:"Device O/S Version",req_language:"Language",req_user_agent:"User Agent",req_mobile_carrier:"Mobile Carrier"};return b[a]||a},g=function(){var c=e.getTargeting(b.offer_id);return c.success(function(b){a.ruleSet=h(b)}),c},h=function(a){return _(a).each(function(a){var b=[];_(a.rule).each(function(a,c){c.match(/^req_/)&&a&&b.push({key:f(c),value:a})}),a.rulesFiltered=b}),a};a.$watch("offerLoaded",function(){a.offerLoaded&&1===Number(a.offerData.Offer.use_target_rules)&&(a.isMobile?d.onDirectivesReady(["targetingMobile"],function(){a.table=d.get("targetingMobile"),g().then(function(){a.table.addItems(a.ruleSet,{})})}):d.onDirectivesReady(["targetingDesktop"],function(){a.table=d.get("targetingDesktop"),g().then(function(){a.table.render(a.ruleSet)})}))})};b.$inject=["$scope","$routeParams","models","directiveRegistry"],a.Application.controller("Controllers.offerTargeting",b)}(this),function(a){a.Application.controller("Controllers.offers",["$rootScope","$scope","$timeout","$q","analyticsService","$location","$routeParams","cache","timeoutQueue","models","directiveRegistry","currentUser","digestService",function(b,c,d,e,f,g,h,cache,i,j,k,l,m){var n=j.get("offers"),o=[{value:"channels",field:"OfferChannel"},{value:"operatingSystems",field:"OfferOperatingSystem"},{value:"verticals",field:"OfferVertical"},{value:"incentives",field:"OfferIncentive"},{value:"conversionTypes",field:"OfferConversionType"},{value:"mediaPlacements",field:"OfferMediaPlacement"},{value:"customs",field:"OfferTag"}];c.selectedCountries=[],c.selectedCountriesLeft=[],c.selectedCountriesRight=[],c.offerFile={type:{},size:{},anySize:!0},c.search={keyword:"",newKeyword:"",isAdvancedVisible:!1,keywords:[],filters:{newCountry:"",countries:[],minPayout:null,maxPayout:null,newCategory:{},newChannel:{},newOperatingSystem:{},newVertical:{},newIncentive:{},newConversionType:{},newMediaPlacement:{},newCustom:{},categories:[],channels:[],operatingSystems:[],verticals:[],incentives:[],conversionTypes:[],mediaPlacements:[],customs:[],selectedCategories:{},selectedChannels:{},selectedOperatingSystems:{},selectedVerticals:{},selectedIncentives:{},selectedConversionTypes:{},selectedMediaPlacements:{},selectedCustoms:{},selected:{payout:!1,category:!1,country:!1,channels:!1,operatingSystems:!1,verticals:!1,incentives:!1,conversionTypes:!1,mediaPlacements:!1,customs:!1},isEmpty:function(){var a=this,b=!0;return a.selected.payout!==!0||_.isNull(a.minPayout)&&_.isNull(a.maxPayout)||(b=!1),a.selected.category&&a.categories.length>0&&(b=!1),_.each(["channels","operatingSystems","verticals","incentives","conversionTypes","mediaPlacements","customs"],function(c){a.selected[c]&&a[c].length>0&&(b=!1)}),a.selected.country&&a.countries.length>0&&(b=!1),b},addFilter:function(a){switch(a){case"country":var b=_.find(c.countries,function(a){return a.name==c.search.filters.newCountry});_.isObject(b)&&(this.countries.push(b),this.countries=_.chain(this.countries).uniq().compact().value()),this.newCountry="";break;case"channel":this.selectedChannels[this.newChannel.value]=!0,this.channels.push(this.newChannel),this.channels=_.chain(this.channels).uniq().compact().value();break;case"operatingSystem":this.selectedOperatingSystems[this.newChannel.value]=!0,this.operatingSystems.push(this.newOperatingSystem),this.operatingSystems=_.chain(this.operatingSystems).uniq().compact().value();break;case"vertical":this.selectedVerticals[this.newVertical.value]=!0,this.verticals.push(this.newVertical),this.verticals=_.chain(this.verticals).uniq().compact().value();break;case"incentive":this.selectedIncentives[this.newIncentive.value]=!0,this.incentives.push(this.newIncentive),this.incentives=_.chain(this.incentives).uniq().compact().value();break;case"mediaPlacement":this.selectedMediaPlacements[this.newMediaPlacement.value]=!0,this.mediaPlacements.push(this.newMediaPlacement),this.mediaPlacements=_.chain(this.mediaPlacements).uniq().compact().value();break;case"conversionType":this.selectedConversionTypes[this.newConversionType.value]=!0,this.conversionTypes.push(this.newConversionType),this.conversionTypes=_.chain(this.conversionTypes).uniq().compact().value();break;case"custom":this.selectedCustoms[this.newCustom.value]=!0,this.customs.push(this.newCustom),this.customs=_.chain(this.customs).uniq().compact().value();break;case"category":this.selectedCategories[this.newCategory.value]=!0,this.categories.push(this.newCategory),this.categories=_.chain(this.categories).uniq().compact().value()}},removeFilter:function(a,b){switch(a){case"country":this.countries=_.without(this.countries,b);break;case"category":this.selectedCategories[b.value]=!1,this.categories=_.without(this.categories,b);break;case"channel":this.selectedChannels[b.value]=!1,this.channels=_.without(this.channels,b);break;case"operatingSystem":this.selectedOperatingSystems[b.value]=!1,this.operatingSystems=_.without(this.operatingSystems,b);break;case"vertical":this.selectedVerticals[b.value]=!1,this.verticals=_.without(this.verticals,b);break;case"incentive":this.selectedIncentives[b.value]=!1,this.incentives=_.without(this.incentives,b);break;case"conversionType":this.selectedConversionTypes[b.value]=!1,this.conversionTypes=_.without(this.conversionTypes,b);break;case"mediaPlacement":this.selectedMediaPlacements[b.value]=!1,this.mediaPlacements=_.without(this.mediaPlacements,b);break;case"custom":this.selectedCustoms[b.value]=!1,this.customs=_.without(this.customs,b)}},hasClassificationFilter:function(a){return!_.isEmpty(c.search.filters[a])&&c.search.filters.selected[a]}},hasClassificationFilter:function(a){return!_.isEmpty(c.search.filters[a])&&c.search.filters.selected[a]},addKeyword:function(){this.keywords.push(this.newKeyword),this.keywords=_.chain(this.keywords).uniq().compact().value(),this.newKeyword=""},removeKeyword:function(a){this.keywords=_.without(this.keywords,a)}},c.hasCityTargetingEnabled=b.hasFeatures("CITY_TARGETING"),c.hasExclusionTargetingEnabled=b.hasFeatures("GEOTARGETING_EXCLUSIONS"),c.offerFileSizeEmpty=function(){return _.isEmpty(_.filterSelected(c.offerFile.size))},c.moveCountryRight=function(a){a&&a.preventDefault(),c.selectedCountriesLeft.length>0&&(_.each(c.selectedCountriesLeft,function(a){var b=_.find(c.countries,function(b){return b.code==a.code});_.isObject(b)&&c.search.filters.countries.push(b)}),c.search.filters.countries=_.chain(c.search.filters.countries).uniq().compact().value())},c.moveCountryLeft=function(a){a&&a.preventDefault(),c.selectedCountriesRight.length>0&&_.each(c.selectedCountriesRight,function(a){var b=_.find(c.countries,function(b){return b.code==a.code});_.isObject(b)&&(c.search.filters.countries=_.without(c.search.filters.countries,b))})},c.checkboxChangedCountry=function(){c.search.filters.countries=[]},c.controlCategoryFilter=function(a){a&&a.value&&(c.search.filters.selected.category?c.search.filters.addFilter("category",a.value):c.search.filters.removeFilter("category",a))},c.checkboxChangedCategory=function(){c.controlCategoryFilter(c.search.filters.newCategory),c.search.filters.newCategory=null},c.changeCategoryCheckbox=function(a){var b=_.find(c.categories,function(b){return b.value==a});_.isObject(b)&&(c.search.filters.selectedCategories[a]?(c.search.filters.newCategory=b,c.search.filters.addFilter("category",b)):c.search.filters.removeFilter("category",b))};var p=g.search();p.search&&(c.search.keyword=p.search,c.isMobile||d(function(){a.angular.element("#basicKeywordSearch").focus()})),c.updateQueryParams=function(){c.isMobile||g.search("search",c.search.keyword)},c.updateTable=function(){c.updateQueryParams(),c.generateTable()},c.getDefinition=function(){return n.getOffersDefinition()},c.getDefaultContainParams=function(){return{0:"Country",1:"OfferCategory"}};var q=function(a){for(var b={},c=0;c<a.length;c++)b[c]=a[c];return b},r=function(){var a={fields:["id","name","default_payout","payout_type","currency","percent_payout","preview_url"],sort:{},page:c.table.paging.page,limit:c.table.paging.pageSize},d=["Country","OfferCategory","Thumbnail"];_.each(o,function(b){!_.isEmpty(c.search.filters[b.value])&&c.search.filters.selected[b.value]&&(d.push(b.field),a.fields.push(b.field))}),c.hasClassificationFilter=function(a){return!_.isEmpty(c.search.filters[a])&&c.search.filters.selected[a]},a.contain=q(d),a.sort[c.table.sort.field]=c.table.sort.direction;var f=c.processUserFilters();_(f).size()&&(a.filters=f);var g="my"==h.context,i=!0,j=!0,k=b.hasFeatures("HOR-1220-PS-ON-GOALS");c.incrementLoading(),g?n.getOffersWithAdditionalInfo(a,e,g,i,j,k).then(function(b){var d=Object.keys(b.data);d.length>0?n.getThumbnailForOffers(d).success(function(d){for(var e in d)b.data[d[e].offer_id].Thumbnail=d[e].Thumbnail[Object.keys(d[e].Thumbnail)[0]];c.decrementLoading(),(c.table.addItems||c.table.drawTable)(b,a)}).error(function(d){c.decrementLoading(),(c.table.addItems||c.table.drawTable)(b,a)}):c.decrementLoading()})["catch"](function(a){c.flashError(a.errorMessage),c.decrementLoading()}):n.getOffersWithAdditionalInfo(a,e,g,i,j,k).then(function(b){b.data&&_.each(_.keys(b.data),function(a){_.each(o,function(c){var d=b.data[a][c.field],e=[];_.isEmpty(d)||(_.each(_.keys(d),function(a){e.push(d[a].name)}),b.data[a][c.value+"String"]=e.join(", "))})}),c.decrementLoading(),(c.table.addItems||c.table.drawTable)(b,a)})["catch"](function(a){c.flashError(a.errorMessage),c.decrementLoading()})};c.makePopovers=function(){$(".hasTable").find('[data-popover="add_to_parent"]').each(function(){var a=$(this),b=a.parent(),c=a.data("title");b.attr("title",c),b.popover({trigger:"manual",html:"Goal Payouts"==c?!0:!1,content:"Goal Payouts"==c?a.html():a.text(),title:c,placement:"top"}).on("mouseenter",function(){var a=$(this);a.parent().on("mouseleave",function(){a.popover("hide")}),a.siblings(".popover").length<1&&a.popover("show")})})};var s=function(a){var b=[];return _.each(a.Cities,function(a){var c=a.name+", "+a.region.name+", "+a.country.name;b.push(c)}),_.each(a.Regions,function(a){var c=a.name+", "+a.country.name;b.push(c)}),_.each(a.Countries,function(a){b.push(a.name)}),b},t={namespace:"offers",key:"countries",getPromise:n.getLocationsForOffers,defaultValue:"All",processData:function(a){var b=this;_.each(a.data,function(a,c){var d=[];_.each(a.GeoTargeting.Countries,function(a){d.push(a.name)});var e=_.size(d),f=d.join(", ");e>2&&(f=e+'&nbsp;Countries<span data-popover="add_to_parent" data-title="Countries" style="display: none;">'+f+"</span>"),b.cachePut(c,f)})},postProcess:c.makePopovers},u={namespace:"offers",key:"locations",getPromise:n.getLocationsForOffers,defaultValue:"All",processData:function(a){var b=this;_.each(a.data,function(a,d){var e=_.isEmpty(a.GeoTargeting)?[]:s(a.GeoTargeting);c.offerLocationsQueue=e;var f=_.size(e),g=e.join(", ");f>2&&(g=f+'&nbsp;locations<span data-popover="add_to_parent" data-title="locations" style="display: none;">'+g+"</span>"),b.cachePut(d,g)})},postProcess:c.makePopovers},v={namespace:"offers",key:"includedLocations",getPromise:n.getLocationsForOffers,defaultValue:"All",processData:function(a){var b=this;_.each(a.data,function(a,c){var d={};_.each(a.GeoTargeting,function(b,c){_.contains(a.GeoTargeting.Exclude,c.toLowerCase())||_.isEmpty(b)||"Exclude"===c||(d[c]=b)});var e=_.isEmpty(d)?[]:s(d),f=_.size(e),g=e.join(", ");f>2&&(g=f+'&nbsp;Included Locations<span data-popover="add_to_parent" data-title="Included Locations" style="display: none;">'+g+"</span>"),b.cachePut(c,g)})},postProcess:c.makePopovers},w={namespace:"offers",key:"excludedLocations",getPromise:n.getLocationsForOffers,defaultValue:"All",processData:function(a){var b=this;_.each(a.data,function(a,c){var d={};_.each(a.GeoTargeting,function(b,c){_.contains(a.GeoTargeting.Exclude,c.toLowerCase())&&!_.isEmpty(b)&&(d[c]=b)});var e=_.isEmpty(d)?[]:s(d),f=_.size(e),g=e.join(", ");f>2&&(g=f+'&nbsp;Excluded Locations<span data-popover="add_to_parent" data-title="Excluded Locations" style="display: none;">'+g+"</span>"),b.cachePut(c,g)})},postProcess:c.makePopovers},x={namespace:"offers",key:"categories",getPromise:n.getCategoriesForOffers,defaultValue:"",processData:function(a){var b=this;_.each(a,function(a){var d=a.categories,e=a.offer_id,f=_.pluck(d,"name").join(", ");_.size(d)>2&&!c.isMobile&&(f=_.size(d)+'&nbsp;Categories<span data-popover="add_to_parent" data-title="Categories" style="display: none;">'+f+"</span>"),b.cachePut(e,f)})},postProcess:c.makePopovers},y={},z=function(a,b){c.hasCityTargetingEnabled?c.hasExclusionTargetingEnabled?(F.enqueue(a,b.find(".offerLocations").first()),G.enqueue(a,b.find(".offerExcludeLocations").first())):E.enqueue(a,b.find(".offerLocations").first()):D.enqueue(a,b.find(".offerLocations").first())},A=function(){k.onDirectivesReady(["offerMobile"],function(){c.table=k.get("offerMobile"),c.table.sort={field:"Offer.id",direction:"desc"},r(),c.generateTable=function(){c.table.clearItems(),r()},c.table.$on("moreItemsRequested",function(){r()}),c.table.$on("rowRendered",function(a,b){var c=b.scope().Offer.id;C.enqueue(c,b.find(".7dayEPCValue").first()),D.options.namespace="offersMobile",H.enqueue(c,b.find(".offerCategories").first()),z(c,b)})}),t.namespame="offersMobile",t.postProcess=angular.noop,t.processData=function(a){var b=this;_(a).each(function(a){var c=a.countries,d=a.offer_id;b.cachePut(d,_(c).pluck("name").join(" <br> "))})},u.namespame="offersMobile",u.postProcess=angular.noop,u.processData=function(a){var b=this;_(a).each(function(a){var c=a.locations,d=a.offer_id;b.cachePut(d,_(c).pluck("name").join(" <br> "))})},v.namespame="offersMobile",v.postProcess=angular.noop,v.processData=function(a){var b=this;_(a).each(function(a){var c=a.includedLocations,d=a.offer_id;b.cachePut(d,_(c).pluck("name").join(" <br> "))})},w.namespame="offersMobile",w.postProcess=angular.noop,w.processData=function(a){var b=this;_(a).each(function(a){var c=a.excludedLocations,d=a.offer_id;b.cachePut(d,_(c).pluck("name").join(" <br> "))})},x.namespace="offersMobile",x.postProcess=angular.noop,x.processData=function(a){var b=this;_(a).each(function(a){var c=a.categories,d=a.offer_id;b.cachePut(d,_(c).pluck("name").join(" <br> "))})}},B=function(){c.generateTable=function(){r()},k.onDirectivesReady(["offersTable"],function(){c.table=k.get("offersTable"),c.table.sort={field:"Offer.id",direction:"desc"},c.table.$on("sortRequested",r),c.table.$on("pagingChanged",r),c.table.$on("rowRendered",function(a,b){var c=b.scope().Offer,d=c.id;y[d]=c.currency,C.enqueue(d,b.find(".7dayEPCValue").first()),H.enqueue(d,b.find(".offerCategories").first()),z(d,b)}),r()})};c.isMobile?A():B();var C=i.factory({namespace:"offers",key:"erpc",getPromise:n.getEPCForOffers,defaultValue:"New",processData:function(b){var c=this;_.each(b.data,function(b){var d=b.Stat.offer_id;c.cachePut(d,a.currency.formatCurrency(b.Stat.erpc,y[d],5))})}}),D=i.factory(t),E=i.factory(u),F=i.factory(v),G=i.factory(w),H=i.factory(x);c.routeParams=h,c.getDefaultSort=function(){return"my"==h.context?"id desc":"Offer.id desc"},c.getDataCall=function(){return"my"==h.context?$.proxy(n.getMyOffers,n):$.proxy(n.getOffers,n)},c.processUserFilters=function(){var a={},b=_.clone(c.search.keywords);return b.push(c.search.keyword),b=_.chain(b).uniq().compact().value(),_.isEmpty(b)||(a.query=[],_.each(b,function(b){a.query.push(b)})),_.isEmpty(c.search.filters.countries)||(!c.search.isAdvancedVisible||c.search.isAdvancedVisible&&c.search.filters.selected.country)&&(a["Country.code"]=a["Country.code"]||[],a["Country.code"]=_.union(a["Country.code"],_.pluck(c.search.filters.countries,"code"))),_.each(o,function(b){!_.isEmpty(c.search.filters[b.value])&&c.search.filters.selected[b.value]&&(a[b.field+".id"]=a[b.field+".id"]||[],a[b.field+".id"]=_.union(a[b.field+".id"],_.pluck(c.search.filters[b.value],"value")))}),_.isEmpty(c.search.filters.categories)||(!c.search.isAdvancedVisible||c.search.isAdvancedVisible&&c.search.filters.selected.category)&&(a["OfferCategory.id"]=a["OfferCategory.id"]||[],a["OfferCategory.id"]=_.union(a["OfferCategory.id"],_.pluck(c.search.filters.categories,"value"))),c.search.filters.selected.payout&&!_.isNull(c.search.filters.minPayout)&&(a["Offer.default_payout"]=a["Offer.default_payout"]||{},a["Offer.default_payout"].GREATER_THAN_OR_EQUAL_TO=parseFloat(c.search.filters.minPayout).toFixed(2)),c.search.filters.selected.payout&&!_.isNull(c.search.filters.maxPayout)&&(a["Offer.default_payout"]=a["Offer.default_payout"]||{},a["Offer.default_payout"].LESS_THAN_OR_EQUAL_TO=parseFloat(c.search.filters.maxPayout).toFixed(2)),a},c.getDefaultFilter=function(){return c.processUserFilters()},c.applyPanelFn=function(a){_(["category","creative","country","advanced-search"]).contains(a)&&c.generateTable()};var I={},J=function(a,b){if(I[a]){var c=I[a],d=document.getElementById("tracking-"+b);if(c.message)d.innerText=c.message,setTimeout(function(){d.innerText=""},1e3);else{const e=c.universal_tracking_link?c.universal_tracking_link:c.click_url;if(navigator.clipboard)navigator.clipboard.writeText(e),d.innerText="Copied!";else{var f=document.createElement("textarea");f.value=e,document.body.appendChild(f),f.select();try{document.execCommand("copy"),d.innerText="Copied!"}catch(g){console.error("Unable to copy text to clipboard (execCommand)",g)}finally{document.body.removeChild(f)}}setTimeout(function(){d.innerText=""},1e3)}}};c.trackingLink="",c.getTrackingLink=function(b){var c,d=e.defer(),f={offer_id:b,options:{}},g=m.md5(a.angular.toJson(f));if(I[g])J(g,b),d.reject();else{var h=document.getElementById("tracking-"+b);h.innerText="Getting Link...",c=n.generateTrackingLink(f),c.success(function(a){I[g]=a,d.resolve(!0)}),c.error(function(){h.innerText=["Your link did not successfully generate. ","Try again by clicking the attached refresh icon"].join(),setTimeout(function(){h.innerText=""},3e3)})}d.promise.then(function(){J(g,b)})},n.processRequestsToScope(c,{categories:"getCategories"}),n.processRequestsToScope(c,{tags:"getTags"}),n.getCountries(c)}])}(this),function(a){var b=["$q","$translate","api","models","geographic",function(b,c,d,e,f){var g=e.getExtendable("base").extend({name:"offers",simpleCountryList:[],init:function(){this._super()},getOffers:function(a,b,c){var e=d.get("Offer/findAll",a);return b&&c&&this.populateScope(e,b,c),e},getTags:function(a,b){return this.getTagsChoices(a,b,"Tag/findAll",{sort:{name:"asc"},limit:1e3,offset:0},{entity:"Tag",label:"name",value:"id",scope:"attribute"})},getMyOffers:function(a,b,c){var e=d.get("Offer/findMyOffers",a);return b&&c&&this.populateScope(e,b,c),e},getTuneNetworkOffers:function(a,b,c){var e=d.get("ZenithConnect/offers",a);return b&&c&&this.populateScope(e,b,c),e},generateTrackingLink:function(b){return _.isUndefined(b.affiliate_id)&&(b.affiliate_id=a.Config.affiliate_id),b.params=b.options,d.get("Offer/generateTrackingLink",b,this.apiKey,this.upstreamNetworkId)},getAffiliateConnections:function(a,b,c){var e=d.get("ZenithConnect/getAffiliateConnections",a);return b&&c&&this.populateScope(e,b,c),e},getFeaturedOffers:function(a,b){var c=b.defer(),e=this;return d.get("Offer/findAllFeaturedOfferIds").success(function(f){_.isEmpty(f)&&c.resolve({}),a.filters=a.filters||{},a.filters.id=f;var g={filters:{offer_id:f}},h=d.get("Goal/findAll",g);b.all([e.getOffers(a),h]).then(function(a){var b=a[0].data,d=a[1].data;_.each(d,function(a){var c=a.Goal.offer_id;b[c].Goals?b[c].Goals.push(a):b[c].Goals=[a]}),_.each(f,function(a){var c=[],d=[];_.each(b[a].Goals,function(a){"cpa_flat"===a.Goal.payout_type&&c.push(a.Goal.default_payout),"cpa_percentage"===a.Goal.payout_type&&d.push(a.Goal.percent_payout),"cpa_both"===a.Goal.payout_type&&(c.push(a.Goal.default_payout),d.push(a.Goal.percent_payout))}),_.isEmpty(c)||(b[a].flatPayout=c.sort(function(a,b){return parseFloat(a)-parseFloat(b)})),_.isEmpty(d)||(b[a].percentagePayout=d.sort(function(a,b){return parseFloat(a)-parseFloat(b)}))}),c.resolve(b)})}),c.promise},getEPCForOffers:function(a){var b={fields:["Stat.offer_id","Stat.erpc"],groups:["Stat.offer_id"],limit:a.length,filters:{"Stat.offer_id":{conditional:"EQUAL_TO",values:a},"Stat.date":{conditional:"BETWEEN",values:[moment().subtract(7,"days").format("YYYY-MM-DD"),moment().format("YYYY-MM-DD")]}}};return d.get("Report/getStats",b)},getThumbnailForOffers:function(a){return d.get("Offer/getThumbnail",{ids:a})},getCategoriesForOffers:function(a){return d.get("Offer/getCategories",{ids:a})},getLocationsForOffers:function(a){var b={contain:{0:"GeoTargeting"},fields:["id"],limit:a.length,page:1,filters:{id:a}};return d.get("Offer/findAll",b)},getOfferUrlsForOffers:function(a){return a=_.isArray(a)?a:[a],d.get("OfferUrl/findAll",{filters:{offer_id:a,status:"active"}})},getSimpleOfferAndOfferUrlList:function(a){return a=_.extend({filters:{"Offer.status":"active"},contain:{OfferUrl:{filters:{status:"active"}}}},a),d.get("Offer/findAll",a)},getOffersWithAdditionalInfo:function(a,b,c,d,e,f){var g=b.defer(),h=this,i=c?h.getMyOffers:h.getOffers;return i(a).success(function(a){var c=Object.keys(a.data);if(_.isEmpty(c))g.resolve(a);else{
var i={};d&&(i.getPs=h.getPayoutStructures(c,"offer")),e&&(i.getGoals=h.getGoals(c)),b.all(i).then(function(b){if(b.getPs&&(a.data=h.formatPayoutStructures(a.data,b.getPs.data,"offers")),f&&b.getGoals){var c=Object.keys(b.getGoals.data);h.getPayoutStructures(c,"goal").then(function(c){var d=h.formatPayoutStructures(b.getGoals.data,c.data,"goals");a.data=h.formatOffersWithGoals(a.data,d),g.resolve(a)})["catch"](function(b){g.resolve(a)})}else b.getGoals&&(a.data=h.formatOffersWithGoals(a.data,b.getGoals.data)),g.resolve(a)})["catch"](function(b){g.resolve(a)})}}).error(function(a){g.reject(a)}),g.promise},getPayoutStructures:function(a,c){var e=b.defer(),f={limit:a.length},g="offer_ids",h="getPayoutStructureByOfferIds";return"goal"===c&&(g="goal_ids",h="getPayoutStructureByGoalIds"),f[g]=a,d.get("PayoutStructure/"+h,f).success(function(a){e.resolve(a)}).error(e.reject),e.promise},formatPayoutStructures:function(a,b,c){var d=c.substring(0,c.length-1),e=d.charAt(0).toUpperCase()+d.slice(1),f=b.psdata[c]||null;return f&&("goals"==c&&(f=f.reduce(function(a,b){return Object.assign(a,b)},{})),Object.keys(f).forEach(function(c){if(b.psdata.ps&&b.psdata.ps.data){var d=b.psdata.ps.data.find(function(a){return a.id==f[c]});d&&a[c]&&a[c][e]&&(a[c][e].default_payout=d.default_payout.rate,a[c][e].payout_type=d.payout_type_id,a[c][e].percent_payout=d.default_payout.percent)}})),a},getGoals:function(a){return d.get("Goal/findAll",{filters:{offer_id:a}})},formatOffersWithGoals:function(a,b){return _.each(b,function(b){var c=b.Goal.offer_id;a[c].Offer.Goals?a[c].Offer.Goals.push(b):a[c].Offer.Goals=[b]}),a},getCountries:function(a,b,c){var e=d.get("Application/findAllCountries",c);return a&&b&&this.populateScope(e,a,b),e.success(function(b){a.simpleCountryList=[],a.countries=[],a.countryObject={},_(b).each(function(b){a.countries.push(b.Country),a.simpleCountryList.push(b.Country.name),a.countryObject[b.Country.code]=b.Country.name})}),e},getCategories:function(a,b){return this.getChoices(a,b,"Application/findAllOfferCategories",{sort:{"OfferCategory.name":"asc"}},{entity:"OfferCategory",label:"name",value:"id"})},getScheduledOfferChanges:function(a){return a=a||{},a.page=a.page||1,a.limit=a.limit||10,d.get("ScheduledOfferChange/findSchedules",a)},getOfferChoices:function(a,b){return this.getChoices(a,b.property,"Offer/findAll",{sort:{"Offer.name":"asc"},fields:["name","id"],limit:0},{entity:"Offer",label:"name",value:"id",default_choice:{value:"",label:c("reports.filters.defaultChoice.selectOffer")}},b.apiKey,b.upstreamNetworkId)},getGoalChoices:function(a,b){var e=b.property,f={fields:["id","name","Offer.name"],contain:{Offer:{fields:["id","name"]}}},g=[{value:"",label:c("reports.filters.defaultChoice.selectGoal")}],h=d.get("Goal/findAll",f,b.apiKey,b.upstreamNetworkId);return h.success(function(b){g.push({value:0,label:"Default Goal"}),_.each(b,function(a){_.hasMembers(a,"Offer","name")&&g.push({value:a.Goal.id,label:a.Goal.name,group:a.Offer.name})}),g.sort(function(a,b){var c=0;return c=a.group>b.group?1:a.group<b.group?-1:a.value>b.value?1:a.value<b.value?-1:0}),a[e]=g}),h},getCategoryChoices:function(a,b){return this.getChoices(a,b.property,"Application/findAllOfferCategories",{sort:{"OfferCategory.name":"asc"}},{entity:"OfferCategory",label:"name",value:"id",default_choice:{value:"",label:c("reports.filters.defaultChoice.selectCategory")}},b.apiKey,b.upstreamNetworkId)},getOfferUrlChoices:function(a,b){return this.getChoices(a,b.property,"OfferUrl/findAll",{sort:{"OfferUrl.name":"asc"},fields:["name","id"],limit:0},{entity:"OfferUrl",label:"name",value:"id",default_choice:{value:"",label:c("reports.filters.defaultChoice.selectOfferUrl")}},b.apiKey,b.upstreamNetworkId)},getOfferFileChoices:function(a,b){return this.getChoices(a,b.property,"OfferFile/findAll",{sort:{"OfferFile.display":"asc"},fields:["display","id"],limit:1e4},{entity:"OfferFile",label:"display",value:"id",default_choice:{value:"",label:c("reports.filters.defaultChoice.selectOfferFile")}},b.apiKey,b.upstreamNetworkId)},getCountryChoices:function(a,b){var d=b.property,e=f.getCountries(),g=[{value:"",label:c("reports.filters.defaultChoice.selectCountry")}];return _.each(e,function(a){g.push({value:a.code,label:a.name})}),a[d]=g,{}},getOfferTypes:function(){return{cpa_flat:{title:"CPA",full_title:"Cost per Conversion (CPA)",type:"money"},cpa_percentage:{title:"CPS",full_title:"Cost per Sale (CPS)",type:"percentage"},cpa_both:{title:"CPA + CPS",full_title:"Cost per Conversion plus Cost per Sale (CPA + CPS)",type:"both"},cpc:{title:"CPC",full_title:"Cost per Click (CPC)",type:"money"},cpm:{title:"CPM",full_title:"Cost per Thousand Impressions (CPM)",type:"money"}}},getProtocolTypes:function(){return{http:"HTTP iFrame Pixel",https:"HTTPS iFrame Pixel",http_img:"HTTP Image Pixel",https_img:"HTTPS Image Pixel",server:"Server Postback w/ Transaction ID",server_affiliate:"Server Postback w/ Affiliate ID",mobile_app:"Mobile App Postback",mobile_device:"Mobile Device Postback",pay_per_call:"Pay Per Call"}},getOffersDefinition:function(){return{entity:"Offer",fields:{advertiser_id:{type:"integer"},allow_direct_links:{type:"boolean"},allow_multiple_conversions:{type:"boolean"},allow_website_links:{type:"boolean"},approve_conversions:{type:"boolean"},click_macro_url:{type:"url"},conversion_cap:{type:"boolean"},conversion_ratio_threshold:{type:"integer"},converted_offer_id:{type:"integer"},converted_offer_type:{type:"string"},converted_offer_url:{type:"url"},currency:{type:"string"},customer_list_id:{type:"integer"},default_goal_name:{type:"string"},default_payout:{type:"currency",nicename:"Payout"},default_scrub:{type:"boolean"},description:{type:"string"},disable_click_macro:{type:"boolean"},display_advertiser:{type:"boolean"},dne_download_url:{type:"url"},dne_list_id:{type:"integer"},dne_unsubscribe_url:{type:"url"},dne_url_generation_error:{type:"string"},email_instructions:{type:"boolean"},email_instructions_from:{type:"email"},email_instructions_subject:{type:"string"},enable_offer_whitelist:{type:"boolean"},enforce_encrypt_tracking_pixels:{type:"boolean"},enforce_geo_targeting:{type:"boolean"},expiration_date:{type:"date"},featured:{type:"boolean"},has_goals_enabled:{type:"boolean"},hostname_id:{type:"integer"},id:{type:"integer"},is_expired:{type:"boolean"},is_private:{type:"boolean"},is_seo_friendly_301:{type:"boolean"},is_subscription:{type:"boolean"},max_payout:{type:"currency"},max_percent_payout:{type:"percent"},modified:{type:"timestamp"},monthly_conversion_cap:{type:"boolean"},monthly_payout_cap:{type:"currency"},monthly_revenue_cap:{type:"currency"},name:{type:"string"},note:{type:"string"},offer_url:{type:"url"},payout_cap:{type:"currency"},payout_type:{type:"enum",values:{cpa_flat:"CPA",cpa_percentage:"CPA&nbsp;%",cpa_both:"CPA&nbsp;+&nbsp;CPA&nbsp;%",cpc:"CPC",cpm:"CPM"}},percent_payout:{type:"currency"},preview_url:{type:"url"},protocol:{type:"string"},rating:{type:"integer"},redirect_offer_id:{type:"integer"},ref_id:{type:"string"},require_approval:{type:"boolean"},require_terms_and_conditions:{type:"boolean"},revenue_cap:{type:"currency"},revenue_type:{type:"string"},session_hours:{type:"integer"},session_impression_hours:{type:"integer"},set_session_on_impression:{type:"boolean"},show_custom_variables:{type:"boolean"},show_mail_list:{type:"boolean"},status:{type:"string"},subscription_duration:{type:"integer"},subscription_frequency:{type:"integer"},terms_and_conditions:{type:"string"},tiered_payout:{type:"boolean"},tiered_revenue:{type:"boolean"},use_target_rules:{type:"boolean"}},related_entities:{OfferCategory:{nicename:"Offer Category",groupable:!0,fields:{id:{type:"integer"},name:{type:"string",nicename:"Category"}}},Country:{groupable:!0,fields:{id:{type:"integer"},name:{type:"string",nicename:"Country"},code:{type:"string",nicename:"Country Code"}}},OfferUrl:{nicename:"Offer URL",idField:"offer_url_id",groupable:!0,fields:{id:{type:"integer"},name:{type:"string",nicename:"Offer URL"},preview_url:{type:"string"},offer_url:{type:"string"}}},Thumbnail:{nicename:"Thumbnail",groupable:!0,fields:{id:{type:"integer"},display:{type:"string"},thumbnail:{type:"string"},width:{type:"string"},height:{type:"string"}}},Stat:{idField:"offer_id",groupable:!1,fields:{offer_id:{type:"integer"},erpc:{type:"currency",nicename:"EPC",defaultValue:"0.00"}}}}}}});return g}];a.Models.offers=b}(this),function(a){var b=function(a,b,c,d){var e=b.get("offers"),f=-1*Math.round((new Date).getTimezoneOffset()/60);a.timezone=f>0?"+"+f:0!==f?f:"",a.updateTimezone=function(b){a.timezone=b},a.timezones=[];for(var g=-14;13>g;g++){var h=g>0?"+"+g:0!==g?g:"";a.timezones.push({label:"GMT"+h,value:h})}var i=function(){var b=(new Date).toISOString().replace("T"," ");b=b.substring(0,b.length-5);var c={page:a.table.paging.page,limit:a.table.paging.pageSize,sort:{update_time_utc:"asc"}};e.getScheduledOfferChanges(c).success(function(e){var f=[],g=d.getPreferenceValue("network_currency");_.each(e.data,function(a){a.ScheduledOfferChange.update_time_utc<b||(-1!==a.ScheduledOfferChange.update_field.indexOf("percent")?a.ScheduledOfferChange.update_value+="%":"payout"==a.ScheduledOfferChange.type&&_.isEmpty(a.Offer.currency)&&(a.Offer.currency=g),f.push(a))}),e.data=f,a.table.drawTable(e,c)})};c.onDirectivesReady(["scheduledOfferChangesTable"],function(){a.table=c.get("scheduledOfferChangesTable"),i(),a.table.$on("pagingChanged",function(){i()})})};b.$inject=["$scope","models","directiveRegistry","currentUser"],a.Application.controller("Controllers.scheduledOfferChanges",b)}(this),function(a){a.Application.controller("Controllers.tuneNetworkOffers",["$scope","models","$timeout","$location","directiveRegistry","digestService","$q",function(b,c,d,e,f,g,h){function i(){function a(a){b.table.drawTable?b.table.drawTable(a,c):b.table.addItems(a,c,!0)}b.incrementLoading();var c={offset:b.table.paging.offset,limit:b.table.paging.pageSize,search_term:b.search.keyword,advertiser_ids:b.selectedAdvertisers,sort_by:b.table.sort.field,sort_direction:b.table.sort.direction};q.getTuneNetworkOffers(c).success(function(c){c.data&&a(c),b.decrementLoading()})}function j(){f.onDirectivesReady(["tuneNetworkOffersMobile"],function(){l("tuneNetworkOffersMobile"),b.table.$on("moreItemsRequested",function(){b.generateTable(!0)})})}function k(){f.onDirectivesReady(["tuneNetworkOffersTable"],function(){l("tuneNetworkOffersTable"),b.table.$on("sortRequested",i),b.table.$on("pagingChanged",i)})}function l(a){b.table=f.get(a),b.table.sort={field:"network_name",direction:"desc"},i()}function m(){b.isMobile?j():k()}function n(){var c=e.search();c.search&&(b.search.keyword=c.search,b.isMobile||d(function(){a.angular.element("#basicKeywordSearch").focus()}))}function o(){b.advertisers=[],b.advertisersOptions.pageCount=0,b.advertisersOptions.stopCallingLoadMore=!1}function p(){b.advertisersOptions.loading=!0;var a={status:"active",limit:r,search_term:b.advertisersOptions.search,offset:r*b.advertisersOptions.pageCount};q.getAffiliateConnections(a).success(function(a){b.advertisersOptions.pageCount++,b.advertisersOptions.total=a.total_rows,Array.prototype.push.apply(b.advertisers,a.data),b.advertisersOptions.total===b.advertisers.length&&(b.advertisersOptions.stopCallingLoadMore=!0)})["finally"](function(){b.advertisersOptions.loading=!1})}var q=c.get("offers"),r=50;b.search={keyword:""},b.advertisers=[],b.selectedAdvertisers=[],b.advertisersOptions={total:0,search:"",pageCount:0,loading:!1,stopCallingLoadMore:!1},b.generateTable=function(a){a&&b.table.clearItems(a),i()},b.updateQueryParams=function(){b.table.paging.offset=0,b.table.paging.page=1,e.search("search",b.search.keyword)},b.updateTable=function(){b.updateQueryParams(),b.generateTable(!1)},b.handleChange=function(){o(),p()},b.handleToggle=function(a){var c=b.selectedAdvertisers.indexOf(a);c>-1?b.selectedAdvertisers.splice(c,1):b.selectedAdvertisers.push(a)},b.loadMore=function(){p()},b.cancelPanelFn=function(){b.selectedAdvertisers.length&&(b.selectedAdvertisers=[],i()),b.advertisersOptions.search.length&&(b.advertisersOptions.search="",o(),p())},b.applyPanelFn=function(){i()};var s={},t=function(a,b){if(s[a]){var c=s[a],d=document.getElementById("tracking-"+b);if(c.message)d.innerText=c.message,setTimeout(function(){d.innerText=""},1e3);else{const e=c.universal_tracking_link?c.universal_tracking_link:c.click_url;if(navigator.clipboard)navigator.clipboard.writeText(e),d.innerText="Copied!";else{var f=document.createElement("textarea");f.value=e,document.body.appendChild(f),f.select();try{document.execCommand("copy"),d.innerText="Copied!"}catch(g){console.error("Unable to copy text to clipboard (execCommand)",g)}finally{document.body.removeChild(f)}}setTimeout(function(){d.innerText=""},1e3)}}};b.trackingLink="",b.getTrackingLink=function(b){var c,d=h.defer(),e={offer_id:b,options:{}},f=g.md5(a.angular.toJson(e));if(s[f])t(f,b),d.reject();else{var i=document.getElementById("tracking-"+b);i.innerText="Getting Link...",c=q.generateTrackingLink(e),c.success(function(a){s[f]=a,d.resolve(!0)}),c.error(function(){i.innerText=["Your link did not successfully generate. ","Try again by clicking the attached refresh icon"].join(),setTimeout(function(){i.innerText=""},3e3)})}d.promise.then(function(){t(f,b)})},n(),m(),p()}])}(this),function(a){a.Application.controller("Controllers.privacyPolicy",["$scope","models",function(a,b){function c(a){return decodeURIComponent((a+"").replace(/%(?![\da-f]{2})/gi,function(){return"%25"}))}var d=b.get("privacyPolicy").getPrivacyPolicy();d.success(function(b){try{a.privacyPolicy=c(b).replace(/[+]/g," ")}catch(d){console.log("Privacy Policy Decode Error: ",d),a.privacyPolicy=b}}).error(function(){a.privacyPolicyError=!0})}])}(this),function(a){var b=["api","models",function(a,b){var c=b.getExtendable("base").extend({name:"privacyPolicy",init:function(){this._super()},getPrivacyPolicy:function(){return a.get("PrivacyPolicy/getPrivacyPolicy")}});return c}];a.Models.privacyPolicy=b}(this),function(a){a.Application.controller("Controllers.Widgets.adgroupPerformance",["$scope","$q","chartService","$rootScope","$timeout","models",function(b,c,d,e,f,g){var h,i,j,k="YYYY-MM-DD",l=moment().subtract(7,"days").format(k),m=moment().format(k),n=moment().subtract(14,"days").format(k),o=g.get("adGroups"),p={fields:["Stat.ad_campaign_id","Stat.conversions","Stat.clicks","Stat.payout"],groups:["Stat.ad_campaign_id"],data_start:l,data_end:m,sort:{"Stat.conversions":"desc"},limit:3},q={fields:["id","name","type","width","height"]};b.list=[],b.noDataAvailable=!1,b.adgroupPerformanceLoaded=!1,o.getAdGroupsPerformance(p).success(function(a){if(h=a,_.isUndefined(h.data)||0===_.size(h.data))return b.noDataAvailable=!0,void(b.adgroupPerformanceLoaded=!0);var d=_.chain(h.data).map(function(a){return a.Stat.ad_campaign_id}).unique().value();p.data_start=n,p.data_end=l,p.filter={"Stat.ad_campaign_id":{conditional:"EQUAL_TO",values:d}},p.fields=["Stat.ad_campaign_id","Stat.conversions"],q.filters={OR:_.map(d,function(a){return{"AdCampaign.id":{EQUAL_TO:a}}})},c.all([o.getAdGroupData(q),o.getAdGroupsPerformance(p)]).then(function(a){b.adgroupPerformanceLoaded=!0,j=a[0],i=a[1],r()})});var r=function(){var c=[];_.each(h.data,function(b){var g,h=$.extend(!0,{Stat:{id:0,conversions:0}},_.find(i.data.data,function(a){return a.Stat.ad_campaign_id===b.Stat.ad_campaign_id})||{}),k=$.extend({AdCampaign:{id:0,name:"",type:"",width:"",height:""}},_.find(j.data,function(a){return a.AdCampaign.id===b.Stat.ad_campaign_id})||{}),l="banner"===k.AdCampaign.type?"{0} [{1}x{2}]":"{0}",m="{0}%",n="positive";if(_.isUndefined(h.Stat)||0===Number(h.Stat.conversions))g="No Change",m="{0}",n="no-change";else{var o=b.Stat.conversions-h.Stat.conversions;g=(o/h.Stat.conversions*100).toFixed(2),h.Stat.conversions>b.Stat.conversions?n="negative":h.Stat.conversions===b.Stat.conversions&&(n="no-change")}c.push({id:b.Stat.ad_campaign_id,name:k.AdCampaign.name,type:l.format(a.Formatter.titleCaps(k.AdCampaign.type,!0),k.AdCampaign.width,k.AdCampaign.height),conversions:b.Stat.conversions||0,clicks:b.Stat.clicks||0,payouts:b.Stat.payout||0,direction:n,difference:m.format(g)});var q={type:"spark",color:"#444444",fillColor:"#e9e9e9",width:"140",height:"30"};"positive"===n&&(p.color="#2585c7",p.fillColor="#d9ecf5");var r=[199,455,25,92,42,109,438];f(function(){d.buildChart({data:r,params:q},e.$new(),"spark-adgroup-performance")})}),b.list=c}}])}(this),function(a){a.Application.controller("Controllers.dashboard",["$scope","currentUser",function(a,b){a.widgets={},a.showFeaturedOffersWidget=!0;var c=b.getPreferenceValue("affiliate_conversion_access")||"";a.showPendingConversions=-1!==c.indexOf("pending"),a.$on("visibilityOfFeaturedOffer",function(b,c){a.showFeaturedOffersWidget=c})}])}(this),function(a){a.Application.controller("Controllers.Widgets.featuredOffers",["$scope","$q","models",function(a,b,c){a.offersLoaded=!1,a.popoversInitialized=!1;var d={contain:{OfferCategory:{filter:{"OfferCategory.status":"active"},fields:["OfferCategory.status","OfferCategory.name"]}},fields:["id","name","OfferCategory.name","percent_payout","payout_type","default_payout","currency"]},e=c.get("offers");e.getFeaturedOffers(d,b).then(function(b){var c=e.getOfferTypes();a.featuredOffers=_.chain(b).toArray().map(function(a){var b=c[a.Offer.payout_type];return b&&(a.payout_type=b.title),_.size(a.OfferCategory)>0?(a.category=_(a.OfferCategory).pluck("name").slice(0,4),a.category.forEach(function(b,c){b.length>=24&&(a.category[c]=b.substring(0,21)+"...")})):a.category=["None"],a}).value(),a.offersLoaded=!0,a.$emit("visibilityOfFeaturedOffer",!!a.featuredOffers.length)}),a.handleNgShow=function(){return a.offersLoaded&&!a.popoversInitialized&&f(),a.offersLoaded};var f=function(){$("#featured-offers").find('[data-popover="add_to_parent"]').each(function(){var b=$(this),c=b.parent(),d=b.data("title");c.popover({trigger:"hover",html:!0,content:b.html(),title:d,placement:"top"}),a.popoversInitialized=!0})}}])}(this),function(a){a.Application.controller("Controllers.Widgets.pendingConversions",["$scope","api",function(a,b){a.pendingConversionsData={count:{total:0,items:[]},payout:{total:0,items:[]}},a.pendingConversionsLoaded=!1;var c=moment().endOf("day").format("YYYY-MM-DD HH:mm:ss"),d=moment().startOf("day").subtract(89,"days").format("YYYY-MM-DD HH:mm:ss"),e=0,f=[],g=0,h=[],i={fields:["Stat.count_pending","Stat.pending_payout"],groups:["Stat.date"],pageSize:90,filters:{},data_start:d,data_end:c};i.filters["Stat.datetime"]={conditional:"BETWEEN",values:[d,c]},b.get("Report/getConversions",i).success(function(b){_.each(b.data,function(a){_.each(i.fields,function(b){b=b.split(".").pop();var c,d=a.Stat[b];switch(b){case"count_pending":c=parseInt(d,10),e+=c,f.push(c);break;case"pending_payout":c=parseFloat(d),g+=c,h.push(c)}})}),a.pendingConversionsData.count.total=e,a.pendingConversionsData.count.items=f,a.pendingConversionsData.payout.total=g,a.pendingConversionsData.payout.items=h})["finally"](function(){a.pendingConversionsLoaded=!0})}])}(this),function(a){a.Application.directive("performanceChartWidget",["chartService","models","$timeout","$window","$translate","$rootScope",function(b,c,d,e,f,g){return{restrict:"E",templateUrl:"js/application/dashboard/partials/performanceChartWidget.html",transclude:!0,compile:function(){return function(h){h.chartId=_.uniqueId("performanceChartWidget_"),h.performanceChartLoaded=!1,h.chartInterval="Stat.date",h.processUserFilters=function(){return{}};var i={data_start:moment().subtract(6,"days").format("YYYY-MM-DD"),data_end:moment().format("YYYY-MM-DD"),fields:["Stat.conversions","Stat.clicks","Stat.payout","Stat.impressions","Stat.date"],timestamp:"Stat.date",groups:["Stat.date"],type:"line",lineStyles:["solid"]};h.chartCallback=function(){},h.getLineStyleByIndex=function(a){var b=["solid","solid","solid","solid"];return b[a]},h.model=c.get("statsReport"),h.getDefinition=function(){return h.model.getDefinition()};var j=function(c){if(_.isUndefined(c.data)||0===_.size(c.data)){h.performanceChartLoaded=!0;var j=g.hasFeatures("PREMIUM_PARTNER_INSTANCE")?"/tuneNetwork/offers":"/offers";return void a.angular.element("#"+h.chartId).html('<div class="no-data"><p class="no-data-available"><em>'+f("common.no_data")+'</em></p><p class="msg"></p><a href="#!'+j+'" class="btn"><span>'+f("offer.browse_offers")+"</span></div>")}h.currentReport={selectedMetrics:["Stat.payout","Stat.clicks"],selectedInterval:"Stat.date",selectedFilters:null,chartType:"line",rowCount:null},b.buildChart({data:c.data,params:i},h,"#"+h.chartId),h.performanceChartLoaded=!0,d(function(){$(e).trigger("resize")})};h.model.getReportData(i).success(function(a){j(a)})}}}}])}(this),function(a){a.Application.controller("Controllers.Widgets.quickStats",["$rootScope","$scope","$q","chartService","$timeout","models","$translate",function(b,c,d,e,f,g,h){var i,j,k,l=moment(),m=moment().startOf("day").subtract(1,"week"),n=moment().startOf("day").subtract(2,"weeks"),o=moment().startOf("year"),p=moment().subtract(1,"year").startOf("year"),q=moment().startOf("day").subtract(1,"year"),r={fields:["Stat.impressions","Stat.clicks","Stat.conversions","Stat.payout"],data_start:n.format("YYYY-MM-DD"),data_end:l.format("YYYY-MM-DD"),groups:["Stat.date"],sort:{"Stat.date":"asc"}},s={fields:["Stat.payout"],data_start:o.format("YYYY-MM-DD"),data_end:l.format("YYYY-MM-DD"),groups:["Stat.month"],sort:{"Stat.month":"asc"}},t={fields:["Stat.payout"],data_start:p.format("YYYY-MM-DD"),data_end:q.format("YYYY-MM-DD")},u=0,v=[],w=g.get("statsReport");c.quickStatsLoaded=!1,c.currentYear=l.format("YYYY");var x=w.getReportData(r).then(function(a){i=a}),y=w.getReportData(s).then(function(a){j=a}),z=w.getReportData(t).then(function(a){k=a}),A=function(){d.all([x,y,z]).then(function(){var b=[],d=[],e=function(a,b){return a+Number(b)};_.each(i.data.data,function(a){moment(a.Stat.date,"YYYY-MM-DD").diff(m)>0?b.push(a.Stat):d.push(a.Stat)}),_.each(j.data.data,function(a){var b=parseFloat(a.Stat.payout);u+=b,v.push(b)});var g=l.diff(m,"days"),n=l.diff(o,"months")+1,p=["impressions","clicks","payout","conversions","payoutytd"];_.each(p,function(a){if("payoutytd"==a){c[a]={count:u,lastCount:k.data.data.length>0?Number(k.data.data[0].Stat.payout):0,direction:"positive",data:[]};for(var f=0;n>=f;f++)c[a].data[f]=0;_.each(j.data.data,function(b){var d=parseInt(b.Stat.month,10);c[a].data[d]=parseFloat(b.Stat.payout)})}else{c[a]={count:_.chain(b).pluck(a).reduce(e,0).value(),lastCount:_.chain(d).pluck(a).reduce(e,0).value(),direction:"positive",data:[]};for(var i=0;g>=i;i++)c[a].data[i]=0;_.each(b,function(b){var d=moment(b.date,"YYYY-MM-DD").diff(m,"days");c[a].data[d]=parseFloat(b[a])})}if(_.isNull(c[a].lastCount)||0===c[a].lastCount)c[a].difference="",c[a].direction=h("common.stats.no_change");else{var l=c[a].count-c[a].lastCount;c[a].difference=(l/c[a].lastCount*100).toFixed(2)+"% "+h("common.stats.change"),c[a].lastCount>=c[a].count&&(c[a].direction=h(c[a].lastCount==c[a].count?"common.stats.no_change":"common.stats.negative"))}}),f(function(){a.angular.element(".quickstats p").textfill({maxFontPixels:28}),$(".with-tooltip").tooltip({placement:"right"})}),c.payoutytd.count=Number(c.payoutytd.count).toFixed(2),c.payout.count=Number(c.payout.count).toFixed(2),c.quickStatsLoaded=!0})};A()}])}(this),function(a){a.Application.controller("Controllers.Widgets.recentMessages",["$scope","models",function(b,c){b.messagesLoaded=!1,b.noMessages=!1;var d=c.get("messages");b.removeMessage=function(a,c){a.preventDefault(),d.dismissMessage({alert_id:c},b).success(function(){e()})};var e=function(){d.getMessages({limit:7}).then(function(a){b.messages=_.chain(a.data).map(function(a){return{title:a.Alert.title,id:a.Alert.id,datetime:a.Alert.datetime}}).value(),b.messagesLoaded=!0,b.noMessages=0===b.messages.length},a.angular.noop)};e()}])}(this),function(a){var b=function(a,b,c,d,e){var f=c.BrandPreferences;b.redirectToTunePay=function(){window.open(window.location.origin+"/users/tunepay_partner_login","_blank")},b.showWarningTax=!(!a.hasFeatures("TUNEPAY_DISPLAY_HINTS")||!a.hasFeatures("TUNEPAY_TAX_MANAGEMENT")&&!a.hasFeatures("TUNEPAY_FULL_SERVICE")||c.UserPreferences.tunepay_tax_info_submitted),b.showWarningPayment=!!a.hasFeatures("TUNEPAY_DISPLAY_HINTS")&&!!f.tunepay_enabled&&!c.UserPreferences.tunepay_payment_method_submitted,b.brandPrefs=f};b.$inject=["$rootScope","$scope","currentUser","localStorageService","$location"],a.Application.controller("Controllers.Widgets.tunePaySetup",b)}(this),function(a){var b=function(a,b,c,d,e){var f=c.BrandPreferences,g=d.get("dismissW9Warning");-1!=e.path().indexOf("/billing")&&(g=!1),b.showWarning=!g&&0!=f.require_w9&&0==c.Affiliate.w9_filed&&0!=f.enable_custom_tax_urls&&0!=!f.tunepay_enabled&&!a.hasFeatures("TUNEPAY_TAX_MANAGEMENT")&&!a.hasFeatures("TUNEPAY_FULL_SERVICE")&&(f.custom_w8_url||f.custom_w9_url),f.custom_w8_url&&0!==f.custom_w8_url.indexOf("http")&&(f.custom_w8_url="http://"+f.custom_w8_url),f.custom_w9_url&&0!==f.custom_w9_url.indexOf("http")&&(f.custom_w9_url="http://"+f.custom_w9_url),b.brandPrefs=f,b.dismissW9Warning=function(){d.add("dismissW9Warning",!0),b.showWarning=!1}};b.$inject=["$rootScope","$scope","currentUser","localStorageService","$location"],a.Application.controller("Controllers.Widgets.w9Warning",b)}(this),function(a){a.Application.controller("Controllers.mobileApp",["$scope","$location","$timeout","models","currentUser",function(a,b,c,d,e){e.checkPreference("enable_aff_moho",!0).then(Function.prototype,function(){b.path("/dashboard")});var f=e.hasFeatures("AFFMOHO");f.then(function(b){a.hasMobileApp=!0})}])}(this),function(a){a.Application.controller("Controllers.adGroupCreatives",["$scope","$q","models","directiveRegistry",function(a,b,c,d){var e=c.get("adGroups"),f=c.get("offers"),g=!1;a.paging=a.paging||{count:0,page:1,pageCount:1,pageSize:200},a.gridPageNumOptions=[10,20,50,200],a.gridSetPageSize=function(b){a.paging.pageSize=b,Math.floor(a.paging.count/b)<a.currentPage&&(a.paging.page=1),h()},a.gridPageNext=function(){a.paging.page>=a.paging.pageCount||(a.paging.page=Number(a.paging.page)+1,h())},a.gridPagePrev=function(){a.paging.page<=1||(a.paging.page=Number(a.paging.page)-1,h())},a.updatePageNum=function(){_.isNumber(parseInt(a.currentPage,10))&&a.currentPage<=a.paging.pageCount&&a.currentPage>0?(a.paging.page=a.currentPage,h()):a.currentPage=Number(a.paging.page)||1},a.$watch("paging.page",function(){a.currentPage=Number(a.paging.page)||1});var h=function(){a.$parent.$broadcast("pagingChanged",a.paging),a.currentPage=Number(a.paging.page)||1},i={};_.has(a.adgroupData,"id")&&e.getCreativeData({filters:{id:a.adgroupData.id}}).success(function(a){_(a).each(function(a){var b=a.AdCampaignCreative;i[b.offer_file_id]=b.status})}),a.addCreative=function(c,d,f,h){h.preventDefault(),g=!0,a.clearAlert("creativesResult");var i={ad_campaign_id:a.adgroupData.id,offer_file_id:c,offer_url_id:f||0,offer_id:d};c||delete i.offer_file_id,"link"==a.adgroupData.type?delete i.offer_file_id:delete i.offer_id;var j=e.addCreativeToAdgroup(i,b),k=angular.element(h.srcElement),l=k.parent();k.remove(),l.text("Adding..."),j.success(function(){a.addSuccess("creativesResult","Creative Added Successfully"),k.remove(),l.text("Added Creative")}),j.error(function(b){a.addError("creativesResult",b.errorMessage,b.errorDetails)})},a.onModalClose=function(){g&&a.$parent.updateTableData()},a.getStatus=function(a){var b=null;return _(i).each(function(c,d){a.id===d&&(b=c)}),b},a.setPaging=function(){a.OfferFiles&&(a.paging.page=a.OfferFiles.page,a.currentPage=a.OfferFiles.page,a.paging.count=a.OfferFiles.count,a.paging.pageCount=a.OfferFiles.pageCount)},a.typeFilter="all";var j=function(){a.incrementLoading();var b={page:a.paging.page,limit:a.paging.pageSize};f.getSimpleOfferAndOfferUrlList(b).success(function(b){a.OfferFiles=b})["finally"](function(){a.setPaging(),a.decrementLoading()})},k=function(){a.incrementLoading();var b={status:"active","Offer.status":"active"};"banner"==a.adgroupData.type?(b.width=a.adgroupData.width,b.height=a.adgroupData.height,"all"!==a.typeFilter?b.type=[a.typeFilter]:b.type=["image banner","flash banner","html ad"]):b.type=["text ad"];var c={sort:{id:"desc"},contain:["Offer"],filters:b,page:a.paging.page,limit:a.paging.pageSize};e.findCreatives(c).success(function(b){var c=[];_.each(b.data,function(a,d){b.data[d].OfferUrl=[],c.push(a.Offer.id)}),c=_.unique(c),f.getOfferUrlsForOffers(c).success(function(c){_.each(b.data,function(a,d){_.chain(c).where(function(b){return b.OfferUrl.offer_id==a.Offer.id}).each(function(a){b.data[d].OfferUrl.push(a.OfferUrl)})}),a.OfferFiles=b,a.setPaging()})})["finally"](function(){a.setPaging(),a.decrementLoading()})};a.generateTable=function(){_.has(a.adgroupData,"type")&&("link"==a.adgroupData.type?j():k())},d.onDirectivesReady([],function(){a.currentPage=Number(a.paging.page)||1,a.table.$on("pagingChanged",a.generateTable)}),a.$watch("typeFilter",function(b,c){b!==c&&a.generateTable()})}])}(this),function(a){a.Application.controller("Controllers.adGroupDetail",["$scope","$routeParams","$q","directiveRegistry","models","$window","$timeout","util",function(a,b,c,d,e,f,g,h){var i=e.get("adGroups");a.page={"interface":"creatives"},i.getHostnames().success(function(b){a.hostNameList=[],_.each(b,function(b){a.hostNameList.push({id:b.Hostname.id,label:b.Hostname.domain})})});var j=!1;a.toggleEditAdgroup=function(b){b&&b.preventDefault(),j=!j,j&&(a.adgroupDataForm={},_.each(a.adgroupData,function(b,c){a.adgroupDataForm[c]=b}))},a.editModeShow=function(a){return"display"==a?!j:j},a.isNotReadOnly=function(){return a.adgroupData&&a.getPreference("enable_affiliate_ad_server")?"affiliate"===a.adgroupData["interface"]:!1};var k={};a.toggleShow=function(a,b){k[b]=!k[b]},a.getShow=function(a){return k[a]||!1};var l={javascript:"JavaScript",iframe:"iFrame",url:"URL"};a.trackingDomain="",a.adTagReturn="",a.$watch("adgroupData",function(b){var c;b&&("banner"==a.adgroupData.type?(a.trackingFormat="javascript",c=_.pick(l,"javascript","iframe")):"link"==a.adgroupData.type?(a.trackingFormat="url",c=_.pick(l,"url")):"text"==a.adgroupData.type&&(a.trackingFormat="javascript",c=_.pick(l,"javascript")),a.trackingOptions=h.convertForOptions(c),a.generateAdTag())}),a.$watch(function(){return a.trackingFormat+a.trackingDomain},function(){a.generateAdTag()}),a.$watch("affiliateSource",function(b){b||a.generateAdTag()}),a.$watch("subId",function(b){b||a.generateAdTag()}),a.$watch("clickRedirect",function(b){b||a.generateAdTag()});var m=null;a.generateAdTag=function(){if(a.adgroupData){m&&m.reject&&m.reject();var b={id:a.adgroupData.id,format:a.trackingFormat,domain:a.trackingDomain,source:a.trackingSource,aff_sub:a.affSub1,aff_sub2:a.affSub2,aff_sub3:a.affSub3,aff_sub4:a.affSub4,aff_sub5:a.affSub5,aff_click_id:a.affClickId,aff_unique1:a.affUnique1,aff_unique2:a.affUnique2,aff_unique3:a.affUnique3,aff_unique4:a.affUnique4,aff_unique5:a.affUnique5};a.trackingRedirectEncode?b.eredirect=a.trackingRedirect:b.redirect=a.trackingRedirect,a.tagLoading=!0,m=i.getAdgroupCode(b),m.success(function(b){a.adTagReturn=b.CampaignCode,a.tagLoading=!1,m=null})}},a.toggleCreativeCheckAll=function(a){var b=angular.element(a.srcElement).prop("checked");$(".creative_checkbox").prop("checked",b)},a.selectedAction="";var n=function(){a.clearAlert("creativesStatusResult");var b=_.map($(".creative_checkbox:checked"),function(a){return $(a).data("id")});return 0===_.size(b)?!1:b};a.updateWeight=function(b,c){if(!b.saving&&b.custom_weight!=b.temp_weight){b.saving=!0;var d=i.updateCreativeWeight(b.id,b.temp_weight);d.success(function(a){b.temp_weight=b.custom_weight=a.AdCampaignCreative.custom_weight,b.saving=!1}),d.error(function(){a.flashError("There was a problem saving custom weight for "+c),b.saving=!1})}},a.modifySelected=function(){var b=this.selectedAction,d={pause:{status:"paused",message:"paused"},resume:{status:"active",
message:"resumed"},"delete":{status:"deleted",message:"deleted"}},e=n();e&&i.updateCreativesStatus(e,d[b].status,c).then(function(){a.addSuccess("creativesStatusResult","Creatives successfully {0}".format(d[b].message)),a.updateTableData()})},a.statusValues=[],d.onDirectivesReady(["creativesDatePicker","creativesTable"],function(){a.table=d.get("creativesTable"),a.datePicker=d.get("creativesDatePicker"),a.$watch("statusFilter",function(){a.updateTableData()}),a.table.$on("pagingChanged",function(){a.updateTableData()})});var o=function(){var b={};return b.contain=a.getDefaultContainParams(),b.filters=a.getDefaultFilter(),b.page=a.table.paging.page,b.limit=a.table.paging.pageSize,b};a.getDefaultSort=function(){return"Stat.conversions desc"},a.updateTableData=function(){var b=i.getCreativeData(o());b.error(function(){a.table.noData=!0}),b.success(function(b){p(b,o()),a.table.drawTable(b,o())})};var p=function(b,c){var d,e;e=c.fields,d={},_.each(e,function(a){var b=a.split(".");"Stat"==b[0]&&(d[b[1]]=0)}),a.statusValues=[],_.each(b.data,function(b){b.Stat||(b.Stat=d),b.AdCampaignCreative.temp_weight=b.AdCampaignCreative.custom_weight,a.statusValues.push(b.status)}),a.statusValues=_.uniq(a.statusValues)};a.getDefaultFilter=function(){var c={id:b.id};return"all"!==a.statusFilter&&(c.status=[a.statusFilter]),c},a.getStartDate=function(){return a.datePicker.getStartDate()},a.getEndDate=function(){return a.datePicker.getEndDate()},a.getDefaultContainParams=function(){return{0:"Offer",1:"OfferFile",2:"OfferUrl",Stat:{fields:["Stat.impressions","Stat.clicks","Stat.ctr","Stat.conversions","Stat.cpc","Stat.payout"],filters:{"Stat.date":{conditional:"BETWEEN",values:[a.datePicker.getStartDate(),a.datePicker.getEndDate()]}}}}},a.statusFilter="active",a.updateTaskbarOffset=function(){var b=$(".taskbar-positioner:first");_.isObject(b.offset())&&(a.taskbarOffset=b.offset().top-40)},a.updateTaskbarOffset(),g(a.updateTaskbarOffset,1500),$(f).on("resize",_.debounce(function(){g(a.updateTaskbarOffset)},500))}])}(this),function(a){a.Application.controller("Controllers.adGroupForm",["$scope","$routeParams","$location","$translate","models","directiveRegistry",function(b,c,d,e,f,g){var h=f.get("adGroups"),i=!1;b.define=h.getAdgroupDefinition(),g.onDirectivesReady(["adgroupCreateModal"],function(){b.modal=g.get("adgroupCreateModal")}),c&&c.id>0?(b.saveButtonText=e("adGroups.buttons.updateAdGroup"),h.getAdGroupData(c).success(function(a){b.adgroupData=k(a.AdCampaign),b.$parent.adgroupData=b.adgroupData,b.$parent.define=b.define,b.$parent.displaySize=b.displaySize,i=!0})):(b.saveButtonText=e("adGroups.buttons.createAdGroup"),b.adgroupDataForm={status:"active",serve_type:"random",optimization_field:"cr",type:"text"}),b.showOptimizationField=function(a){var c="display"==a?b.adgroupData||{}:b.adgroupDataForm||{};return c.optimization?1===Number(c.optimization):!1},b.showCancelButton=function(){return i},b.displaySize=function(a){var c="display"==a?b.adgroupData||{}:b.adgroupDataForm||{};return c.type&&"banner"==c.type?!0:!1},b.saveAdGroup=function(a){a&&a.preventDefault(),b.clearAlert("adgroupSaveResult"),h.saveAdGroup(j()).success(function(a){a.errors&&_.size(a.errors)>0?b.addError("adgroupSaveResult",_.first(a.errors).publicMessage,_.pluck(a.errors,"err_msg")):(b.adgroupData=b.$parent.adgroupData=k(a.AdCampaign),b.adgroupDataForm.id?(b.toggleEditAdgroup(),b.addSuccess("adgroupSaveResult","Ad Group Saved Successfully")):(b.queueMessage("addSuccess",["adgroupSaveResult","Ad Group Saved Successfully"]),b.modal.dismiss(),d.path("/tools/adgroups/{0}".format(b.adgroupData.id))))})},b.isBannerBad=function(){if(!b.adgroupDataForm)return!1;var a=b.adgroupDataForm.height||"",c=b.adgroupDataForm.width||"";return!(a&&c)},b.getFormState=function(){var a=b.adgroupDataForm,c={ok:!0};return a?($.trim(a.name)||(c.ok=!1,c.name=!0),"banner"==a.type&&b.isBannerBad()&&(c.ok=!1),c):(c.ok=!1,c)};var j=function(){var c=a.angular.copy(b.adgroupDataForm);switch(c.serve_type){case"optimize":c.optimization=1,c.custom_weights=0;break;case"custom_weights":c.optimization=0,c.custom_weights=1;break;case"random":c.optimization=0,c.custom_weights=0}return delete c.serve_type,c},k=function(a){return 1==Number(a.optimization)?a.serve_type="optimize":1==Number(a.custom_weights)?(a.serve_type="custom_weights",a.optimization_field="cr"):(a.serve_type="random",a.optimization_field="cr"),"banner"==a.type&&(a.width=Number(a.width),a.height=Number(a.height)),a}}])}(this),function(a){a.Application.controller("Controllers.adGroups",["$scope","$q","directiveRegistry","models",function(a,b,c,d){a.canManage=function(){return a.getPreference("enable_affiliate_ad_server")},a.getDefaultSort=function(){return"Stat.conversions desc"};var e=d.get("adGroups");a.mutateGridData=function(a,b){var c={},d=b.fields;_.each(d,function(a){a=a.split("."),"Stat"==a[0]&&(c[a[1]]=0)});var e=[];_.each(a.data,function(a){a.Stat||(a.Stat=c),e.push(a)}),a.data=e},a.getDefaultFilter=function(){var b={};a.statusFilter&&(b.status=[a.statusFilter]);var c=$.trim(a.nameFilter);return c&&(b.OR={name:{LIKE:"%"+c+"%"},id:{LIKE:"%"+c+"%"}}),b},a.getStartDate=function(){return a.datePicker.getStartDate()},a.getEndDate=function(){return a.datePicker.getEndDate()},a.getDefaultContainParams=function(){return{0:"Stat"}},c.onDirectivesReady(["adgroupsDatePicker"],function(){a.datePicker=c.get("adgroupsDatePicker")}),a.isMobile?c.onDirectivesReady(["adgroupsMobile"],function(){a.table=c.get("adgroupsMobile"),a.table.$on("moreItemsRequested",a.updateTableData);var b=_.after(2,a.clearAndRefresh);a.$watch("statusFilter",b),a.clearAndRefresh()}):c.onDirectivesReady(["adgroupsTable"],function(){a.table=c.get("adgroupsTable"),a.table.clearItems=angular.noop,a.$watch("statusFilter",_.after(1,a.clearAndRefresh)),a.table.$on("pagingChanged",a.updateTableData),a.table.$on("tableRenderComplete",function(){$("#adgroup-check-all").unbind("click"),$("#adgroup-check-all").click(function(a){a.stopPropagation(),$(this).prop("checked")?$(".adgroup_checkbox").prop("checked",!0):$(".adgroup_checkbox").prop("checked",!1)})})}),a.statusFilter="active";var f=function(){var b={};return b.fields=["check","id","name","type","size","status","width","height","interface","Stat.impressions","Stat.clicks","Stat.ctr","Stat.conversions","Stat.cpc","Stat.payout"],b.contain=a.getDefaultContainParams(),b.filters=a.getDefaultFilter(),b.data_start=a.getStartDate(),b.data_end=a.getEndDate(),b.page=a.table.paging.page,b.limit=a.table.paging.pageSize,b};a.updateTableData=function(){var b=e.getAdGroupData(f());return a.incrementLoading(),b.success(function(b){a.mutateGridData(b,f()),a.table.drawTable?a.table.drawTable(b):a.table.addItems(b),a.decrementLoading()}).error(function(b){a.flashError(b.errorMessage),a.decrementLoading()}),b},a.updateCheckedGroups=function(){var c=[],d={pause:{status:"paused",message:"paused"},active:{status:"active",message:"made active"},"delete":{status:"deleted",message:"made inactive"}},f=$(".adgroup_checkbox:checked");_.each(f,function(b){c.push(e.saveAdGroup({id:$(b).data("id"),status:d[a.selectedAction].status}))}),b.all(c).then(function(){f.length&&(a.addSuccess("adgroupSaveResult","Ad Group{0} successfully {1}.".format(c.length>1?"s":"",d[a.selectedAction].message)),a.updateTableData()),a.selectedAction=""})},a.clearAndRefresh=function(){a.table.clearItems(),a.updateTableData()}}])}(this),function(a){var b=["api","models",function(b,c){var d=c.getExtendable("base").extend({getAdGroupsPerformance:function(a){return a=this.addDateFilter(a),b.get("Report/getStats",a)},getAdGroupData:function(a,c,d){return a=this.addDateFilter(a),a=this.convertContains(a),a.id?b.get("AdManager/findCampaignById",a,c,d):b.get("AdManager/findAllCampaigns",a,c,d)},getCreativeData:function(a){return a.id=a.filters.id,delete a.filters.id,b.get("AdManager/getCampaignCreatives",a)},findCreatives:function(a){return b.get("OfferFile/findAll",a)},saveAdGroup:function(c){var d={data:a.angular.copy(c)};return c.id?(d.id=c.id,_.each(["id","modified"],function(a){delete d.data[a]}),b.get("AdManager/updateCampaign",d)):(d.data["interface"]="affiliate",d.data.account_id=a.Config.affiliate_id,b.get("AdManager/createCampaign",d))},addCreativeToAdgroup:function(c,d){var e={filters:a.angular.copy(c)},f=d.defer();return b.get("AdManager/findAllCreatives",e).success(function(d){if(_.size(d)>0&&_.isObject(_.first(_.values(d)).AdCampaignCreative)){var e={id:_.first(_.values(d)).AdCampaignCreative.id,field:"status",value:"active"};b.get("AdManager/updateCreativeField",e).then(function(a){f.resolve(a)},function(a){f.reject(a)})}else{var g={campaign_id:c.ad_campaign_id,data:a.angular.copy(c)};delete g.data.ad_campaign_id,b.get("AdManager/addCreative",g).then(function(a){f.resolve(a)},function(a){f.reject(a)})}}),f.promise},updateCreativeWeight:function(a,c){var d={id:a,field:"custom_weight",value:c};return b.get("AdManager/updateCreativeField",d)},updateCreativesStatus:function(a,c,d){var e=d.defer(),f=[],g={field:"status",value:c};return _.each(a,function(a){g.id=a,f.push(b.get("AdManager/updateCreativeField",g))}),d.all(f).then(function(){e.resolve(arguments)}),e.promise},getHostnames:function(){return b.get("Application/findAllHostnames",{fields:["id","domain"]})},getAdgroupCode:function(c){var d={affiliate_id:a.Config.affiliate_id,campaign_id:c.id,options:{},params:{}},e={format:"format",eredirect:"eredirect",redirect:"redirect"},f={domain:"hostNameId",aff_sub:"aff_sub",aff_sub2:"aff_sub2",aff_sub3:"aff_sub3",aff_sub4:"aff_sub4",aff_sub5:"aff_sub5",source:"source",aff_click_id:"aff_click_id",aff_unique1:"aff_unique1",aff_unique2:"aff_unique2",aff_unique3:"aff_unique3",aff_unique4:"aff_unique4",aff_unique5:"aff_unique5"};return _.each(e,function(a,b){c[b]&&""!==c[b]&&(d.options[a]=c[b])}),_.each(f,function(a,b){c[b]&&""!==c[b]&&(d.params[a]=c[b])}),b.get("AdManager/getCampaignCode",d)},getAdgroupDefinition:function(){return{entity:"AdCampaign",fields:{id:this.getStandardDef("id"),name:{type:"string"},type:{type:"enum",values:{banner:"Banner",text:"Text",link:"Link"}},height:{type:"integer"},width:{type:"integer"},"interface":{type:"enum",values:{affiliate:"Affiliate",network:"Network"}},account_id:{type:"integer"},status:this.getStandardDef("status"),custom_weights:this.getStandardDef("bool_enabled"),affiliate_access:this.getStandardDef("bool_yes"),optimization:this.getStandardDef("bool_enabled"),optimization_field:{type:"enum",values:{ctr:"Click through Rate (CTR)",cr:"Conversion Rate (CR)",rpm:"Revenue per Thousand Impressions (RPM)",rpc:"Revenue per Click (RPC)",profit:"Profit"}},modified:{type:"timestamp"}},related_entities:{Stat:{fields:{impressions:{type:"integer"},clicks:{type:"integer"},ctr:{type:"float",nicename:"CTR"},conversions:{type:"integer"},cpc:{type:"string",nicename:"CPC"},payout:{type:"string"}}}},custom_fields:{serve_type:{random:"Randomly",custom_weights:"By Custom Weights",optimize:"By Optimization"}}}},getAdgroupCreativeDefinition:function(){return{entity:"AdCampaignCreative",fields:{id:this.getStandardDef("id"),ad_campaign_id:{type:"integer"},offer_file_id:{type:"integer"},offer_id:{type:"integer"},offer_creative_url_id:{type:"integer"},status:this.getStandardDef("status"),weight:{type:"integer"},custom_weight:{type:"integer"},modified:this.getStandardDef("modified")},related_entities:{OfferFile:this.getOfferFileDefinition(),Offer:this.getOfferDefinition(),OfferUrl:this.getOfferUrlDefinition(),Stat:{fields:{impressions:{type:"integer"},clicks:{type:"integer"},ctr:{type:"float",nicename:"CTR"},conversions:{type:"integer"},cpc:{type:"string",nicename:"CPC"},payout:{type:"string"}}}}}},getOfferFileDefinition:function(){var b={entity:"OfferFile",nicename:"Offer File",nameField:"display",groupable:!0,fields:{id:this.getStandardDef("id"),offer_id:{type:"integer"},display:{type:"string"},filename:{type:"string"},thumbnail:{type:"string"},size:{type:"string"},status:this.getStandardDef("status"),type:{type:"string"},width:{type:"integer"},height:{type:"integer"},code:{type:"string"},flash_vars:{type:"string"},creator_interface:{type:"string"},creator_account_id:{type:"integer"},is_private:this.getStandardDef("bool_yes"),created:this.getStandardDef("created"),modified:this.getStandardDef("modified")},related_entities:{Offer:this.getOfferDefinition(),OfferUrl:this.getOfferUrlDefinition()}};return a.angular.copy(b)},getOfferDefinition:function(){var b={groupable:!0,fields:{id:this.getStandardDef("id"),name:{type:"string"}}};return a.angular.copy(b)},getOfferUrlDefinition:function(){var b={groupable:!0,fields:{id:this.getStandardDef("id"),name:{type:"string"}}};return a.angular.copy(b)}});return d}];a.Models.adGroups=b}(this),function(a){a.Application.controller("Controllers.adGroupsOfferModal",["$scope","$q","models","currentUser","directiveRegistry",function(b,c,d,e,f){var g=d.get("adGroups");f.onDirectivesReady(["addAdGroupTable"],function(){b.table=f.get("addAdGroupTable"),h(),b.table.$on("pagingChanged",function(){h()})});var h=function(){var a={sort:{name:"desc"},fields:["id","name","type","size","status","add","width","height","offer_id"],filters:{status:["active"],"interface":"affiliate",account_id:e.Affiliate.id},page:b.table.paging.page,limit:b.table.paging.pageSize};b.offerFile&&"image banner"==b.offerFile.type&&(a.filters.width=b.offerFile.width,a.filters.height=b.offerFile.height,a.filters.type="banner");var c=d.get("offerDetail");g.getAdGroupData(a,c.apiKey,c.upstreamNetworkId).success(function(c){b.table.drawTable(c,a)})};b.$on("updateTable",h),b.addCreative=function(d,e,f){b.clearAlert("adgroupAddResult");var h=a.angular.element(d.currentTarget),i={ad_campaign_id:e,offer_file_id:b.offerFile.id,offer_id:b.offerData.Offer.id,offer_url_id:0};"link"==f?delete i.offer_file_id:delete i.offer_id,g.addCreativeToAdgroup(i,c).then(function(){b.addSuccess("adgroupAddResult","Creative Added Successfully");var a=h.parent();h.remove(),a.append("<div>Added Default</div>")},function(a){b.addError("adgroupAddResult",a.errorMessage,a.errorDetails)})}}])}(this),function(a){a.Application.controller("Controllers.customPage",["$scope","$routeParams","models","currentUser","$rootScope","nonceService",function(a,b,c,d,e,f){a.page_id=b.id,a.not_found=!1,a.page={};var g=c.get("customPage").getPage(a.page_id);g.success(function(b){return _(b).hasMembers(0,"CustomPage")?(a.page=b[0].CustomPage,a.page.html=decodeURIComponent(a.page.html.replace(/\+/g," ")),a.page.html='<script src="js/vendor/jquery-1.8.3.min.js"></script><h1>'+a.page.title+"</h1>"+a.page.html,e.updatePageTitle(a.page.title),a.page.html=a.page.html.replace(/<affiliate_id>/g,d.Affiliate.id||""),a.page.html=a.page.html.replace(/<firstname>/g,d.AffiliateUser.first_name||""),a.page.html=a.page.html.replace(/<lastname>/g,d.AffiliateUser.last_name||""),a.page.html=a.page.html.replace(/<email>/g,d.AffiliateUser.email||""),a.page.html=a.page.html.replace(/<company>/g,d.Affiliate.company||""),a.page.html=a.page.html.replace(/<affiliate_ref>/g,d.Affiliate.ref_id||""),void(e.hasFeatures("NONCE")&&f.generateNonce().then(function(b){a.page.html=a.page.html.replace(/<nonce>/g,b.data||"")},function(a){console.log("Error generating Nonce")}))):void(a.not_found=!0)}),g.error(function(){a.not_found=!0})}])}(this),function(a){var b=["api","models",function(a,b){var c=b.getExtendable("base").extend({name:"customPage",init:function(){this._super()},getPages:function(){return a.get("CustomMenuLink/findActive")},getPage:function(b){return a.get("CustomPage/findById",{id:b})}});return c}];a.Models.customPage=b}(this),function(a){var b=function(b,c,d,e,f){var g=c.get("apiKey");e.checkPreference("enable_affiliate_api","disabled").then(function(){d.path("/dashboard")});var h=function(c,d){d=d||function(){},b.incrementLoading(),c.success(function(c){c?(b.apiKey=c.api_key,b.keyStatus=c.status):b.apiKey=b.keyStatus=null,b.networkId=a.Config.api_network_id,b.decrementLoading(),d()}).error(function(a){b.flashError(a.errorMessage),b.decrementLoading(),d()})},i=g.getApiKey();b.pageLoaded=!1,h(i,function(){b.pageLoaded=!0}),b.generateApiKey=function(){var a=g.generateApiKey();h(a)},b.regenerateApiKey=function(){b.confirmationModal.dismiss();var a=g.regenerateApiKey(b.apiKey);h(a)},f.onDirectivesReady(["confirmationModal"],function(){b.confirmationModal=f.get("confirmationModal")})};b.$inject=["$scope","models","$location","currentUser","directiveRegistry"],a.Application.controller("Controllers.apiKey",b)}(this),function(a){var b=["api","models",function(a,b){var c=b.getExtendable("base").extend({name:"ApiKey",init:function(){this._super()},getApiKey:function(){return a.get("ApiKey/getUserApiKey")},generateApiKey:function(){return a.get("ApiKey/generateApiKey")},regenerateApiKey:function(b){return a.get("ApiKey/regenerateApiKey",{existing_api_key:b})}});return c}];a.Models.apiKey=b}(this),function(a){a.Application.controller("Controllers.terms",["$scope","models",function(a,b){var c=b.get("terms").getTerms();a.incrementLoading(),c.success(function(b){a.terms=b,a.decrementLoading()}),c.error(function(){a.termsError=!0,a.decrementLoading()})}])}(this),function(a){var b=["api","models",function(a,b){var c=b.getExtendable("base").extend({name:"terms",init:function(){this._super()},getTerms:function(){return a.get("BrandDesign/getTermsAndConditions")}});return c}];a.Models.terms=b}(this),function(a){a.Application.controller("Controllers.advertiserDetailModal",["$scope","api",function(a,b){a.advertiser={id:a.$parent.id,display_name:a.$parent.display_name,logo:a.$parent.logo,status:a.$parent.status,website:a.$parent.website,brand_id:a.$parent.brand_id,categories:a.$parent.categories,commission:a.$parent.commission,created_by:a.$parent.created_by,created_on:a.$parent.created_on,network_id:a.$parent.network_id,description:a.$parent.description,modified_on:a.$parent.modified_on,modified_by:a.$parent.modified_by,network_name:a.$parent.network_name,contact_email:a.$parent.contact_email,AffiliateConnection:a.$parent.AffiliateConnection,notification_emails:a.$parent.notification_emails},a.isConnRequestLoading=!1,a.sendConnectionRequest=function(c){a.isConnRequestLoading=!0,b.get("ZenithConnect/requestConnection",{advertiser_brand_id:a.advertiser.brand_id}).success(function(b){a.AffiliateConnection.id=b.id,a.AffiliateConnection.status=b.status})["finally"](function(){a.isConnRequestLoading=!1})},a.cancelConnectionRequest=function(c){a.isConnRequestLoading=!0,b.get("ZenithConnect/cancelConnectionRequest",{connection_id:a.AffiliateConnection.id}).success(function(b){a.AffiliateConnection.status=b.status})["finally"](function(){a.isConnRequestLoading=!1})}}])}(this),function(a){a.Application.controller("Controllers.brandReport",["$scope","api","directiveRegistry","currentUser",function(a,b,c,d){function e(){a.incrementLoading();var c={fields:k,filters:{"Stat.date":{conditional:"BETWEEN",values:[a.datePicker.getStartDate(),a.datePicker.getEndDate()]}},hour_offset:a.datePicker.getTimezoneOffset(),data_start:a.getStartDate(),data_end:a.getEndDate()};a.hidePagination=!0,a.isLoading=!0,a.NoStatsRecord=!0;var e=[];_.each(d.ConnectAdvertisers,function(d,g){e.push({networkName:d.network_name,isLoading:!0}),f(e,c),b.get("Report/getStats",c,d.api_key,g).success(function(b){b.data&&0===b.data.length?a.NoStatsRecord=!1:(a.isLoading=!1,_.each(b.data,function(a){a.Stat.networkName=d.network_name,e=e.map(function(b){if(d.network_name==b.networkName){for(var c in a.Stat)"networkName"!==c&&(a.Stat[c]=parseFloat(a.Stat[c]));return a.Stat}return b})}),f(e,c))})["finally"](function(){a.decrementLoading()})})}function f(b,c){a.table.drawTable?a.table.drawTable(b,c):a.table.addItems(b,c,!0)}function g(){c.onDirectivesReady(["networkBrandReportTable"],function(){i("networkBrandReportTable")})}function h(){c.onDirectivesReady(["networkBrandReportTableMobile"],function(){i("networkBrandReportTableMobile")})}function i(b){a.table=c.get(b),e()}function j(){a.isMobile?h():g()}var k=["Stat.impressions","Stat.conversions","Stat.clicks","Stat.payout","Stat.ctr","Stat.ltr","Stat.erpc"];a.datepickerRangeOptions={today:!1,yesterday:!0,lastThreeDays:!0,lastWeek:!0,lastFourteenDays:!0,thisMonth:!1,lastMonth:!1,lastThirtyDays:!0,lastSixtyDays:!0,lastSixMonths:!1,thisYear:!1,lastYear:!1,allTime:!1},a.togglePanelFn=function(b,c,d){switch(d){case"default":c||"datepicker"!==b?a.datePicker.cancel():a.datePicker.show()}},a.getStartDate=function(){return a.datePicker?a.datePicker.getStartDate():void 0},a.getEndDate=function(){return a.datePicker?a.datePicker.getEndDate():void 0},a.dateChange=function(){e()},a.generateTable=function(b){b&&a.table.clearItems(b),e()},c.onDirectivesReady(["panelStates","brandDatePicker"],function(){j()})}])}(this),function(a){a.Application.controller("Controllers.tune_network_connection_request",["$scope","api","directiveRegistry",function(a,b,c){function d(c){c&&a.incrementLoading();var d={offset:a.table.paging.offset,limit:a.table.paging.pageSize,sort_by:a.table.sort.field,sort_direction:a.table.sort.direction,initiated_by:"advertiser"};b.get("ZenithConnect/getAffiliateConnections",d).success(function(b){a.connections=b.data,a.table.drawTable?a.table.drawTable(b,d):a.table.addItems(b,d,!0)})["finally"](function(){c&&a.decrementLoading()})}function e(){c.onDirectivesReady(["tuneNetworkConnectionRequestDesktop"],function(){f("tuneNetworkConnectionRequestDesktop"),a.table.$on("sortRequested",function(){d(!0)})})}function f(b){a.table=c.get(b),a.table.sort={field:"display_name",direction:"asc"},g()}function g(){a.incrementLoading(),Promise.all([d()]).then(function(){a.decrementLoading()})}a.connections=[],e(),a.acceptConnectionRequest=function(c){a.incrementLoading(),b.get("ZenithConnect/acceptConnectionRequest",{connection_id:c}).success(function(b){return null!=b.errorMessage?void a.addError("requestStatusUpdate","","An Error Occurred Please Try Again"):void d(!0)}).error(function(){a.addError("requestStatusUpdate","","An Error Occurred Please Try Again")})["finally"](function(){a.decrementLoading()})},a.rejectConnectionRequest=function(c){a.incrementLoading(),b.get("ZenithConnect/cancelConnectionRequest",{connection_id:c}).success(function(b){return null!=b.errorMessage?void a.addError("requestStatusUpdate","","An Error Occurred Please Try Again"):void d(!0)}).error(function(){a.addError("requestStatusUpdate","","An Error Occurred Please Try Again")})["finally"](function(){a.decrementLoading()})},a.terminateConnectionRequest=function(c){a.incrementLoading(),b.get("ZenithConnect/terminateConnectionRequest",{connection_id:c}).success(function(b){return null!=b.errorMessage?void a.addError("requestStatusUpdate","","An Error Occurred Please Try Again"):void d(!0)}).error(function(){a.addError("requestStatusUpdate","","An Error Occurred Please Try Again")})["finally"](function(){a.decrementLoading()})}}])}(this),function(a){a.Application.controller("Controllers.tune_network",["$scope","api","directiveRegistry",function(a,b,c){function d(){a.categoriesOptions.loading=!0,b.get("ZenithConnect/getCategories",{active:!0,types:["industry"],limit:i,offset:i*a.categoriesOptions.pageCount}).success(function(b){a.categoriesOptions.pageCount++,a.categoriesOptions.total=b.total_rows,Array.prototype.push.apply(a.categories,b.data),a.categoriesOptions.total===a.categories.length&&(a.categoriesOptions.stopCallingLoadMore=!0)})["finally"](function(){a.categoriesOptions.loading=!1})}function e(c){c&&a.incrementLoading();var d={offset:a.table.paging.offset,limit:a.table.paging.pageSize,sort_by:a.table.sort.field,sort_direction:a.table.sort.direction};a.selectedCategories.length&&(d["categories[]"]=a.selectedCategories),a.search.length&&(d.search_term=a.search),b.get("ZenithConnect/getAdvertisers",d).success(function(b){a.advertisers=_.map(b.data,function(a){return null===a.AffiliateConnection?Object.assign(a,{AffiliateConnection:{id:-1,status:null}}):a}),a.table.drawTable?a.table.drawTable(b,d):a.table.addItems(b,d,!0)})["finally"](function(){c&&a.decrementLoading()})}function f(){c.onDirectivesReady(["tuneNetworkAdvertiserDesktop"],function(){g("tuneNetworkAdvertiserDesktop"),a.table.$on("sortRequested",function(){e(!0)})})}function g(b){a.table=c.get(b),a.table.sort={field:"network_name",direction:"asc"},h()}function h(){a.incrementLoading(),Promise.all([d(),e()]).then(function(){a.decrementLoading()})}var i=50;a.search="",a.categories=[],a.advertisers=[],a.selectedCategories=[],a.categoriesOptions={total:0,pageCount:0,loading:!1,stopCallingLoadMore:!1},a.isCategoriesVisible=!1,a.handleChange=function(a){"search-advertisers"===a&&e(!0)},a.handleToggle=function(b){var c=a.selectedCategories.indexOf(b);c>-1?a.selectedCategories.splice(c,1):a.selectedCategories.push(b),e(!0)},a.loadMore=function(){d()},f(),a.sendConnectionRequest=function(c){a.incrementLoading(),b.get("ZenithConnect/requestConnection",{advertiser_brand_id:c}).success(function(a){e(!0)})["finally"](function(){a.decrementLoading()})},a.cancelConnectionRequest=function(c){a.incrementLoading(),b.get("ZenithConnect/cancelConnectionRequest",{connection_id:c}).success(function(a){e(!0)})["finally"](function(){a.decrementLoading()})},a.toggleCategories=function(){a.isCategoriesVisible=!a.isCategoriesVisible},a.hideCategories=function(){a.isCategoriesVisible=!1}}])}(this),function(a){a.Application.controller("Controllers.tune_network_profile",["$scope","api","currentUser",function(b,c,d){function e(){return a.Config.connect_affiliate_id?c.get("ZenithConnect/getAffiliate",{id:a.Config.connect_affiliate_id}).then(function(a){b.affiliate=a.data.data,g()},function(a){b.addError("submitNetworkProfileMessage","","Error fetching profile record.")}):void 0}function f(){return c.get("ZenithConnect/getCategories",{active:!0,types:a.Config.Enums.categoryTypes,limit:100}).then(function(a){var c=a.data.data.reduce(function(a,b){var c=b.type;return b.active&&(a[c]||(a[c]=[]),a[c].push(b)),a},{});b.categories=c},function(a){b.addError("submitNetworkProfileMessage","","Error fetching categories.")})}function g(){b.affiliate.region={},b.affiliate.payout_model={},b.affiliate.industry={},b.affiliate.publisher_type={},b.affiliate.categories.forEach(function(a){b.affiliate[a.type]&&(b.affiliate[a.type][a.category_name]=!0)}),b.affiliate.hidden=!b.affiliate.visible_in_directory}function h(a){c.postFile("ZenithConnect/putAffiliateLogo",b.logoFile).success(function(c){b.affiliate=c.data,g(),b.addSuccess("submitNetworkProfileMessage","",a)}).error(function(){b.addError("submitNetworkProfileMessage","","Error uploading logo.")})}function i(){b.incrementLoading(),Promise.all([f(),e()]).then(function(){b.decrementLoading(),b.$apply()})["catch"](function(a){b.decrementLoading(),b.$apply()})}function j(){var a=[];return b.tuneNetworkProfileForm.display_name.$error.required&&a.push("Display name required"),b.tuneNetworkProfileForm.description.$error.required&&a.push("Description required"),b.tuneNetworkProfileForm.website.$error.required&&a.push("Website required"),b.affiliate.logo||b.logoFile||a.push("Logo required"),b.isChecked(b.affiliate.region)||a.push("Please select at least one region of operation"),b.isChecked(b.affiliate.payout_model)||a.push("Please select at least one payout model"),b.isChecked(b.affiliate.industry)||a.push("Please select at least one industry"),b.isChecked(b.affiliate.publisher_type)||a.push("Please select at least one publisher type"),b.tuneNetworkProfileForm.contact_email.$error.required&&a.push("Contact Email required"),b.tuneNetworkProfileForm.contact_email.$error.email&&a.push("Contact Email improperly formatted"),b.tuneNetworkProfileForm.notification_emails.$error.required&&a.push("At least one notification email required"),b.tuneNetworkProfileForm.notification_emails.$error.email&&a.push("Notification email(s) improperly formatted"),a.length?(b.addError("submitNetworkProfileMessage","",a),!1):b.tuneNetworkProfileForm.$valid?!0:!1}function k(a,e){c.get("ZenithConnect/postAffiliate",{display_name:b.affiliate.display_name,website:b.affiliate.website,description:b.affiliate.description,contact_email:b.affiliate.contact_email,contact_name:b.affiliate.contact_name,notification_emails:e,categories:a,brand_id:d.Brand.brand_id,visible_in_directory:!b.affiliate.hidden,status:"active",created_by:d.AffiliateUser.id}).success(function(a){return a.errored?void b.addError("submitNetworkProfileMessage","","Error creating profile."):void h("Profile Successfully Created!")}).error(function(){b.addError("submitNetworkProfileMessage","","Error creating profile.")})["finally"](function(){b.decrementLoading()})}function l(d,e){c.get("ZenithConnect/patchAffiliate",{id:a.Config.connect_affiliate_id||b.affiliate.id,patches:[{op:"replace",path:"/display_name",value:b.affiliate.display_name},{op:"replace",path:"/description",value:b.affiliate.description},{op:"replace",path:"/website",value:b.affiliate.website},{op:"replace",path:"/contact_email",value:b.affiliate.contact_email},{op:"replace",path:"/notification_emails",value:e},{op:"replace",path:"/visible_in_directory",value:!b.affiliate.hidden},{op:"replace",path:"/categories",value:d}]}).success(function(a){return a.errored?void b.addError("submitNetworkProfileMessage","","Error editing profile."):void(b.logoFile?h("Profile Successfully Modified!"):(b.affiliate=a.data,g(),b.addSuccess("submitNetworkProfileMessage","","Profile Successfully Modified!")))}).error(function(){b.addError("submitNetworkProfileMessage","","Error editing profile.")})["finally"](function(){b.decrementLoading()})}b.affiliate={},b.logoFile=null,b.categories=[],b.isChecked=function(a){return a&&Object.keys(a).some(function(b){return a[b]})},b.submitForm=function(){if(j()){b.incrementLoading();var c=Object.keys(Object.assign({},b.affiliate.region,b.affiliate.payout_model,b.affiliate.industry,b.affiliate.publisher_type)),d=Array.isArray(b.affiliate.notification_emails)?b.affiliate.notification_emails:b.affiliate.notification_emails.split(",");a.Config.connect_affiliate_id||b.affiliate.id?l(c,d):k(c,d)}},i()}])}(this),function(a){a.Application.controller("Controllers.conversionReport",["$scope","api","directiveRegistry",function(a,b,c){function d(a,b){var c={},e=a.split(".");if(1==e.length)c[e[0]]=b;else if(e.length>1){var f=e.slice(1,e.length).join(".");c[e[0]]=d(f,b)}return c}function e(a){return a.data.map(function(a){var b={};return Object.keys(a).forEach(function(c){a["Stat.datetime"]&&(a["Stat.datetime"]=new Date(a["Stat.datetime"]).getTime());var e=d(c,a[c]);b=$.extend(!0,b,e)}),b})}function f(){a.incrementLoading();var c={fields:n,end_date:a.getEndDate(),sort_by:a.table.sort.field,start_date:a.getStartDate(),offset:a.table.paging.offset,limit:a.table.paging.pageSize,sort_direction:a.table.sort.direction,brand_ids:a.selectedBrands};b.get("ZenithConnect/getConversions",c).success(function(a){a.data&&(a.data=e(a),g(a,c))})["finally"](function(){a.decrementLoading()})}function g(b,c){a.table.drawTable?a.table.drawTable(b,c):a.table.addItems(b,c,!0)}function h(){c.onDirectivesReady(["premiumPartnerConversionsTable"],function(){j("premiumPartnerConversionsTable"),a.table.$on("sortRequested",f),a.table.$on("pagingChanged",f)})}function i(){c.onDirectivesReady(["premiumPartnerConversionsTableMobile"],function(){j("premiumPartnerConversionsTableMobile"),a.table.$on("moreItemsRequested",function(){a.generateTable(!0)})})}function j(b){a.table=c.get(b),a.table.sort={field:"Stat.datetime",direction:"desc"},a.timezone=a.datePicker.getSelectedTimezone().keyword,f()}function k(){a.isMobile?i():h()}function l(){a.brands=[],a.brandsOptions.pageCount=0,a.brandsOptions.stopCallingLoadMore=!1}function m(){a.brandsOptions.loading=!0;var c={limit:o,search_term:a.brandsOptions.search,offset:o*a.brandsOptions.pageCount};b.get("ZenithConnect/getAffiliateConnections",c).success(function(b){b.data&&(a.brandsOptions.pageCount++,a.brandsOptions.total=b.total_rows,Array.prototype.push.apply(a.brands,b.data),a.brandsOptions.total===a.brands.length&&(a.brandsOptions.stopCallingLoadMore=!0));
})["finally"](function(){a.brandsOptions.loading=!1})}var n=["Stat.datetime","Brand.network_name","Offer.name","Offer.id","Stat.conversion_status","Stat.payout"],o=50;a.datepickerRangeOptions={today:!1,yesterday:!0,lastThreeDays:!0,lastWeek:!0,lastFourteenDays:!0,thisMonth:!1,lastMonth:!1,lastThirtyDays:!0,lastSixtyDays:!0,lastSixMonths:!1,thisYear:!1,lastYear:!1,allTime:!1},a.brands=[],a.selectedBrands=[],a.brandsOptions={total:0,search:"",pageCount:0,loading:!1,stopCallingLoadMore:!1},a.togglePanelFn=function(b,c,d){switch(d){case"default":c||"datepicker"!==b?a.datePicker.cancel():a.datePicker.show()}},a.getStartDate=function(){return a.datePicker?moment.utc(a.datePicker.getStartDate()).tz(a.datePicker.getSelectedTimezone().keyword).format():void 0},a.getEndDate=function(){return a.datePicker?moment.utc(a.datePicker.getEndDate()).tz(a.datePicker.getSelectedTimezone().keyword).format():void 0},a.dateChange=function(){a.timezone=a.datePicker.getSelectedTimezone().keyword,f()},a.generateTable=function(b){b&&a.table.clearItems(b),f()},a.handleChange=function(){l(),m()},a.handleToggle=function(b){var c=a.selectedBrands.indexOf(b);c>-1?a.selectedBrands.splice(c,1):a.selectedBrands.push(b)},a.cancelPanelFn=function(){a.selectedBrands.length&&(a.selectedBrands=[],f()),a.brandsOptions.search.length&&(a.brandsOptions.search="",l(),m())},a.applyPanelFn=function(){f()},a.loadMore=function(){m()},a.reloadTable=function(a){a&&a.preventDefault(),f()},a.downloadNetworkConversionReport=function(d){d&&d.preventDefault();var e={fields:n,end_date:a.getEndDate(),start_date:a.getStartDate(),brand_ids:a.selectedBrands},f=c.get("downloadReportModal");a.downloadReportLink="",a.downloadReportGenerating=!0,a.downloadReportFailed=!1,f.show(),b.get("ZenithConnect/getConversionsDownloadLink",e).success(function(b){a.downloadReportLink=b.data,a.downloadReportGenerating=!1})["catch"](function(b){a.downloadReportLink="",a.downloadReportGenerating=!1,a.downloadReportFailed=!0})},c.onDirectivesReady(["panelStates","ConversionDatePicker"],function(){m(),k()})}])}(this),function(a){a.Application.controller("Controllers.account",["$scope","currentUser","$location","geographic","models",function(b,c,d,e,f){b.user=c.AffiliateUser,b.affiliate=c.Affiliate,b.currentUserLoading=c.loading,b.auth={},b.affiliateCountries=[],b.newUser={access:[]},b.geo=e,b.affiliateEditMode=!1;var g=f.get("affiliateUser");e.loaded?b.affiliateCountries=e.getCountries():b.$on("geoInfoLoaded",function(){b.affiliateCountries=e.getCountries()}),b.$on("UserLoaded",function(a){a&&(b.user=c.AffiliateUser,b.affiliate=c.Affiliate,b.currentUserLoading=!1,b.affiliateLoading=!1)}),b.isAccountManager=function(){return c.hasPermission("account_management")},b.canEditUsers=function(){return c.hasPermission("user_management")&&b.getPreference("enable_affiliate_user_management")},b.buildUserRegionLine=function(){var a=c.Affiliate,b=[];return _.each([a.city,a.region,a.zipcode],function(a){a&&b.push(a)}),b.join(", ")},b.auth.cleanPermissionNames=[{name:"Reporting",field:"stats"},{name:"Offer Management",field:"offer_management"},{name:"User Management",field:"user_management"},{name:"Account Management",field:"account_management"},{name:"API Access",field:"API"}],b.newUser.isValidPassword=function(){return g.isValidPassword(b.newUser.password)},b.newUser.confirmPassword=function(){return b.newUser.password_confirm===b.newUser.password},b.newUser.isValidEmail=function(){return g.isValidEmail(b.newUser.email)},b.newUser.isValid=function(){return this.isValidEmail()&&this.isValidPassword()&&this.confirmPassword()},b.newUser.create=function(){b.newUser.error="";var a={data:{affiliate_id:c.Affiliate.id,first_name:b.newUser.first_name,last_name:b.newUser.last_name,title:b.newUser.title||"",email:b.newUser.email,phone:b.newUser.phone||"",cell_phone:b.newUser.cell_phone||"",password:b.newUser.password,password_confirmation:b.newUser.password_confirm}},e=g.create(a);e.success(function(a){b.$broadcast("userCreated"),d.path("/account/"+a.AffiliateUser.id)}),e.error(function(a){b.newUser.error=a.errorDetails})},b.tax={show_tax_id:!1,ssn_tax:null},c.getPreferenceValue("enable_affiliate_vat")===!0&&(b.tax.show_tax_id=!0,f.get("affiliate").getAffiliate().success(function(a){b.tax.ssn_tax=a.AffiliateMeta.ssn_tax||""})),b.toggleAffiliateEdit=function(){b.affiliateEditMode=b.affiliateEditMode===!0?!1:!0},b.editAffiliate=function(){b.affiliateEditMode=!0},b.cancelAffiliateEdit=function(){b.affiliate=a.angular.copy(c.Affiliate),b.affiliateEditMode=!1},b.saveAffiliateInfo=function(){var d=b.affiliate,e={id:a.Config.affiliate_id,data:{company:d.company,address1:d.address1,address2:d.address2,city:d.city,country:d.country,region:d.region,zipcode:d.zipcode,phone:d.phone,fax:d.fax,website:d.website}};c.getPreferenceValue("enable_affiliate_vat")===!0&&f.get("affiliate").updateAffiliateTaxId(b.tax.ssn_tax),b.affiliateLoading=!0,f.get("affiliate").updateAffiliate(e).success(function(){c.refresh(),b.affiliateEditMode=!1})},b.$watch("affiliate.country",function(a){var c={US:"State",CA:"Province"};b.affiliateRegionType=c[a]||"Province_Territory",b.affiliateRegions=e.getCountryRegions(a)})}])}(this),function(a){a.Application.controller("Controllers.affiliateUsers",["$scope","$location","$rootScope","sessionStorageService","currentUser","models","directiveRegistry",function(a,b,c,d,e,f,g){var h=f.get("affiliateUser"),i=function(){var b={filters:{status:{NOT_EQUAL_TO:"deleted"}},fields:["id","email","first_name","last_name","title","modified","status"],sort:{},page:a.table.paging.page,limit:a.table.paging.pageSize};a.incrementLoading(),h.getAllAffiliateUsers(b).success(function(c){a.decrementLoading(),(a.table.addItems||a.table.drawTable)(c,b)}).error(function(b){a.flashError(b.errorMessage),a.decrementLoading()})},j=function(){g.onDirectivesReady("affiliateUsers",function(){a.table=g.get("affiliateUsers"),a.table.$on("pagingChanged",function(){i()}),a.table.$on("sortRequested",function(){i()}),i()}),a.$parent.$on("userUpdated",function(){i()})},k=function(){g.onDirectivesReady(["usersTableMobile"],function(){a.table=g.get("usersTableMobile"),i(),a.table.$on("moreItemsRequested",function(){i()})})};a.isMobile?k():j()}])}(this),function(a){a.Application.controller("Controllers.alertSettings",["$scope","$location","currentUser","models",function(a,b,c,d){c.checkPreference("affiliate_email_notifications",!0).then(function(a){a||b.path("/dashboard")},function(a){b.path("/dashboard")}),d.get("notifications").getNotifications(c.AffiliateUser.id).success(function(b){_.each(a.alertSubscription,function(a){_.each(a.options,function(a){_.each(b,function(b){parseInt(b,10)===a.scenario_id&&(a.selected=!0)})})})}).error(function(){a.$broadcast("alertSettingsChanged",{success:!1})}),d.get("notifications").getNotificationOptOuts(c.AffiliateUser.id).success(function(b){_.each(a.alertOptOutSubscription,function(a){_.each(a.options,function(a){_.each(Object.keys(b),function(c){var d="optimizer_affiliate_"+a.optimizerType;c===d&&(b[c].no_email&&(a.fields.email.selected=!1),b[c].no_in_app&&(a.fields.app.selected=!1))})})})}).error(function(){a.$broadcast("alertSettingsChanged",{success:!1})}),a.saveAutomationSettings=function(){var b={};_.each(a.alertOptOutSubscription,function(a){_.each(a.options,function(a){var c=a.fields;c.email.selected&&c.app.selected||(b["optimizer_affiliate_"+a.optimizerType]={no_email:Number(!c.email.selected),no_in_app:Number(!c.app.selected)},b["optimizer_source_"+a.optimizerType]=b["optimizer_affiliate_"+a.optimizerType])})}),_.isEmpty(b)&&(b=[""]),d.get("notifications").setNotificationOptOuts(b).success(function(){a.$broadcast("alertSettingsChanged",{success:!0})}).error(function(){a.$broadcast("alertSettingsChanged",{success:!1})})},a.saveAlertSettings=function(){var b=[];_.each(a.alertSubscription,function(a){_.each(a.options,function(a){a.selected&&b.push(a.scenario_id)})});var c=[];_.each(a.alertSubscription,function(a){_.each(a.options,function(a){a.selected&&c.push(a.scenario_id)})}),d.get("notifications").setNotifications(b).success(function(){a.$broadcast("alertSettingsChanged",{success:!0})}).error(function(){a.$broadcast("alertSettingsChanged",{success:!1})})},a.$on("alertSettingsChanged",function(b,c){c.success?a.flashSuccess("Alert Settings Successfully Updated"):a.flashError("Alert Settings Update Failed")}),a.getAlertSettingsLabel=function(a){return"function"==typeof a?a():a},a.alertSubscription=d.get("notifications").getDefinition(),a.alertOptOutSubscription=d.get("notifications").getOptOutDefinition()}])}(this),function(a){a.Application.controller("Controllers.app",["$scope","$http","$window","$location","$timeout","$rootScope","$route","hasSession","api","currentUser","analyticsService",function(b,c,d,e,f,g,h,i,j,k,l){a.Config.$http=c;var m=k.BrandPreferences;g.network_name=a.Config.network_name,g.getPreference=function(a){return m[a]},g.hasFeatures=function(a){return _.indexOf(k.Features,a)>-1},g.userHasPermission=_.bind(k.hasPermission,k),g.themeLoaded=!1,g.$on("themeLoaded",function(){g.themeLoaded=!0,$("#sidebar").removeClass("loading-state"),$("#globalLoadingIndicator").removeClass("preload"),g.decrementLoading()}),g.$on("UserLoaded",function(a){if(a){m=k.BrandPreferences;var b=l.getSettings();m.enable_google_analytics&&m.google_analytics&&(b.googleAnalyticsAccountId=m.google_analytics),g.hasFeatures("PENDO_PI")&&(b.pendoEnabled=!0,b.pendoUserProps={visitor:{id:k.Brand.brand_id+"-"+k.AffiliateUser.id,email:k.AffiliateUser.email,full_name:k.AffiliateUser.first_name+" "+k.AffiliateUser.last_name,role:k.AffiliateUser.title},account:{id:k.Brand.brand_id}}),l.setSettings(b),l.init(),g.$on("$routeChangeSuccess",function(){l.track({page:e.path()},"googleAnalytics")})}});var n;g.loadingCount=1,g.incrementLoading=function(){g.loadingCount++,clearTimeout(n),n=setTimeout(function(){g.loadingCount>0&&g.decrementLoading(!0)},3e4)},g.decrementLoading=function(a){f(function(){a||g.loadingCount<=1?(g.loadingCount=0,clearTimeout(n)):g.loadingCount--},200)},g.addReturnLocation=function(){var a=e.search(),b=e.path();-1===b.indexOf("/dashboard")&&(g.returnLocation=b),a.upstreamNetworkId&&0===b.indexOf("/offer/")&&(g.returnLocation=b+"?upstreamNetworkId="+a.upstreamNetworkId)},g.$on("$routeChangeStart",function(){g.incrementLoading(),g.addReturnLocation()}),g.$on("$routeChangeSuccess",function(){g.decrementLoading()}),g.$on("$routeChangeError",function(a,c,d,e){switch(g.decrementLoading(!0),e){case"missing_permission":case"missing_preference":case"missing_feature":b.flashError("This feature is not enabled");break;case"login_required":case"user_load_failure":window.top.location.href="/login"}}),i.init();var o=function(a){return b[a]={text:"",visible:!1},function(c){b[a].text=c,b[a].visible=!0,f(function(){b[a].visible=!1},2500)}};b.flashError=o("flashErrorMessage"),b.flashSuccess=o("flashSuccessMessage");var p={},q={};b.addError=function(a,c,d){c=c||"",d=d||"",p[a]=_.uniqueId("alertmsg-"),d&&_.isString(d)&&0===d.length?d="":(_.isArray(d)===!1&&(d=[d]),d="<ul><li>{0}</li></ul>".format(d.join("</li><li>")));var e='<div id="{0}" class="alert alert-error">';e+='<a href="javascript:void(0)" class="close" data-dismiss="alert" ng-click="clearAlert(\'{1}\')"></a>',e+="<h2>{2}</h2> {3}</div>",b[a]=e.format(p[a],a,c,d),f(function(){$("body").scrollTo("#"+p[a],800)},300)},b.addSuccess=function(a,c,d){c=c||"",d=d||"",q[a]=_.uniqueId("alertmsg-");var e='<div id="{0}" class="alert alert-success">';e+='<a href="javascript:void(0)" class="close" data-dismiss="alert" ng-click="clearAlert(\'{1}\')"></a>',e+="<h2>{2}</h2> {3}</div>",b[a]=e.format(q[a],a,c,d),f(function(){b.clearAlert(a,!0)},5e3)},b.clearAlert=function(c,d){function e(d,e){e&&d?a.angular.element("#"+d).fadeOut("fast",function(){b[c]=""}):(d&&a.angular.element("#"+d).hide(),b[c]="")}var f;p[c]&&(f=p[c],delete p[c],e(f,d)),q[c]&&(f=q[c],delete q[c],e(f,d))};var r=[];b.queueMessage=function(a,b){r.push({method:a,args:b})},g.updatePageTitle=function(a){b.pageTitle=a||""},b.bodyClass="",b.$on("$routeChangeSuccess",function(a,c){b.bodyClass=c.bodyClass||"",g.updatePageTitle(c.pageTitle),_.size(p)>0&&_.each(p,function(a,c){b.clearAlert(c,!1)}),_.size(q)>0&&_.each(q,function(a,c){b.clearAlert(c,!1)}),r.length>0&&(_.each(r,function(a){b[a.method]&&b[a.method].apply(b,a.args)}),r=[])}),g.log=function(){console.log.apply(console,arguments)},g.logError=function(){console.error.apply(console,arguments)};var s=755;g.isMobile=$(d).width()<s,g.detectMobile=_.throttle(function(){var a=$(d).width()<s;a!=g.isMobile&&(f(function(){g.isMobile=a,g.$broadcast("isMobileSwitched",a)}),_.isEmpty(h.current.mobileTemplateUrl)&&_.isEmpty(h.current.mobileController)||f(function(){h.reload()}))},150);var t="menu-open",u="";b.initMenuBodyClass=function(){b.menuBodyClass=b.isMobile?u:t},b.toggleSidebar=function(){b.menuBodyClass=b.menuBodyClass===u?t:u,b.$broadcast("sidebarToggle")},g.$on("isMobileSwitched",b.initMenuBodyClass),g.$on("$routeChangeSuccess",function(){b.isMobile&&(b.menuBodyClass=u,b.$broadcast("mobileRouteChange"))}),b.initMenuBodyClass(),b.broadcastSidebarMouseleave=function(){b.$broadcast("sidebarMouseleave")},$(d).bind("resize",g.detectMobile),$(d).bind("resize",_.throttle(function(){a.angular.element(".quickstats p").textfill({maxFontPixels:28})},1e3))}])}(this),function(a){a.Application.controller("Controllers.billing",["$scope","$location","$routeParams","$translate","$q","models","api","geographic","$timeout","currentUser","directiveRegistry",function(b,c,d,e,f,g,h,i,j,k,l){var m=g.get("billing");b.account_balance="",m.getAccountBalance(b),b.affiliate={},g.get("affiliate").getAffiliate().success(function(a){b.affiliate=a,(_.hasMembers(b.affiliate,"PaymentMethod","Payoneer","status")&&null===b.affiliate.PaymentMethod.Payoneer.status||_.isNull(b.affiliate.PaymentMethod.Payoneer))&&k.hasPermission("account_management")&&(b.payoneerSignupLink="fetching",m.getPayoneerSignupLink().success(function(a){b.payoneerSignupLink=a}))}).error(function(a){console.log(a)}),b.payout_to_date="",b.payout_year="";var n=m.getPayoutTotals(b);n.success(function(){j(function(){a.angular.element(".quickstats p").textfill({maxFontPixels:28})})}),i.loaded?b.countries=i.getCountries():b.$on("geoInfoLoaded",function(){b.countries=i.getCountries()}),b.paymentReconciliationEnabled=!1,k.checkPreference("disable_payment_reconciliation",!1,b,"paymentReconciliationEnabled"),b.defaultPaymentMethod="";var o=k.checkPreference("affiliate_payment_method_default",null);o.then(angular.noop,function(a){b.defaultPaymentMethod=a}),b.updateInvoiceTable=function(){var a={fields:["id","datetime","amount","memo","currency"],page:b.invoiceTable.paging.page,limit:b.invoiceTable.paging.pageSize,sort:{"AffiliateInvoice.id":"desc"}};m.getPaymentHistory(a).success(function(c){b.invoiceTable.addItems?b.invoiceTable.addItems(c,a):b.invoiceTable.drawTable(c,a)})},l.onDirectivesReady("billingInvoices",function(){b.invoiceTable=l.get("billingInvoices"),b.updateInvoiceTable(),b.invoiceTable.$on("pagingChanged",function(){b.updateInvoiceTable()}),b.invoiceTable.$on("moreItemsRequested",function(){b.updateInvoiceTable()})}),b.mobile={pageState:"invoices"};var p={check:"billing.paymentMethods.check",direct_deposit:"billing.paymentMethods.direct_deposit",other:"billing.paymentMethods.other",payoneer:"billing.paymentMethods.payoneer",paypal:"billing.paymentMethods.paypal",wire:"billing.paymentMethods.wire"},q=function(){if(!k.isLoaded)return[];var a=_.keys(p),b=[];return _.each(a,function(a){k.getPreferenceValue("affiliate_payment_"+a+"_disabled")!==!0&&b.push(a)}),b};b.getPaymentMethodsMap=function(a){var b={},c=q(),d="";return _.each(a,function(a,f){d=f.toLowerCase(),"DirectDeposit"==f&&(d="direct_deposit"),_.contains(c,d)&&(b[e(p[d])]=d)}),b},b.checkPaymentMethodsType=[{value:"0",label:e("billing.labels.company")},{value:"1",label:e("billing.labels.individual")}],b.formatPaymentMethod=function(a){return p[a]||a},b.original_affiliate=null,b.editMode="true"==d.edit?!0:!1,b.editMode&&(b.editMode=!0),b.$watch("affiliate",function(a){a&&b.isBillingDetailsBlankState(a)&&!b.editMode&&b.toggleEditMode()}),b.isBillingDetailsBlankState=function(a,c){if(""===b.defaultPaymentMethod)return!1;if(!a||!a.Affiliate||!a.PaymentMethod||a.Affiliate.payment_method!=b.defaultPaymentMethod)return!1;var d=b.defaultPaymentMethod.split("_"),e=_.map(d,function(a){return a.charAt(0).toUpperCase()+a.slice(1)}).join(""),f=!0;return a.PaymentMethod[e]?_.each(a.PaymentMethod[e],function(a,b){_.contains(["affiliate_id","modified","method"],b)||_.isEmpty(a)||"NO"==a||"0"==a||(f=!1)}):f=!1,!c&&b.editMode&&f&&null!==b.original_affiliate?b.isBillingDetailsBlankState(b.original_affiliate,!0):f},b.toggleEditMode=function(){b.editMode=!b.editMode,b.editMode?b.original_affiliate=a.angular.copy(b.affiliate):(b.original_affiliate&&(b.affiliate=b.original_affiliate),b.clearAlert("paymentMethodUpdateStatus"))},b.savePaymentMethod=function(){var c="",d={},g=["account_number","routing_number","country"],i=function(a){var b={};return _.each(a,function(a,c){a?(_.contains(g,c)&&(a=(a+"").replace(/\W/g,"")),b[c]=a):b[c]=""}),b};switch(b.affiliate.Affiliate.payment_method){case"wire":c="Affiliate/updatePaymentMethodWire",d=i(b.affiliate.PaymentMethod.Wire);break;case"check":c="Affiliate/updatePaymentMethodCheck",d=i(b.affiliate.PaymentMethod.Check);break;case"direct_deposit":c="Affiliate/updatePaymentMethodDirectDeposit",d=i(b.affiliate.PaymentMethod.DirectDeposit);break;case"payoneer":c=!1;break;case"paypal":c="Affiliate/updatePaymentMethodPaypal",d=i(b.affiliate.PaymentMethod.Paypal);break;case"other":c="Affiliate/updatePaymentMethodOther",d=i(b.affiliate.PaymentMethod.Other)}if(""!==c){var j={affiliate_id:a.Config.affiliate_id,data:d},k={id:a.Config.affiliate_id,data:{payment_method:b.affiliate.Affiliate.payment_method}},l=[h.get("Affiliate/update",k)];c&&l.push(h.get(c,j)),f.all(l).then(function(){b.addSuccess("paymentMethodUpdateStatus",e("billing.alert.billingDetailsUpdated")),b.editMode=!1,b.original_affiliate=null},function(a){b.addError("paymentMethodUpdateStatus",a.errorMessage,a.errorDetails)})}}}])}(this),function(a){a.Application.controller("Controllers.createPixelPostback",["$scope","$routeParams","models","directiveRegistry",function(b,c,d,e){var f=!1,g=d.get("offerPixel");if(b.pixelData={},b.define=g.getOfferPixelDefinition(),b.codeTypes={},b.goals=[],c.offer_id){var h=d.get("offerDetail"),i=g.getAllowedTypes(c.offer_id,h.apiKey,h.upstreamNetworkId);i.success(function(a){1==a.length&&"url"===a[0]&&a.push("code","image"),_(a).each(function(a){b.codeTypes[a]=b.define.fields.type.values[a]})}),g.getOfferGoals(c.offer_id,h.apiKey,h.upstreamNetworkId).then(function(a){_.each(a.data,function(a){b.goals[a.Goal.id]=a.Goal.name})})}b.optionalVariables=[{value:"{offer_id}",description:"ID of offer."},{value:"{offer_name}",description:"Name of offer."},{value:"{offer_ref}",description:"Reference ID for offer."},{value:"{goal_id}",description:"ID of goal for offer."},{value:"{affiliate_id}",description:"ID of affiliate."},{value:"{affiliate_name}",description:"Company name of affiliate."},{value:"{affiliate_ref}",description:"Reference ID for affiliate."},{value:"{source}",description:"Source value specified in the tracking link."},{value:"{aff_sub}",description:"Affiliate sub specified in the tracking link."},{value:"{aff_sub2}",description:"Affiliate sub 2 specified in the tracking link."},{value:"{aff_sub3}",description:"Affiliate sub 3 specified in the tracking link."},{value:"{aff_sub4}",description:"Affiliate sub 4 specified in the tracking link."},{value:"{aff_sub5}",description:"Affiliate sub 5 specified in the tracking link."},{value:"{aff_click_id}",description:"Affiliate click ID specified in the tracking link."},{value:"{aff_unique1}",description:"Affiliate unique value 1 specified in the tracking link."},{value:"{aff_unique2}",description:"Affiliate unique value 2 specified in the tracking link."},{value:"{aff_unique3}",description:"Affiliate unique value 3 specified in the tracking link."},{value:"{aff_unique4}",description:"Affiliate unique value 4 specified in the tracking link."},{value:"{aff_unique5}",description:"Affiliate unique value 5 specified in the tracking link."},{value:"{offer_url_id}",description:"ID of offer URL for offer."},{value:"{offer_file_id}",description:"ID of creative file for offer."},{value:"{file_name}",description:"Name of creative file for offer."},{value:"{advertiser_id}",description:"ID of advertiser."},{value:"{advertiser_ref}",description:"Reference ID for affiliate."},{value:"{adv_sub}",description:"Advertiser sub specified in the conversion pixel / URL."},{value:"{transaction_id}",description:"ID of the transaction for your network. Don't get confused with an ID an affiliate passes into aff_sub."},{value:"{session_ip}",description:"IP address that started the tracking session."},{value:"{ip}",description:"IP address that made the conversion request."},{value:"{date}",description:"Current date of conversion formatted as YYYY-MM-DD."},{value:"{time}",description:"Current time of conversion formatted as HH:MM:SS."},{value:"{datetime}",description:"Current date and time of conversion formatted as YYYY-MM-DD HH:MM:SS."},{value:"{ran}",description:"Randomly generated number."},{value:"{currency}",description:"3 digit currency abbreviated."},{value:"{payout}",description:"Amount paid to affiliate for conversion."},{value:"{sale_amount}",description:"Sale amount generated for advertiser from conversion."},{value:"{device_id}",description:"For mobile app tracking, the ID of the user's mobile device."}],b.addVariable=function(c,d){c&&c.preventDefault();var e=a.angular.element("#pixel-postback-code-input"),f=b.pixelData.code||"",g=e.caret().start,h=e.caret().end,i=[f.substr(0,g),d,f.substr(h)];b.pixelData.code=i.join("")},b.onModalClose=function(){f&&(b.isMobile?e.onDirectivesReady(["pixelsTableMobile"],function(){b.table=e.get("pixelsTableMobile"),b.table.$broadcast("refresh")}):e.onDirectivesReady(["pixelsTable"],function(){b.table=e.get("pixelsTable"),b.table.$broadcast("refresh")})),b.clearAlert("pixelSaveResult"),b.pixelData={},f=!1},b.save=function(){b.clearAlert("pixelSaveResult"),b.pixelData.offer_id=c.offer_id,g.createOfferPixel(b.pixelData,h.apiKey,h.upstreamNetworkId).success(function(){f=!0,b.$parent.pixelAdded(),b.dismiss()}).error(function(a){b.errors=a})}}])}(this),function(a){a.Application.controller("Controllers.invoice",["$scope","$routeParams","currentUser","models",function(b,c,d,e){b.invoice_id=c.id,b.affiliate=d.Affiliate,b.brand=d.Brand,b.paymentReconciliationEnabled=!1,d.checkPreference("disable_payment_reconciliation",!1,b,"paymentReconciliationEnabled");var f=e.get("invoice").getInvoice(b.invoice_id);f.success(function(a){return a?void(b.invoice=a):void b.addError("invoiceLoadStatus","Error loading invoice","The details for this invoice cannot be displayed")});var g=e.get("affiliate").getAffiliate();g.success(function(a){b.affiliateMeta=a.AffiliateMeta||{}}),b.payoutTypeFromAbbr=function(b){return a.Config.Enums.offerPayoutType[b]||""},b.formatPayoutActions=function(a,b){var c=0===a?"":"s";switch(b){case"cpc":return"{0}&nbsp;Click{1}".format(a,c);case"cpm":return"{0}&nbsp;Impression{1}".format(a,c);case"cpa_flat":case"cpa_percentage":case"cpa_both":return"{0}&nbsp;Conversion{1}".format(a,c)}},b.print=function(){window.print()}}])}(this),function(a){a.Application.controller("Controllers.languageSettings",["$rootScope","$scope","$location","currentUser","models","$timeout",function(a,b,c,d,e,f){var g=e.get("language");b.selectedLanguage=g.getSelectedLanguage(),b.languageSelection=g.getLanguageOptions(),b.saveLanguageSettings=function(){g.setLanguage(b.selectedLanguage).then(function(){b.flashSuccess("Language changed to "+b.selectedLanguage.label+" successfully, reloading page ..."),f(function(){window.location.reload()},2e3)},function(a){b.flashError("There was a problem saving language preferences to "+b.selectedLanguage.label)})}}])}(this),function(a){a.Application.controller("Controllers.messages",["$scope","$location","$routeParams","models","directiveRegistry",function(b,c,d,e,f){b.message_id=d.message_id,b.message={},b.$watch("message_id",function(){b.loadMessage()});var g=e.get("messages");b.loadMessage=function(){b.message_id&&g.getMessage(b.message_id,b)},b.deleteThisMessage=function(){if(b.message_id){var a=b.dismissMessage(b.message_id,$("#message-single .message"));a.success(function(){c.url("/messages/")})}},b.dismissMessage=function(a,c){_(c).isString()&&(c=angular.element("#"+c)),c.addClass("delete_in_progress");var d=g.dismissMessage({alert_id:a},b);return d.success(function(a){"false"!=a&&a?c.slideUp("slow"):c.removeClass("delete_in_progress")}),d},b.showDeleteConfirm=function(a,b){_(b).isString()&&(b=angular.element("#"+b)),b.find(".primary-delete").hide(),b.find(".confirm-group").show(),a.stopPropagation()},b.hideDeleteConfirm=function(a,b){_(b).isString()&&(b=angular.element("#"+b)),b.find(".primary-delete").show(),b.find(".confirm-group").hide(),a.stopPropagation()};var h=function(){var c={sort:{},fields:["id","title","description","datetime"],page:b.table.paging.page,limit:b.table.paging.pageSize};_(b).hasMembers("table","sort","field")&&(c.sort[b.table.sort.field]=b.table.sort.direction);var d=g.getMessages(c);d.then(function(a){b.messages=a,(b.table.drawTable||b.table.addItems)(a,c)},a.angular.noop)},i=function(){$(".hasTable").find("tbody > tr").each(function(){var a=$(this);a.css("cursor","pointer"),a.click(function(a){if("input"!==a.target.nodeName.toLowerCase()){var d=$(this).find("a").attr("href").replace("#!","");b.$apply(function(){c.url(d)})}})})};d.message_id||(b.isMobile?f.onDirectivesReady(["messagesMobile"],function(){b.table=f.get("messagesMobile"),b.table.$on("pagingChanged",function(){h()}),h()}):f.onDirectivesReady("messages",function(){b.table=f.get("messages"),h(),b.table.$on("pagingChanged",function(){h()}),b.table.$on("tableRenderComplete",i),b.table.$on("tableRenderComplete",function(){$("#checkAllBoxes").click(function(){var a=$(this).is(":checked");$(".message-check").attr("checked",a)})})})),b.bulkDelete=function(){$(".hasTable").find(".message-check:checked").each(function(){b.dismissMessage($(this).data("alert-id"),$(this).parents("tr"))})}}])}(this),function(a){a.Application.controller("Controllers.pageHeader",["$scope","$location","$route","hasSession",function(a,b,c,d){a.logOut=function(){d.logOut()},a.quicksearch="",a.submitQuicksearch=function(){this.quicksearch&&(a.isMobile&&$('[ng-model="quicksearch"]').blur(),b.path("/offers"),b.search({search:this.quicksearch,source:"sidebar"}),this.quicksearch="",c.reload())}}])}(this),function(a){a.Application.controller("Controllers.performanceMobile",["$scope",function(a){a.message="Mobile performance report improvements are in progress."}])}(this),function(a){a.Application.controller("Controllers.pixelPostback",["$scope","models","$routeParams","directiveRegistry",function(a,b,c,d){var e=b.get("offerPixel"),f=function(){var d={fields:["id","type","code","status","offer_id","goal_id","Offer.name"],sort:{},page:a.table.paging.page,limit:a.table.paging.pageSize,filters:{},contain:["Offer"]};_(a).hasMembers("table","sort","field")?d.sort[a.table.sort.field]=a.table.sort.direction:d.sort={"Offer.name":"desc"},c.offer_id&&(d.filters["Offer.id"]=c.offer_id),a.incrementLoading();var f=b.get("offerDetail"),g=e.getOfferPixelData(d,f.apiKey,f.upstreamNetworkId);g.success(function(b){a.decrementLoading(),(a.table.drawTable||a.table.addItems)(b,d)}),g.error(function(b){a.flashError(b.errorMessage),a.decrementLoading()})},g=function(){d.onDirectivesReady(["pixelsTableMobile"],function(){a.table=d.get("pixelsTableMobile"),f(),a.table.$on("moreItemsRequested",function(){f()}),a.table.$on("refresh",function(){f()}),a.table.$on("rowRendered",function(b,c){c.find(".delete-button").click(function(){a.deletePixel(c.scope().OfferPixel.id),a.$on("pixelDeleted",function(){c.slideUp()})})})})},h=function(){d.onDirectivesReady("pixelsTable",function(){a.table=d.get("pixelsTable"),f(),a.sortDir="desc",a.sortField="Offer.name",a.table.sort.field=a.sortField,a.table.sort.direction=a.sortDir,a.table.$on("refresh",function(){f()}),a.table.$on("pagingChanged",function(){f()}),a.table.$on("sortRequested",function(){a.sortField=a.table.sort.field,a.sortDir=a.table.sort.direction,f()}),a.table.$on("tableRenderComplete",function(){$('div[name="pixelsTable"]').find(".delete-button").each(function(){var b=$(this);b.click(function(){a.deletePixel(b.data("pixelId")),a.$on("pixelDeleted",function(){b.parents("tr").slideUp()})})})})})};a.isMobile?g():h(),a.onGridComplete=function(){$(".offer-pixel-delete").unbind("click"),$(".offer-pixel-delete").click(function(b){b.stopPropagation(),a.deletePixel($(b.currentTarget).data("id"))})},a.deletePixel=function(c){var d=b.get("offerDetail");e.deleteOfferPixel({id:c},d.apiKey,d.upstreamNetworkId).success(function(){a.addSuccess("offerPixelDeleteMsg","Offer pixel successfully deleted"),(a.generateTable||angular.noop)(),a.$broadcast("pixelDeleted",c)})},a.pixelAdded=function(){a.addSuccess("offerPixelDeleteMsg","Offer pixel successfully created")}}])}(this),function(a){a.Application.controller("Controllers.receipt",["$scope","$routeParams","currentUser","models",function(a,b,c,d){a.receipt_id=b.id,a.affiliate=c.Affiliate,a.brand=c.Brand;var e=d.get("invoice"),f=e.getReceipt(a.receipt_id);f.success(function(b){var c=b.AffiliateReceipt.payment_info;c&&(1==_.size(c)&&(c=_.toArray(c).pop()),delete c.affiliate_id,_.each(c,function(a,b){""===a&&delete c[b]})),b.AffiliateReceipt.payment_info=c,a.receipt=b.AffiliateReceipt,a.receipt.invoices=[],b.AffiliateInvoice&&b.AffiliateInvoice[0]&&_.each(b.AffiliateInvoice[0],function(b){a.receipt.invoices.push(b.id)})}),a.humanizeKey=function(a){return a=a.replace("_"," "),a=a.replace(/\d/,"")}}])}(this),function(a){a.Application.controller("Controllers.receipts",["$scope","models","directiveRegistry",function(a,b,c){var d=b.get("receipts"),e=function(){var b={fields:["id","datetime","status","memo","method","amount","currency_code"],page:a.table.paging.page,limit:a.table.paging.pageSize};d.getReceipts(b).success(function(c){var d=_.chain(c).map(function(a){return a}).sortBy(function(a){return a.AffiliateInvoice.id}).reverse().value();a.table.drawTable?a.table.drawTable(d,b):a.table.addItems(d,b)})};c.onDirectivesReady("billingPayments",function(){a.table=c.get("billingPayments"),e(),a.table.$on("pagingChanged",function(){e()}),a.table.$on("moreItemsRequested",function(){e()})})}])}(this),function(a){var b=function(a,b){var c=b.get("referralReport");c.getReferralList().success(function(b){a.referralList=b})};b.$inject=["$scope","models"],a.Application.controller("Controllers.referralList",b)}(this),function(a){a.Application.controller("Controllers.referralReport",["$scope","$location","directiveRegistry","models","$window","currentUser","pageState",function(b,c,d,e,f,g,h){var i=c.path();b.pageState="report";var j=e.get("referralReport");b.mutateGridData=function(a,b){var c={},d=b.fields;_.each(d,function(a){a=a.split("."),"Stat"==a[0]&&(c[a[1]]=0)});var e=[];_.each(a.data,function(a){a.Stat||(a.Stat=c),e.push(a)}),a.data=e},b.getFilter=function(){var a={},c=$.trim(b.nameFilter);return"date"!==b.displayFields&&c&&(a.OR={"ReferredAffiliate.company":{conditional:"LIKE",values:"%"+c+"%"}}),a},d.onDirectivesReady(["referralDatePicker","referralTable"],function(){b.table=d.get("referralTable"),b.datePicker.setDate(moment().format("YYYY-MM-DD"),moment().subtract(6,"days").format("YYYY-MM-DD"),!0),b.sortDir="desc",b.sortField="ReferredAffiliate.company",b.table.sort.field=b.sortField,b.table.sort.direction=b.sortDir,b.table.paging.page=h.get(i).page||1,b.table.paging.pageSize=h.get(i).limit||50,b.table.$on("pagingChanged",b.updateTableData),b.$watch("displayFields",b.updateTableData),
b.table.$on("sortRequested",function(){b.sortField=b.table.sort.field,b.sortDir=b.table.sort.direction,b.updateTableData()})}),b.togglePanelFn=function(a,c,d){switch(d){case"default":c||"datepicker"!==a?b.datePicker.cancel():b.datePicker.show()}};var k=function(){var a={};switch(a.groups=[],a.fields=["Stat.amount"],b.displayFields){case"affiliate":a.fields.push("ReferredAffiliate.company"),a.groups.push("ReferredAffiliate.company");break;case"date":a.fields.push("Stat.date"),a.groups.push("Stat.date");break;case"both":a.groups.push("Stat.date"),a.fields.push("Stat.date"),a.fields.push("ReferredAffiliate.company"),a.groups.push("ReferredAffiliate.company")}return a.sort={},a.sort[b.table.sort.field]=b.sortDir,_(a.fields).contains(b.table.sort.field)||delete a.sort,a.filters=b.getFilter(),a.filters["Stat.date"]={conditional:"BETWEEN",values:[b.datePicker.getStartDate(),b.datePicker.getEndDate()]},a.page=b.table.paging.page,a.limit=b.table.paging.pageSize,a};b.updateTableData=function(){b.fetchingData=!0,j.getReportData(k()).success(function(a){b.mutateGridData(a,k()),b.table.drawTable(a,k()),b.fetchingData=!1})},b.getReferralUrl=function(){var b=f.location.protocol+"//",c=b+f.location.host;if(g.BrandPreferences.enable_custom_referral_link&&g.BrandPreferences.custom_referral_link){var d=/^https?:\/\//,e=g.BrandPreferences.custom_referral_link;return d.test(e)||(e=b+e),e.replace("{affiliate_id}",a.Config.affiliate_id)}var h=f.location.pathname,i=h.indexOf("publisher/");return i?(h=h.substring(0,i),"/"!==h.charAt(h.length-1)&&(h+="/")):h="/",c+h+"signup/"+a.Config.affiliate_id},b.displayFields="affiliate",b.searchFilter=function(){b.updateTableData()}}])}(this),function(a){a.Application.controller("Controllers.reports",["$scope","$location","sessionStorageService","chartService","digestService","$routeParams","$rootScope","$timeout","models","api","directiveRegistry","$q","$translate","currentUser",function(b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p,q,r,s,t,u=!1;s=j.get("savedReports"),t=c.$$path.split("/")[1],b.isPerformanceDetailReport=!1;var v=[];_(o.ConnectAdvertisers).each(function(a,b){a.network_id=b,v.push(a)}),b.selectedNetworkBrand=o.hasFeature("PREMIUM_PARTNER_INSTANCE")&&v.length?v[0].network_id:"",b.networkBrands=v;var w=function(a,e){switch("performanceDetail"==a&&(b.isPerformanceDetailReport=!0),a){case"performance":case"performanceDetail":case"stats":b.reportModel=j.get("statsReport"),b.includeFraudFields=o.hasFeature("FRAUD_STATS_REPORT"),p="performance",q="stats";break;case"conversion":case"conversions":b.reportModel=j.get("conversionReport"),p="log",q="conversions";break;default:throw new Error("Could not determine report model for "+a)}if("savedReport"==t&&(u=!0),b.optionsSelectors=b.reportModel.getSelectorOptions(),b.reportOptions={},b.intervalSelectors=b.reportModel.getIntervalOptions(),b.selectedInterval={type:""},b.selectedFilters=[],"performanceDetail"==t&&(b.selectedFilters=b.reportModel.determineFiltersFromParam(b,g)),b.filterValues=[],b.selectedFilterValue="",b.filterList=b.reportModel.getFilterList(),b.selectedFilterType="",b.$watch("selectedFilterType",function(a){if(b.selectedFilterValue="",""!==a){var c=_.find(b.filterList,function(b){return b.value==a});if(c.dataCall){b.filterValues=[];var d=o.hasFeature("PREMIUM_PARTNER_INSTANCE")&&o.ConnectAdvertisers[b.selectedNetworkBrand]?o.ConnectAdvertisers[b.selectedNetworkBrand].api_key:"",e=c.dataCall(b,{property:"filterValues",apiKey:d,upstreamNetworkId:b.selectedNetworkBrand});e&&e.success&&(b.loadingFilters=!0,e.success(function(){b.loadingFilters=!1}))}else b.filterValues=!1}else b.filterValues=[{value:"",label:n("reports.filters.defaultChoice.selectFilterType")}]}),r=b.reportModel.getDefinition(),"default"==c.$$path.split("/").pop()){var f,h;f="log"==p?"today":"last_week",h=s.timePresetFunctionMap[f],b.setDateRange({start_date:h.dateStart().format("YYYY-MM-DD"),end_date:h.dateEnd().format("YYYY-MM-DD")},{preset:f})}b.isMobile?l.onDirectivesReady(p+"_mobile",x(p+"_mobile")):l.onDirectivesReady("reportTable",function(){G||_(["performanceDetail","savedReport"]).contains(t)||(b.buildGrid(),G=!0)}),e?(b.currentReport=e,b.populateOptions(b.currentReport),b.isMobile||b.buildGrid()):(b.currentReport=d.get("performanceReportSettings")||b.reportModel.getDefaultReport(),b.populateOptions(b.currentReport))};b.hideAllTime=h.hasFeatures("DATE_RESTRICTION_GETCONVERSIONS")&&"conversion"===t,b.populateChartData=function(a){var c,d,e,f,g,h,i;h=a.scope(),h.chartData={},c={},e=h._params;var j=moment(e.data_start),l=moment(e.data_end);e.data_start==e.data_end?(i="Stat.hour",d=24):l.diff(j,"weeks")>=6?(i="Stat.week",d=l.diff(j,"weeks")):(i="Stat.date",d=l.diff(j,"days")),f={filters:{},fields:{},groups:[i]},f.filters={"Stat.date":{conditional:"BETWEEN",values:[e.data_start,e.data_end]}};for(var m=0;d>=m;m++)c[m]=0;_(e.groups).each(function(a){var b="NULL",c=a.split("."),d=c[0],e=c[1];_(h).hasMembers(d,e)&&(b=h[d][e]||"NULL"),f.filters[a]={conditional:"EQUAL_TO",values:b}}),f.fields=["Stat.conversions","Stat.impressions","Stat.clicks","Stat.payout"];var n=o.hasFeature("PREMIUM_PARTNER_INSTANCE")&&o.ConnectAdvertisers[b.selectedNetworkBrand]?o.ConnectAdvertisers[b.selectedNetworkBrand].api_key:"";g=k.get("Report/getStats",f,n,b.selectedNetworkBrand),g.success(function(a){var b;a=a.data||a,_(f.fields).each(function(a){h.chartData[a]=angular.copy(c)}),_(a).each(function(a){if("Stat.hour"==i)b=a.Stat.hour;else if("Stat.week"==i){var c=a.Stat.week.substring(0,4),d=a.Stat.week.substring(4,6);b=moment().year(c).week(d).diff(j,"weeks")}else b=moment(a.Stat.date,"YYYY-MM-DD").diff(j,"days");_(f.fields).each(function(c){var d=c.split("."),e=d[0],f=d[1];_(a).hasMembers(e,f)&&(h.chartData[c][b]=parseFloat(a[e][f]))})}),_(f.fields).each(function(a){h.chartData[a]=_(h.chartData[a]).values()})})};var x=function(a){return function(){b.onDataCallComplete=function(a,c){b.table.addItems(a,c)},b.table=l.get(a),"performance"==p&&(b.table.paging={count:0,page:1,pageSize:5},b.table.$on("rowRendered",function(a,c){b.populateChartData(c);var d=c.scope();d.activeChart=d.activeChart||"Stat.conversions",d.activeChartLabel="con",d.setActiveChart=d.setActiveChart||function(a){var b={con:"Stat.conversions",imp:"Stat.impressions",clk:"Stat.clicks",pay:"Stat.payout"};d.activeChart=b[a],d.activeChartLabel=a},d.getChartData=d.getChartData||function(){return _(d).hasMembers("chartData",d.activeChart)?d.chartData[d.activeChart]:null}})),E(),b.buildGrid=function(){b.table.clearItems(),E()},b.table.$on("moreItemsRequested",function(){E()})}};b.saveReport=function(a){var c;c={currentReport:b.currentReport,name:b.savedReportName,type:q,filters:b.selectedFilters,dateRange:{start_date:b.getStartDate(),end_date:b.getEndDate(),preset:b.datePicker.getType()}},b.savedReportId>0&&!a&&(c.id=b.savedReportId);var d=o.hasFeature("PREMIUM_PARTNER_INSTANCE")&&o.ConnectAdvertisers[b.selectedNetworkBrand]?o.ConnectAdvertisers[b.selectedNetworkBrand].api_key:"";s.saveReport(c,d,b.selectedNetworkBrand).then(function(){b.addSuccess("saveReportResult","Report Saved Successfully")},function(a){b.addError("saveReportResult",a.errorMessage,a.errorDetails)})},b.setReportTimeline=function(){var a=b.datePicker.getType();b.savedReportTimeline="{0} - {1} (Preset: {2})".format(b.getStartDate(!0).format("MMM. D, YYYY"),b.getEndDate(!0).format("MMM. D, YYYY"),s.getPresetTitle(a))};var y=function(){b.savedReportId=g.id,s.getSavedReport(b.savedReportId).success(function(a){b.setDateRange(a[b.savedReportId].reportData,a[b.savedReportId].SavedReport.data.DateRange),w(a[b.savedReportId].SavedReport.type,a[b.savedReportId].reportData),b.savedReportName=a[b.savedReportId].SavedReport.name})};b.isPerformanceReport=function(){return"performance"==p},b.rowCounts={3:"Top 3 Offers",5:"Top 5 Offers",10:"Top 10 Offers",0:"Offer Totals"},b.downloadReportLink=!1,b.downloadReport=function(){var a=D();a.fields=a.fields.concat(b.determineGroups(a.fields)),delete a.limit,delete a.page;var c=l.get("downloadReportModal");b.downloadReportGenerating=!0,b.downloadReportFailed=!1,c.show();var d=o.hasFeature("PREMIUM_PARTNER_INSTANCE")&&o.ConnectAdvertisers[b.selectedNetworkBrand]?o.ConnectAdvertisers[b.selectedNetworkBrand].api_key:"",e=b.reportModel.getDownloadReportLink(a,d,b.selectedNetworkBrand);e.then(function(a){b.downloadReportLink=a.data,b.downloadReportGenerating=!1}),e.then(angular.noop,function(){b.downloadReportLink=!1,b.downloadReportGenerating=!1,b.downloadReportFailed=!0})},b.togglePanelFn=function(a,c,d){switch(d){case"default":c||"datepicker"!==a?b.datePicker.cancel():b.datePicker.show();break;case"chart-interval":b.panelObj.panelOpen["chart-interval"]=a,b.chartInterval=a,b.buildChart()}},b.hasSelectedFilters=function(){return b.selectedFilters&&_.size(b.selectedFilters)>0},b.addFilter=function(a){b.$parent.clearAlert("filterMessage"),a&&a.preventDefault();var c=!1;if(""===b.selectedFilterType?c="You must select a filter type":""===b.selectedFilterValue&&(c="You must select a filter value"),_.each(b.selectedFilters,function(a){a.entity==b.selectedFilterType&&a.value==b.selectedFilterValue&&(c="Filter already exists")}),c)b.$parent.addError("filterMessage","Error",c);else{var d=b.selectedFilters.length,e=_.find(b.filterValues,function(a){return a.value==b.selectedFilterValue}),f=_.find(b.filterList,function(a){return a.value==b.selectedFilterType});b.filterValues===!1&&(e={label:b.selectedFilterValue}),b.selectedFilters[d]={id:d,entity:b.selectedFilterType,field:f.field?f.field:!1,value:b.selectedFilterValue,label:"{0}: {1}".format(b.selectedFilterType,e.label),matchType:f.matchType||"exact"}}},b.removeFilter=function(a,c){a&&a.preventDefault(),b.selectedFilters=_(b.selectedFilters).reject(function(a){return a.id==c})},b.processUserFilters=function(a){var b={};return _(a).each(function(a){var c=a.field&&!_(["true","false"]).contains(a.field),d=c?a.field:"Stat.{0}_id".format(a.entity.toLowerCase()),e="{0}";b[d]||("exact"===a.matchType?b[d]={conditional:"EQUAL_TO",values:[]}:(b[d]={conditional:"LIKE",values:[]},e="%{0}%")),b[d].values.push(e.format(a.value))}),b},b.populateOptions=function(a){_.each(a.fields,function(a){b.reportOptions[a]=!0}),b.setChartType(null,a.chartType,"chart-type"),b.currentReport.selectedInterval?b.selectedInterval.type=a.intervalType=b.currentReport.selectedInterval:b.selectedInterval.type=a.intervalType,b.togglePanel(null,b.selectedInterval.type,"chart-interval"),b.setRowCount(null,a.rowCount),b.currentReport.selectedMetrics=a.selectedMetrics,b.metricDisplay=b.getSelectedMetricsDisplay(),b.selectedFilters=_.clone(a.selectedFilters||[])},b.$watch("reportOptions.Category",function(a){a&&!u&&b.categoryWarningModal&&(b.categoryWarningModal.show(),u=!0)}),b.setRowCount=function(a,c){a&&a.preventDefault(),b.rowCount=c,e.clearCurrentSet(),b.buildChart()},b.setChartType=function(a,c,d){a&&a.preventDefault(),d=d||"default",b.togglePanel(a,c,d),b.currentReport.chartType=c,b.buildChart()},b.getSelectedMetricsDisplay=function(){return _(b.currentReport.selectedMetrics).map(function(a){return n("reports.options."+b.reportModel.determineNicename(a))}).join(" / ")},b.selectMetric=function(a,c){a&&a.preventDefault();var d=_(b.currentReport.selectedMetrics);if(d.contains(c)){if(1===d.size())return;b.currentReport.selectedMetrics=d.reject(function(a){return a===c})}else b.currentReport.selectedMetrics.push(c);b.metricDisplay=b.getSelectedMetricsDisplay(),b.buildChart()},b.getLineStyleByIndex=function(a){for(var b=["solid","dashed","dotted","dashDot"],c=a;c>=b.length;)c-=b.length;return b[c]},b.metricSelected=function(a){return b.currentReport&&_(b.currentReport.selectedMetrics).contains(a)},b.getStartDate=function(a){if(b.datePicker){var c=b.datePicker.getStartDate();return a?moment(c):c}},b.getEndDate=function(a){if(b.datePicker){var c=b.datePicker.getEndDate();return a?moment(c):c}},b.setDateRange=function(a,c){a.start_date&&a.end_date&&(b.datePicker.setDate(a.start_date,a.end_date,!0),c&&b.datePicker.setType(c.preset),b.setReportTimeline())},b.applyPanelFn=function(a){_(["options","filters"]).contains(a)&&(b.currentReport.fields=_.filterSelected(b.reportOptions),b.currentReport.selectedInterval=b.selectedInterval.type,b.currentReport.selectedFilters=b.selectedFilters,b.buildGrid())},b.processColumns=function(a){var c=b.reportModel.getColumnOrder();return _.chain(a).filter(function(a){return _.contains(c,a)}).sortBy(function(b){var d=_.indexOf(c,b);return-1===d&&(d=a.length),d}).map(function(a){return-1===a.indexOf(".")&&(a=b.reportModel.getNameField(a)),a}).value()},b.determineGroups=function(a,c){var d=[];return _.each(a,function(a){var c=a.split(".");c.length>1&&r.related_entities[c[0]]&&r.related_entities[c[0]].groupable&&d.push(b.reportModel.getIdField(c[0])),_(r.singleFieldGroups).contains(a)&&d.push(a)}),("0"==b.rowCount||"performance"!=p)&&(d=_.reject(d,function(a){return"Stat.offer_id"===a})),!c&&b.groupByInterval&&d.push(b.currentReport.selectedInterval),_.unique(d)},b.getDefaultFilter=function(){return b.processUserFilters(b.currentReport.selectedFilters||{})},b.getHourOffset=function(){return b.datePicker.getTimezoneOffset()},b.getDefinition=function(){return r},b.getColumnModel=function(){var c=m.defer(),d={},e=b.processColumns(b.currentReport.fields),f=$("#reportsColumnSnippets");return b.groupByInterval&&e.unshift(b.currentReport.selectedInterval),_.each(e,function(c){var e="#report_column_{0}".format(c.split(".").join("_").toLowerCase());d[c]={name:b.reportModel.determineNicename(c,r)},f.find(e).length>0?d[c].template=e:_.contains(a.Config.Enums.currencyFields,c)&&(d[c].formatoptions={currencyField:"Stat.currency"})}),d["Stat.currency"]?(d["Stat.payout"]&&(d["@payout"]={name:"Currency Payout",definition:{type:"lookup_currency_payout"}}),(d["Stat.conversion_sale_amount"]||d["Stat.sale_amount"])&&(d["@sale"]={name:"Currency Sale",definition:{type:"lookup_currency_sale"}}),c.resolve(d)):c.resolve(d),c.promise},b.getExtraFields=function(){return _.chain(b.currentReport.fields).filter(function(a){return!_.isUndefined(r.related_entities[a])}).map(function(a){return b.reportModel.getIdField(a)}).value()},b.getDefaultSort=function(){return _.hasMembers(b,"currentReport","defaultSort")?b.currentReport.defaultSort:"Stat.offer_id desc"},b.getDataCall=function(){var a=function(a){var c=o.hasFeature("PREMIUM_PARTNER_INSTANCE")&&o.ConnectAdvertisers[b.selectedNetworkBrand]?o.ConnectAdvertisers[b.selectedNetworkBrand].api_key:"";return b.reportModel.getReportData(a,c,b.selectedNetworkBrand).error(function(a){b.flashError(a.errorMessage)})};return b.reportModel?$.proxy(a,b.reportModel):!1};var z;b.getGridOptions=function(){return"performance"==p?{beforeSelectRow:$.proxy(function(a){e.changeColorState(a)},e)}:{}},b.setGridElement=function(a){z=a,"performance"==p&&z.bind("gridComplete",$.proxy(function(){e.highlightMetrics(),_.each($(".col-name"),function(a){a=$(a),a.height(a.parent().height())})},e))},b.getGridElement=function(){return z},b.buildGrid||(b.buildGrid=a.angular.noop),b.gridDataChange=function(a,c){"performance"==p?b.buildChart(c):"log"==p&&b.fetchConversionSummary()};var A=!0;b.reportSummaryToggle="on",b.toggleReportSummary=function(){b.reportSummaryToggle="on"==b.reportSummaryToggle?"":"on","on"==b.reportSummaryToggle&&(A||b.fetchReportSummaryData())},b.reportSummary={impressions:{total:0,data:null},conversions:{total:0,data:null},clicks:{total:0,data:null},payout:{total:0,data:null},ctr:{total:0,data:null},ltr:{total:0,data:null},erpc:{total:0,data:null}},b.reportSummaryFields=["impressions","conversions","clicks","payout","ctr","ltr","erpc"];var B,C;b.buildChart=function(a){if(a||B){a?B=_.clone(a):a=_.clone(B),C?$(location).html(C):C=$(location).html();var c=moment(b.getStartDate()),d=moment(b.getEndDate());b.getStartDate()==b.getEndDate()?(b.chartInterval="Stat.hour",b.intervalSelectors=b.reportModel.getIntervalOptions()):d.diff(c,"days")>14?(b.chartInterval.indexOf("hour")>-1&&(b.chartInterval="Stat.date"),b.intervalSelectors=_.reject(b.reportModel.getIntervalOptions(),function(a){return a.field.indexOf("hour")>-1})):b.intervalSelectors=b.reportModel.getIntervalOptions(),_(b.reportSummaryFields).each(function(a){b.reportSummary[a].data=null}),A&&b.fetchReportSummaryData(),""!==b.selectedNetworkBrand&&(a.params.NetworkId=b.selectedNetworkBrand),e.buildChart(a,b,"#chart_container")}};var D=function(a){b.table||(b.table={paging:{page:1,pageSize:10}});var c={fields:b.processColumns(b.currentReport.fields),groups:[],sort:{"Stat.datetime":"desc"},filters:b.getDefaultFilter(),data_start:b.getStartDate(),data_end:b.getEndDate(),hour_offset:b.datePicker.getTimezoneOffset(),page:b.table.paging.page,limit:b.table.paging.pageSize};b.isMobile&&("log"==p&&c.fields.push("Stat.datetime"),c.fields.push("Offer.name"),c.fields.push("Stat.offer_id"));var d=_(b.currentReport.fields).filter(function(a){return void 0!==a&&1===a.split(".").length});return _(d).each(function(a){if(void 0!==a){var d=_(c.fields).without(a);d.push(b.reportModel.getIdField(a)),c.fields=d}}),c.fields=_(c.fields).unique(),c.groups=b.determineGroups(c.fields,!!a),c},E=function(){var a=D(!0);b.incrementLoading();var c=o.hasFeature("PREMIUM_PARTNER_INSTANCE")&&o.ConnectAdvertisers[b.selectedNetworkBrand]?o.ConnectAdvertisers[b.selectedNetworkBrand].api_key:"",d=b.reportModel.getReportData(a,c,b.selectedNetworkBrand);d.success(function(c){b.decrementLoading(),b.onDataCallComplete(c,a)}),d.error(function(a){b.flashError(a.errorMessage),b.decrementLoading()})},F=!1;b.userInterval=function(){F=!0},b.dateChange=function(){F===!1&&(b.getStartDate()==b.getEndDate()?(b.panelObj.panelOpen["chart-interval"]="Stat.hour",b.chartInterval="Stat.hour"):"Stat.hour"==b.chartInterval&&(b.panelObj.panelOpen["chart-interval"]="Stat.date",b.chartInterval="Stat.date")),b.setReportTimeline(),b.buildGrid()},b.fetchReportSummaryData=function(){var c,d,e,f,g,h,j=moment(b.getStartDate()),l=moment(b.getEndDate());b.getStartDate()==b.getEndDate()?(d="Stat.hour",h=24):l.diff(j,"weeks")>=6?(d="Stat.week",h=l.diff(j,"weeks")):(d="Stat.date",h=l.diff(j,"days")),A=!0,c={groups:[d],fields:["Stat.conversions","Stat.impressions","Stat.payout","Stat.clicks","Stat.ctr","Stat.ltr","Stat.erpc"],filters:b.getDefaultFilter(),hour_offset:b.datePicker.getTimezoneOffset(),data_start:b.getStartDate(),data_end:b.getEndDate()},c.filters["Stat.date"]={conditional:"BETWEEN",values:[b.getStartDate(),b.getEndDate()]},e=a.angular.copy(c),e.groups=null;var m=o.hasFeature("PREMIUM_PARTNER_INSTANCE")&&o.ConnectAdvertisers[b.selectedNetworkBrand]?o.ConnectAdvertisers[b.selectedNetworkBrand].api_key:"";f=k.get("Report/getStats",e,m,b.selectedNetworkBrand),f.success(function(c){_.each(b.reportSummaryFields,function(d){b.reportSummary[d].total=parseFloat(c.data[0].Stat[d]),i(function(){a.angular.element(".quickstats p").textfill({maxFontPixels:28})})})}),g=k.get("Report/getStats",c,m,b.selectedNetworkBrand),g.success(function(a){_.each(b.reportSummaryFields,function(a){b.reportSummary[a].data=[];for(var c=0;h>=c;c++)b.reportSummary[a].data[c]=0}),_.each(a.data,function(a){var c;if("Stat.hour"==d)c=a.Stat.hour;else if("Stat.week"==d){var e=a.Stat.week.substring(0,4),f=a.Stat.week.substring(4,6);c=moment().year(e).week(f).diff(j,"weeks")}else c=moment(a.Stat.date,"YYYY-MM-DD").diff(b.getStartDate(!0),"days");_.each(b.reportSummaryFields,function(d){b.reportSummary[d].data[c]=parseFloat(a.Stat[d])})})})},b.conversionSummary={},b.conversionSummarySparklines={},b.pendingConversionAccess=!1,b.fetchConversionSummary=function(){b.conversionSummaryLoaded=!1;var c,d,e=moment(b.getStartDate()),f=moment(b.getEndDate()),g=o.getPreferenceValue("affiliate_conversion_access")||"";-1!==g.indexOf("pending")&&(b.pendingConversionAccess=!0),b.getStartDate()==b.getEndDate()?(c="Stat.hour",d=24):f.diff(e,"weeks")>=6?(c="Stat.week",d=f.diff(e,"weeks")):(c="Stat.date",d=f.diff(e,"days"));var h={fields:["Stat.count_approved","Stat.approved_payout"],groups:["Affiliate.company"],filters:b.getDefaultFilter(),hour_offset:b.datePicker.getTimezoneOffset(),data_start:b.getStartDate(),data_end:b.getEndDate()};h.filters["Stat.date"]={conditional:"BETWEEN",values:[b.getStartDate(),b.getEndDate()]},b.pendingConversionAccess&&(h.fields.push("Stat.count_pending"),h.fields.push("Stat.pending_payout"));var j=a.angular.copy(h);k.get("Report/getConversions",j).success(function(c){_.each(h.fields,function(d){d=d.split(".").pop(),_.hasMembers(c,"data",0,"Stat",d)?b.conversionSummary[d]=parseFloat(c.data[0].Stat[d]):b.conversionSummary[d]=0,i(function(){a.angular.element(".quickstats p").textfill({maxFontPixels:28})})})})["finally"](function(){b.conversionSummaryLoaded=!0}),h.groups=[c],k.get("Report/getConversions",h).success(function(a){_.each(h.fields,function(a){a=a.split(".").pop(),b.conversionSummarySparklines[a]=[];for(var c=0;d>=c;c++)b.conversionSummarySparklines[a][c]=0}),_.each(a.data,function(a){var d;if("Stat.hour"==c)d=a.Stat.hour;else if("Stat.week"==c){var f=a.Stat.week.substring(0,4),g=a.Stat.week.substring(4,6);d=moment().year(f).week(g).diff(e,"weeks")}else d=moment(a.Stat.date,"YYYY-MM-DD").diff(b.getStartDate(!0),"days");_.each(h.fields,function(c){c=c.split(".").pop(),b.conversionSummarySparklines[c][d]=parseFloat(a.Stat[c])})})})},b.cancelGridLoad=!0;var G=!1;l.onDirectivesReady(["panelStates","dateRangePicker"],function(){"savedReport"==t?y():w(t),b.setReportTimeline()}),b.onChangeBrand=function(){b.selectedFilterType="",b.buildGrid()}}])}(this),function(a){a.Application.controller("Controllers.savedReports",["$scope","models",function(a,b){var c=b.get("savedReports");c.getSavedReports().success(function(b){_.each(b,function(a){a.dateRangeTitle=c.getPresetTitle(a.SavedReport.data.DateRange.preset)}),a.savedReports=b}),a.defaultDateRange={last_week:"{0} - {1}".format(moment().subtract(7,"days").format("YYYY-MM-DD"),moment().format("YYYY-MM-DD")),today:moment().format("YYYY-MM-DD")},a.deleteReport=function(b){var d=0,e="",f=null;b&&b.SavedReport&&(d=b.SavedReport.id,e=b.SavedReport.name,confirm("Delete "+e+"?")&&(f=c.deleteReport(d),f.success(function(){delete a.savedReports[d],a.flashSuccess(e+" successfully deleted")}),f.error(function(){a.flashError("Could not remove "+e)})))}}])}(this),function(a){a.Application.controller("Controllers.settings",["$scope","$location","currentUser",function(a,b,c){a.hasOptimizationEnabled=c.hasFeatures("OPTIMIZATION"),c.hasFeatures("EMAILNO").then(function(b){"yes"===c.getPreferenceValue("use_alternative_smtp_server")&&c.getPreferenceValue("affiliate_email_notifications")===!0?a.hasEmailNotifications=!0:a.hasEmailNotifications=!1},function(b){a.hasEmailNotifications=!1})}])}(this),function(a){var b=function(b,c,d,e,f,g,h,i,j){b.links={account:{top:[],def:[{href:"/account",route:"/account(.*)",title:"sidebar.utilities.account_details"},{href:"/billing",route:"/(invoice(.*)|billing(.*)|receipt(.*))",title:"sidebar.utilities.billing",features:["ENABLE_LEGACY_BILLING"],preferences:["enable_affiliate_billing"],restrictOnFeatures:["PREMIUM_PARTNER_INSTANCE"]},{route:"/",click:"redirectToTunePay",title:"Payments",preferences:["tunepay_enabled"],customDisplayOverrideCallback:function(){return a&&a.Config&&"1"===a.Config.tunepay_enabled}},{href:"/settings",route:"/settings",title:"sidebar.utilities.settings"}],bottom:[]},offers:{top:[],def:[{href:"/offers",route:"/offers",title:"sidebar.offers.browse",restrictOnFeatures:["PREMIUM_PARTNER_INSTANCE"]},{href:"/offers/my",route:"/offers/my",title:"sidebar.offers.my",restrictOnFeatures:["PREMIUM_PARTNER_INSTANCE"]},{href:"/tuneNetwork/offers",route:"/tuneNetwork/offers",title:"sidebar.offers.browseNetworkOffers",features:["PREMIUM_PARTNER_INSTANCE"]},{href:"/scheduled/changes",route:"/scheduled/changes",title:"sidebar.offers.scheduled",preferences:["enable_scheduled_offer_changes"],restrictOnFeatures:["PREMIUM_PARTNER_INSTANCE"]}],bottom:[]},reports:{top:[],def:[{href:"/performance",route:"/performance(.*)",title:"sidebar.reports.performance"},{href:"/conversion",route:"/conversion(.*)",title:"sidebar.reports.conversion",restrictOnFeatures:["PREMIUM_PARTNER_INSTANCE"]},{href:"/network-conversion-report",route:"/network-conversion-report",title:"sidebar.reports.conversion",features:["PREMIUM_PARTNER_INSTANCE"]},{href:"/referral",route:"/referral",title:"sidebar.reports.referral",preferences:["referral_commissions"]},{href:"/savedReports",route:"/savedReport(.*)",title:"sidebar.reports.saved"},{href:"/network-brand-report",route:"/network-brand-report",title:"sidebar.reports.brand",features:["PREMIUM_PARTNER_INSTANCE"]}],bottom:[]},tools:{top:[],def:[{href:"/tools/adgroups",route:"/tools/adgroups",title:"sidebar.tools.adgroups",preferences:["enable_affiliate_ad_server"],restrictOnFeatures:["PREMIUM_PARTNER_INSTANCE"]},{href:"/tools/mobileapp",route:"/tools/mobileapp",title:"sidebar.tools.mobile_app",features:["AFFMOHO"],preferences:["enable_aff_moho"],restrictOnFeatures:["PREMIUM_PARTNER_INSTANCE"]},{href:"/tools/api-key",route:"/tools/api-key",title:"sidebar.tools.api",permissions:["API"],preferences:["enable_affiliate_api"]},{href:"/tools/pixels",route:"/tools/pixels",title:"sidebar.tools.pixels"}],bottom:[]},tune_network:{top:[],def:[{href:"/tune_network",route:"/tune_network",title:"sidebar.tune_network.brand_directory"},{href:"/tune_network/manage_profile",route:"/tune_network/manage_profile",title:"sidebar.tune_network.manage_profile",features:["NETWORK_PARTNER_PROFILE","PREMIUM_PARTNER_INSTANCE"]},{href:"/tune_network/connection_request",route:"/tune_network/connection_request",title:"sidebar.tune_network.connection_request",features:["PARTNERS_MANAGE_BRAND_REQUESTS","PREMIUM_PARTNER_INSTANCE"]}],bottom:[]}},b.tabs=[{tab:"account",title:"sidebar.tabs.account",usetab:!0,icon:"AccountOutline"},{tab:"offers",title:"sidebar.tabs.offers",usetab:!0,icon:"Offers"},{tab:"reports",title:"sidebar.tabs.reports",usetab:!0,icon:"GraphBar",permissions:["stats"]},{tab:"tools",title:"sidebar.tabs.tools",usetab:!0,icon:"BuildingOutline"},{tab:"tune_network",title:"sidebar.tabs.tune_network",usetab:!0,icon:"TuneNetwork",features:["PREMIUM_PARTNER_INSTANCE","CORE1104_TUNENETWORK_DIRECTORY"]}],b.tabRoutes={account:["/account(.*)","/invoice(.*)","/billing(.*)","/receipt(.*)"],offers:["/offers","/offers/my","/tuneNetwork/offers","/scheduled/changes"],reports:["/performance","/performance(.*)","/conversion","/conversion(.*)","/referral","/savedReport(.*)","/network-conversion-report","/network-brand-report"],tools:["/tools/adgroups","/tools/pixels","/tools/api-key"],tune_network:["/tune_network"]},b.cleanLinks=angular.copy(b.links),b.cleanTabs=angular.copy(b.tabs),b.cleanTabRoutes=angular.copy(b.tabRoutes),b.toggleTab=function(a,c){_.isUndefined(a.respondToClick)&&(a.respondToClick=!0);var e=function(){switch(c.tabState){case"open":a.isOpen=!0,a.isClosed=!1;break;case"close":a.isOpen=!1,a.isClosed=!0;break;default:_.isUndefined(a.isOpen)&&c.uiRoute&&(a.isOpen=!0),a.isOpen=!a.isOpen,a.isClosed=!a.isOpen}a.isOpen&&(a.respondToClick=!1,d(function(){a.respondToClick=!0},500))};_.isUndefined(c.event)||"mouseenter"!==c.event.type&&"mouseover"!==c.event.type?("close"==c.tabState||a.respondToClick===!0)&&(b.cancelTabTimeout(a),e()):a.timer=d(e,250)},b.cancelTabTimeout=function(a){d.cancel(a.timer)},b.collapseTabs=function(a){var c;switch(a){case"sidebarGroups":c=_.rest(b.tabs);break;case"sidebarUtilities":c=[b.tabs[0]];break;default:c=b.tabs}_.each(c,function(a){a.isCurrent?b.toggleTab(a,{tabState:"open"}):b.toggleTab(a,{tabState:"close"})})},b.$on("sidebarMouseleave",function(){b.collapseTabs()}),b.$on("mobileRouteChange",function(){b.collapseTabs("sidebarUtilities")}),b.$on("sidebarToggle",function(){"menu-open"!==b.menuBodyClass&&b.collapseTabs("sidebarUtilities")});var k=function(){b.hasPermission=$.proxy(h.hasPermission,h),b.BrandPrefs=h.BrandPreferences,b.Features=h.Features,b.Manager=h.AccountManager;var a=function(a){a.permissions&&_.each(a.permissions,function(c){b.hasPermission(c)||(a.enabled=!1)}),a.preferences&&_.each(a.preferences,function(c){b.getPreference(c)&&"disabled"!=b.getPreference(c)||(a.enabled=!1),"use_alternative_smtp_server"===c&&"yes"!==b.getPreference(c)&&(a.enabled=!1)}),a.features&&_.each(a.features,function(c){b.hasFeatures(c)||(a.enabled=!1)}),a.restrictOnFeatures&&_.each(a.restrictOnFeatures,function(c){b.hasFeatures(c)&&(a.enabled=!1)}),a.customDisplayOverrideCallback&&a.customDisplayOverrideCallback()&&(a.enabled=!0)};f.get("customPage").getPages().success(function(c){b.links=angular.copy(b.cleanLinks),b.tabs=angular.copy(b.cleanTabs),b.tabRoutes=angular.copy(b.cleanTabRoutes),_(c).each(function(a){var c=a.CustomMenuLink;if("link"==c.type)switch(c.tab){case"ad_manager":case"snapshot":b.links.tools[c.placement].push(c),b.tabRoutes.tools.push("/page/"+c.custom_page_id);break;case"stats":b.links.reports[c.placement].push(c),b.tabRoutes.reports.push("/page/"+c.custom_page_id);break;case"support":b.links.account[c.placement].push(c),b.tabRoutes.account.push("/page/"+c.custom_page_id);break;default:_.isUndefined(b.links[c.tab])&&(b.links[c.tab]={top:[],bottom:[]}),_.isUndefined(b.tabRoutes[c.tab])&&(b.tabRoutes[c.tab]=[]),b.links[c.tab][c.placement].push(c),b.tabRoutes[c.tab].push("/page/"+c.custom_page_id)}else c.icon="FolderOutline",b.tabs.push(c),_.isUndefined(b.tabRoutes[c.title])&&(b.tabRoutes[c.title]=[]),b.tabRoutes[c.title].push("/page/"+c.custom_page_id)}),_.each(b.tabs,function(c){var d=c.usetab?c.tab:c.title;a(c),c.uiRoute=_.isArray(b.tabRoutes[d])?b.tabRoutes[d].join("|"):""}),_.each(b.links,function(b){_.each(b,function(b){_.isArray(b)&&b.sort(function(a,b){if(a.tab!==b.tab){if(a.tab<b.tab)return-1;if(a.tab>b.tab)return 1}return a.position-b.position}),_.each(b,function(b){a(b)})})})})};h.isLoadedDeferred.promise.then(k,a.angular.noop),b.updateMessageCount=function(){},b.updateMessageCountInterval=0,b.updateMessageCountTimeout=0,b.startMessageCountInterval=function(){b.updateMessageCountInterval||(b.updateMessageCountInterval=setInterval(function(){b.$apply(function(){b.updateMessageCount()})},1e4))},b.resetMessageCountTimeout=_.throttle(function(){clearTimeout(b.updateMessageCountTimeout),b.updateMessageCountInterval||b.startMessageCountInterval(),b.updateMessageCountTimeout=setTimeout(function(){clearInterval(b.updateMessageCountInterval)},12e4)},2e3),b.$on("successful_api_call",function(a,c){-1===c.indexOf("Method=getAffiliateUserAlerts")&&b.resetMessageCountTimeout()}),b.$on("http_status_401",function(){clearInterval(b.updateMessageCountInterval)}),b.loggedIn=!1,b.$on("sessionLogin",function(a,c){b.loggedIn=c,c?(b.updateMessageCount(),b.startMessageCountInterval(),b.resetMessageCountTimeout()):delete b.affiliate}),b.logOut=function(){g.logOut()},b.quicksearch="",b.submitQuicksearch=function(){this.quicksearch&&(b.isMobile&&$('[ng-model="quicksearch"]').blur(),c.path("/offers"),c.search({search:this.quicksearch,source:"sidebar"}),this.quicksearch="",e.reload())},b.externalLinkClick=function(a){i.hasFeatures("NONCE")?j.generateNonce().then(function(b){var c=b.data||"",d=a.indexOf("?")>=0?"&":"?";window.location.href=a+d+"nonce="+c},function(a){console.log("Error generating Nonce")}):window.location.href=a},b.redirectToTunePay=function(){window.open(window.location.origin+"/users/tunepay_partner_login","_blank")}};b.$inject=["$scope","$location","$timeout","$route","models","hasSession","currentUser","$rootScope","nonceService"],a.Application.controller("Controllers.sidebar",b)}(this),function(a){a.Application.controller("Controllers.startPage",["$scope","$location","currentUser",function(a,b,c){c.checkPreference("enable_affiliate_start",!0).then(function(){var a=c.getPreferenceValue("affiliate_start_url"),d=/(http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/;(0===String(a).length||d.test(a))&&(a=c.hasFeature("PREMIUM_PARTNER_INSTANCE")?"/tuneNetwork/offers":"/dashboard"),b.path(a)},function(){c.hasFeature("PREMIUM_PARTNER_INSTANCE")?b.path("/tuneNetwork/offers"):b.path("/dashboard");
})}])}(this),function(a){a.Application.controller("Controllers.table",["$scope","$element","$location","$rootScope","sessionStorageService","$timeout","$translate",function(b,c,d,e,f,g,h){var i,j,k,l,m={sessionStorageService:f,$scope:b,$rootScope:e,$location:d,dataCall:null,pager:"#{0}_pager".format(b.gridName),definition:null,defaultSort:null,columnTitles:!1,noPageHistory:!0},n=function(a){_.isFunction(b.gridDataChange)&&(k=b.gridDataChange),_.isFunction(b.getGridOptions)&&(m.gridOptions=b.getGridOptions()),_.isFunction(b.onGridComplete)&&(l=b.onGridComplete),a&&a.preventDefault(),b.fetchingData=!0,e.incrementLoading(),m.dataCall=b.getDataCall(),m.definition=b.getDefinition(),m.defaultSort=b.getDefaultSort(),_(b.getHourOffset).isFunction()&&(m.hour_offset=b.getHourOffset()),j?c.html(j):j=c.html(),i=c.find("table.jqgrid"),_.isFunction(b.setGridElement)&&b.setGridElement(i),_.isFunction(b.getDefaultAlign)&&i.addClass(b.getDefaultAlign);var d=function(){b.fetchingData=!1,e.decrementLoading(),p()};k&&i.bind("gridDataChange",$.proxy(k,b)),l&&i.bind("gridComplete",$.proxy(l,b)),i.bind("gridComplete",$.proxy(d,b)),_.isFunction(b.getDefaultFilter)&&(m.defaultFilter=b.getDefaultFilter()),_.isFunction(b.getDefaultContainParams)&&(m.defaultContainParams=b.getDefaultContainParams());b.getColumnModel().then(function(a){var c=_.reduce(a,function(a,b,c){return a[c]=b,a[c].name=h("reports.options."+b.name),a},{});_.extend(m,{columns:c,groupBy:_.isFunction(b.determineGroups)?b.determineGroups(_.keys(c)):"",extraFields:_.isFunction(b.getExtraFields)?b.getExtraFields():{}}),_.isFunction(b.getStartDate)&&(m.startDate=b.getStartDate(),m.endDate=b.getEndDate()),m.ignoreUndefined=b.gridIgnoreUndefined,i.grid(m)})};b.$parent.buildGrid==a.angular.noop&&(b.$parent.buildGrid=n),b.triggerResize=function(){_.isUndefined(i)||i.jqGrid("setGridWidth",c.width())},b.generateTable=n,b.triggerInitialGridLoad=function(){b.cancelGridLoad||b.generateTable()},b.gridPageNumrows=20,b.gridPageNumrowOptions=[10,20,50,100,200],b.gridPageSetNumrows=function(a,c){a&&a.preventDefault(),b.gridPageNumrows!==c&&(b.gridPageNumrows=c,i.jqGrid("setGridParam",{rowNum:b.gridPageNumrows}),r(1),b.isInModal&&i.parents("jq-grid").find(".grid-pagination").find(".grid-page-numrows").text(b.gridPageNumrows))};var o=0,p=function(){g(function(){b.gridPageTotal=i.jqGrid("getGridParam","lastpage"),b.gridPageCurrent=i.jqGrid("getGridParam","page"),o=b.gridPageCurrent,t(c.find(".grid-pagination")),s()})},q=function(){b.gridPageTotal=1,b.gridPageCurrent=1,s()},r=function(a){b.fetchingData=!0,e.incrementLoading(),i.trigger("reloadGrid",[{page:a}])},s=function(){if(b.isInModal){var a=i.parents("jq-grid").find(".grid-pagination");t(a)}},t=function(a){a.find("a").unbind("click"),a.find(".grid-page-prev").bind("click.pagination",b.gridPrevPage),a.find(".grid-page-next").bind("click.pagination",b.gridNextPage),a.find(".dropdown-menu a").bind("click.pagination",function(a){a.preventDefault();var c=$(a.currentTarget).data("val");b.gridPageSetNumrows(a,c)}),a.find(".grid-page-input").val(b.gridPageCurrent),a.find(".grid-page-total").text(b.gridPageTotal),a.find(".grid-page-numrows").text(b.gridPageNumrows),"disabled"==b.gridPageNextDisabled()?a.find(".grid-page-next").addClass("disabled"):a.find(".grid-page-next").removeClass("disabled"),"disabled"==b.gridPagePrevDisabled()?a.find(".grid-page-prev").addClass("disabled"):a.find(".grid-page-prev").removeClass("disabled")};q(),b.gridPageNextDisabled=function(){var a=!1;return 0===_.min([b.gridPageTotal,b.gridPageCurrent])?a=!0:b.gridPageCurrent==b.gridPageTotal&&(a=!0),a?"disabled":""},b.gridUpdatePage=function(){o!==b.gridPageCurrent&&r(b.gridPageCurrent)},b.gridPagePrevDisabled=function(){var a=!1;return(0===b.gridPageTotal||b.gridPageCurrent<2)&&(a=!0),a?"disabled":""},b.gridPrevPage=_.throttle(function(a){a&&a.preventDefault(),"disabled"!=b.gridPagePrevDisabled()&&(b.gridPageCurrent--,r(b.gridPageCurrent))},280),b.gridNextPage=_.throttle(function(a){a&&a.preventDefault(),"disabled"!=b.gridPageNextDisabled()&&(b.gridPageCurrent++,r(b.gridPageCurrent))},280)}])}(this),function(a){a.Application.controller("Controllers.unsubscribe",["$scope","currentUser","models",function(a,b,c){var d;c.get("notifications").getNotifications(b.AffiliateUser.id).success(function(a){d=a}).error(function(){a.$broadcast("alertSettingsChanged",{success:!1})}),a.wasEnabled=function(a){var b=!1;return _.each(d,function(c){parseInt(c,10)===a&&(b=!0)}),b}}])}(this),function(a){a.Application.controller("Controllers.userDetails",["$scope","$routeParams","currentUser","$location","models","$q","$timeout",function(b,c,d,e,f,g,h){var i=f.get("affiliateUser");b.userDetails=a.angular.copy(d.AffiliateUser),b.editMode=!1,b.userDetailsLoading=!1,b.currentUserLoading=a.angular.copy(d.loading),b.currentUser=d,b.userDetails.wantsEmail=_(d.UserPreferences.disable_mail_room_email).isNull()||!d.UserPreferences.disable_mail_room_email,b.isSelf=_(c.id).isUndefined()||c.id==a.Config.affiliate_user_id;var j=function(a){b.userDetails.wantsEmail=_(d.UserPreferences.disable_mail_room_email).isNull()||!d.UserPreferences.disable_mail_room_email,b.editMode=a};d.loading&&b.$on("UserLoaded",function(e){e&&(c.id&&c.id!==a.Config.affiliate_user_id||(b.userDetails=a.angular.copy(d.AffiliateUser)),b.currentUserLoading=!1)}),b.loadUserDetails=function(a){var c=i.get(a);b.userDetailsLoading=!0,c.success(function(a){b.userDetailsLoading=!1,b.userDetails=a.AffiliateUser}),c.error(function(){b.flashError("You do not have access to view that user or the user does not exist."),e.path("/account")})},b.auth.cleanPermissionNames=[{name:"Reporting",field:"Affiliate.stats"},{name:"Offer Management",field:"Affiliate.offer_management"},{name:"User Management",field:"Affiliate.user_management"},{name:"Account Management",field:"Affiliate.account_management"},{name:"API Access",field:"Affiliate.API"}],b.auth.hasPermission=function(a){return _(b.userDetails.access).contains(a)},b.auth.canEditPermissions=function(){var c=b.userDetails.id==a.Config.affiliate_user_id;return d.hasPermission("user_management")&&!c},b.auth.togglePermission=function(a){var c=_.indexOf(b.userDetails.access,a);-1!==c?b.userDetails.access.splice(c,1):b.userDetails.access.push(a)},b.toggleUserDetailsEdit=function(){j(!b.editMode)},b.cancelUserDetailsEdit=function(){j(!1),e.path("/account")},b.saveUserDetails=function(){var a={id:b.userDetails.id,data:{first_name:b.userDetails.first_name||"",last_name:b.userDetails.last_name||"",title:b.userDetails.title||"",email:b.userDetails.email,phone:b.userDetails.phone||"",cell_phone:b.userDetails.cell_phone||""}},c=[];b.auth.canEditPermissions()&&c.push(i.setPermissions(a.id,b.userDetails.access)),b.isSelf&&c.push(d.setPreferenceValue("disable_mail_room_email",b.userDetails.wantsEmail?0:1));var e=i.update(a);c.push(e),b.userDetailsLoading=!0,e.then(function(a){b.$parent.$broadcast("userUpdated");var c=a.data;b.isSelf&&(c.AffiliateUser.wantsEmail=b.userDetails.wantsEmail),h(function(){b.userDetails=c.AffiliateUser})}),g.all(c).then(function(){b.userDetails.id===d.AffiliateUser.id&&d.refresh(),b.addSuccess("userDetails","User updated successfully!"),b.userDetailsLoading=!1,j(!1)})},b.validPassword=function(){return i.isValidPassword(b.userDetails.password)},b.confirmPassword=function(){return b.userDetails.password_confirm===b.userDetails.password},b.updatePassword=function(){b.validPassword()&&b.confirmPassword()&&(b.userDetailsLoading=!0,i.update({data:{password:b.userDetails.password},id:b.userDetails.id}).success(function(){delete b.userDetails.password,delete b.userDetails.password_confirm,b.userDetailsLoading=!1}))};var k=function(){d.hasPermission("user_management")||b.isSelf||(b.flashError("You do not have permissions to edit that user."),e.path("/account"))};!function(){_.isUndefined(c.id)||(d.loading?b.$on("UserLoaded",function(){k()}):k(),c.id!=a.Config.affiliate_user_id&&b.loadUserDetails(c.id))}()}])}(this),function(a){a.Application.directive("advancedTargetingBody",["directiveRegistry",function(a){return{restrict:"A",controller:["$scope","$element","$attrs",function(b,c,d){d.name&&a.register(b,d.name),b.render=function(a){_(a).each(function(b,d){_(b.rulesFiltered).each(function(e,f,g){var h,i,j=$("<tr>").appendTo(c).addClass(d%2===0?"even":"odd").attr("data-rule-id",b.id),k=$("<td />").text(e.key).addClass("variable"),l=$("<td />").text(e.value).addClass("value");j.append(k),j.append(l),d===a.length-1&&j.addClass("set-last"),f===g.length-1&&j.addClass("last"),0===f&&(j.addClass("first"),h=$("<td />").text(b.action).addClass("type").attr("rowspan",g.length),i=$("<td />").text(b.rule.description).addClass("note").attr("rowspan",g.length),j.prepend(h),j.append(i))})}),c.on("mouseenter","tr",function(){$(this).siblings("[data-rule-id="+$(this).attr("data-rule-id")+"]").andSelf().addClass("hover")}).on("mouseleave","tr",function(){$(this).siblings("[data-rule-id="+$(this).attr("data-rule-id")+"]").andSelf().removeClass("hover")})}}]}}])}(this),function(a){a.Application.directive("clickOutside",["$document",function(a){return{restrict:"A",scope:{clickOutside:"&"},link:function(b,c,d){a.on("click",function(a){c===a.target||c[0].contains(a.target)||b.$apply(function(){b.$eval(b.clickOutside)})})}}}])}(this),function(a){var b=function(){if(_.isObject(a.Config.txl_theme_information)){var b=a.Config.txl_theme_information;return{1:b.header_background_color,2:b.header_text_color,3:b.hover,4:b.accent,5:b.hover,6:b.color100,7:b.accent}}return{1:"#FFF",2:"#20252D",3:"#0252C6",4:"#007AFF",5:"#0252C6",6:"#D4EDFF",7:"#007AFF"}};a.Application.directive("customStyle",["$compile","$http","$q","directiveRegistry",function(a,c,d,e){var f=function(a,b){var c=/rgba\(0,\s*0,\s*([1-7]),\s*0\.001\)/g;return b=b.replace(c,function(b,c){return a[c]})};return{restrict:"E",link:function(g,h){var i=c.get("css/theme.css").then(function(a){return a.data},function(a){console.log("error loading css theme",a)}),j=d.all([i]);j.then(function(c){var d=f(b(),c[0]),e=a("<style>"+d+"</style>");h.replaceWith(e(g)),g.$emit("themeLoaded")},function(){var b=a('<link rel="stylesheet" href="css/theme-13.css" />');h.replaceWith(b(g)),g.$emit("themeLoaded")}),e.register(g,"customStyle")}}}])}(this),function(a){var b=function(a,b){var c='<option value="{0}">{1} {2}</option>',d=[];_(a.getTimezones()).each(function(a){var b=c.format(a.keyword,a.gmt,a.location);d.push(b)}),b.empty().append(d.join("")).val(a.getTimezone()).prop("disabled",!1)};a.Application.directive("dateRangePicker",["sessionStorageService","garbageCollection","$q","$translate","directiveRegistry","models","geographic","$rootScope","$timeout",function(c,d,e,f,g,h,i,j,k){var l=Class.extend({rangeSplit:"to",format:"yyyy-MM-dd",namespace:"default",nsSettings:{"default":{defaultRange:["today-6days","today"],defaultType:"last_week"},performance:{defaultRange:["today-6days","today"],defaultType:"last_week"},conversion:{defaultRange:["today","today"],defaultType:"today"},savedReport:{defaultRange:["today-6days","today"],defaultType:"last_week"},logs:{defaultRange:["today","today"],defaultType:"today"}},settings:{change:a.angular.noop,close:a.angular.noop,target:"#date-range",onOpen:null},locale:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sun"],daysMin:["Su","Mo","Tu","We","Th","Fr","Sa","Su"],months:[f("common.calendar.month.long.january"),f("common.calendar.month.long.february"),f("common.calendar.month.long.march"),f("common.calendar.month.long.april"),f("common.calendar.month.long.may"),f("common.calendar.month.long.june"),f("common.calendar.month.long.july"),f("common.calendar.month.long.august"),f("common.calendar.month.long.september"),f("common.calendar.month.long.october"),f("common.calendar.month.long.november"),f("common.calendar.month.long.december")],monthsShort:[f("common.calendar.month.short.jan"),f("common.calendar.month.short.feb"),f("common.calendar.month.short.mar"),f("common.calendar.month.short.apr"),f("common.calendar.month.short.may"),f("common.calendar.month.short.jun"),f("common.calendar.month.short.jul"),f("common.calendar.month.short.aug"),f("common.calendar.month.short.sep"),f("common.calendar.month.short.oct"),f("common.calendar.month.short.nov"),f("common.calendar.month.short.dec")],weekMin:"wk"},current:null,last:null,el:null,elDisplay:null,open:!1,rangeType:"last_week",rangeTypes:h.get("savedReports").timePresetFunctionMap,populateTimezones:function(){var a,c=this;a=$("#"+c.settings.containerId).parents(".datepicker-wrapper").find(".datepicker-timezone-select"),this.tzElement=a,i.loaded&&b(i,a),j.$on("geoInfoLoaded",function(){b(i,a)})},cancel:function(){this.el.parent().DatePickerHide()},show:function(){this.el.parent().DatePickerShow()},init:function(b,d){var e,f,g,h,i;if(e=this,b=b||{},d=d||"default",e.namespace!=d&&(e.current=null),e.namespace=d,e.settings.target="#date-range",e.settings.defaultRange=_.clone(e.nsSettings[d].defaultRange),e.settings.defaultType=_.clone(e.nsSettings[d].defaultType),e.toolTipPref=[],$.extend(e.settings,{currentDate:this.current},b),e.settings.currentDate==e.current?e.settings.rangeType=e.rangeType:e.settings.rangeType="date_range",e.el=$(e.settings.target),e.elDisplay=$(e.settings.target+"-display"),0!==e.el.length){if(e.el.blur(function(){e.open||e.triggerChange()}),this.settings.timeframe)this.settings.timeframe.type||(this.settings.timeframe.type="last_week"),f=this.settings.timeframe.type,"date_range"==f?(g=Date.parse(e.settings.timeframe.start_date),h=Date.parse(e.settings.timeframe.end_date)):(g=e.rangeTypes[f].dateStart(),h=e.rangeTypes[f].dateEnd()),i=g.toString(e.format)+" "+e.rangeSplit+" "+h.toString(e.format);else if(e.settings.currentDate)i=e.settings.currentDate,f="date_range";else{var j=c.get("hasDateRangeObj.{0}".format(e.namespace));j?(j=JSON.parse(j),i=j.dateRange,f=j.rangeType):(f="last_week",i=Date.parse(e.settings.defaultRange[0]).toString(e.format)+" "+e.rangeSplit+" "+Date.parse(e.settings.defaultRange[1]).toString(e.format))}e.current=e.last=i,e.rangeType=f,c.add("hasDateRangeObj.{0}".format(e.namespace),JSON.stringify({dateRange:e.current,rangeType:e.rangeType})),e.el.val(e.current),e.setDisplay(),_.each(e.el,function(b,c){var d,f=$(b).parent(),g={},h=e.getType();d=function(){var a,b;if(b=new Date(Date.parse(g.endInput.val(),e.format).setHours(23,59,59,0)),a=Date.parse(g.startInput.val(),e.format),a>b){var c=[b,a];a=c[0],b=c[1]}return{start:a,end:b}};var i=function(a){a&&a.preventDefault();var b=f.DatePickerGetDate();if(g.startInput&&g.endInput){var c=d();(b[0]!=c.start||b[1]!=c.end)&&f.DatePickerSetDate([c.start,c.end],!0)}},j=function(a){var b=d();e.setStartDate(b.start.toString(e.format)),e.setEndDate(b.end.toString(e.format)),e.setType(h),e.triggerChange(),k(a)},k=function(a){a&&a.preventDefault(),f.DatePickerHide(),e.settings.close(a,e.settings)},l=function(a){a&&a.preventDefault();var b=$(a.currentTarget).data("preset"),c=e.rangeTypes[b];h=b,g.startInput.val(c.dateStart().format("YYYY-MM-DD")),g.endInput.val(c.dateEnd().format("YYYY-MM-DD")).trigger("change")};b=$(b),f.DatePicker({id:e.settings.containerId,flat:!0,date:[e.getStartDate(),e.getEndDate()],current:a.Date.today().toString(e.format),format:e.format,calendars:3,mode:"range",starts:1,position:c,parentContainer:e.settings.parentContainer||null,locale:e.locale,onChange:function(a){g.startInput.val()!=a[0]&&g.startInput.val(a[0]),g.endInput.val()!=a[1]&&g.endInput.val(a[1]),h="custom"},onHide:function(){g.wrapper.removeClass("on")},onShow:function(){e.open=!1,g.startInput.val(e.getStartDate()),g.endInput.val(e.getEndDate()).trigger("change"),g.wrapper.addClass("on"),_.isFunction(e.settings.onOpen)&&e.settings.onOpen()},onComplete:function(){e.populateTimezones(),g.picker=$("#{0}".format(e.settings.containerId)),g.wrapper=g.picker.parents(".datepicker-wrapper"),g.startInput=g.wrapper.find(".datepicker-input-start"),g.endInput=g.wrapper.find(".datepicker-input-end"),g.startInput.bind("change",i),g.endInput.bind("change",i),g.wrapper.find("a.apply").click(j),g.wrapper.find("a.cancel").click(k),g.wrapper.find(".datepicker-preset").click(l),g.wrapper.find(".panel-container").hover(function(a){e.settings.scope.hoverPanel(a,"panel-display")}),g.startInput.bind("click",function(){f.DatePickerSetActiveInput("first")}),g.endInput.bind("click",function(){f.DatePickerSetActiveInput("second")})}})}),e.setDateTooltip(e.current),$(".preset_0").trigger("click",!0)}},setDateTooltip:function(a){var b=this;b.el.length>0&&_.each(b.el,function(c,d){$(c).hasClass("btn-date")&&(b.toolTipPref[d]?b.toolTipPref[d].message=a:b.toolTipPref[d]=$(c).hasTooltip({message:a,parent:$(c).parent(),padding:{left:17,top:10}}))})},triggerChange:function(){var a,b;a=this,a.open=!1,a.current=a.el.val(),a.lastOffset=a.lastOffset||"";var d=a.getTimezoneOffset();(a.current!=a.last||a.lastOffset!=d)&&(a.last=a.current,a.lastOffset=d,a.setDate(),a.el.val(a.current),b=JSON.stringify({dateRange:a.current,rangeType:a.rangeType}),c.add("hasDateRangeObj.{0}".format(a.namespace),b),a.settings.change(),a.setDateTooltip(a.current),a.setDisplay())},setDisplay:function(){var a=this.parseDate(this.getStartDate()),b=this.parseDate(this.getEndDate());this.elDisplay.text("{0} - {1}".format(this.locale.monthsShort[a.toString("M")-1]+" "+a.toString("d, yyyy"),this.locale.monthsShort[b.toString("M")-1]+" "+b.toString("d, yyyy")))},getStartDate:function(){return $.trim(this.current.split(this.rangeSplit)[0])},getEndDate:function(){var a=this.current.split(this.rangeSplit);return a.length>1?$.trim(a[1]):$.trim(a[0])},getTimezoneOffset:function(){var a=i.getTimezone(),b=this.tzElement.val()||a;return i.loaded?(b!=a&&i.setUserTimezone(b),i.getTimezones()[b].hour_offset):"+0"},getSelectedTimezone:function(){return this.tzElement?i.getTimezones()[this.tzElement.val()]:null},setStartDate:function(a){this.setDate(Date.parse(a),null),this.el.val(this.current)},setEndDate:function(a){this.setDate(null,Date.parse(a)),this.el.val(this.current)},setDate:function(a,b,c){var d=_.isNull(a)||_.isNull(b);if(a=a||Date.parse(this.getStartDate()),b=b||Date.parse(this.getEndDate()),!d&&a>b){var e=a;a=b,b=e}this.current=a.toString(this.format)+" "+this.rangeSplit+" "+b.toString(this.format),c&&this.setDisplay()},parseDate:function(a){return Date.parse(a,this.format)},setType:function(a){var b=JSON.stringify({dateRange:this.current,rangeType:a});this.rangeType=a,c.add("hasDateRangeObj.{0}".format(this.namespace),b)},getType:function(){return this.rangeType}});return{restrict:"E",templateUrl:"datePicker.html",transclude:!0,link:function(b,c,e){var f,h,i;b.datepickerRangeOptions||(b.datepickerRangeOptions={today:!0,yesterday:!0,lastThreeDays:!1,lastWeek:!0,lastFourteenDays:!1,thisMonth:!0,lastMonth:!0,lastThirtyDays:!1,lastSixtyDays:!1,lastSixMonths:!0,thisYear:!0,lastYear:!0,allTime:!0}),b.dateRangeId=_.uniqueId("date-range-"),f=e.namespace||"default",_.isFunction(b.getDatepickerNamespace)&&(f=b.getDatepickerNamespace()),h=function(){var c=b[e.changefn]||a.angular.noop;$.proxy(c,b)()},i=function(a,c){b.$apply(function(){b.$parent.applyPanel(a,c.ns)})};var j=function(){var a,j;a=b.dateRangeId+"-container",j={scope:b,target:"#"+b.dateRangeId,change:h,close:i,containerId:a,ns:f},e.parentContainer&&(j.parentContainer=e.parentContainer),e.onOpen&&_.isFunction(b.$parent[e.onOpen])&&(j.onOpen=b.$parent[e.onOpen]),c.find(".datepicker-controls .apply").click(function(a){b.$parent.applyPanel(a,f)}),b.$parent.datePicker=new l(j,f),d.add("#"+a),b.$apply(function(){b.directivesReady=b.directivesReady||[],b.directivesReady.push("dateRangePicker"),g.register(b,e.name||"dateRangePicker")})};k(j)}}}])}(this),function(a){a.Application.directive("donuts",["$rootScope","directiveRegistry","$translate",function(b,c,d){return{templateUrl:"partials/chartTemplates/donuts.html",restrict:"E",transclude:!0,"replace ":!0,scope:{items:"=",titlelabel:"=",popularity:"="},link:function(b,e,f){var g,h,i,j,k,l,m={color:"#2585c7",fillcolor:"#CBDFEC"};h=e.find(".chart"),l=e.find(".status"),j=e.find(".textlabel"),k={backgroundColor:f.backgroundcolor||"",color:f.color||m.color,fillColor:f.fillcolor||m.fillcolor,loadingText:f.loadingText||d("common.loading").toUpperCase(),noDataText:f.noDataText||d("common.no_data").toUpperCase()};var n=b.popularity.split("."),o='<div style="color:'+k.color+';"><span style="font-size: 45px; font-weight: 700; float:left;">'+n[0]+"</span>";parseInt(n[0],10)<10&&(o+='<span style="font-size: 25px; font-weight: 700; display: block; float: right; line-height: 40px;">.'+n[1]+"</span>"),o+="</div>",i={chart:{type:"pie",margin:[0,0,0,0],plotBackgroundColor:k.backgroundColor,renderTo:h[0],reflow:!0},colors:[k.color,"#CFCFCF"],title:{useHTML:!0,text:o,align:"center",verticalAlign:"middle",y:-10,color:k.color},plotOptions:{pie:{dataLabels:{enabled:!1},startAngle:0,endAngle:360}},legend:{enabled:!1},tooltip:{enabled:!1},series:[{innerSize:"80%",data:b.items}]};var p=function(){g=new a.Highcharts.Chart(i),b.$watch("items",function(a){l.text(k.loadingText),0===a.length?(l.text(k.noDataText),e.addClass("no-data"),h.hide(),j.hide(),l.show()):(l.hide(),j.show(),h.show(),g.series[0].setData(a),g.setSize(h.width(),h.height(),!1),g.hasUserSize=null)},!0)};p(),f.name&&c.register(b,f.name)}}}])}(this),function(a){a.Application.directive("dotlinechart",["$rootScope","directiveRegistry","$translate",function(b,c,d){return{templateUrl:"partials/chartTemplates/dotlineChart.html",restrict:"E",transclude:!0,"replace ":!0,scope:{items:"="},link:function(b,e,f){var g,h,i,j,k,l,m={color:"#2585c7",fillcolor:"#CBDFEC"};h=e.find(".chart").hide(),l=e.find(".status"),j=e.find(".textlabel"),k={backgroundColor:f.backgroundcolor||"",color:f.color||m.color,fillColor:f.fillcolor||m.fillcolor,loadingText:f.loadingText||d("common.loading").toUpperCase(),noDataText:f.noDataText||d("common.no_data").toUpperCase()},i={chart:{margin:[10,30,40,30],plotBackgroundColor:k.backgroundColor,renderTo:h[0],type:"area",reflow:!0},plotOptions:{line:{dataLabels:{enabled:!1},enableMouseTracking:!1},series:{fillColor:k.fillColor,lineWidth:1.3,shadow:!0,states:{hover:{lineWidth:1.7}},marker:{enabled:!1,states:{hover:{enabled:!1}}}}},xAxis:{tickInterval:14,labels:{staggerLines:1,x:30,y:15},lineWidth:0},yAxis:{lineWidth:1},legend:{enabled:!1},tooltip:{enabled:!0,formatter:function(){return"Popularity on "+this.x+" : <b>"+parseFloat(this.y).toFixed(2)+"</b><br/>"}},series:[{color:k.color,data:b.items}]},void 0!==f.grid&&(i.xAxis.gridLineWidth=1,i.xAxis.gridLineColor="#ededed",i.xAxis.tickPixelInterval=15,i.xAxis.endOnTick=!0,i.xAxis.startOnTick=!0,i.yAxis.gridLineWidth=1,i.yAxis.gridLineColor="#ededed",i.yAxis.tickPixelInterval=15,i.yAxis.endOnTick=!0,i.yAxis.startOnTick=!0);var n=function(a){if(h.is(":visible")){var b=g.xAxis[0].getExtremes(),c=g.yAxis[0].getExtremes();g.xAxis[0].setExtremes(b.dataMin-b.dataMax/4,b.dataMax),g.yAxis[0].setExtremes(c.dataMin-c.dataMax/8,c.dataMax),g.xAxis[0].setCategories(a),j.show()}},o=function(){g=new a.Highcharts.Chart(i),b.$watch("items",function(a){if(l.text(k.loadingText),!_.isArray(a))return l.show(),void h.hide();var b=_(a).chain().find(function(a){return 0!==a}).isUndefined().value();if(0===a.length||b)l.text(k.noDataText),e.addClass("no-data"),h.hide(),j.hide(),l.show();else{l.hide(),j.show(),h.show();var c=_.pluck(a,"value"),d=_.pluck(a,"date");h.is(":visible")?n(d):g.xAxis[0].setCategories(d),g.series[0].setData(c),g.setSize(h.width(),h.height(),!1),g.hasUserSize=null}},!0)};o(),f.name&&c.register(b,f.name)}}}])}(this),function(a){a.Application.directive("ngFocus",["$parse",function(a){return function(b,c,d){var e=a(d.ngFocus);c.bind("focus",function(a){b.$$phase||b.$apply(function(){e(b,{$event:a})})})}}]),a.Application.directive("ngBlur",["$parse",function(a){return function(b,c,d){var e=a(d.ngBlur);c.bind("blur",function(a){b.$$phase||b.$apply(function(){e(b,{$event:a})})})}}]),a.Application.directive("ngHover",["$parse",function(a){return function(b,c,d){var e=a(d.ngHover);c.bind("hover",function(a){b.$$phase||b.$apply(function(){e(b,{$event:a})})})}}]),a.Application.directive("ngEnterkey",["$parse",function(a){return function(b,c,d){var e=a(d.ngEnterkey);c.bind("keydown",function(a){13===a.which&&b.$apply(function(){e(b,{$event:a})})})}}])}(this),function(a){a.Application.directive("fileSelect",["$parse",function(a){return{scope:{fileSelect:"="},link:function(a,b,c){b.bind("change",function(){a.$apply(function(){a.fileSelect=b[0].files[0]})})}}}])}(this),function(a){var b=function(){var a=angular.element(this).fileupload("option","scope")();a.$$phase||a.$apply()},c={handleResponse:function(a,b){var c=b.result&&b.result.files;c?b.scope().replace(b.files,c):(b.errorThrown||"error"===b.textStatus)&&(b.files[0].error=b.errorThrown||b.textStatus)},add:function(a,b){var c=b.scope();b.process(function(){return c.process(b)}).always(function(){var a=b.files[0]||{};a.formData=b.formData;var d=function(){return a.submitted=!0,b.submit()};a.$cancel=function(){return c.clear(b.files),b.abort()},a.$state=function(){return b.state()},a.$progress=function(){return b.progress()},a.$response=function(){return b.response()},"rejected"===a.$state()?a._$submit=d:a.$submit=d,c.$timeout(function(){var a=c.option("prependFiles")?"unshift":"push";Array.prototype[a].apply(c.queue,b.files)})})},progress:function(a,b){b.scope().$apply()},done:function(a,b){var c=b.files[0],d=this;c.done=!0,b.scope().$apply(function(){b.handleResponse.call(d,a,b)})},fail:function(a,b){var c=this;if("abort"!==b.errorThrown){if(new RegExp(/^json/).test(b.dataType))try{b.result=angular.fromJson(b.jqXHR.responseText)}catch(d){}b.scope().$apply(function(){b.handleResponse.call(c,a,b)})}},submit:function(a,b){var c=b.files[0];c.done=!1,c.error=null},getNumberOfFiles:function(){return this.scope().queue.length},stop:b,processstart:b,processstop:b,dataType:"json",prependFiles:!0,autoUpload:!1};a.Application.directive("fileUploadProgress",function(){return{restrict:"A",replace:!1,scope:{fileUploadProgress:"=",file:"="},link:function(a,b){var c=function(){var b=a.fileUploadProgress;b&&b.total&&(a.num=Math.floor(b.loaded/b.total*100))};c(),a.$watch("file",function(a){a.$progress?b.show():b.hide()}),a.$watch("fileUploadProgress.loaded",function(a,b){a!==b&&c()})}}}),a.Application.directive("fileupload",["directiveRegistry","$timeout",function(b,d){return{templateUrl:"partials/fileupload.html",restrict:"E",transclude:!0,"replace ":!0,scope:{hideControls:"=",options:"="},link:function(e,f,g){a.dirScope=e,e.options=_(c).extend(e.options),e.$timeout=d;var h={progress:function(){return f.fileupload("progress")},active:function(){return f.fileupload("active")},option:function(a,b){return f.fileupload("option",a,b)},add:function(a){return f.fileupload("add",a)},send:function(a){return f.fileupload("send",a)},process:function(a){return f.fileupload("process",a)},processing:function(a){return f.fileupload("processing",a)}};e.disabled=angular.element('<input type="file">').prop("disabled"),e.queue=e.queue||[],e.clear=function(a){var b=this.queue,c=b.length,d=a,e=1;for(angular.isArray(a)&&(d=a[0],e=a.length);c;)if(c-=1,b[c]===d)return b.splice(c,e)},e.replace=function(a,b){for(var c=this.queue,d=a[0],e=0;e<c.length;e+=1)if(c[e]===d){for(var f=0;f<b.length;f+=1)c[e+f]=b[f];return}},e.applyOnQueue=function(a){for(var b,c=this.queue.slice(0),d=0;d<c.length;d+=1)b=c[d],b[a]&&b[a]()},e.submit=function(){this.applyOnQueue("$submit")},e.cancel=function(){this.applyOnQueue("$cancel")},angular.extend(e,h),f.fileupload(angular.extend({scope:function(){return e}},e.options)).on("fileuploadadd",function(a,b){b.scope=e.option("scope")}).on(["fileuploadadd","fileuploadsubmit","fileuploadsend","fileuploaddone","fileuploadfail","fileuploadalways","fileuploadprogress","fileuploadprogressall","fileuploadstart","fileuploadstop","fileuploadchange","fileuploadpaste","fileuploaddrop","fileuploaddragover","fileuploadchunksend","fileuploadchunkdone","fileuploadchunkfail","fileuploadchunkalways","fileuploadprocessstart","fileuploadprocess","fileuploadprocessdone","fileuploadprocessfail","fileuploadprocessalways","fileuploadprocessstop"].join(" "),function(a,b){e.$emit(a.type,b)}).on("remove",function(){var a;for(a in h)h.hasOwnProperty(a)&&delete e[a]}),e.$watch("options",function(a){e.options=_(c).extend(a),f.fileupload("option",e.options)}),g.name&&_.isUndefined(b.get(g.name))&&b.register(e,g.name)}}}])}(this),function(a){a.Application.directive("fnEnter",function(){return function(a,b,c){b.bind("keydown keypress",function(b){13===b.which&&(a.$apply(function(){a.$eval(c.fnEnter)}),b.preventDefault())})}})}(this),function(a){a.Application.directive("fnRightClick",function(){return function(a,b,c){b.bind("contextmenu",function(b){a.$apply(function(){b.preventDefault(),a.$eval(c.fnRightClick)})})}})}(this),function(a){a.Application.directive("hasTooltip",["$parse",function(){return{template:['<div class="hasTooltipIcon" style="display: none;"><span ng-transclude></span></div>'].join(),restrict:"E",transclude:!0,replace:!0,link:function(){}}}])}(this),function(a){a.Application.directive("iframeContent",["directiveRegistry","$window",function(a,b){return{template:"<iframe />",restrict:"A",transclude:!1,scope:{content:"=iframeContent"},link:function(c,d,e){var f=_.throttle(function(){var a=b.innerHeight?b.innerHeight:$(b).height();d.find("iframe").height(a)},250);$(b).on("resize",f),c.$on("$destroy",function(){d.remove(),$(b).off("resize",f)}),c.$watch("content",function(a){var b=d.find("iframe").get(0);if(b&&a){var c=b.contentWindow.document;c.open(),c.write(a),c.write('<link rel="stylesheet" href="css/screen.css" />'),c.write('<style type="text/css">html, body {height: auto;}body {padding: 12px;background-color:transparent;}</style>'),c.close(),f()}}),e.name&&a.register(c,e.name)}}}])}(this),function(a){a.Application.directive("infiniteScroll",[function(){return{restrict:"A",link:function(a,b,c){function d(a,b){var c=this,d=!1;return function(){d||(d=!0,setTimeout(function(){a.apply(c,arguments),d=!1},b))}}var e=b[0].id,f=c.loadMore,g=angular.element("#"+e),h=document.createElement("li");h.setAttribute("class","infinite-load-more-text"),h.setAttribute("style","display: none;"),h.innerHTML=c.loadMoreText||"Loading More...",g[0].appendChild(h),g.scroll(d(function(b){var d=g[0].scrollHeight,e=g[0].scrollTop+g[0].offsetHeight,i=c.disabledLoadMore?JSON.parse(c.disabledLoadMore):!1,j=c.loading?JSON.parse(c.loading):!1;j||h.setAttribute("style","display: none;"),!j&&!i&&e>=d&&(h.setAttribute("style","display: block;"),a.$apply(function(){a.$eval(f)}))},500))}}}])}(this),function(a){a.Application.directive("jqGrid",["garbageCollection","directiveRegistry",function(b,c){return{restrict:"E",transclude:!1,templateUrl:"grid-table-snippet.html",link:function(d,e,f){"true"==f.isInModal&&(d.isInModal=!0),d.gridName=_.uniqueId("gridContainer_"),b.add("#alertmod_"+d.gridName),d.directivesReady=d.directivesReady||[],d.directivesReady.push("jqGrid"),c.register(d,f.name||"jqGrid"),_.defer($.proxy(d.triggerInitialGridLoad,this)),$(a).bind("resize",_.throttle(function(){var a=$(".ui-jqgrid-btable:visible");a&&a.each(function(){var a=$(this).attr("id"),b=$("#gbox_"+a).parent().width();$(this).setGridWidth(b,!0)})},100))}}}])}(this),function(a){a.Application.directive("mobileHeaderHide",function(){return{restrict:"A",link:function(a,b){var c="input:not(:checkbox, :radio), textarea, select",d=function(){return b.find("header.mobile .bar")},e=function(){d().css({position:"absolute"})},f=function(){d().css({position:""})};a.isMobile?b.on("focus",c,e).on("blur",c,f):b.off("focus",c,e).off("blur",c,f)}}})}(this),function(a){a.Application.directive("bsModal",["$parse","$compile","$http","$timeout","garbageCollection","$q","$templateCache","directiveRegistry",function(b,c,d,e,f,g,h,i){return{restrict:"A",scope:!0,link:function(j,k,l){
var m=b(l.bsModal),n=m(j);g.when(h.get(n)||d.get(n,{cache:!0})).then(function(b){j.dismiss=function(){n.modal("hide"),j.$broadcast("modalHide")};var d={};j.show=function(){n.modal("show")},j.onShow=function(){j.$broadcast("modalShow"),l.triggerOnce&&_.isUndefined(d[l.triggerOnce])&&_.isFunction(j[l.triggerOnce])&&(d[l.triggerOnce]=!0,j[l.triggerOnce]()),l.triggerShow&&_.isFunction(j[l.triggerShow])&&j[l.triggerShow]();var a=n.find(".jqgrid");a.length>0&&_.delay(function(){a.grid("resizeGrid")},100)},j.onHide=function(){j.$broadcast("modalHide"),l.triggerHide&&_.isFunction(j[l.triggerHide])&&j[l.triggerHide]()};var g=m(j).replace(/\//g,"-").replace(/\./g,"-").replace("html",j.$id),h=l.bsClass||"",n=a.angular.element('<div class="modal-container"></div>').attr("id",g).addClass("modal hide fade "+h).html(b.data||b);f.add("#"+g),a.angular.element("body").append(n),k.attr("href","?#"+g).attr("data-toggle","modal"),l.parentName&&(j.$parent[l.parentName]={show:j.show,hide:j.hide,scope:j}),l.closeOn&&j.$on(l.closeOn,function(){j.dismiss()}),e(function(){c(n)(j),n.on("show",$.proxy(j.onShow,j)),n.on("hide",$.proxy(j.onHide,j)),i.register(j,l.parentName||g)})})}}}])}(this),function(a){a.Application.directive("multimail",function(){var a=/\S+@\S+\.\S+/i;return{require:"?ngModel",link:function(b,c,d,e){e&&e.$validators.email&&(e.$validators.email=function(b){if(e.$isEmpty(b))return!0;var c=[];b.indexOf(",")>0?c=b.split(","):c.push(b);for(var d=!0,f=0;f<c.length;f++)if(!a.test(c[f])){d=!1;break}return d})}}})}(this),function(a){a.Application.directive("networkLogo",function(){return{restrict:"A",link:function(b,c){var d=a.Config.network_name,e=a.Config.network_logo,f="<p>"+d+"</p>",g="this.outerHTML='"+f+"';";e?c.attr({src:e,alt:d,onerror:g}):c.hide()}}})}(this),function(a){a.Application.directive("panelStates",["$timeout","directiveRegistry",function(a,b){return function(c,d,e){c.panelObj={panelOpen:{},panelElement:{},searchBox:{},hoverState:{},hoverPanel:{},hoverPanelOn:{},setupNamespace:function(a){var b=this;return a=a||"default",_.each(["panelOpen","panelElement","searchBox"],function(c){_.isUndefined(b[c][a])&&(b[c][a]=null)}),a}},c.preventTouchScrolling=function(a){0===$(a.srcElement).parents(".panel-container").length?a.preventDefault():a.stopPropagation()},c.disableMainPage=function(){$("html, body").addClass("scroll-disabled").on("touchstart touchmove",c.preventTouchScrolling)},c.enableMainPage=function(){$("html, body").removeClass("scroll-disabled").off("touchstart touchmove",c.preventTouchScrolling)},c.$parent.toggleHoverPanel=c.toggleHoverPanel=function(b,d,e){return c.isMobile?void c.togglePanel(b,d,e):(e=c.panelObj.setupNamespace(e),c.panelObj.hoverPanelOn[e]=c.panelObj.hoverPanelOn[e]==d?null:d,void(c.panelObj.hoverState[e]&&(a.cancel(c.panelObj.hoverState[e]),c.panelObj.hoverState[e]=null,c.panelObj.hoverPanel[e]=null,c.togglePanel(null,d,e))))},c.$parent.hoverPanel=c.hoverPanel=function(b,d,e){c.isMobile||(e=c.panelObj.setupNamespace(e),c.panelObj.hoverState[e]&&(a.cancel(c.panelObj.hoverState[e]),c.panelObj.hoverState[e]=null,c.panelObj.hoverPanel[e]=null),"mouseenter"==b.type?c.panelObj.panelOpen[e]!=d&&"panel-display"!=d&&(c.panelObj.hoverState[e]=a(function(){c.togglePanel(null,d,e),c.panelObj.hoverState[e]=null,c.panelObj.hoverPanel[e]=null,c.panelObj.hoverPanelOn[e]=null},350)):(null===c.panelObj.hoverPanelOn[e]||c.panelObj.hoverPanelOn[e]!=d&&"panel-display"!=d)&&(c.panelObj.hoverState[e]=a(function(){c.panelObj.hoverPanelOn[e]?c.togglePanel(null,c.panelObj.hoverPanelOn[e],e):c.togglePanel(null,c.panelObj.panelOpen[e],e),c.panelObj.hoverState[e]=null,c.panelObj.hoverPanel[e]=null},350)))},c.$parent.togglePanel=c.togglePanel=function(a,b,d){d=c.panelObj.setupNamespace(d),c.panelObj.panelOpen[d]&&c.panelObj.panelElement[d].hide("fast"),c.isMobile&&_.isObject(a)&&$(a.currentTarget).parents(".taskbar").length>0&&(c.panelObj.panelOpen[d]==b?c.enableMainPage():c.disableMainPage()),c.panelObj.panelOpen[d]==b?c.panelObj.panelOpen[d]=null:(c.panelObj.panelOpen[d]=b,c.panelObj.panelElement[d]=$(".panel."+b),c.panelObj.panelElement[d].slideDown()),_.isFunction(c.togglePanelFn)&&c.togglePanelFn(b,_.isNull(c.panelObj.panelOpen[d],d),d)},c.$parent.cancelPanel=c.cancelPanel=function(a,b){b=c.panelObj.setupNamespace(b),a.preventDefault();var d=c.panelObj.panelOpen[b];d&&c.togglePanel(a,d,b),_.isFunction(c.togglePanelFn)&&c.togglePanelFn(d,!0,b),_.isFunction(c.cancelPanelFn)&&c.cancelPanelFn(d,!0,b)},c.$parent.applyPanel=c.applyPanel=function(a,b){if(b=c.panelObj.setupNamespace(b),a.preventDefault(),c.panelObj.panelOpen[b]){var d=c.panelObj.panelOpen[b];_.isFunction(c.applyPanelFn)&&c.applyPanelFn(d)}c.togglePanel(a,c.panelObj.panelOpen[b],b)},c.$parent.getPanelClass=c.getPanelClass=function(a,b){return b=c.panelObj.setupNamespace(b),c.panelObj.panelOpen[b]==a||c.panelObj.searchBox[b]==a?"on":""},c.directivesReady=c.directivesReady||[],c.directivesReady.push("panelStates"),b.register(c,e.name||"panelStates")}}])}(this),function(a){a.AppModules=a.AppModules||{},a.AppModules.directives=a.AppModules.directives||[],a.Application.directive("shortDatePicker",["directiveRegistry","$translate",function(b,c){return{restrict:"E",templateUrl:"short-date-picker.tpl",replace:!0,link:function(d,e,f){var g=function(a){return a.format("YYYY-MM-DD")},h=function(a){return a.format("MMM Do, YYYY")+" - "+moment().format("MMM Do, YYYY")},i=[{relativeRange:c("adGroups.options.last7days"),startDate:g(moment().subtract(6,"days")),endDate:g(moment()),verboseRange:h(moment().subtract(6,"days"))},{relativeRange:c("adGroups.options.last30days"),startDate:g(moment().subtract(30,"days")),endDate:g(moment()),verboseRange:h(moment().subtract(30,"days"))},{relativeRange:c("adGroups.options.last365days"),startDate:g(moment().subtract(365,"days")),endDate:g(moment()),verboseRange:h(moment().subtract(365,"days"))},{relativeRange:c("adGroups.options.allTime"),startDate:g(moment("20070101","YYYYMMDD")),endDate:g(moment()),verboseRange:h(moment("20070101","YYYYMMDD"))}];d.displayRanges=[],_.each(i,function(a,b){d.displayRanges.push({index:b,range:a.relativeRange})}),d.selectedDateIndex=0,d.setSelectedIndex=function(a){d.selectedDateIndex=a},d.getStartDate=function(){return i[d.selectedDateIndex].startDate},d.getEndDate=function(){return i[d.selectedDateIndex].endDate},d.getSelectedDateRange=function(){return i[d.selectedDateIndex]};var j=!1;d.$watch("selectedDateIndex",function(){var b=d[f.changeFn]||a.angular.noop;return j?(b(),void d.$broadcast("selectedDateChanged")):void(j=!0)}),b.register(d,f.name||"shortDatePicker")}}}])}(this),function(a){a.Application.directive("sparkline",["$rootScope","directiveRegistry","$translate","$timeout",function(b,c,d,e){return{templateUrl:"partials/chartTemplates/sparkline.html",restrict:"E",transclude:!0,"replace ":!0,scope:{items:"=",label:"="},link:function(b,f,g){var h,i,j,k,l,m,n={color:"#444444",fillcolor:"#e9e9e9"};i=f.find(".chart").hide(),m=f.find(".status"),k=f.find(".textlabel"),l={backgroundColor:g.backgroundcolor||"",color:g.color||n.color,fillColor:g.fillcolor||n.fillcolor,loadingText:g.loadingText||d("common.loading").toUpperCase()},j={chart:{margin:[0,0,0,0],plotBackgroundColor:l.backgroundColor,renderTo:i[0],type:"area",reflow:!0},plotOptions:{series:{fillColor:l.fillColor,lineWidth:1.3,shadow:!1,states:{hover:{lineWidth:1.7}},marker:{enabled:!1,states:{hover:{enabled:!1}}}}},xAxis:{lineWidth:0,alternateGridColor:"transparent",gridLineColor:"transparent",labels:{enabled:!1}},yAxis:{lineWidth:0,alternateGridColor:"transparent",gridLineColor:"transparent",labels:{enabled:!1}},legend:{enabled:!1},tooltip:{enabled:!1},series:[{color:l.color,data:b.items}]},void 0!==g.grid&&(j.xAxis.gridLineWidth=1,j.xAxis.gridLineColor="#ededed",j.xAxis.tickPixelInterval=15,j.xAxis.endOnTick=!0,j.xAxis.startOnTick=!0,j.yAxis.gridLineWidth=1,j.yAxis.gridLineColor="#ededed",j.yAxis.tickPixelInterval=15,j.yAxis.endOnTick=!0,j.yAxis.startOnTick=!0);var o=function(){if(b.label&&i.is(":visible")){var a=h.xAxis[0].getExtremes(),c=h.yAxis[0].getExtremes();h.xAxis[0].setExtremes(a.dataMin-a.dataMax/4,a.dataMax),h.yAxis[0].setExtremes(c.dataMin-c.dataMax/8,c.dataMax),k.text(b.label),k.show()}},p=function(){h=new a.Highcharts.Chart(j),b.$watch("label",function(){o()}),b.$watch("items",function(a){if(m.text(l.loadingText),!_.isArray(a))return m.show(),void i.hide();var b=_(a).chain().find(function(a){return 0!==a}).isUndefined().value();0===a.length||b?f.hide():(m.hide(),k.hide(),i.show(),h.series[0].setData(a),o(),h.setSize(i.width(),i.height(),!1),h.hasUserSize=null)},!0)};p(),b.$watch("label",function(){o()}),b.$watch("items",function(b){if(m.text(l.loadingText),!_.isArray(b))return m.show(),void i.hide();var c=_(b).chain().find(function(a){return 0!==a}).isUndefined().value();0===b.length||c?f.hide():(m.hide(),k.hide(),i.show(),h.series[0].setData(b),o(),h.setSize(i.width(),i.height(),!1),e(function(){$(a).resize()}),h.hasUserSize=null)},!0),g.name&&c.register(b,g.name)}}}])}(this),function(a){a.Application.directive("starratings",function(){return{templateUrl:"partials/starratings.html",restrict:"E",transclude:!0,"replace ":!0,scope:{value:"="}}})}(this),function(a){a.Application.directive("stringToNumber",function(){return{require:"ngModel",link:function(a,b,c,d){d.$parsers.push(function(a){return""+a}),d.$formatters.push(function(a){return parseFloat(a)})}}})}(this),function(a){a.Application.directive("txlIcon",["$compile",function(a){return{restrict:"A",link:function(b,c,d){var e='<span class="txl-icon" ng-include="\'img/txl/'+d.txlIcon+".svg'\"></span>",f=angular.element(e);c.append(f),a(f)(b)}}}])}(this),function(a){a.Application.directive("bsTypeahead",["$parse",function(a){return{restrict:"A",require:"?ngModel",link:function(b,c,d,e){var f=a(d.bsTypeahead);c.attr("data-provide","typeahead");var g=c.typeahead({source:f(b),updater:function(a){return e&&b.$apply(function(){e.$setViewValue(a)}),a}});b.$watch(d.bsTypeahead,function(a){g.data("typeahead").source=a})}}}])}(this),function(a){var b="js/vendor/zerocb/ZeroClipboard.swf";a.Application.directive("diZclip",function(){return function(a,c,d){c.zclip({path:b,copy:function(){return d.model?a[d.model]||"":d.copytarg?$("#"+d.copytarg).val():void 0},afterCopy:function(){c.tooltip("show"),_.delay(function(){c.tooltip("hide")},4e3)}}),c.bind("hover",function(){c.zclip("reposition")}),c.tooltip({placement:"right",title:"Copied to Clipboard",trigger:"manual"})}}),a.ZeroClipboard.setMoviePath(b)}(this),function(a){var b=a.angular.module("hasOffers.hasTable",["hasOffers.serviceLayer"]);b.directive("hasTable",function(){return{restrict:"E",controller:"hasTable",templateUrl:"hasTableBase",replace:!0,scope:!0}})}(this),function(a){var b=a.angular.module("hasOffers.hasTable");b.controller("hasTable",["$scope","$element","$attrs","directiveRegistry","$compile","$q","$http","$location","pageState","$templateCache","dataRenderer",function(a,b,c,d,e,f,g,h,i,j,k){var l,m,n,o,p,q,r,s=h.path();if(i.pageSettings({},self.pageStateNamespace),l={},m=function(a,b){f.when(j.get(b)||g.get(b,{cache:!0})).then(function(b){l[a]=b.data||b},function(){throw new Error("template for "+b+" not found in cache or on the server.")})},!c.name)throw new Error("No name specified for table.");c.headerTemplate?m("header",c.headerTemplate):m("header",c.name+"HeaderTemplate.tpl"),c.rowTemplate?m("row",c.rowTemplate):m("row",c.name+"RowTemplate.tpl"),a.$watch(function(){return l.row&&l.header},function(b){b&&d.register(a,c.name)}),c.paging?a.pagingEnabled=a.$eval(c.paging):a.pagingEnabled=!0,c.isTopPagingVisible?a.isTopPagingVisible=a.$eval(c.isTopPagingVisible):a.isTopPagingVisible=!0,a.paging=a.paging||{count:0,page:i.get(s).page||1,pageCount:1,pageSize:i.get(s).limit||50},a.paging.offset=(a.paging.page-1)*a.paging.pageSize,a.sort={field:"",direction:""},a.drawTable=function(d,e){var f=function(a){return _.object([a],[e[a]])},g=function(a){i.set(a,s)};e&&e.limit&&e.page&&_.map(_.map(_.keys(_.pick(e,["limit","page","filters"])),f),g);var h,j,m,p;m=b.find(".hasTableHeaderRow").first().html(l.header);var t=d.data||d;k.renderSingleTemplate(a,m,e);var u=n(m,m.scope());if(h=l.row,j=b.find("tbody").first(),j.html(" "),_.isArray(t)&&!t.length)return a.paging.page=1,a.paging.pageCount=1,a.paging.count=0,a.noData=!0,void(a.tableDataNumRows=0);a.noData=!1,a.tableDataNumRows=t.length||Object.keys(t).length;var v=k.renderTemplateItems(t,a,h,e);p=[],_(v).each(function(a){var b=a.scope();a.find("[data-show]").each(function(a,c){r(c,b)}),o(u,a,b),p.push(a)}),j.append(p),_(p).each(function(b){a.$broadcast("rowRendered",b)}),j.find("> tr").click(q),a.$broadcast("tableRenderComplete",c.name,b),a.pagingEnabled&&(a.paging.count=d.count||d.total_rows,a.paging.page=d.page||a.paging.page,a.currentPage=d.page||a.paging.page,a.paging.pageCount=d.pageCount||Math.ceil(a.paging.count/a.paging.pageSize))},n=function(b,c){var d=null;return $(b).find("> th").each(function(b){var e=$(this);if(!r(e,c)){var f=e.data("sort")?!0:!1;if(f){var g={index:b,sortField:e.data("sort")};e.addClass("sortable");var h="icon-sort";a.sort.field===g.sortField&&(e.addClass("sorted-column"),d=g,a.sort.direction&&(h+="asc"===a.sort.direction?"-up":"-down")),e.append('<i class="{0} table-sort-icon"></i>'.format(h)),e.click(p)}}}),d},p=function(){var b=$(this).data("sort");a.sort.field===b&&(a.sort.direction="desc"===a.sort.direction?"asc":"desc"),a.sort.field=b,a.$broadcast("sortRequested")},q=function(){a.$broadcast("rowClick",angular.element(this).scope())},o=function(a,b){if(a){var c=$(b).find("td")[a.index];$(c).addClass("sorted-column")}},r=function(a,b){a=angular.element(a);var c=a.data("show");return c&&!b.$eval(c)?(a.remove(),!0):!1}}])}(this),function(a){var b=a.angular.module("hasOffers.hasTable");b.directive("hasPager",function(){return{restrict:"E",replace:!0,require:"^hasTable",templateUrl:"hasPager",controller:"hasPagerController"}})}(this),function(a){var b=a.angular.module("hasOffers.hasTable");b.controller("hasPagerController",["$scope",function(a){a.currentPage=Number(a.paging.page)||1,a.gridPageNumOptions=[10,20,50,200],a.gridSetPageSize=function(c){a.paging.pageSize=c,Math.floor(a.paging.count/c)<a.currentPage&&(a.paging.page=1),b()},a.gridPageNext=function(){a.paging.page>=a.paging.pageCount||(a.paging.page=Number(a.paging.page)+1,b())},a.gridPagePrev=function(){a.paging.page<=1||(a.paging.page=Number(a.paging.page)-1,b())},a.updatePageNum=function(){_.isNumber(parseInt(a.currentPage,10))&&a.currentPage<=a.paging.pageCount&&a.currentPage>0?(a.paging.page=a.currentPage,b()):a.currentPage=Number(a.paging.page)||1},a.$watch("paging.page",function(){a.currentPage=Number(a.paging.page)||1});var b=function(){a.paging.offset=(a.paging.page-1)*a.paging.pageSize,a.paging.pageCount=Math.ceil(a.paging.count/a.paging.pageSize),a.$parent.$broadcast("pagingChanged",a.paging),a.$parent.$broadcast("moreItemsRequested",a.paging),a.currentPage=Number(a.paging.page)||1}}])}(this),function(a){var b=a.angular.module("hasOffers.hasTable");b.controller("hasTableMobile",["$scope","$element","$attrs","directiveRegistry","$compile","$q","$http","$templateCache","dataRenderer",function(a,b,c,d,e,f,g,h,i){var j,k;if(j={},k=function(a,b){f.when(h.get(b)||g.get(b,{cache:!0})).then(function(b){j[a]=b.data||b},function(){throw new Error("Template for "+b+" not found in cache or on the server.")})},!c.name)throw new Error("No name specified for table.");a.$watch(function(){return j.main},function(b){if(b){var e=$(b);if(!e.children(".card-header").length)throw new Error("Template for "+c.name+" does not have a .card-header section.");if(!e.children(".card-body").length)throw new Error("Template for "+c.name+" does not have a .card-body section.");d.register(a,c.name)}}),k("main",c.template),a.paging=a.paging||{count:0,page:1,pageCount:1,pageSize:5},a.paging.offset=(a.paging.page-1)*a.paging.pageSize,a.clearItems=function(c){b.find(".mobile-table-data").html(" "),c||(a.paging.page=1)},a.addItems=function(c,d,e){a.clearItems(e);var f=b.find(".mobile-table-data").first(),g=c.data||c;return _.isArray(g)&&!g.length?(a.paging.page=1,a.paging.pageCount=1,a.paging.count=0,void(a.noData=!0)):(a.noData=!1,a.paging.page=c.page||a.paging.page||1,a.currentPage=c.page||a.paging.page||1,a.paging.count=c.count||c.total_rows||c.length||0,a.paging.pageCount=c.pageCount||Math.ceil(a.paging.count/a.paging.pageSize)||1,a.pagingEnabled=_(a.paging.pageCount).isFinite(),void l(f,g,d))},a.requestMoreItems=function(){a.paging.page++,a.$broadcast("moreItemsRequested")};var l=function(b,c,d){var e=i.renderTemplateItems(c,a,j.main,d);b.append(e),_(e).each(function(c){var d=angular.element(c),e=c.scope();d.find("[data-show]").each(function(a,b){n(angular.element(b),e)}),c.data("noToggle")?(b.find(".card-header").addClass("on"),b.find(".card-body").addClass("on")):c.find(".card-header").click(function(){var a=$(this).toggleClass("on"),b=a.siblings(".card-body").toggleClass("on");m(this,b.hasClass("on"))}),a.$broadcast("rowRendered",c)})},m=function(b,c){a.$broadcast("itemExpansion",angular.element(b).scope(),c)},n=function(a,b){var c=a.data("show");b.$eval(c)||a.remove()}}])}(this),function(a){var b=a.angular.module("hasOffers.hasTable");b.directive("hasPagerMobile",function(){return{restrict:"E",replace:!0,require:"^hasTableMobile",templateUrl:"hasPagerMobile",controller:"hasPagerController"}})}(this),function(a){var b=a.angular.module("hasOffers.hasTable");b.directive("mobileTable",function(){return{restrict:"E",controller:"hasTableMobile",templateUrl:"hasTableMobileBase",replace:!0}})}(this);